<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="format-detection" content="telephone=no">
    <!-- Allow embedding in Wix iframes -->
    <meta http-equiv="Content-Security-Policy" content="frame-ancestors 'self' https://*.wix.com https://*.wixsite.com https://editor.wix.com https://manage.wix.com;">
    <base target="_parent">
    <title>BANF Jacksonville - Bengali Association of North Florida</title>
    <!-- Favicon - Multiple formats to prevent 403 errors -->
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAABILAAASCwAAAAAAAAAAAAD/AAAA/wAAAP8AAAD/AQAA/wYAAP8MAAD/EgAA/xIAAP8MAAD/BgAA/wEAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wMAAP8PAAD/IQAA/zQAAP9HAAD/VwAA/1cAAP9HAAD/NAAA/yEAAP8PAAD/AwAA/wAAAP8AAAD/BAAA/xsAAP87AAD/XQAA/4UAAP+sAAD/yAAA/8gAAP+sAAD/hQAA/10AAP87AAD/GwAA/wQAAP8AAAD/EgAA/0UAAP+GAAD/xAAA//UAAP//AAD//wAA//8AAP//AAD/9QAA/8QAAP+GAAD/RQAA/xIAAP8CAAD/JQAA/3cAAP/HAAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA/8cAAP93AAD/JQAA/wIAAP8DAAD/PAAA/6YAAP/0AAD//wAA//8AdQD/AH0A/wB5AP8AdQD//wAA//QAAP+mAAD/PAAA/wMAAP8GAAD/UwAA/8oAAP//AAD//wA7AP8AVQD/AFYA/wBWAP8AVQD/ADsA//8AAP/KAAD/UwAA/wYAAP8IAAD/XwAA/9oAAP//AAD/ADkA/wBYAP8AUgD/AFYA/wBWAP8AUgD/AFgA/wA5AP//AAD/2gAA/18AAP8IAAD/CAAA/18AAP/aAAD//wAALgBSAP8AWAD/AFIA/wBWAP8AVgD/AFIA/wBYAP8AUgAu//8AAP/aAAD/XwAA/wgAAP8GAAD/UwAA/8oAAP//AABSAFUA/wBYAP8AUgD/AFYA/wBWAP8AUgD/AFgA/wBVAFIA/wAA/8oAAP9TAAD/BgAA/wMAAP88AAD/pgAA//QAABUAeQD/AH0A/wBWAP8AVgD/AFYA/wBWAP8AfQD/AHkAFf/0AAD/pgAA/zwAAP8DAAD/AgAA/yUAAP93AAD/xwAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP/HAAD/dwAA/yUAAP8CAAD/AAAA/xIAAP9FAAD/hgAA/8QAAP/1AAD//wAA//8AAP//AAD//wAA//UAAP/EAAD/hgAA/0UAAP8SAAD/AAAA/wQAAP8bAAD/OwAA/10AAP+FAAD/rAAA/8gAAP/IAAD/rAAA/4UAAP9dAAD/OwAA/xsAAP8EAAD/AAAA/wAAAP8DAAD/DwAA/yEAAP80AAD/RwAA/1cAAP9XAAD/RwAA/zQAAP8hAAD/DwAA/wMAAP8AAAD/AAAA/wAAAP8AAAD/AQAA/wYAAP8MAAD/EgAA/xIAAP8MAAD/BgAA/wEAAP8AAAD/AAAA/wAAAP8AAAD/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23ff6b35'/%3E%3Cstop offset='100%25' stop-color='%23006A4E'/%3E%3C/linearGradient%3E%3C/defs%3E%3Ccircle cx='50' cy='50' r='45' fill='url(%23g)'/%3E%3Ctext x='50' y='65' font-family='Arial' font-size='40' font-weight='bold' fill='white' text-anchor='middle'%3EB%3C/text%3E%3C/svg%3E">
    <link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAABILAAASCwAAAAAAAAAAAAD/AAAA/wAAAP8AAAD/AQAA/wYAAP8MAAD/EgAA/xIAAP8MAAD/BgAA/wEAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wMAAP8PAAD/IQAA/zQAAP9HAAD/VwAA/1cAAP9HAAD/NAAA/yEAAP8PAAD/AwAA/wAAAP8AAAD/BAAA/xsAAP87AAD/XQAA/4UAAP+sAAD/yAAA/8gAAP+sAAD/hQAA/10AAP87AAD/GwAA/wQAAP8AAAD/EgAA/0UAAP+GAAD/xAAA//UAAP//AAD//wAA//8AAP//AAD/9QAA/8QAAP+GAAD/RQAA/xIAAP8CAAD/JQAA/3cAAP/HAAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA/8cAAP93AAD/JQAA/wIAAP8DAAD/PAAA/6YAAP/0AAD//wAA//8AdQD/AH0A/wB5AP8AdQD//wAA//QAAP+mAAD/PAAA/wMAAP8GAAD/UwAA/8oAAP//AAD//wA7AP8AVQD/AFYA/wBWAP8AVQD/ADsA//8AAP/KAAD/UwAA/wYAAP8IAAD/XwAA/9oAAP//AAD/ADkA/wBYAP8AUgD/AFYA/wBWAP8AUgD/AFgA/wA5AP//AAD/2gAA/18AAP8IAAD/CAAA/18AAP/aAAD//wAALgBSAP8AWAD/AFIA/wBWAP8AVgD/AFIA/wBYAP8AUgAu//8AAP/aAAD/XwAA/wgAAP8GAAD/UwAA/8oAAP//AABSAFUA/wBYAP8AUgD/AFYA/wBWAP8AUgD/AFgA/wBVAFIA/wAA/8oAAP9TAAD/BgAA/wMAAP88AAD/pgAA//QAABUAeQD/AH0A/wBWAP8AVgD/AFYA/wBWAP8AfQD/AHkAFf/0AAD/pgAA/zwAAP8DAAD/AgAA/yUAAP93AAD/xwAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP/HAAD/dwAA/yUAAP8CAAD/AAAA/xIAAP9FAAD/hgAA/8QAAP/1AAD//wAA//8AAP//AAD//wAA//UAAP/EAAD/hgAA/0UAAP8SAAD/AAAA/wQAAP8bAAD/OwAA/10AAP+FAAD/rAAA/8gAAP/IAAD/rAAA/4UAAP9dAAD/OwAA/xsAAP8EAAD/AAAA/wAAAP8DAAD/DwAA/yEAAP80AAD/RwAA/1cAAP9XAAD/RwAA/zQAAP8hAAD/DwAA/wMAAP8AAAD/AAAA/wAAAP8AAAD/AQAA/wYAAP8MAAD/EgAA/xIAAP8MAAD/BgAA/wEAAP8AAAD/AAAA/wAAAP8AAAD/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=">
    <!-- Google Fonts - using preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* ========== SOURCE PROTECTION ========== */
        body, html {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
        }
        /* Allow selection inside form inputs and textareas */
        input, textarea, select, [contenteditable="true"] {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        /* ========== CSS VARIABLES ========== */
        :root {
            --banf-orange: #ff6b35;
            --banf-yellow: #f7931e;
            --banf-deep-red: #8B0000;
            --banf-green: #006A4E;
            --gold: #D4AF37;
            --navy: #1a1a2e;
            --cream: #FFF8F0;
            --gradient-primary: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            --gradient-hero: linear-gradient(135deg, rgba(139,0,0,0.95) 0%, rgba(255,107,53,0.9) 50%, rgba(247,147,30,0.85) 100%);
            --gradient-green: linear-gradient(135deg, #006A4E 0%, #00856F 100%);
        }

        /* ========== EMBED-SPECIFIC STYLES ========== */
        /* 
         * FIX: For Wix iframe embedding, DO NOT use height:100% on html/body
         * This causes content to be compressed. Instead, let content flow naturally
         * and the iframe should auto-resize OR have internal scrolling.
         */
        html {
            width: 100%;
            min-height: 100%;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            touch-action: pan-y pinch-zoom;
            -webkit-overflow-scrolling: touch;
            /* Let content determine height naturally */
        }
        
        body {
            width: 100%;
            min-height: 100%;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            overflow-y: auto;
            touch-action: pan-y pinch-zoom;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
            /* Content flows naturally - no fixed height constraint */
        }
        
        /* Fix for Wix iframe embedding - make content visible */
        .wix-embed-mode {
            min-height: auto !important;
            /* Let actual content determine height — removes phantom scrollbar space */
        }

/* When embedded in Wix iframe, reduce hero top padding since Wix provides nav */
.wix-embed-mode .hero {
    padding-top: 20px !important;
}

/* On standalone (GitHub Pages), keep standard padding */
@media (max-width: 768px) {
    .wix-embed-mode .hero {
        padding-top: 15px !important;
    }
}
        
        /* Force all sections to be visible (scope to actual layout elements, not scripts/modals) */
        body > section,
        body > nav,
        body > footer,
        body > header {
            position: relative;
            z-index: 1;
        }
        
        /* Ensure footer has no trailing space */
        footer {
            position: relative;
            z-index: 1;
            margin-bottom: 0;
        }
        
        /* Hide modals/overlays from document flow entirely */
        body > .modal,
        body > .member-portal-fullscreen,
        body > .admin-portal-fullscreen {
            position: fixed !important;
        }
        
        /* ========== BASE STYLES ========== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; 
            background: #f8f9fa; 
            color: #495057; 
            line-height: 1.7;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        h1, h2, h3, h4, h5, h6 { 
            font-family: 'Playfair Display', Georgia, serif; 
            font-weight: 600; 
            color: var(--navy); 
        }
        .bengali-text { font-family: 'Hind Siliguri', sans-serif; }
        a { text-decoration: none; transition: all 0.3s ease; }
        img { max-width: 100%; height: auto; }

        /* ========== NAVBAR ========== */
        .navbar {
            background: rgba(26, 26, 46, 0.98);
            backdrop-filter: blur(20px);
            padding: 0.75rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0,0,0,0.15);
        }
        .navbar-brand {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: #fff !important;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .navbar-brand .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        .nav-link {
            color: rgba(255,255,255,0.85) !important;
            font-weight: 500;
            padding: 0.5rem 0.9rem !important;
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.95rem;
        }
        .nav-link:hover {
            color: #fff !important;
            background: rgba(255,255,255,0.1);
        }
        .nav-link i { margin-right: 0.4rem; }
        .btn-nav {
            background: var(--gradient-primary);
            color: #fff !important;
            border: none;
            padding: 0.6rem 1.3rem;
            border-radius: 50px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s;
        }
        .btn-nav:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255,107,53,0.4);
        }
        .navbar-toggler {
            border-color: rgba(255,255,255,0.3);
        }
        .navbar-toggler-icon {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%28255, 255, 255, 0.85%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
        }

        /* ========== HERO SECTION ========== */
        .hero {
            min-height: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            background: var(--gradient-hero);
            padding-top: 60px;
            padding-bottom: 1.5rem;
            overflow: visible;
        }
        .hero::before {
            content: '';
            position: absolute;
            inset: 0;
            background: url('https://images.unsplash.com/photo-1545893835-abaa50cbe628?w=1920&q=80') center/cover no-repeat;
            opacity: 0.12;
        }
        .hero::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(to top, #f8f9fa, transparent);
        }
        .hero-content {
            position: relative;
            z-index: 2;
            text-align: center;
            padding: 0 1rem;
            max-width: 900px;
        }
        .hero h1 {
            font-size: clamp(2.5rem, 6vw, 4.5rem);
            color: #fff;
            margin-bottom: 1rem;
            text-shadow: 2px 4px 20px rgba(0,0,0,0.3);
            line-height: 1.2;
        }
        .hero-subtitle {
            font-size: 1.15rem;
            color: rgba(255,255,255,0.92);
            max-width: 700px;
            margin: 0 auto 0.75rem;
            line-height: 1.7;
        }
        .hero-bengali {
            font-size: 1.7rem;
            color: #E5C158;
            margin-bottom: 0.75rem;
            text-shadow: 1px 2px 10px rgba(0,0,0,0.2);
        }
        .hero-badge {
            display: inline-block;
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.25);
            color: #fff;
            padding: 0.6rem 1.5rem;
            border-radius: 50px;
            font-size: 0.9rem;
            margin-bottom: 0.75rem;
        }
        .hero-badge i { color: var(--gold); }
        .hero-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.75rem;
            margin-top: 0.75rem;
        }
        .btn-primary-custom {
            background: var(--gradient-primary);
            color: #fff;
            border: none;
            padding: 0.9rem 2rem;
            border-radius: 50px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .btn-primary-custom:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255,107,53,0.4);
            color: #fff;
        }
        .btn-outline-custom {
            background: transparent;
            color: #fff;
            border: 2px solid rgba(255,255,255,0.5);
            padding: 0.85rem 2rem;
            border-radius: 50px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .btn-outline-custom:hover {
            background: rgba(255,255,255,0.15);
            border-color: #fff;
            color: #fff;
        }

        /* ========== STATS SECTION ========== */
        .stats-section {
            background: var(--gradient-primary);
            padding: 1rem 0;
            margin-top: -30px;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 3;
        }
        .stat-item {
            text-align: center;
            color: #fff;
            padding: 0.5rem;
        }
        .stat-number {
            font-family: 'Playfair Display', serif;
            font-size: 2.2rem;
            font-weight: 700;
            display: block;
            line-height: 1.2;
        }
        .stat-label {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-top: 0.15rem;
        }

        /* ========== SECTION STYLES ========== */
        section { padding: 2.5rem 0; }
        section.py-5 { padding-top: 2.5rem !important; padding-bottom: 2.5rem !important; }
        section.py-4 { padding-top: 2rem !important; padding-bottom: 2rem !important; }
        .py-5 { padding-top: 2.5rem !important; padding-bottom: 2.5rem !important; }
        .section-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }
        .section-header h2 {
            font-size: 2.2rem;
            margin-bottom: 0.75rem;
            position: relative;
            display: inline-block;
        }
        .section-header h2::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }
        .section-header p {
            color: #6c757d;
            font-size: 1.05rem;
            max-width: 600px;
            margin: 0.75rem auto 0;
        }

        /* ========== QUICK ACCESS BAR ========== */
        .quick-access {
            background: #fff;
            border-radius: 20px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.1);
            padding: 1rem;
            margin-top: 0;
            position: relative;
            z-index: 10;
        }
        .quick-item {
            text-align: center;
            padding: 0.75rem 0.5rem;
            border-radius: 15px;
            transition: all 0.3s;
            text-decoration: none;
            color: var(--navy);
            display: block;
        }
        .quick-item:hover {
            background: #f8f9fa;
            transform: translateY(-5px);
            color: var(--banf-orange);
        }
        .quick-item i {
            font-size: 1.5rem;
            color: var(--banf-orange);
            margin-bottom: 0.4rem;
            display: block;
        }
        .quick-item span {
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* ========== PRESIDENT'S MESSAGE ========== */
        .president-welcome {
            background: #fff;
            border-radius: 25px;
            overflow: hidden;
            box-shadow: 0 15px 50px rgba(0,0,0,0.1);
        }
        .president-header {
            background: linear-gradient(135deg, var(--banf-deep-red) 0%, #a52a2a 100%);
            padding: 1.25rem 1.5rem;
            color: #fff;
        }
        .president-photo {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid rgba(255,255,255,0.3);
            background: linear-gradient(135deg, var(--banf-orange), var(--banf-yellow));
        }
        .president-body {
            padding: 1.5rem 2rem;
            line-height: 1.75;
            color: #2c3e50;
        }
        .president-body p { margin-bottom: 0.75rem; }
        .president-body .lead {
            font-size: 1.2rem;
            color: var(--banf-deep-red);
            font-weight: 600;
        }
        .poem-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #fff3e0 100%);
            padding: 1.5rem;
            border-radius: 15px;
            margin: 1.5rem 0;
            border-left: 5px solid var(--gold);
            font-style: italic;
            color: #5d4037;
        }
        .lang-toggle {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin-top: 1rem;
        }
        .lang-toggle .btn {
            border-radius: 20px;
            padding: 0.4rem 1.2rem;
            font-size: 0.9rem;
        }
        .lang-toggle .btn.active {
            background: rgba(255,255,255,0.3);
        }
        .signature-block {
            text-align: right;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid #dee2e6;
        }

        /* ========== EC TEAM CARDS ========== */
        .ec-section { background: #f0f4f8; }
        .ec-card {
            background: #fff;
            border-radius: 20px;
            padding: 1.25rem 1rem;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            transition: all 0.4s;
            border: 2px solid transparent;
            height: 100%;
        }
        .ec-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.12);
            border-color: var(--banf-orange);
        }
        .ec-avatar-wrapper {
            position: relative;
            width: 110px;
            height: 110px;
            margin: 0 auto 1rem;
        }
        .ec-avatar-img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #f0f0f0;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        .ec-avatar {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--banf-orange), var(--banf-yellow));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: #fff;
            font-weight: 700;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        .ec-position {
            display: inline-block;
            background: var(--gradient-primary);
            color: #fff;
            padding: 0.4rem 1.2rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }
        .ec-card h6 {
            font-size: 1.1rem;
            margin: 0.75rem 0 0.25rem;
            color: var(--navy);
        }
        .ec-short-bio {
            font-size: 0.85rem;
            color: #6c757d;
            margin: 0.5rem 0;
        }
        .ec-contact {
            margin-top: 1rem;
            display: flex;
            justify-content: center;
            gap: 0.75rem;
        }
        .ec-contact a {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
            transition: all 0.3s;
        }
        .ec-contact a:hover {
            background: var(--gradient-primary);
            color: #fff;
        }

        /* ========== SERVICES SECTION (REDESIGNED PORTAL HUB) ========== */
        .services-section { background: linear-gradient(180deg, #fff 0%, #f8f9fa 100%); }
        
        /* Portal Hub Container */
        .portal-hub {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        /* Portal Cards - Main Entry Points */
        .portal-card {
            background: #fff;
            border-radius: 24px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.4s ease;
            border: 3px solid transparent;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
            position: relative;
            overflow: hidden;
        }
        .portal-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--gradient-primary);
        }
        .portal-card.member-portal::before { background: var(--gradient-green); }
        .portal-card.admin-portal::before { background: linear-gradient(135deg, #8B0000, #DC143C); }
        .portal-card.visitor-portal::before { background: linear-gradient(135deg, #673AB7, #9C27B0); }
        
        .portal-card:hover {
            transform: translateY(-12px) scale(1.02);
            box-shadow: 0 25px 60px rgba(0,0,0,0.15);
        }
        
        .portal-icon {
            width: 80px;
            height: 80px;
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 2rem;
            color: #fff;
        }
        .visitor-portal .portal-icon { background: linear-gradient(135deg, #673AB7, #9C27B0); }
        .member-portal .portal-icon { background: var(--gradient-green); }
        .admin-portal .portal-icon { background: linear-gradient(135deg, #8B0000, #DC143C); }
        
        .portal-card h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            color: var(--banf-charcoal);
        }
        .portal-card .portal-subtitle {
            font-size: 0.95rem;
            color: #6c757d;
            margin-bottom: 1.5rem;
        }
        
        .portal-features {
            list-style: none;
            padding: 0;
            margin: 0 0 1.5rem 0;
            text-align: left;
        }
        .portal-features li {
            padding: 0.6rem 0;
            border-bottom: 1px dashed #eee;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.9rem;
        }
        .portal-features li:last-child { border-bottom: none; }
        .portal-features li i {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            background: rgba(0,106,78,0.1);
            color: var(--banf-green);
        }
        
        .portal-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 1rem 2rem;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1rem;
            width: 100%;
            transition: all 0.3s;
            text-decoration: none;
            cursor: pointer;
            border: none;
        }
        .portal-btn.visitor-btn {
            background: linear-gradient(135deg, #673AB7, #9C27B0);
            color: #fff;
        }
        .portal-btn.member-btn {
            background: var(--gradient-green);
            color: #fff;
        }
        .portal-btn.admin-btn {
            background: linear-gradient(135deg, #8B0000, #DC143C);
            color: #fff;
        }
        .portal-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        
        .portal-note {
            font-size: 0.8rem;
            color: #888;
            margin-top: 1rem;
        }
        .portal-note i { color: var(--banf-orange); }
        
        /* Service Cards Grid (for individual services) */
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }
        
        .service-card {
            background: #f8f9fa;
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s;
            height: 100%;
            border: 2px solid transparent;
        }
        .service-card:hover {
            background: #fff;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            border-color: var(--banf-orange);
            transform: translateY(-8px);
        }
        .service-icon {
            width: 70px;
            height: 70px;
            border-radius: 20px;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.25rem;
            font-size: 1.8rem;
            color: #fff;
        }
        .service-card h5 {
            font-size: 1.15rem;
            margin-bottom: 0.75rem;
        }
        .service-card p {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 1rem;
        }
        .service-link {
            color: var(--banf-orange);
            font-weight: 600;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .service-link:hover {
            color: var(--banf-deep-red);
        }
        
        /* Quick Access Bar */
        .quick-access {
            background: linear-gradient(135deg, var(--banf-charcoal), #3d3d3d);
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .quick-access h4 {
            color: #fff;
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }
        .quick-links {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }
        .quick-link {
            background: rgba(255,255,255,0.1);
            color: #fff;
            padding: 0.6rem 1.2rem;
            border-radius: 30px;
            font-size: 0.85rem;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .quick-link:hover {
            background: var(--banf-orange);
            color: #fff;
        }

        /* ========== EVENTS SECTION ========== */
        .event-card {
            background: #fff;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            transition: all 0.3s;
            height: 100%;
        }
        .event-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.12);
        }
        .event-image {
            height: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            color: rgba(255,255,255,0.9);
            position: relative;
        }
        .event-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255,255,255,0.9);
            color: var(--banf-deep-red);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .event-content { padding: 1.5rem; }
        .event-date {
            display: inline-block;
            background: var(--gradient-primary);
            color: #fff;
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        .event-content h4 {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }
        .event-location {
            color: #6c757d;
            font-size: 0.9rem;
        }
        .event-location i {
            color: var(--banf-orange);
            margin-right: 0.5rem;
        }

        /* ========== RADIO SECTION ========== */
        .radio-section {
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: #fff;
            position: relative;
            overflow: hidden;
        }
        .radio-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,107,53,0.05) 0%, transparent 60%);
            animation: radioGlow 8s ease-in-out infinite;
        }
        @keyframes radioGlow {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(5%, 5%); }
        }
        .radio-player {
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.12);
            border-radius: 24px;
            padding: 2rem 2rem 1.5rem;
            max-width: 480px;
            margin: 0 auto;
            text-align: center;
            position: relative;
        }
        /* Radio Image Box — Vinyl Disc */
        .radio-image-box {
            width: 160px;
            height: 160px;
            margin: 0 auto 1.5rem;
            position: relative;
        }
        .radio-vinyl {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle, #222 20%, #111 40%, #333 42%, #111 44%, #333 46%, #111 60%, #222 80%, #111 100%);
            box-shadow: 0 0 30px rgba(255,107,53,0.3), inset 0 0 20px rgba(0,0,0,0.5);
            position: relative;
            animation: none;
        }
        .radio-vinyl.spinning {
            animation: vinylSpin 3s linear infinite;
        }
        @keyframes vinylSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .vinyl-groove {
            position: absolute;
            border-radius: 50%;
            border: 1px solid rgba(255,255,255,0.06);
        }
        .vinyl-groove:nth-child(1) { top: 15%; left: 15%; width: 70%; height: 70%; }
        .vinyl-groove.vinyl-groove-2 { top: 25%; left: 25%; width: 50%; height: 50%; }
        .vinyl-groove.vinyl-groove-3 { top: 35%; left: 35%; width: 30%; height: 30%; }
        .vinyl-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 10px rgba(255,107,53,0.5);
        }
        .vinyl-text {
            font-size: 0.65rem;
            font-weight: 800;
            letter-spacing: 1px;
            color: #fff;
        }
        /* Now Playing */
        .now-playing {
            font-size: 1.15rem;
            margin-bottom: 0.3rem;
            color: rgba(255,255,255,0.95);
            min-height: 1.5em;
        }
        .now-playing-sub {
            font-size: 0.82rem;
            color: rgba(255,255,255,0.5);
            margin-bottom: 1.2rem;
        }
        /* Equalizer Animation */
        .radio-equalizer {
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 3px;
            height: 36px;
            margin-bottom: 1.2rem;
        }
        .eq-bar {
            width: 5px;
            border-radius: 2px 2px 0 0;
            background: var(--gradient-primary);
            height: 6px;
            transition: height 0.1s;
        }
        .radio-equalizer.active .eq-bar {
            animation: eqBounce 0.6s ease-in-out infinite alternate;
        }
        @keyframes eqBounce {
            0% { height: 6px; opacity: 0.5; }
            25% { height: 18px; opacity: 0.75; }
            50% { height: 30px; opacity: 1; }
            75% { height: 14px; opacity: 0.8; }
            100% { height: 36px; opacity: 1; }
        }
        /* Play/Stop Button */
        .radio-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
        }
        .radio-btn {
            border-radius: 50%;
            border: none;
            cursor: pointer;
            color: #fff;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .radio-btn.play-btn {
            width: 72px;
            height: 72px;
            font-size: 1.6rem;
            background: var(--gradient-primary);
            box-shadow: 0 4px 20px rgba(255,107,53,0.35);
        }
        .radio-btn.play-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(255,107,53,0.5);
        }
        .radio-btn.skip-btn {
            width: 44px;
            height: 44px;
            font-size: 1rem;
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(5px);
        }
        .radio-btn.skip-btn:hover {
            background: rgba(255,255,255,0.25);
            transform: scale(1.1);
        }
        /* Schedule Strip */
        .schedule-strip {
            display: flex;
            gap: 6px;
            overflow-x: auto;
            padding: 8px 0;
            margin-top: 12px;
            scrollbar-width: none;
            -ms-overflow-style: none;
            justify-content: center;
            flex-wrap: wrap;
        }
        .schedule-strip::-webkit-scrollbar { display: none; }
        .schedule-chip {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 6px 10px;
            border-radius: 12px;
            background: rgba(255,255,255,0.1);
            cursor: pointer;
            transition: all 0.25s;
            min-width: 48px;
            font-size: 0.75rem;
            color: rgba(255,255,255,0.7);
            border: 1px solid transparent;
        }
        .schedule-chip:hover {
            background: rgba(255,255,255,0.2);
            color: #fff;
        }
        .schedule-chip.active {
            background: var(--gradient-primary);
            color: #fff;
            border-color: rgba(255,255,255,0.3);
            box-shadow: 0 2px 12px rgba(255,107,53,0.4);
        }
        .chip-time {
            font-size: 0.65rem;
            opacity: 0.8;
            margin-top: 2px;
        }
        /* Source Tabs */
        .radio-source-tabs {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-top: 10px;
        }
        .radio-source-tab {
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            background: rgba(255,255,255,0.08);
            color: rgba(255,255,255,0.5);
            border: 1px solid transparent;
            transition: all 0.25s;
        }
        .radio-source-tab:hover {
            background: rgba(255,255,255,0.15);
            color: #fff;
        }
        .radio-source-tab.active {
            background: rgba(255,107,53,0.25);
            color: #FF6B35;
            border-color: rgba(255,107,53,0.4);
        }
        /* Radio Progress Bar */
        .radio-progress {
            width: 100%;
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            margin-top: 12px;
            cursor: pointer;
            display: none;
        }
        .radio-progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 2px;
            width: 0%;
            transition: width 0.3s;
        }
        /* Station info label */
        .radio-station-info {
            font-size: 0.75rem;
            color: rgba(255,255,255,0.4);
            margin-top: 6px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        @media (max-width: 576px) {
            .radio-player { padding: 1.25rem 1rem 1rem; max-width: 100%; }
            .radio-image-box { width: 120px; height: 120px; margin-bottom: 1rem; }
            .vinyl-label { width: 38px; height: 38px; }
            .vinyl-text { font-size: 0.55rem; }
            .now-playing { font-size: 1rem; }
            .radio-btn.play-btn { width: 62px; height: 62px; font-size: 1.3rem; }
            .radio-btn.skip-btn { width: 36px; height: 36px; font-size: 0.85rem; }
            .radio-equalizer { height: 28px; }
            .eq-bar { width: 4px; }
            .schedule-strip { gap: 4px; }
            .schedule-chip { padding: 4px 7px; min-width: 40px; font-size: 0.7rem; }
            .radio-source-tab { padding: 3px 8px; font-size: 0.65rem; }
        }

        /* ========== MEMBERSHIP SECTION ========== */
        .membership-section {
            background: linear-gradient(135deg, var(--banf-deep-red) 0%, #4a0000 100%);
            color: #fff;
        }
        .membership-section .section-header h2 { color: #fff; }
        .membership-section .section-header h2::after {
            background: linear-gradient(135deg, var(--gold), #E5C158);
        }
        .pricing-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 20px;
            overflow: hidden;
            transition: all 0.4s;
            height: 100%;
        }
        .pricing-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }
        .pricing-card.featured {
            background: #fff;
            transform: scale(1.05);
        }
        .pricing-card.featured:hover { transform: scale(1.08); }
        .pricing-header {
            padding: 2rem;
            text-align: center;
            color: #fff;
        }
        .pricing-card.featured .pricing-header {
            background: var(--gradient-primary);
        }
        .pricing-price {
            font-family: 'Playfair Display', serif;
            font-size: 3rem;
            font-weight: 700;
        }
        .pricing-price span {
            font-size: 1rem;
            opacity: 0.8;
        }
        .pricing-body {
            padding: 2rem;
            background: rgba(255,255,255,0.05);
        }
        .pricing-card.featured .pricing-body {
            background: #fff;
            color: var(--navy);
        }
        .pricing-feature {
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .pricing-card.featured .pricing-feature {
            border-color: #eee;
        }
        .pricing-feature i { color: #28a745; }
        .pricing-footer {
            padding: 1.5rem 2rem;
            background: rgba(0,0,0,0.1);
        }
        .pricing-card.featured .pricing-footer {
            background: #f8f9fa;
        }

        /* ========== MEMBERSHIP BENEFITS TABS & EVENT MATRIX ========== */
        .membership-tabs {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 2rem;
        }
        .membership-tab-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.25);
            color: #fff;
            padding: 0.6rem 1.5rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            font-size: 0.9rem;
        }
        .membership-tab-btn:hover {
            background: rgba(255,255,255,0.2);
            border-color: var(--gold);
        }
        .membership-tab-btn.active {
            background: var(--gold);
            color: #1a1a2e;
            border-color: var(--gold);
            font-weight: 700;
        }
        .membership-tab-content { display: none; }
        .membership-tab-content.active { display: block; }

        /* Event Coverage Matrix Table */
        .event-matrix-wrapper {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.15);
        }
        .event-matrix {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.82rem;
            min-width: 700px;
        }
        .event-matrix thead th {
            background: rgba(0,0,0,0.4);
            color: var(--gold);
            padding: 0.7rem 0.5rem;
            text-align: center;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 2;
            white-space: nowrap;
            font-size: 0.75rem;
        }
        .event-matrix thead th:first-child {
            text-align: left;
            min-width: 180px;
            position: sticky;
            left: 0;
            z-index: 3;
            background: rgba(0,0,0,0.5);
        }
        .event-matrix tbody td {
            padding: 0.55rem 0.5rem;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.06);
            color: rgba(255,255,255,0.9);
        }
        .event-matrix tbody td:first-child {
            text-align: left;
            font-weight: 500;
            position: sticky;
            left: 0;
            background: rgba(30,0,0,0.85);
            z-index: 1;
        }
        .event-matrix tbody tr:hover td {
            background: rgba(255,255,255,0.06);
        }
        .event-matrix tbody tr:hover td:first-child {
            background: rgba(60,0,0,0.9);
        }
        .event-matrix .ev-included {
            color: #28a745;
            font-weight: bold;
        }
        .event-matrix .ev-addon {
            color: #ffc107;
            font-size: 0.72rem;
        }
        .event-matrix .ev-na {
            color: rgba(255,255,255,0.2);
        }
        .event-matrix .ev-month {
            font-size: 0.68rem;
            color: rgba(255,255,255,0.45);
            display: block;
        }
        .event-matrix tfoot td {
            background: rgba(0,0,0,0.3);
            color: var(--gold);
            font-weight: 700;
            padding: 0.7rem 0.5rem;
            text-align: center;
            border-top: 2px solid var(--gold);
        }
        .event-matrix tfoot td:first-child {
            text-align: left;
            position: sticky;
            left: 0;
            background: rgba(0,0,0,0.5);
        }

        /* Value Analysis Cards */
        .value-card {
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.12);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s;
        }
        .value-card:hover {
            transform: translateY(-5px);
            border-color: var(--gold);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .value-card.best-value {
            border: 2px solid #28a745;
            background: rgba(40,167,69,0.1);
        }
        .value-multiplier {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: #28a745;
            line-height: 1;
        }
        .value-card.best-value .value-multiplier { color: #28a745; }
        .value-savings {
            font-size: 1.1rem;
            color: var(--gold);
            font-weight: 600;
        }
        .event-cost-bar {
            background: rgba(255,255,255,0.08);
            border-radius: 8px;
            overflow: hidden;
            height: 28px;
            position: relative;
            margin-bottom: 0.5rem;
        }
        .event-cost-bar-fill {
            height: 100%;
            border-radius: 8px;
            display: flex;
            align-items: center;
            padding-left: 8px;
            font-size: 0.72rem;
            font-weight: 600;
            color: #fff;
            white-space: nowrap;
        }
        .event-cost-bar-label {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.72rem;
            color: rgba(255,255,255,0.6);
        }

        @media (max-width: 768px) {
            .membership-tab-btn { padding: 0.5rem 1rem; font-size: 0.8rem; }
            .event-matrix { font-size: 0.75rem; }
            .event-matrix thead th, .event-matrix tbody td { padding: 0.4rem 0.3rem; }
            .value-multiplier { font-size: 2rem; }
        }

        /* ========== JACKSONVILLE GUIDE ========== */
        .guide-section { background: #f0f4f8; }
        .guide-card {
            background: #fff;
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            transition: all 0.3s;
            height: 100%;
        }
        .guide-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.12);
        }
        .guide-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 2rem;
        }
        .guide-card h5 { margin-bottom: 0.5rem; }
        .guide-card p {
            font-size: 0.9rem;
            color: #6c757d;
        }

        /* ========== MAGAZINE SECTION ========== */
        .magazine-section { background: var(--cream); }
        .magazine-preview {
            background: #fff;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 50px rgba(0,0,0,0.1);
        }
        .magazine-cover {
            height: 300px;
            background: linear-gradient(135deg, var(--banf-deep-red), var(--banf-orange));
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 5rem;
        }
        .magazine-info { padding: 2rem; }

        /* ========== CONTACT SECTION ========== */
        .contact-section { background: #f0f4f8; }
        .contact-form {
            background: #fff;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
        }
        .form-group { margin-bottom: 1.5rem; }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--navy);
        }
        .form-control {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        .form-control:focus {
            outline: none;
            border-color: var(--banf-orange);
        }
        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }
        .submit-btn {
            width: 100%;
            background: var(--gradient-primary);
            color: #fff;
            border: none;
            padding: 1rem;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255,107,53,0.4);
        }
        .contact-info-card {
            background: #fff;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
            height: 100%;
        }
        .contact-info-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .contact-info-item i {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: rgba(255,107,53,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--banf-orange);
            flex-shrink: 0;
        }

        /* ========== FOOTER ========== */
        .footer {
            background: linear-gradient(135deg, #1a1a2e, #2d2d44);
            color: #fff;
            padding: 2.5rem 0 1.5rem;
        }
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }
        .footer-section h5 {
            color: var(--gold);
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
        }
        .footer-section p,
        .footer-section a {
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            display: block;
            margin-bottom: 0.75rem;
            transition: color 0.3s;
        }
        .footer-section a:hover { color: var(--gold); }
        .social-links {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        .social-link {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            transition: all 0.3s;
            text-decoration: none;
        }
        .social-link:hover {
            background: var(--gradient-primary);
            transform: translateY(-3px);
            color: #fff;
        }
        .footer-bottom {
            border-top: 1px solid rgba(255,255,255,0.1);
            padding-top: 2rem;
            text-align: center;
            opacity: 0.8;
        }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 992px) {
            .president-header { text-align: center; }
            .president-header .d-flex { justify-content: center !important; }
            .quick-access { margin-top: -40px; padding: 1.5rem; }
        }
        @media (max-width: 768px) {
            .hero h1 { font-size: 2.2rem; }
            .hero-bengali { font-size: 1.4rem; }
            .hero { padding: 56px 1rem 1.5rem 1rem; }
            .hero-subtitle { font-size: 1rem; }
            .hero-buttons { flex-direction: column; gap: 0.5rem; }
            .hero-buttons .btn-primary-custom,
            .hero-buttons .btn-outline-custom { width: 100%; justify-content: center; }
            .stat-number { font-size: 2.5rem; }
            .president-body { padding: 1.5rem; }
            .president-header .d-flex { flex-direction: column; text-align: center; }
            .pricing-card.featured { transform: scale(1); }
            .pricing-card.featured:hover { transform: scale(1); }
            section { padding: 2rem 0; }
            section.py-5, .py-5 { padding-top: 1.5rem !important; padding-bottom: 1.5rem !important; }
            .section-header { margin-bottom: 1rem; }
            .section-header h2 { font-size: 1.8rem; }
            /* Quick Access Bar — horizontal scroll on mobile */
            .quick-access .row { flex-wrap: nowrap; overflow-x: auto; -webkit-overflow-scrolling: touch; scroll-snap-type: x mandatory; padding-bottom: 0.5rem; }
            .quick-access .row > .col { flex: 0 0 auto; width: 80px; scroll-snap-align: start; }
            .quick-access .quick-item span { font-size: 0.65rem; }
            /* Sponsorship tiers — full-width stack */
            .pricing-card { margin-bottom: 1rem; }
            /* Touch targets — minimum 44px */
            .btn, .admin-nav-item, .portal-nav-item, .quick-item, a.btn { min-height: 44px; }
        }

        /* ========== SMALL MOBILE (≤480px) — Sidebar drawer mode ========== */
        @media (max-width: 480px) {
            .hero h1 { font-size: 1.6rem; }
            .hero-badge { font-size: 0.75rem; padding: 0.35rem 0.8rem; }
            .hero-bengali { font-size: 1.1rem; }
            .stat-number { font-size: 2rem; }
            .stat-label { font-size: 0.7rem; }
            section { padding: 1.5rem 0; }
            section.py-5, .py-5 { padding-top: 1rem !important; padding-bottom: 1rem !important; }
            .section-header { margin-bottom: 0.75rem; }
            .section-header h2 { font-size: 1.4rem; }
            .section-header p { font-size: 0.85rem; }
            .ec-card h6 { font-size: 0.8rem; }
            .ec-card .ec-short-bio { display: none; }
        }

        /* ===== iPhone SE / very small phones (375px and below) ===== */
        @media (max-width: 375px) {
            /* Hero — tighter fit */
            .hero { min-height: auto; padding: 52px 0.5rem 1.5rem 0.5rem; }
            .hero h1 { font-size: 1.35rem; line-height: 1.3; }
            .hero-subtitle { font-size: 0.8rem; line-height: 1.4; padding: 0 0.25rem; }
            .hero-bengali { font-size: 0.95rem; }
            .hero-badge { font-size: 0.7rem; padding: 0.3rem 0.6rem; }
            .hero-buttons { flex-direction: column; gap: 0.5rem; }
            .hero-buttons a { width: 100%; text-align: center; font-size: 0.85rem; padding: 0.6rem 1rem; }

            /* Navigation — compact */
            .navbar-brand { font-size: 1rem; }
            .navbar-brand .logo-icon { font-size: 1.1rem; width: 28px; height: 28px; }
            .nav-link { font-size: 0.8rem; padding: 0.4rem 0.5rem !important; }

            /* Section headers */
            .section-header h2 { font-size: 1.2rem; }
            .section-header p { font-size: 0.8rem; }

            /* Stats — single column */
            .stats-grid { grid-template-columns: repeat(2, 1fr); gap: 0.5rem; }
            .stat-number { font-size: 1.6rem; }
            .stat-label { font-size: 0.65rem; }

            /* EC team grid — single column on tiny screens */
            .ec-team-grid { grid-template-columns: 1fr !important; gap: 0.75rem; }
            .ec-card { padding: 0.75rem; }
            .ec-card .ec-photo { width: 60px; height: 60px; }
            .ec-card h6 { font-size: 0.75rem; }
            .ec-card .ec-role { font-size: 0.65rem; }

            /* Buttons — full width, proper touch targets */
            .btn, .btn-primary-custom, .btn-outline-custom {
                min-height: 44px;
                font-size: 0.8rem;
                padding: 0.5rem 0.75rem;
                width: 100%;
            }

            /* Cards & containers — reduce padding */
            .card, .feature-card, .service-card { padding: 0.75rem; }
            .container { padding-left: 0.75rem; padding-right: 0.75rem; }

            /* Tables — compact text */
            table th, table td { font-size: 0.7rem; padding: 0.35rem 0.4rem; }

            /* Member portal — tighter spacing */
            .portal-content-area { padding: 0.5rem !important; }
            .portal-page-header h2 { font-size: 1.1rem; }

            /* Admin portal — tighter spacing */
            .admin-main-content { padding: 0.5rem !important; }
            .admin-section-header h3 { font-size: 1rem; }

            /* Quick access bar — smaller icons */
            .quick-item { min-width: 60px; font-size: 0.65rem; padding: 0.4rem; }
            .quick-item i { font-size: 1rem; }

            /* Modals — ensure full screen */
            .modal-dialog { margin: 0 !important; }
            .modal-header h5 { font-size: 1rem; }
            .modal-body { padding: 0.75rem; font-size: 0.85rem; }

            /* Careers section */
            .career-card { padding: 0.75rem; }
            .career-card h6 { font-size: 0.85rem; }

            /* DB Explorer — compact */
            .db-explorer-controls { flex-direction: column; gap: 0.5rem; }
            .db-explorer-controls input,
            .db-explorer-controls select { width: 100%; font-size: 0.8rem; }

            /* Form inputs — prevent zoom on iOS */
            input, select, textarea { font-size: 16px !important; }
        }
    </style>
</head>
<body oncontextmenu="return false;">
    <!-- ========== NAVIGATION ========== -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="#">
                <span class="logo-icon"><i class="fas fa-om"></i></span>
                BANF
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav align-items-center">
                    <li class="nav-item"><a class="nav-link" href="#about"><i class="fas fa-info-circle"></i>About</a></li>
                    <li class="nav-item"><a class="nav-link" href="#ec-team"><i class="fas fa-users"></i>Leadership</a></li>
                    <li class="nav-item"><a class="nav-link" href="#services"><i class="fas fa-th-large"></i>Services</a></li>
                    <li class="nav-item"><a class="nav-link" href="#careers-guidance"><i class="fas fa-briefcase"></i>Careers</a></li>
                    <li class="nav-item"><a class="nav-link" href="#events"><i class="fas fa-calendar-alt"></i>Events</a></li>
                    <li class="nav-item"><a class="nav-link" href="#radio"><i class="fas fa-broadcast-tower"></i>Radio</a></li>
                    <li class="nav-item"><a class="nav-link" href="#membership"><i class="fas fa-id-card"></i>Membership</a></li>
                    <li class="nav-item"><a class="nav-link" href="#contact"><i class="fas fa-envelope"></i>Contact</a></li>
                    <li class="nav-item ms-2">
                        <a class="btn-nav" href="#membership"><i class="fas fa-user-plus me-2"></i>Join Now</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- ========== HERO SECTION ========== -->
    <section class="hero">
        <div class="hero-content">
            <div class="hero-badge">
                <i class="fas fa-star me-2"></i>Since 2008 — 17 Years of Heritage
            </div>
            <p class="hero-bengali bengali-text">স্বাগতম | আমাদের পরিবারে আপনাকে স্বাগত</p>
            <h1>Bengali Association of<br>North Florida</h1>
            <p class="hero-subtitle">
                Preserving Bengali culture, traditions, and heritage in Jacksonville, Florida — 
                Building bridges between generations through community, celebration, and service.
            </p>
            <div class="hero-buttons">
                <a href="#membership" class="btn-primary-custom" data-action="join" title="Navigate to membership page">
                    <i class="fas fa-user-plus"></i>Become a Member
                </a>
                <a href="#events" class="btn-outline-custom" data-action="events" title="View all events">
                    <i class="fas fa-calendar-alt"></i>Upcoming Events
                </a>
            </div>
        </div>
    </section>

    <!-- ========== STATS SECTION ========== -->
    <section class="stats-section">
        <div class="container">
            <div class="row">
                <div class="col-6 col-md-3">
                    <div class="stat-item">
                        <span class="stat-number">80+</span>
                        <span class="stat-label">Active Families</span>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="stat-item">
                        <span class="stat-number">10+</span>
                        <span class="stat-label">Events Yearly</span>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="stat-item">
                        <span class="stat-number">17</span>
                        <span class="stat-label">Years Strong</span>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="stat-item">
                        <span class="stat-number">45+</span>
                        <span class="stat-label">Sponsors</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ========== QUICK ACCESS BAR ========== -->
    <div class="container">
        <div class="quick-access">
            <div class="row row-cols-4 row-cols-md-6 row-cols-lg-12 g-2 justify-content-center">
                <div class="col">
                    <a href="#membership" class="quick-item" data-action="join" title="members.jsw → registerMember()">
                        <i class="fas fa-credit-card"></i>
                        <span>Pay Dues</span>
                    </a>
                </div>
                <div class="col">
                    <a href="#events" class="quick-item" data-action="events" title="events.jsw → getUpcomingEvents()">
                        <i class="fas fa-calendar-check"></i>
                        <span>Events</span>
                    </a>
                </div>
                <div class="col">
                    <a href="#radio" class="quick-item" data-action="radio" title="radio.jsw → getRadioStationConfig()">
                        <i class="fas fa-broadcast-tower"></i>
                        <span>Radio</span>
                    </a>
                </div>
                <div class="col">
                    <a href="#magazine" class="quick-item" data-action="magazine" title="magazine.jsw → getPublishedMagazines()" onclick="scrollToSection('magazine'); return false;">
                        <i class="fas fa-book-open"></i>
                        <span>Magazine</span>
                    </a>
                </div>
                <div class="col">
                    <a href="#guide" class="quick-item" data-action="guide" title="guide.jsw → getGuideByCategory()" onclick="scrollToSection('guide'); return false;">
                        <i class="fas fa-map-marked-alt"></i>
                        <span>Jax Guide</span>
                    </a>
                </div>
                <div class="col">
                    <a href="#surveys" class="quick-item" data-action="surveys" title="Members only — Login required" onclick="openSurveyModal(); return false;">
                        <i class="fas fa-poll"></i>
                        <span>Surveys <i class="fas fa-lock ms-1 small"></i></span>
                    </a>
                </div>
                <div class="col">
                    <a href="#complaints" class="quick-item" data-action="complaints" title="Members only — Login required" onclick="openComplaintForm(); return false;">
                        <i class="fas fa-shield-alt"></i>
                        <span>Complaints <i class="fas fa-lock ms-1 small"></i></span>
                    </a>
                </div>
                <div class="col">
                    <a href="#sponsors" class="quick-item" data-action="sponsors" title="sponsorship.jsw → getSponsors()" onclick="scrollToSection('sponsors'); return false;">
                        <i class="fas fa-handshake"></i>
                        <span>Sponsors</span>
                    </a>
                </div>
                <div class="col">
                    <a href="#contact" class="quick-item">
                        <i class="fas fa-comments"></i>
                        <span>Contact</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== PRESIDENT'S MESSAGE ========== -->
    <section id="about" class="py-5" style="background: #f8f9fa;">
        <div class="container">
            <div class="section-header">
                <h2 class="bengali-text">সভাপতির বার্তা</h2>
                <p>President's Welcome Message</p>
            </div>
            <div class="row justify-content-center">
                <div class="col-lg-10">
                    <div class="president-welcome">
                        <div class="president-header">
                            <div class="d-flex align-items-center justify-content-center flex-wrap gap-3">
                                <div class="ec-avatar-wrapper" style="width: 90px; height: 90px;">
                                    <img src="https://static.wixstatic.com/media/c62f94_d6f7e8a5b3c14f4f8a7f9e0d1c2b3a4d~mv2.jpg/v1/fill/w_180,h_180,al_c,q_80/rana.jpg" alt="Dr. Ranadhir Ghosh" style="width:100%;height:100%;border-radius:50%;object-fit:cover;border:3px solid white;" onerror="this.style.display='none';this.nextElementSibling.style.display='flex';">
                                    <div class="ec-avatar" style="width: 100%; height: 100%; font-size: 1.8rem; display:none;">RG</div>
                                </div>
                                <div class="text-start text-md-start text-center">
                                    <h4 class="mb-1"><i class="fas fa-crown me-2"></i>Dr. Ranadhir Ghosh</h4>
                                    <p class="mb-0 opacity-90">President, BANF 2025-26</p>
                                </div>
                            </div>
                            <div class="lang-toggle">
                                <button type="button" class="btn btn-light btn-sm active" onclick="toggleLanguage('bengali')" id="btn-bengali">
                                    <i class="fas fa-language me-1"></i>বাংলা
                                </button>
                                <button type="button" class="btn btn-outline-light btn-sm" onclick="toggleLanguage('english')" id="btn-english">
                                    <i class="fas fa-globe me-1"></i>English
                                </button>
                            </div>
                        </div>
                        
                        <!-- Bengali Message -->
                        <div class="president-body bengali-text" id="message-bengali">
                            <p class="lead">প্রিয় BANF পরিবার,</p>
                            
                            <p>BANF শুধু একটি সংগঠন নয়—এটি আমাদের সবার স্বপ্ন, পরিশ্রম ও সাংস্কৃতিক বন্ধনের প্রতিফলন। আমরা প্রত্যেকে ভিন্ন ভিন্ন জায়গা থেকে এসেছি—কেউ নতুন, কেউ বহু বছর ধরে এখানে আছেন। কিন্তু আমাদের সংযুক্ত করেছে একটাই জিনিস—বাংলা ভাষা, সংস্কৃতি আর আমাদের ঐতিহ্যের প্রতি ভালোবাসা।</p>
                            
                            <div class="alert" style="background: linear-gradient(135deg, #e8f5e8, #f0f8f0); border-left: 5px solid #28a745; border-radius: 10px; padding: 20px; margin: 25px 0;">
                                <p class="mb-0 fw-bold" style="color: #155724;">
                                    <i class="fas fa-quote-left me-2"></i>
                                    আমাদের মূল বিশ্বাস—BANF-এর সদস্যদের মধ্যে সংযোগ, সমন্বয় এবং সহমর্মিতা বজায় রাখা ও বৃদ্ধি করা।
                                    <i class="fas fa-quote-right ms-2"></i>
                                </p>
                            </div>
                            
                            <p>গত বছরগুলোতে BANF অনেক পথ পেরিয়ে এসেছে। আমরা একসাথে দুর্গাপূজা, কালীপূজা, সরস্বতী পূজা উদযাপন করেছি, পিকনিকে আনন্দ ভাগ করে নিয়েছি, সাংস্কৃতিক অনুষ্ঠানে আমাদের শিল্পকলা প্রদর্শন করেছি। এই সব কিছুই সম্ভব হয়েছে আপনাদের সক্রিয় অংশগ্রহণের জন্য।</p>
                            
                            <p>এই বছর আমাদের লক্ষ্য হলো BANF-কে আরও অংশগ্রহণমূলক, স্বচ্ছ এবং সদস্য-কেন্দ্রিক সংগঠন হিসেবে গড়ে তোলা। আমরা চাই প্রতিটি সদস্য নিজেকে এই পরিবারের অংশ মনে করুক এবং তাদের মতামত, পরামর্শ ও সমালোচনা যেন আমাদের কাছে সহজে পৌঁছাতে পারে।</p>
                            
                            <div class="poem-section">
                                <p class="mb-2">তব চরণ নিম্নে উৎসবময়ী শ্যামধরনী সরসা</p>
                                <p class="mb-2">ঊর্ধ্বে চাহো অগণিত মণি রঞ্জিত নভঃ নীলাঞ্চলা,</p>
                                <p class="mb-0">সৌম্য মধুর দিব্যাঙ্গনা শান্ত-কুশল-দরশা॥</p>
                            </div>
                            
                            <p>আসুন, একসাথে BANF-কে আরও সমৃদ্ধ করি। আপনাদের সহযোগিতা ও ভালোবাসা আমাদের পথ চলার সবচেয়ে বড় অনুপ্রেরণা।</p>
                            
                            <div class="signature-block">
                                <p class="mb-1 fw-bold" style="color: #2c3e50;">শুভেচ্ছান্তে,</p>
                                <p class="mb-1 fw-bold" style="color: var(--banf-deep-red);">— ডঃ রণধীর ঘোষ</p>
                                <p class="mb-0 text-muted">সভাপতি, BANF 2025-26</p>
                            </div>
                        </div>
                        
                        <!-- English Message -->
                        <div class="president-body" id="message-english" style="display: none;">
                            <p class="lead">Dear BANF Family,</p>
                            
                            <p>BANF is not just an organization—it is a reflection of all our dreams, hard work, and cultural bonds. Each of us has come from different places—some are new, some have been here for many years. But one thing connects us all—our love for the Bengali language, culture, and heritage.</p>
                            
                            <div class="alert" style="background: linear-gradient(135deg, #e8f5e8, #f0f8f0); border-left: 5px solid #28a745; border-radius: 10px; padding: 20px; margin: 25px 0;">
                                <p class="mb-0 fw-bold" style="color: #155724;">
                                    <i class="fas fa-quote-left me-2"></i>
                                    Our core belief—to maintain and strengthen the connection, coordination, and compassion among BANF members.
                                    <i class="fas fa-quote-right ms-2"></i>
                                </p>
                            </div>
                            
                            <p>Over the years, BANF has come a long way. Together we have celebrated Durga Puja, Kali Puja, Saraswati Puja, shared joy at picnics, and showcased our artistry at cultural events. All of this has been possible because of your active participation.</p>
                            
                            <p>This year, our goal is to make BANF more participatory, transparent, and member-centric. We want every member to feel they are part of this family, and their opinions, suggestions, and feedback can easily reach us.</p>
                            
                            <div class="poem-section">
                                <p class="mb-2"><em>At your feet lies the festive, verdant, flowing Earth,</em></p>
                                <p class="mb-2"><em>Above, gaze upon the countless jewel-adorned blue sky,</em></p>
                                <p class="mb-0"><em>The gentle, sweet divine maiden, bestowing peace and welfare.</em></p>
                            </div>
                            
                            <p>Come, let us enrich BANF together. Your cooperation and love are our greatest inspiration on this journey.</p>
                            
                            <div class="signature-block">
                                <p class="mb-1 fw-bold" style="color: #2c3e50;">With warm regards,</p>
                                <p class="mb-1 fw-bold" style="color: var(--banf-deep-red);">— Dr. Ranadhir Ghosh</p>
                                <p class="mb-0 text-muted">President, BANF 2025-26</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ========== EC TEAM SECTION ========== -->
    <section class="ec-section" id="ec-team">
        <div class="container">
            <div class="section-header">
                <h2>Executive Committee</h2>
                <p>2025-26 Leadership Team — Dedicated to serving our community</p>
            </div>
            <!-- Feature 4: Dynamically populated from EC_MEMBERS data array -->
            <div class="row g-4" id="ec-team-grid">
                <!-- Rendered by renderECTeam() on page load -->
            </div>
        </div>
    </section>

    <!-- ========== SERVICES SECTION - PORTAL HUB ========== -->
    <section class="services-section" id="services">
        <div class="container">
            <div class="section-header">
                <h2>Service Portals</h2>
                <p>Access comprehensive digital services for the Bengali community in Jacksonville</p>
            </div>
            
            <!-- Quick Access Bar -->
            <div class="quick-access">
                <h4><i class="fas fa-bolt me-2"></i>Quick Access</h4>
                <div class="quick-links">
                    <a href="#radio" class="quick-link"><i class="fas fa-broadcast-tower"></i> BANF Radio</a>
                    <a href="#events" class="quick-link"><i class="fas fa-calendar"></i> Events</a>
                    <a href="#surveys" class="quick-link" onclick="openSurveySection(); return false;"><i class="fas fa-poll"></i> Surveys</a>
                    <a href="#complaints" class="quick-link" onclick="openComplaintForm(); return false;"><i class="fas fa-shield-alt"></i> Complaints</a>
                    <a href="#guide" class="quick-link" onclick="scrollToSection('guide'); return false;"><i class="fas fa-map-marked-alt"></i> Jax Guide</a>
                    <a href="#magazine" class="quick-link" onclick="scrollToSection('magazine'); return false;"><i class="fas fa-book-open"></i> E-Magazine</a>
                    <a href="#sponsors" class="quick-link" onclick="scrollToSection('sponsors'); return false;"><i class="fas fa-handshake"></i> Sponsors</a>
                </div>
            </div>
            
            <!-- Portal Hub - Two Main Entry Points -->
            <div class="portal-hub">
                <!-- Member Portal (Login Required) -->
                <div class="portal-card member-portal" id="memberPortalCard">
                    <div class="portal-icon"><i class="fas fa-user-circle"></i></div>
                    <h3>Member Portal</h3>
                    <p class="portal-subtitle">Exclusive member services & features</p>
                    
                    <ul class="portal-features">
                        <li><i class="fas fa-tachometer-alt"></i> Personal Dashboard</li>
                        <li><i class="fas fa-id-card"></i> Profile & Family Management</li>
                        <li><i class="fas fa-credit-card"></i> Payments & Receipts</li>
                        <li><i class="fas fa-file-alt"></i> Meeting Minutes Access</li>
                        <li><i class="fas fa-calendar-check"></i> Event Registration & Check-in</li>
                        <li><i class="fas fa-wallet"></i> View Budget Reports</li>
                        <li><i class="fas fa-poll-h"></i> Member-only Surveys</li>
                        <li><i class="fas fa-music"></i> Request Songs on Radio</li>
                        <li><i class="fas fa-pen-fancy"></i> Submit Magazine Content</li>
                        <li><i class="fas fa-address-book"></i> Member Directory</li>
                    </ul>
                    
                    <a href="#" onclick="openMemberPortal('login'); return false;" class="portal-btn member-btn" style="text-decoration: none; display: inline-block;">
                        <i class="fas fa-sign-in-alt"></i> Member Login
                    </a>
                    <p class="portal-note"><i class="fas fa-lock me-1"></i>Login required • <a href="#membership" style="color: var(--banf-orange);">Register Now</a></p>
                </div>
                
                <!-- Admin Portal (EC Login Required) -->
                <div class="portal-card admin-portal">
                    <div class="portal-icon"><i class="fas fa-user-shield"></i></div>
                    <h3>Admin Portal</h3>
                    <p class="portal-subtitle">EC Management Dashboard</p>
                    
                    <ul class="portal-features">
                        <li><i class="fas fa-users-cog"></i> Member Management & Approvals</li>
                        <li><i class="fas fa-money-check-alt"></i> Payment Verification</li>
                        <li><i class="fas fa-calendar-plus"></i> Event & Meeting Management</li>
                        <li><i class="fas fa-broadcast-tower"></i> Radio Station Control</li>
                        <li><i class="fas fa-chart-bar"></i> Survey Administration</li>
                        <li><i class="fas fa-exclamation-triangle"></i> Complaint Resolution</li>
                        <li><i class="fas fa-piggy-bank"></i> Budget & Finance</li>
                        <li><i class="fas fa-store"></i> Vendor & Sponsor Management</li>
                        <li><i class="fas fa-hands-helping"></i> Volunteer Coordination</li>
                        <li><i class="fas fa-newspaper"></i> Magazine Administration</li>
                    </ul>
                    
                    <a href="#" onclick="openAdminLoginModal(); return false;" class="portal-btn admin-btn" style="text-decoration: none; display: inline-block;">
                        <i class="fas fa-user-lock"></i> Admin Login
                    </a>
                    <p class="portal-note"><i class="fas fa-key me-1"></i>EC Members Only</p>
                </div>
            </div>
            
            <!-- Individual Services Grid -->
            <div class="section-header" style="margin-top: 1.5rem;">
                <h3 style="font-size: 1.5rem;">All Services</h3>
                <p>Detailed access to all BANF digital services</p>
            </div>
            
            <div class="services-grid">
                <!-- Membership Portal -->
                <div class="service-card" id="memberPortalServiceCard">
                    <div class="service-icon"><i class="fas fa-id-card"></i></div>
                    <h5>Membership Portal</h5>
                    <p>Register, renew membership, manage family profiles, view payment history and download receipts.</p>
                    <a href="#membership" class="service-link" data-action="join">
                        Join Now <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
                
                <!-- Event Management -->
                <div class="service-card">
                    <div class="service-icon" style="background: var(--gradient-green);"><i class="fas fa-calendar-alt"></i></div>
                    <h5>Events & Programs</h5>
                    <p>Browse upcoming/past events, register online, pay fees, submit feedback, and check-in at venues.</p>
                    <a href="#events" class="service-link" data-action="events">
                        View Events <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
                
                <!-- Community Radio -->
                <div class="service-card">
                    <div class="service-icon" style="background: linear-gradient(135deg, #673AB7, #9C27B0);"><i class="fas fa-broadcast-tower"></i></div>
                    <h5>BANF Radio 24/7</h5>
                    <p>Listen to Bengali music, view schedule, browse song library, and request your favorite songs.</p>
                    <a href="#radio" class="service-link" data-action="radio">
                        Listen Live <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
                
                <!-- E-Magazine -->
                <div class="service-card">
                    <div class="service-icon" style="background: linear-gradient(135deg, #E91E63, #FF5722);"><i class="fas fa-book-open"></i></div>
                    <h5>E-Magazine</h5>
                    <p>Browse issues, read articles by category, search content, and submit your own literary works.</p>
                    <a href="#magazine" class="service-link" data-action="magazine" onclick="scrollToSection('magazine'); return false;">
                        Read Now <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
                
                <!-- Jacksonville Guide -->
                <div class="service-card">
                    <div class="service-icon" style="background: linear-gradient(135deg, #00BCD4, #009688);"><i class="fas fa-map-marked-alt"></i></div>
                    <h5>Jacksonville Guide</h5>
                    <p>Find Bengali restaurants, grocery stores, doctors, schools. Read reviews and submit new listings.</p>
                    <a href="#guide" class="service-link" data-action="guide" onclick="scrollToSection('guide'); return false;">
                        Explore Guide <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
                
                <!-- Surveys -->
                <div class="service-card">
                    <div class="service-icon" style="background: linear-gradient(135deg, #FF9800, #FFC107);"><i class="fas fa-poll"></i></div>
                    <h5>Community Surveys</h5>
                    <p>Participate in community polls and surveys. Members only — login to share your voice.</p>
                    <a href="#surveys" class="service-link" data-action="surveys" onclick="openSurveyModal(); return false;">
                        Take Survey <i class="fas fa-lock ms-1"></i>
                    </a>
                </div>
                
                <!-- Complaints -->
                <div class="service-card">
                    <div class="service-icon" style="background: linear-gradient(135deg, #607D8B, #455A64);"><i class="fas fa-shield-alt"></i></div>
                    <h5>Complaints</h5>
                    <p>Submit complaints securely as a member. Track status with access codes and add follow-ups.</p>
                    <a href="#complaints" class="service-link" data-action="complaints" onclick="openComplaintForm(); return false;">
                        Submit Complaint <i class="fas fa-lock ms-1"></i>
                    </a>
                </div>
                
                <!-- Meeting Minutes -->
                <div class="service-card">
                    <div class="service-icon" style="background: linear-gradient(135deg, #795548, #8D6E63);"><i class="fas fa-file-alt"></i></div>
                    <h5>Meeting Minutes</h5>
                    <p>Members can access meeting summaries, decisions, and action items from EC meetings.</p>
                    <a href="#" class="service-link" data-action="login" onclick="openMemberLoginModal(); return false;" title="Members only - Login required">
                        View Minutes <i class="fas fa-lock ms-1"></i>
                    </a>
                </div>
                
                <!-- Sponsorship -->
                <div class="service-card">
                    <div class="service-icon" style="background: linear-gradient(135deg, #D4AF37, #FFD700);"><i class="fas fa-handshake"></i></div>
                    <h5>Become a Sponsor</h5>
                    <p>Support BANF as a Platinum, Gold, Silver, or Bronze sponsor. Magazine ads & food sponsorships.</p>
                    <a href="#sponsors" class="service-link" data-action="sponsors" onclick="scrollToSection('sponsors'); return false;">
                        Learn More <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- ========== CAREERS & PROFESSIONAL NETWORK SECTION ========== -->
    <section id="careers-guidance" class="py-5" style="background: linear-gradient(180deg, #f8f9fa 0%, #fff 100%);">
        <div class="container">
            <div class="section-header">
                <h2>🎯 Careers & Professional Network</h2>
                <p>Connect with fellow BANF members for career guidance, mentorship, and professional networking</p>
            </div>

            <!-- Search & Filter Bar -->
            <div class="row mb-4 g-2">
                <div class="col-md-6">
                    <input type="text" class="form-control" placeholder="Search by name, skill, or industry..." id="careerSearch" oninput="renderCareerCards()">
                </div>
                <div class="col-md-3">
                    <select class="form-select" id="industryFilter" onchange="renderCareerCards()">
                        <option value="">All Industries</option>
                        <option>Technology</option>
                        <option>Healthcare</option>
                        <option>Finance</option>
                        <option>Education</option>
                        <option>Engineering</option>
                        <option>Legal</option>
                        <option>Business</option>
                        <option>Arts & Media</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select class="form-select" id="guidanceFilter" onchange="renderCareerCards()">
                        <option value="">All Guidance Types</option>
                        <option>Career Mentorship</option>
                        <option>Resume Review</option>
                        <option>Interview Prep</option>
                        <option>Networking</option>
                        <option>Industry Insights</option>
                    </select>
                </div>
            </div>

            <!-- Member Cards Grid -->
            <div class="row g-4" id="careerCardGrid">
                <!-- Dynamically populated by renderCareerCards() -->
            </div>

            <div class="text-center mt-4">
                <p class="text-muted"><i class="fas fa-lock me-1"></i>Logged-in members can create their own career profile from the Member Portal.</p>
            </div>
        </div>
    </section>

    <!-- ========== EVENTS SECTION ========== -->
    <section class="py-5" id="events" style="background: #f8f9fa;">
        <div class="container">
            <div class="section-header">
                <h2>2026 Event Calendar</h2>
                <p>Join us for cultural celebrations and community gatherings</p>
            </div>
            <div class="row g-4">
                <!-- Saraswati Puja - COMPLETED -->
                <div class="col-md-4 col-lg-3">
                    <div class="event-card" onclick="openEventDetails('Saraswati Puja', 'Feb 2, 2026', 'Basant Panchami • Temple', 'Food: Polao, Alu Fulkopi, Goat Curry')" style="cursor: pointer;">
                        <div class="event-image" style="background: linear-gradient(135deg, #ffc107, #ff9800);">
                            📚
                            <span class="event-badge" style="background: #28a745;">✓ Completed</span>
                        </div>
                        <div class="event-content">
                            <span class="event-date"><i class="fas fa-calendar me-1"></i>Feb 2, 2026</span>
                            <h4>Saraswati Puja</h4>
                            <p class="event-location"><i class="fas fa-map-marker-alt"></i>Basant Panchami • Temple</p>
                            <p class="small text-muted">Food: Polao, Alu Fulkopi, Goat Curry</p>
                        </div>
                    </div>
                </div>

                <!-- Bosonto Utsob - COMPLETED -->
                <div class="col-md-4 col-lg-3">
                    <div class="event-card" onclick="openEventDetails('Bosonto Utsob', 'Mar 7, 2026', 'Spring Festival', 'Holi celebration & cultural program')" style="cursor: pointer;">
                        <div class="event-image" style="background: linear-gradient(135deg, #E91E63, #FF69B4);">
                            🌸
                            <span class="event-badge" style="background: #28a745;">✓ Completed</span>
                        </div>
                        <div class="event-content">
                            <span class="event-date"><i class="fas fa-calendar me-1"></i>Mar 7, 2026</span>
                            <h4>Bosonto Utsob</h4>
                            <p class="event-location"><i class="fas fa-map-marker-alt"></i>Spring Festival</p>
                            <p class="small text-muted">Holi celebration & cultural program</p>
                        </div>
                    </div>
                </div>

                <!-- Nabo Borsho / Pohela Boishakh -->
                <div class="col-md-4 col-lg-3">
                    <div class="event-card" onclick="openEventDetails('Nabo Borsho 1433', 'April 25, 2026', 'Bengali New Year', 'Pohela Boishakh celebration')" style="cursor: pointer;">
                        <div class="event-image" style="background: linear-gradient(135deg, #E91E63, #FF5722);">
                            🎉
                            <span class="event-badge">Coming Soon</span>
                        </div>
                        <div class="event-content">
                            <span class="event-date"><i class="fas fa-calendar me-1"></i>April 25, 2026</span>
                            <h4>Nabo Borsho 1433</h4>
                            <p class="event-location"><i class="fas fa-map-marker-alt"></i>Bengali New Year</p>
                            <p class="small text-muted">Pohela Boishakh celebration</p>
                        </div>
                    </div>
                </div>

                <!-- Summer Camp -->
                <div class="col-md-4 col-lg-3">
                    <div class="event-card" onclick="openEventDetails('Summer Camp', 'June 2026', 'Youth Programs', 'Kids & youth activities')" style="cursor: pointer;">
                        <div class="event-image" style="background: linear-gradient(135deg, #4CAF50, #8BC34A);">
                            🏕️
                        </div>
                        <div class="event-content">
                            <span class="event-date"><i class="fas fa-calendar me-1"></i>June 2026</span>
                            <h4>Summer Camp</h4>
                            <p class="event-location"><i class="fas fa-map-marker-alt"></i>Youth Programs</p>
                            <p class="small text-muted">Kids & youth activities</p>
                        </div>
                    </div>
                </div>

                <!-- Spandan Cultural Night -->
                <div class="col-md-4 col-lg-3">
                    <div class="event-card" onclick="openEventDetails('Spandan Cultural', 'August 7, 2026', 'Music, Dance & Drama', 'Theme: Sargam')" style="cursor: pointer;">
                        <div class="event-image" style="background: linear-gradient(135deg, #006A4E, #00856F);">
                            🎭
                            <span class="event-badge">Title: Sargam</span>
                        </div>
                        <div class="event-content">
                            <span class="event-date"><i class="fas fa-calendar me-1"></i>August 7, 2026</span>
                            <h4>Spandan Cultural</h4>
                            <p class="event-location"><i class="fas fa-map-marker-alt"></i>Music, Dance & Drama</p>
                            <p class="small text-muted">Theme: Sargam</p>
                        </div>
                    </div>
                </div>

                <!-- Mahalaya -->
                <div class="col-md-4 col-lg-3">
                    <div class="event-card" onclick="openEventDetails('Mahalaya', 'October 17, 2026', 'Dawn Program', 'Puja inauguration')" style="cursor: pointer;">
                        <div class="event-image" style="background: linear-gradient(135deg, #FFA500, #FF6347);">
                            🌅
                        </div>
                        <div class="event-content">
                            <span class="event-date"><i class="fas fa-calendar me-1"></i>October 17, 2026</span>
                            <h4>Mahalaya</h4>
                            <p class="event-location"><i class="fas fa-map-marker-alt"></i>Dawn Program</p>
                            <p class="small text-muted">Puja inauguration</p>
                        </div>
                    </div>
                </div>

                <!-- Durga Puja -->
                <div class="col-md-4 col-lg-3">
                    <div class="event-card" onclick="openEventDetails('Durga Puja 2026', 'October 2026', '230+ Attendees', '5-day puja celebration')" style="cursor: pointer;">
                        <div class="event-image" style="background: linear-gradient(135deg, #8B0000, #A52A2A);">
                            🕉️
                            <span class="event-badge">Flagship Event</span>
                        </div>
                        <div class="event-content">
                            <span class="event-date"><i class="fas fa-calendar me-1"></i>October 2026</span>
                            <h4>Durga Puja 2026</h4>
                            <p class="event-location"><i class="fas fa-map-marker-alt"></i>230+ Attendees</p>
                            <p class="small text-muted">5-day puja celebration</p>
                        </div>
                    </div>
                </div>

                <!-- Kali Puja -->
                <div class="col-md-4 col-lg-3">
                    <div class="event-card" onclick="openEventDetails('Kali Puja & Diwali', 'November 7, 2026', 'Festival of Lights', 'Lakshmi Puja & fireworks')" style="cursor: pointer;">
                        <div class="event-image" style="background: linear-gradient(135deg, #1a1a2e, #4a148c);">
                            🪔
                        </div>
                        <div class="event-content">
                            <span class="event-date"><i class="fas fa-calendar me-1"></i>November 7, 2026</span>
                            <h4>Kali Puja & Diwali</h4>
                            <p class="event-location"><i class="fas fa-map-marker-alt"></i>Festival of Lights</p>
                            <p class="small text-muted">Lakshmi Puja & fireworks</p>
                        </div>
                    </div>
                </div>

                <!-- Saraswati Puja 2027 -->
                <div class="col-md-4 col-lg-3">
                    <div class="event-card" onclick="openEventDetails('Saraswati Puja 2027', 'January 25, 2027', '+ Winter Picnic', 'Basant Panchami celebration')" style="cursor: pointer;">
                        <div class="event-image" style="background: linear-gradient(135deg, #ffc107, #ff9800);">
                            📚
                        </div>
                        <div class="event-content">
                            <span class="event-date"><i class="fas fa-calendar me-1"></i>January 25, 2027</span>
                            <h4>Saraswati Puja 2027</h4>
                            <p class="event-location"><i class="fas fa-map-marker-alt"></i>+ Winter Picnic</p>
                            <p class="small text-muted">Basant Panchami celebration</p>
                        </div>
                    </div>
                </div>

                <!-- GBM -->
                <div class="col-md-4 col-lg-3">
                    <div class="event-card" onclick="openEventDetails('GBM & Budget Review', 'February 2027', 'Annual Meeting', 'FY 2026-27 Closing')" style="cursor: pointer;">
                        <div class="event-image" style="background: linear-gradient(135deg, #607D8B, #78909C);">
                            📋
                        </div>
                        <div class="event-content">
                            <span class="event-date"><i class="fas fa-calendar me-1"></i>February 2027</span>
                            <h4>GBM & Budget Review</h4>
                            <p class="event-location"><i class="fas fa-map-marker-alt"></i>Annual Meeting</p>
                            <p class="small text-muted">FY 2026-27 Closing</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="text-center mt-4">
                <a href="#" class="btn-primary-custom" onclick="if(window.parent){window.parent.postMessage({type:'NAVIGATE',target:'/events'},'*');}">
                    <i class="fas fa-calendar-alt me-2"></i>View Full Calendar
                </a>
                <a href="#" class="btn-outline-custom ms-2" onclick="openEventDetails('BANF 2026 Event Calendar', '2026', 'Jacksonville', 'Explore upcoming events and click any event card for details.'); return false;">
                    <i class="fas fa-info-circle me-2"></i>Event Details
                </a>
            </div>
        </div>
    </section>

    <!-- ========== RADIO SECTION ========== -->
    <section class="radio-section" id="radio">
        <div class="container">
            <div class="section-header">
                <h2 style="color: #fff;">BANF Radio</h2>
                <p style="color: rgba(255,255,255,0.8);">24/7 Bengali & English Music</p>
            </div>
            <div class="radio-player">
                <!-- Radio Image Box -->
                <div class="radio-image-box">
                    <div class="radio-vinyl">
                        <div class="vinyl-groove"></div>
                        <div class="vinyl-groove vinyl-groove-2"></div>
                        <div class="vinyl-groove vinyl-groove-3"></div>
                        <div class="vinyl-label">
                            <span class="vinyl-text">BANF</span>
                        </div>
                    </div>
                </div>
                <!-- Now Playing (program name from auto-schedule) -->
                <h3 class="now-playing bengali-text" id="nowPlaying">
                    🎵 Bengali Music — Click play to start
                </h3>
                <div class="now-playing-sub" id="nowPlayingSub">Rabindra Sangeet • Folk • Modern Bengali • Classical</div>
                <!-- Equalizer Visualization -->
                <div class="radio-equalizer" id="radioEqualizer">
                    <div class="eq-bar" style="animation-delay: 0s;"></div>
                    <div class="eq-bar" style="animation-delay: 0.15s;"></div>
                    <div class="eq-bar" style="animation-delay: 0.3s;"></div>
                    <div class="eq-bar" style="animation-delay: 0.45s;"></div>
                    <div class="eq-bar" style="animation-delay: 0.6s;"></div>
                    <div class="eq-bar" style="animation-delay: 0.2s;"></div>
                    <div class="eq-bar" style="animation-delay: 0.5s;"></div>
                    <div class="eq-bar" style="animation-delay: 0.1s;"></div>
                    <div class="eq-bar" style="animation-delay: 0.35s;"></div>
                </div>
                <!-- Play / Skip Controls -->
                <div class="radio-controls">
                    <button class="radio-btn skip-btn" title="Previous Station" onclick="skipStation(-1)">
                        <i class="fas fa-backward"></i>
                    </button>
                    <button class="radio-btn play-btn" title="Play/Stop" onclick="toggleRadio()">
                        <i class="fas fa-play" id="radioPlayIcon"></i>
                    </button>
                    <button class="radio-btn skip-btn" title="Next Station" onclick="skipStation(1)">
                        <i class="fas fa-forward"></i>
                    </button>
                </div>
                <!-- Station Info -->
                <div class="radio-station-info" id="radioSourceLabel">LIVE RADIO</div>
                <!-- Progress Bar (visible for archive tracks) -->
                <div class="radio-progress" id="radioProgress" onclick="seekRadio(event)"><div class="radio-progress-fill" id="radioProgressFill"></div></div>
                <!-- Program Schedule Strip -->
                <div class="schedule-strip" id="scheduleStrip"></div>
                <!-- Source Tabs -->
                <div class="radio-source-tabs">
                    <div class="radio-source-tab active" data-source="live" onclick="switchRadioSource('live')">📻 Live</div>
                    <div class="radio-source-tab" data-source="archive" onclick="switchRadioSource('archive')">📚 Archive</div>
                    <div class="radio-source-tab" data-source="youtube" onclick="switchRadioSource('youtube')">▶️ YouTube</div>
                    <div class="radio-source-tab" data-source="spotify" onclick="switchRadioSource('spotify')">🎧 Spotify</div>
                </div>
            </div>
        </div>
    </section>

    <!-- ========== JACKSONVILLE GUIDE ========== -->
    <section class="guide-section" id="guide">
        <div class="container">
            <div class="section-header">
                <h2>Jacksonville Newcomer Guide</h2>
                <p>Your comprehensive guide to Bengali-friendly resources in Jacksonville</p>
            </div>
            <div class="row g-4">
                <div class="col-md-3 col-6">
                    <div class="guide-card">
                        <div class="guide-icon" style="background: linear-gradient(135deg, #FF5722, #FF9800); color: #fff;">
                            <i class="fas fa-utensils"></i>
                        </div>
                        <h5>Restaurants</h5>
                        <p>Indian & Bengali cuisine spots</p>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="guide-card">
                        <div class="guide-icon" style="background: linear-gradient(135deg, #4CAF50, #8BC34A); color: #fff;">
                            <i class="fas fa-shopping-basket"></i>
                        </div>
                        <h5>Grocery Stores</h5>
                        <p>Indian grocery & spices</p>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="guide-card">
                        <div class="guide-icon" style="background: linear-gradient(135deg, #2196F3, #03A9F4); color: #fff;">
                            <i class="fas fa-user-md"></i>
                        </div>
                        <h5>Healthcare</h5>
                        <p>Doctors & specialists</p>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="guide-card">
                        <div class="guide-icon" style="background: linear-gradient(135deg, #9C27B0, #E91E63); color: #fff;">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <h5>Schools</h5>
                        <p>Education resources</p>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="guide-card">
                        <div class="guide-icon" style="background: linear-gradient(135deg, #607D8B, #78909C); color: #fff;">
                            <i class="fas fa-home"></i>
                        </div>
                        <h5>Housing</h5>
                        <p>Apartments & realtors</p>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="guide-card">
                        <div class="guide-icon" style="background: linear-gradient(135deg, #795548, #8D6E63); color: #fff;">
                            <i class="fas fa-briefcase"></i>
                        </div>
                        <h5>Services</h5>
                        <p>Legal, financial & more</p>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="guide-card">
                        <div class="guide-icon" style="background: linear-gradient(135deg, #00BCD4, #009688); color: #fff;">
                            <i class="fas fa-store"></i>
                        </div>
                        <h5>Bengali-Owned</h5>
                        <p>Support our community</p>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="guide-card">
                        <div class="guide-icon" style="background: linear-gradient(135deg, #D4AF37, #FFC107); color: #fff;">
                            <i class="fas fa-star"></i>
                        </div>
                        <h5>Featured</h5>
                        <p>Top recommendations</p>
                    </div>
                </div>
            </div>
            <div class="text-center mt-4">
                <a href="#" class="btn-primary-custom">
                    <i class="fas fa-map-marked-alt me-2"></i>Explore Full Guide
                </a>
                <a href="#" class="btn-outline-custom ms-2" style="border-color: var(--banf-orange); color: var(--banf-orange);">
                    <i class="fas fa-plus me-2"></i>Submit a Listing
                </a>
            </div>
        </div>
    </section>

    <!-- ========== SURVEYS & FEEDBACK SECTION ========== -->
    <section class="py-5" id="surveys" style="background: #fff;">
        <div class="container">
            <div class="section-header">
                <h2>Community Voice</h2>
                <p>Share your feedback and help shape our community</p>
            </div>
            <div class="row g-4 justify-content-center">
                <div class="col-md-5">
                    <div class="service-card" style="border: 2px solid rgba(255,152,0,0.3);">
                        <div class="service-icon" style="background: linear-gradient(135deg, #FF9800, #FFC107);"><i class="fas fa-poll"></i></div>
                        <h5>Active Surveys</h5>
                        <p>Participate in community polls and surveys. Your input helps us plan better events and services.</p>
                        <ul class="list-unstyled text-start mt-3 mb-3" style="font-size: 0.9rem;">
                            <li><i class="fas fa-check-circle text-success me-2"></i>Anonymous participation available</li>
                            <li><i class="fas fa-check-circle text-success me-2"></i>Member-only surveys for detailed feedback</li>
                            <li><i class="fas fa-check-circle text-success me-2"></i>View results (when enabled)</li>
                        </ul>
                        <a href="#" class="btn-primary-custom btn-sm" onclick="openSurveyModal(); return false;">
                            <i class="fas fa-clipboard-list me-2"></i>Take Survey
                        </a>
                    </div>
                </div>
                <div class="col-md-5" id="complaints">
                    <div class="service-card" style="border: 2px solid rgba(96,125,139,0.3);">
                        <div class="service-icon" style="background: linear-gradient(135deg, #607D8B, #455A64);"><i class="fas fa-shield-alt"></i></div>
                        <h5>Anonymous Complaints</h5>
                        <p>File confidential complaints or concerns. Your identity is fully protected.</p>
                        <ul class="list-unstyled text-start mt-3 mb-3" style="font-size: 0.9rem;">
                            <li><i class="fas fa-lock text-primary me-2"></i>100% anonymous submissions</li>
                            <li><i class="fas fa-key text-primary me-2"></i>Track status with access code</li>
                            <li><i class="fas fa-comments text-primary me-2"></i>Add follow-up messages</li>
                        </ul>
                        <a href="#" class="btn-primary-custom btn-sm" style="background: linear-gradient(135deg, #607D8B, #455A64);" onclick="openComplaintForm(); return false;">
                            <i class="fas fa-paper-plane me-2"></i>Submit Complaint
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ========== E-MAGAZINE SECTION ========== -->
    <section class="py-5" id="magazine" style="background: var(--cream);">
        <div class="container">
            <div class="section-header">
                <h2 class="bengali-text">📚 Jagriti E-Magazine</h2>
                <p>Community literary works — Articles, poems, stories & recipes</p>
            </div>
            <div class="row g-4 align-items-center">
                <div class="col-lg-6">
                    <div class="magazine-preview">
                        <div class="magazine-cover">
                            <i class="fas fa-book-reader"></i>
                        </div>
                        <div class="magazine-info">
                            <span class="badge bg-danger mb-2">Latest Issue</span>
                            <h4>Durga Puja 2025 Special Edition</h4>
                            <p class="text-muted">Featuring articles on Bengali traditions, community stories, and Puja memories.</p>
                            <div class="d-flex gap-2 flex-wrap">
                                <a href="#" class="btn-primary-custom btn-sm"><i class="fas fa-book-open me-1"></i>Read Now</a>
                                <a href="#" class="btn-outline-custom btn-sm" style="border-color: var(--banf-orange); color: var(--banf-orange);"><i class="fas fa-archive me-1"></i>Past Issues</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <h4 class="mb-3"><i class="fas fa-feather-alt me-2" style="color: var(--banf-orange);"></i>Content Categories</h4>
                    <div class="row g-3">
                        <div class="col-6">
                            <div class="p-3 bg-white rounded-3 shadow-sm text-center">
                                <i class="fas fa-pen-fancy fa-2x mb-2" style="color: var(--banf-deep-red);"></i>
                                <h6 class="mb-0">Articles</h6>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-3 bg-white rounded-3 shadow-sm text-center">
                                <i class="fas fa-feather fa-2x mb-2" style="color: #9C27B0;"></i>
                                <h6 class="mb-0">Poems</h6>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-3 bg-white rounded-3 shadow-sm text-center">
                                <i class="fas fa-book fa-2x mb-2" style="color: #2196F3;"></i>
                                <h6 class="mb-0">Stories</h6>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-3 bg-white rounded-3 shadow-sm text-center">
                                <i class="fas fa-utensils fa-2x mb-2" style="color: #FF5722;"></i>
                                <h6 class="mb-0">Recipes</h6>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 p-3 rounded-3" style="background: linear-gradient(135deg, rgba(255,107,53,0.1), rgba(247,147,30,0.1)); border: 1px dashed var(--banf-orange);">
                        <h5 class="mb-2"><i class="fas fa-pencil-alt me-2"></i>Contribute Your Work</h5>
                        <p class="mb-2 small text-muted">Members can submit articles, poems, and stories for publication.</p>
                        <a href="#" onclick="openMagazineSubmit(); return false;" class="btn btn-sm" style="background: var(--gradient-primary); color: #fff;"><i class="fas fa-paper-plane me-1"></i>Submit Article <i class="fas fa-lock ms-1 small"></i></a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ========== SPONSORSHIP TIERS SECTION (PROPOSED) ========== -->
    <section class="py-5" id="sponsors" style="background: linear-gradient(135deg, #1a1a2e, #2d2d44); color: #fff;">
        <div class="container">
            <div class="section-header">
                <h2 style="color: #fff;">Sponsorship Opportunities</h2>
                <p style="color: rgba(255,255,255,0.8);">FY 2026-27 Season • Support Our Community</p>
            </div>
            
            <!-- Sponsorship Tiers Overview -->
            <div class="row justify-content-center mb-5">
                <div class="col-lg-10">
                    <div class="p-4 rounded-4 text-center" style="background: rgba(255,255,255,0.05); border: 2px solid var(--gold);">
                        <h4 style="color: var(--gold);"><i class="fas fa-gem me-2"></i>Partner With BANF</h4>
                        <p class="text-white-50 mb-0">Support cultural preservation and community building in Northeast Florida</p>
                    </div>
                </div>
            </div>
            
            <!-- Title Sponsor -->
            <div class="row justify-content-center mb-4">
                <div class="col-lg-8">
                    <div class="p-4 rounded-4 text-center" style="background: linear-gradient(135deg, #FFD700, #FFA500); color: #1a1a2e;">
                        <h4 class="mb-2"><i class="fas fa-trophy me-2"></i>Title Sponsor - $3,000</h4>
                        <p class="mb-3"><strong>Event Naming Rights + All Platinum Benefits</strong></p>
                        <div class="row g-2 justify-content-center text-start" style="font-size: 0.9rem;">
                            <div class="col-md-6">
                                <i class="fas fa-check me-2"></i>Name your sponsored event (e.g., "[Your Brand] Spandan")<br>
                                <i class="fas fa-check me-2"></i>All Platinum-level benefits included<br>
                                <i class="fas fa-check me-2"></i>8 complimentary passes
                            </div>
                            <div class="col-md-6">
                                <i class="fas fa-check me-2"></i>Prime speaking opportunity at event<br>
                                <i class="fas fa-check me-2"></i>Exclusive branding on all event materials<br>
                                <i class="fas fa-check me-2"></i>Homepage banner + Monthly social media
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Tier Cards Row -->
            <div class="row g-4 justify-content-center mb-5">
                <!-- Platinum -->
                <div class="col-lg-3 col-md-6">
                    <div class="h-100 p-4 rounded-4 text-center" style="background: linear-gradient(135deg, rgba(255,215,0,0.15), rgba(255,165,0,0.15)); border: 2px solid #FFD700;">
                        <div class="mb-3" style="color: #FFD700;">
                            <i class="fas fa-crown fa-3x"></i>
                        </div>
                        <h5 style="color: #FFD700;">Platinum</h5>
                        <div class="display-6 mb-2" style="color: #fff;">$5,000<small style="font-size: 0.4em;">/year</small></div>
                        <ul class="list-unstyled text-start small" style="color: rgba(255,255,255,0.85);">
                            <li><i class="fas fa-check text-success me-2"></i>8 complimentary passes</li>
                            <li><i class="fas fa-check text-success me-2"></i>Homepage banner all year</li>
                            <li><i class="fas fa-check text-success me-2"></i>Banner at ALL events</li>
                            <li><i class="fas fa-check text-success me-2"></i>Prime booth location</li>
                            <li><i class="fas fa-check text-success me-2"></i>Monthly social media</li>
                            <li><i class="fas fa-check text-success me-2"></i>Logo on all marketing</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Gold -->
                <div class="col-lg-3 col-md-6">
                    <div class="h-100 p-4 rounded-4 text-center" style="background: rgba(192,192,192,0.1); border: 2px solid #C0C0C0;">
                        <div class="mb-3" style="color: #C0C0C0;">
                            <i class="fas fa-medal fa-3x"></i>
                        </div>
                        <h5 style="color: #C0C0C0;">Gold</h5>
                        <div class="display-6 mb-2" style="color: #fff;">$2,000<small style="font-size: 0.4em;">/year</small></div>
                        <ul class="list-unstyled text-start small" style="color: rgba(255,255,255,0.85);">
                            <li><i class="fas fa-check text-success me-2"></i>4 complimentary passes</li>
                            <li><i class="fas fa-check text-success me-2"></i>Standard booth space</li>
                            <li><i class="fas fa-check text-success me-2"></i>Durga Puja + 2 events</li>
                            <li><i class="fas fa-check text-success me-2"></i>Quarterly social media</li>
                            <li><i class="fas fa-check text-success me-2"></i>Logo on event programs</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Silver -->
                <div class="col-lg-3 col-md-6">
                    <div class="h-100 p-4 rounded-4 text-center" style="background: rgba(205,127,50,0.1); border: 2px solid #CD7F32;">
                        <div class="mb-3" style="color: #CD7F32;">
                            <i class="fas fa-award fa-3x"></i>
                        </div>
                        <h5 style="color: #CD7F32;">Silver</h5>
                        <div class="display-6 mb-2" style="color: #fff;">$1,000<small style="font-size: 0.4em;">/year</small></div>
                        <ul class="list-unstyled text-start small" style="color: rgba(255,255,255,0.85);">
                            <li><i class="fas fa-check text-success me-2"></i>2 complimentary passes</li>
                            <li><i class="fas fa-check text-success me-2"></i>Banner at Durga Puja</li>
                            <li><i class="fas fa-check text-success me-2"></i>Logo on materials</li>
                            <li><i class="fas fa-check text-success me-2"></i>Annual newsletter feature</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Bronze -->
                <div class="col-lg-3 col-md-6">
                    <div class="h-100 p-4 rounded-4 text-center" style="background: rgba(128,128,128,0.1); border: 2px solid #6c757d;">
                        <div class="mb-3" style="color: #6c757d;">
                            <i class="fas fa-handshake fa-3x"></i>
                        </div>
                        <h5 style="color: #adb5bd;">Bronze</h5>
                        <div class="display-6 mb-2" style="color: #fff;">$500<small style="font-size: 0.4em;">/year</small></div>
                        <ul class="list-unstyled text-start small" style="color: rgba(255,255,255,0.85);">
                            <li><i class="fas fa-check text-success me-2"></i>1 complimentary pass</li>
                            <li><i class="fas fa-check text-success me-2"></i>Certificate of appreciation</li>
                            <li><i class="fas fa-check text-success me-2"></i>Name on sponsor board</li>
                            <li><i class="fas fa-check text-success me-2"></i>Logo in event program</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Call to Action -->
            <div class="row justify-content-center">
                <div class="col-lg-8 text-center">
                    <div class="p-4 rounded-3" style="background: rgba(255,255,255,0.05); border: 1px dashed rgba(255,255,255,0.3);">
                        <h5 style="color: #fff;"><i class="fas fa-star me-2" style="color: var(--gold);"></i>Ready to Partner With Us?</h5>
                        <p class="text-white-50 mb-3">Contact us to discuss sponsorship opportunities for FY 2026-27</p>
                        <a href="mailto:sponsors@jaxbengali.org" class="btn-primary-custom me-2">
                            <i class="fas fa-envelope me-2"></i>Contact for Sponsorship
                        </a>
                        <a href="#contact" class="btn-outline-custom" style="border-color: var(--gold); color: var(--gold);">
                            <i class="fas fa-phone me-2"></i>Get in Touch
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ========== ADMIN ADVERTISEMENT SECTION ========== -->
    <section class="py-4" id="admin-ads" style="background: #f8f9fa;">
        <div class="container">
            <div class="row g-4" id="ad-carousel-container">
                <!-- Ad Slot 1 - Business Ad -->
                <div class="col-12 col-sm-6 col-md-4" data-ad-slot="1">
                    <div class="ad-card h-100 p-4 rounded-4 text-center shadow-sm" style="background: white; border: 2px dashed #ccc; min-height: 200px;">
                        <div class="ad-content">
                            <i class="fas fa-bullhorn fa-3x mb-3" style="color: #FF6B35;"></i>
                            <h5>Advertise Here</h5>
                            <p class="text-muted small">Promote your business to the Bengali community</p>
                            <a href="mailto:ads@jaxbengali.org" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-ad me-1"></i>Place Ad
                            </a>
                        </div>
                    </div>
                </div>
                
                <!-- Ad Slot 2 - Featured Sponsor -->
                <div class="col-12 col-sm-6 col-md-4" data-ad-slot="2">
                    <div class="ad-card h-100 p-4 rounded-4 text-center shadow" style="background: linear-gradient(135deg, #006A4E, #00856F); color: white; min-height: 200px;">
                        <div class="ad-content">
                            <div style="font-size: 2rem; margin-bottom: 10px;">🍖</div>
                            <h5>Fresh Meats</h5>
                            <p class="small opacity-85">Quality Halal Meats & Indian Groceries</p>
                            <p class="small"><i class="fas fa-map-marker-alt"></i> Jacksonville, FL</p>
                            <span class="badge bg-warning text-dark">Proud Sponsor</span>
                        </div>
                    </div>
                </div>
                
                <!-- Ad Slot 3 - Community Announcement -->
                <div class="col-12 col-sm-6 col-md-4" data-ad-slot="3">
                    <div class="ad-card h-100 p-4 rounded-4 text-center shadow" style="background: linear-gradient(135deg, #8B0000, #A52A2A); color: white; min-height: 200px;">
                        <div class="ad-content">
                            <i class="fas fa-newspaper fa-2x mb-2"></i>
                            <h5>E-Magazine</h5>
                            <p class="small opacity-85">Submit articles, poems & stories for our annual publication!</p>
                            <a href="#" onclick="openMagazineSubmit(); return false;" class="btn btn-sm btn-warning">
                                <i class="fas fa-pen me-1"></i>Submit Article <i class="fas fa-lock ms-1 small"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Admin controls (hidden for non-admin users) -->
            <div id="ad-admin-controls" class="mt-3 text-center" style="display: none;">
                <button class="btn btn-sm btn-outline-secondary" onclick="openAdManager()">
                    <i class="fas fa-cog me-1"></i>Manage Advertisements (Admin)
                </button>
            </div>
        </div>
    </section>

    <!-- ========== MEMBERSHIP SECTION ========== -->
    <section class="membership-section" id="membership">
        <div class="container">
            <div class="section-header">
                <h2>Membership & Benefits</h2>
                <p style="color: rgba(255,255,255,0.8);">Join our community • FY 2026-27 Season • 17 Events • Incredible Value</p>
            </div>
            
            <!-- Early Bird Alert Banner -->
            <div class="row justify-content-center mb-4">
                <div class="col-lg-10">
                    <div class="alert-box p-3 rounded-3 text-center" style="background: linear-gradient(135deg, #28a745, #20c997); color: #fff;">
                        <i class="fas fa-clock fa-lg me-2"></i>
                        <strong>⏰ Early Bird Pricing!</strong> Family Premium membership $375 (save $35) — Register by March 31, 2026
                    </div>
                </div>
            </div>
            
            <!-- Member Portal Access Box -->
            <div class="row justify-content-center mb-4">
                <div class="col-lg-10">
                    <div class="member-portal-box p-4 rounded-4" style="background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border: 2px solid var(--gold);">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h4 style="color: #fff;"><i class="fas fa-user-lock me-2" style="color: var(--gold);"></i>Member Portal</h4>
                                <p style="color: rgba(255,255,255,0.85); margin-bottom: 0;">
                                    <strong>Already a member?</strong> Log in to access your profile, payment history, event registrations, and exclusive member content.
                                    <br><span class="small">New member who has paid fees? Click "Sign Up" to create your account.</span>
                                </p>
                            </div>
                            <div class="col-md-4 text-md-end mt-3 mt-md-0">
                                <button class="btn me-2" style="background: var(--gold); color: #1a1a2e; font-weight: 600;" onclick="openMemberPortal('login')">
                                    <i class="fas fa-sign-in-alt me-1"></i> Login
                                </button>
                                <button class="btn btn-outline-light" onclick="openMemberPortal('signup')">
                                    <i class="fas fa-user-plus me-1"></i> Sign Up
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="membership-tabs" id="membershipTabs">
                <button class="membership-tab-btn active" onclick="switchMembershipTab('plans')"><i class="fas fa-id-card me-1"></i> Plans & Pricing</button>
                <button class="membership-tab-btn" onclick="switchMembershipTab('events')"><i class="fas fa-calendar-check me-1"></i> Event Coverage</button>
                <button class="membership-tab-btn" onclick="switchMembershipTab('value')"><i class="fas fa-chart-line me-1"></i> Value Analysis</button>
            </div>

            <!-- ====== TAB 1: PLANS & PRICING ====== -->
            <div class="membership-tab-content active" id="tab-plans">
            
            <div class="row justify-content-center">
                <!-- Student Plan -->
                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="pricing-card">
                        <div class="pricing-header" style="background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);">
                            <h4><i class="fas fa-graduation-cap me-2"></i>Student</h4>
                            <p class="mb-2 opacity-75">Full-time Students</p>
                            <div class="pricing-price">
                                $165<span>/year</span>
                            </div>
                            <small class="opacity-75"><i class="fas fa-id-card me-1"></i>Valid student ID required</small>
                        </div>
                        <div class="pricing-body">
                            <div class="pricing-feature"><i class="fas fa-check-circle"></i>Access to all events</div>
                            <div class="pricing-feature"><i class="fas fa-check-circle"></i>Newsletter subscription</div>
                            <div class="pricing-feature"><i class="fas fa-check-circle"></i>Member directory access</div>
                            <div class="pricing-feature"><i class="fas fa-check-circle"></i>Special programs</div>
                        </div>
                        <div class="pricing-footer">
                            <a href="mailto:membership@jaxbengali.org" class="btn btn-outline-light w-100">Select Plan</a>
                        </div>
                    </div>
                </div>
                
                <!-- Individual / Regular Plan -->
                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="pricing-card">
                        <div class="pricing-header" style="background: linear-gradient(135deg, #6c757d 0%, #495057 100%);">
                            <h4><i class="fas fa-user me-2"></i>Individual Premium</h4>
                            <p class="mb-2 opacity-75">Single Adult Member</p>
                            <div class="pricing-price">
                                $240<span>/year</span>
                            </div>
                            <small class="opacity-75"><i class="fas fa-star me-1"></i>Full membership benefits</small>
                        </div>
                        <div class="pricing-body">
                            <div class="pricing-feature"><i class="fas fa-check-circle"></i>All cultural events included</div>
                            <div class="pricing-feature"><i class="fas fa-check-circle"></i>Voting rights in elections</div>
                            <div class="pricing-feature"><i class="fas fa-check-circle"></i>Newsletter &amp; E-Magazine</div>
                            <div class="pricing-feature"><i class="fas fa-check-circle"></i>Member directory access</div>
                        </div>
                        <div class="pricing-footer">
                            <a href="mailto:membership@jaxbengali.org" class="btn btn-outline-light w-100">Select Plan</a>
                        </div>
                    </div>
                </div>
                
                <!-- Couple / Premium Plan -->
                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="pricing-card">
                        <div class="pricing-header" style="background: linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%);">
                            <h4><i class="fas fa-heart me-2"></i>Couple</h4>
                            <p class="mb-2 opacity-75">2 Adults</p>
                            <div class="pricing-price">
                                $330<span>/year</span>
                            </div>
                            <small class="opacity-75"><i class="fas fa-users me-1"></i>Dual premium membership</small>
                        </div>
                        <div class="pricing-body">
                            <div class="pricing-feature"><i class="fas fa-check-circle"></i>All Regular benefits × 2</div>
                            <div class="pricing-feature"><i class="fas fa-check-circle"></i>Priority event registration</div>
                            <div class="pricing-feature"><i class="fas fa-check-circle"></i>Puja dinner included</div>
                            <div class="pricing-feature"><i class="fas fa-check-circle"></i>Event discounts</div>
                        </div>
                        <div class="pricing-footer">
                            <a href="mailto:membership@jaxbengali.org" class="btn btn-outline-light w-100">Select Plan</a>
                        </div>
                    </div>
                </div>
                
                <!-- Family Plan (Featured) -->
                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="pricing-card featured">
                        <div class="pricing-header">
                            <span class="badge bg-warning text-dark mb-2"><i class="fas fa-trophy me-1"></i>Best Value</span>
                            <h4 style="color: #fff;"><i class="fas fa-users me-2"></i>Family Premium</h4>
                            <p class="mb-2 opacity-75">2 Adults + Kids</p>
                            <div class="pricing-price">
                                $410<span>/year</span>
                            </div>
                            <small class="text-success"><i class="fas fa-tag me-1"></i>Early Bird: $375 (by Mar 31)</small>
                        </div>
                        <div class="pricing-body">
                            <div class="pricing-feature"><i class="fas fa-check-circle"></i>All 17 events included</div>
                            <div class="pricing-feature"><i class="fas fa-check-circle"></i>2 adults + children</div>
                            <div class="pricing-feature"><i class="fas fa-check-circle"></i>Puja dinner for family</div>
                            <div class="pricing-feature"><i class="fas fa-check-circle"></i>Up to 2.84× value return</div>
                        </div>
                        <div class="pricing-footer">
                            <a href="mailto:membership@jaxbengali.org" class="btn w-100" style="background: var(--gradient-primary); color: white; border: none;">Select Plan</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Special / Selective Membership Options -->
            <div class="row justify-content-center mt-4">
                <div class="col-lg-10">
                    <div class="p-4 rounded-3 text-center" style="background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15);">
                        <h5 style="color: var(--gold);"><i class="fas fa-theater-masks me-2"></i>Selective Membership Plans</h5>
                        <p class="text-white opacity-85 mb-3">Can't attend all events? Choose the plan that fits your interests!</p>
                        <div class="row g-3 justify-content-center">
                            <div class="col-md-4">
                                <div class="p-3 rounded-3" style="background: rgba(255,255,255,0.1);">
                                    <h6 style="color: #FF69B4;"><i class="fas fa-music me-2"></i>Culture Special — $180</h6>
                                    <p class="small text-white-50 mb-1">Spandan, Noboborsho, Summer Camp, Kids Sports, Winter Picnic</p>
                                    <span class="badge" style="background: rgba(255,105,180,0.3); color: #FF69B4;">4.06× value</span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="p-3 rounded-3" style="background: rgba(255,255,255,0.1);">
                                    <h6 style="color: #ffc107;"><i class="fas fa-om me-2"></i>Religious Special — $180</h6>
                                    <p class="small text-white-50 mb-1">Durga Puja, Mohaloya, Lakshmi Puja, Kali Puja, Saraswati Puja</p>
                                    <span class="badge" style="background: rgba(255,193,7,0.3); color: #ffc107;">3.08× value</span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="p-3 rounded-3" style="background: rgba(255,255,255,0.1);">
                                    <h6 style="color: #20c997;"><i class="fas fa-puzzle-piece me-2"></i>Add-On Events</h6>
                                    <p class="small text-white-50 mb-1">Non-members can attend individual events at guest pricing</p>
                                    <span class="badge" style="background: rgba(32,201,151,0.3); color: #20c997;">Pay per event</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Member Benefits Summary -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="p-4 rounded-3" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);">
                        <h5 class="text-center mb-4" style="color: #fff;"><i class="fas fa-gift me-2"></i>Exclusive Member Benefits</h5>
                        <div class="row g-3 text-center">
                            <div class="col-6 col-md-2">
                                <div class="p-2" style="color: rgba(255,255,255,0.9);">
                                    <i class="fas fa-calendar-alt fa-2x mb-2" style="color: var(--gold);"></i>
                                    <h6 class="mb-0" style="font-size:0.85rem;">17 Events</h6>
                                    <small class="opacity-75">Full year access</small>
                                </div>
                            </div>
                            <div class="col-6 col-md-2">
                                <div class="p-2" style="color: rgba(255,255,255,0.9);">
                                    <i class="fas fa-utensils fa-2x mb-2" style="color: var(--gold);"></i>
                                    <h6 class="mb-0" style="font-size:0.85rem;">Puja Dinner</h6>
                                    <small class="opacity-75">Premium plans</small>
                                </div>
                            </div>
                            <div class="col-6 col-md-2">
                                <div class="p-2" style="color: rgba(255,255,255,0.9);">
                                    <i class="fas fa-file-alt fa-2x mb-2" style="color: var(--gold);"></i>
                                    <h6 class="mb-0" style="font-size:0.85rem;">Meeting Minutes</h6>
                                    <small class="opacity-75">EC summaries</small>
                                </div>
                            </div>
                            <div class="col-6 col-md-2">
                                <div class="p-2" style="color: rgba(255,255,255,0.9);">
                                    <i class="fas fa-pen-fancy fa-2x mb-2" style="color: var(--gold);"></i>
                                    <h6 class="mb-0" style="font-size:0.85rem;">E-Magazine</h6>
                                    <small class="opacity-75">Submit articles</small>
                                </div>
                            </div>
                            <div class="col-6 col-md-2">
                                <div class="p-2" style="color: rgba(255,255,255,0.9);">
                                    <i class="fas fa-vote-yea fa-2x mb-2" style="color: var(--gold);"></i>
                                    <h6 class="mb-0" style="font-size:0.85rem;">Voting Rights</h6>
                                    <small class="opacity-75">EC elections</small>
                                </div>
                            </div>
                            <div class="col-6 col-md-2">
                                <div class="p-2" style="color: rgba(255,255,255,0.9);">
                                    <i class="fas fa-star fa-2x mb-2" style="color: var(--gold);"></i>
                                    <h6 class="mb-0" style="font-size:0.85rem;">Jax Guide</h6>
                                    <small class="opacity-75">Write reviews</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </div><!-- end tab-plans -->

            <!-- ====== TAB 2: EVENT COVERAGE MATRIX ====== -->
            <div class="membership-tab-content" id="tab-events">
                <div class="row justify-content-center mb-3">
                    <div class="col-lg-10 text-center">
                        <p style="color: rgba(255,255,255,0.75);">
                            <i class="fas fa-info-circle me-1"></i> See exactly which events are included in each membership tier. 
                            <span class="text-success">✅ = Included</span> &nbsp; 
                            <span style="color: #ffc107;">$ = Add-on at member rate</span> &nbsp;
                            <span style="color: rgba(255,255,255,0.3);">— = Not included</span>
                        </p>
                    </div>
                </div>
                <div class="row justify-content-center">
                    <div class="col-lg-12">
                        <div class="event-matrix-wrapper">
                            <table class="event-matrix">
                                <thead>
                                    <tr>
                                        <th>Event</th>
                                        <th>🏆 Family Premium<br><small>$410 (EB $375)</small></th>
                                        <th>Couple<br><small>$330</small></th>
                                        <th>Individual Premium<br><small>$240</small></th>
                                        <th>Student<br><small>$165</small></th>
                                        <th>🎭 Culture<br><small>$180</small></th>
                                        <th>🕉️ Religious<br><small>$180</small></th>
                                        <th>Guest<br><small>per event</small></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Spring -->
                                    <tr>
                                        <td>🌸 Bosonto Utsob <span class="ev-month">Mar 7</span></td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-na">—</td>
                                        <td class="ev-addon">$25</td>
                                    </tr>
                                    <tr>
                                        <td>🎊 Noboborsho <span class="ev-month">Apr 14</span></td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-na">—</td>
                                        <td class="ev-addon">$30</td>
                                    </tr>
                                    <!-- Summer -->
                                    <tr>
                                        <td>⚽ Kids Summer Sports <span class="ev-month">Jun–Jul</span></td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-na">—</td>
                                        <td class="ev-addon">$30</td>
                                    </tr>
                                    <tr>
                                        <td>🎨 Summer Workshops <span class="ev-month">Jun–Jul</span></td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-na">—</td>
                                        <td class="ev-addon">$25</td>
                                    </tr>
                                    <tr>
                                        <td>🏅 Sports Day <span class="ev-month">Jul</span></td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-na">—</td>
                                        <td class="ev-addon">$20</td>
                                    </tr>
                                    <!-- Cultural -->
                                    <tr>
                                        <td>🎶 Spandan <span class="ev-month">Aug</span></td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-na">—</td>
                                        <td class="ev-addon">$40</td>
                                    </tr>
                                    <!-- Puja Season -->
                                    <tr>
                                        <td>🪔 Mohaloya <span class="ev-month">Oct 17</span></td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-na">—</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-addon">$15</td>
                                    </tr>
                                    <tr style="background: rgba(255,215,0,0.05);">
                                        <td><strong>🕉️ Durga Puja + Dinner</strong> <span class="ev-month">Oct 24–25</span></td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-addon">$50 add</td>
                                        <td class="ev-addon">$50 add</td>
                                        <td class="ev-na">—</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-addon">$100</td>
                                    </tr>
                                    <tr>
                                        <td>🕉️ Durga Puja (no dinner) <span class="ev-month">Oct 24–25</span></td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-na">—</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-addon">$50</td>
                                    </tr>
                                    <tr>
                                        <td>🪔 Lakshmi Puja <span class="ev-month">Oct 24</span></td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-na">—</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-addon">$15</td>
                                    </tr>
                                    <tr>
                                        <td>🎉 Bijoya Sonmiloni <span class="ev-month">Oct 25</span></td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-na">—</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-addon">$20</td>
                                    </tr>
                                    <tr>
                                        <td>🎭 Artist Program Day 1 <span class="ev-month">Oct 24</span></td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-na">—</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-addon">$30</td>
                                    </tr>
                                    <tr>
                                        <td>🎭 Artist Program Day 2 <span class="ev-month">Oct 25</span></td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-na">—</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-addon">$30</td>
                                    </tr>
                                    <!-- Late Fall / Winter -->
                                    <tr>
                                        <td>🕯️ Kali Puja <span class="ev-month">Nov 14</span></td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-na">—</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-addon">$25</td>
                                    </tr>
                                    <tr>
                                        <td>🎭 Natok <span class="ev-month">Nov 14</span></td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-na">—</td>
                                        <td class="ev-addon">$25</td>
                                    </tr>
                                    <tr>
                                        <td>🏕️ Winter Picnic <span class="ev-month">Jan 11</span></td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-na">—</td>
                                        <td class="ev-addon">$35</td>
                                    </tr>
                                    <tr>
                                        <td>📚 Saraswati Puja <span class="ev-month">Feb 27</span></td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-na">—</td>
                                        <td class="ev-included">✅</td>
                                        <td class="ev-addon">$25</td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td><strong>Events Included</strong></td>
                                        <td><strong>18</strong></td>
                                        <td><strong>18</strong></td>
                                        <td><strong>17*</strong></td>
                                        <td><strong>17*</strong></td>
                                        <td><strong>9</strong></td>
                                        <td><strong>9</strong></td>
                                        <td>—</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Total Guest Value</strong></td>
                                        <td><strong style="color:#28a745;">$1,165</strong></td>
                                        <td><strong style="color:#28a745;">$1,165</strong></td>
                                        <td><strong>$1,115</strong></td>
                                        <td><strong>$1,115</strong></td>
                                        <td><strong>$730</strong></td>
                                        <td><strong>$555</strong></td>
                                        <td>varies</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        <p class="text-center mt-2" style="color: rgba(255,255,255,0.5); font-size: 0.78rem;">
                            * Regular/Student: Durga Puja dinner requires $50 add-on. Guest prices shown for family of 4.
                        </p>
                    </div>
                </div>
            </div><!-- end tab-events -->

            <!-- ====== TAB 3: VALUE ANALYSIS ====== -->
            <div class="membership-tab-content" id="tab-value">
                
                <!-- Value Multiplier Cards -->
                <div class="row justify-content-center mb-4">
                    <div class="col-lg-10 text-center mb-3">
                        <h5 style="color: var(--gold);"><i class="fas fa-chart-bar me-2"></i>What Your Membership Is Really Worth</h5>
                        <p style="color: rgba(255,255,255,0.7);">If you attended every included event as a non-member (guest pricing), here's what you'd pay vs. your membership fee:</p>
                    </div>
                </div>
                <div class="row g-3 justify-content-center mb-5">
                    <!-- Family Premium EB -->
                    <div class="col-lg-3 col-md-6">
                        <div class="value-card best-value">
                            <span class="badge bg-success mb-2"><i class="fas fa-trophy me-1"></i>BEST VALUE</span>
                            <h6 style="color: var(--gold);">Family Premium (EB)</h6>
                            <div class="value-multiplier">2.84×</div>
                            <p class="text-white-50 small mb-2">value return</p>
                            <div class="value-savings">Save $790</div>
                            <p class="text-white-50 small mb-0">$375 fee → $1,165 event value</p>
                        </div>
                    </div>
                    <!-- Family Premium Regular -->
                    <div class="col-lg-3 col-md-6">
                        <div class="value-card">
                            <h6 style="color: var(--gold);">Family Premium</h6>
                            <div class="value-multiplier">2.60×</div>
                            <p class="text-white-50 small mb-2">value return</p>
                            <div class="value-savings">Save $755</div>
                            <p class="text-white-50 small mb-0">$410 fee → $1,165 event value</p>
                        </div>
                    </div>
                    <!-- Culture Special -->
                    <div class="col-lg-3 col-md-6">
                        <div class="value-card">
                            <span class="badge mb-2" style="background: rgba(255,105,180,0.3); color: #FF69B4;">Cultural</span>
                            <h6 style="color: #FF69B4;">Culture Special</h6>
                            <div class="value-multiplier" style="color: #FF69B4;">4.06×</div>
                            <p class="text-white-50 small mb-2">value return</p>
                            <div class="value-savings" style="color: #FF69B4;">Save $550</div>
                            <p class="text-white-50 small mb-0">$180 fee → $730 event value</p>
                        </div>
                    </div>
                    <!-- Religious Special -->
                    <div class="col-lg-3 col-md-6">
                        <div class="value-card">
                            <span class="badge mb-2" style="background: rgba(255,193,7,0.3); color: #ffc107;">Religious</span>
                            <h6 style="color: #ffc107;">Religious Special</h6>
                            <div class="value-multiplier" style="color: #ffc107;">3.08×</div>
                            <p class="text-white-50 small mb-2">value return</p>
                            <div class="value-savings" style="color: #ffc107;">Save $375</div>
                            <p class="text-white-50 small mb-0">$180 fee → $555 event value</p>
                        </div>
                    </div>
                </div>

                <!-- Where Your Fees Go -->
                <div class="row justify-content-center">
                    <div class="col-lg-10">
                        <div class="p-4 rounded-3" style="background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.12);">
                            <h5 class="text-center mb-4" style="color: #fff;"><i class="fas fa-piggy-bank me-2" style="color: var(--gold);"></i>Where Your Membership Fees Go</h5>
                            <p class="text-center mb-4" style="color: rgba(255,255,255,0.6); font-size: 0.85rem;">BANF is a 501(c)(3) non-profit. Every dollar funds community events and cultural programs.</p>
                            
                            <!-- Event Cost Breakdown -->
                            <div class="event-cost-bar">
                                <div class="event-cost-bar-fill" style="width: 38%; background: linear-gradient(135deg, #8B0000, #dc3545);">Durga Puja</div>
                                <span class="event-cost-bar-label">$20,000</span>
                            </div>
                            <div class="event-cost-bar">
                                <div class="event-cost-bar-fill" style="width: 12%; background: linear-gradient(135deg, #6f42c1, #9b59b6);">Spandan</div>
                                <span class="event-cost-bar-label">$6,000</span>
                            </div>
                            <div class="event-cost-bar">
                                <div class="event-cost-bar-fill" style="width: 9%; background: linear-gradient(135deg, #fd7e14, #e67e22);">Kali Puja</div>
                                <span class="event-cost-bar-label">$4,500</span>
                            </div>
                            <div class="event-cost-bar">
                                <div class="event-cost-bar-fill" style="width: 9%; background: linear-gradient(135deg, #ffc107, #f39c12);">Saraswati Puja</div>
                                <span class="event-cost-bar-label">$4,500</span>
                            </div>
                            <div class="event-cost-bar">
                                <div class="event-cost-bar-fill" style="width: 6%; background: linear-gradient(135deg, #17a2b8, #20c997);">Winter Picnic</div>
                                <span class="event-cost-bar-label">$3,000</span>
                            </div>
                            <div class="event-cost-bar">
                                <div class="event-cost-bar-fill" style="width: 5%; background: linear-gradient(135deg, #28a745, #27ae60);">Noboborsho</div>
                                <span class="event-cost-bar-label">$2,500</span>
                            </div>
                            <div class="event-cost-bar">
                                <div class="event-cost-bar-fill" style="width: 21%; background: linear-gradient(135deg, #6c757d, #495057);">Other Events &amp; Operations</div>
                                <span class="event-cost-bar-label">$11,100</span>
                            </div>
                            
                            <div class="text-center mt-3">
                                <p style="color: var(--gold); font-weight: 600; font-size: 1.1rem; margin-bottom: 0.25rem;">
                                    Total Annual Event Budget: $51,600
                                </p>
                                <small style="color: rgba(255,255,255,0.5);">Funded by membership fees, sponsorships, and community donations</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Comparison Table -->
                <div class="row justify-content-center mt-4">
                    <div class="col-lg-10">
                        <div class="p-4 rounded-3" style="background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.12);">
                            <h5 class="text-center mb-3" style="color: #fff;"><i class="fas fa-balance-scale me-2"></i>Quick Comparison</h5>
                            <div class="event-matrix-wrapper">
                                <table class="event-matrix" style="min-width: 500px;">
                                    <thead>
                                        <tr>
                                            <th>Feature</th>
                                            <th>Family Premium</th>
                                            <th>Couple</th>
                                            <th>Regular</th>
                                            <th>Student</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Annual Fee</td>
                                            <td style="color:#28a745; font-weight:700;">$410 (EB $375)</td>
                                            <td>$330</td>
                                            <td>$240</td>
                                            <td>$165</td>
                                        </tr>
                                        <tr>
                                            <td>Members Covered</td>
                                            <td>2 Adults + Kids</td>
                                            <td>2 Adults</td>
                                            <td>1 Adult</td>
                                            <td>1 Student</td>
                                        </tr>
                                        <tr>
                                            <td>Events Included</td>
                                            <td class="ev-included">All 17</td>
                                            <td class="ev-included">All 17</td>
                                            <td>17 (dinner add-on)</td>
                                            <td>17 (dinner add-on)</td>
                                        </tr>
                                        <tr>
                                            <td>Puja Dinner Included</td>
                                            <td class="ev-included">✅ Family</td>
                                            <td class="ev-included">✅ Couple</td>
                                            <td class="ev-addon">$50 add-on</td>
                                            <td class="ev-addon">$50 add-on</td>
                                        </tr>
                                        <tr>
                                            <td>Voting Rights</td>
                                            <td class="ev-included">✅</td>
                                            <td class="ev-included">✅</td>
                                            <td class="ev-included">✅</td>
                                            <td class="ev-na">—</td>
                                        </tr>
                                        <tr>
                                            <td>E-Magazine Access</td>
                                            <td class="ev-included">✅</td>
                                            <td class="ev-included">✅</td>
                                            <td class="ev-included">✅</td>
                                            <td class="ev-included">✅</td>
                                        </tr>
                                        <tr>
                                            <td>Value Multiplier</td>
                                            <td style="color:#28a745; font-weight:700;">2.84× (EB)</td>
                                            <td>3.53×</td>
                                            <td>5.31×</td>
                                            <td>6.76×</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

            </div><!-- end tab-value -->

        </div>
    </section>

    <!-- ========== PHOTO GALLERY SECTION ========== -->
    <section class="py-5" id="photos" style="background: #f8f9fa;">
        <div class="container">
            <div class="section-header">
                <h2>Photo Gallery</h2>
                <p>Relive our cherished moments together</p>
            </div>
            
            <!-- Featured Albums Grid -->
            <div class="row g-4">
                <!-- Durga Puja 2025 -->
                <div class="col-md-4">
                    <div class="photo-album-card position-relative overflow-hidden rounded-4 shadow" style="height: 250px; cursor: pointer;" onclick="PhotoGallery.openGallery('durga-puja-2025')">
                        <div style="background: linear-gradient(135deg, #8B0000, #A52A2A); height: 100%; display: flex; align-items: center; justify-content: center;">
                            <span style="font-size: 4rem;">🕉️</span>
                        </div>
                        <div class="position-absolute bottom-0 start-0 end-0 p-3" style="background: linear-gradient(transparent, rgba(0,0,0,0.8));">
                            <h5 class="text-white mb-1">Durga Puja 2025</h5>
                            <small class="text-white-50"><i class="fas fa-images me-1"></i>150+ Photos</small>
                        </div>
                        <span class="badge bg-success position-absolute top-0 end-0 m-2">Public</span>
                    </div>
                </div>
                
                <!-- Saraswati Puja 2026 -->
                <div class="col-md-4">
                    <div class="photo-album-card position-relative overflow-hidden rounded-4 shadow" style="height: 250px; cursor: pointer;" onclick="PhotoGallery.openGallery('saraswati-puja-2026')">
                        <div style="background: linear-gradient(135deg, #ffc107, #ff9800); height: 100%; display: flex; align-items: center; justify-content: center;">
                            <span style="font-size: 4rem;">📚</span>
                        </div>
                        <div class="position-absolute bottom-0 start-0 end-0 p-3" style="background: linear-gradient(transparent, rgba(0,0,0,0.8));">
                            <h5 class="text-white mb-1">Saraswati Puja 2026</h5>
                            <small class="text-white-50"><i class="fas fa-images me-1"></i>75+ Photos</small>
                        </div>
                        <span class="badge bg-success position-absolute top-0 end-0 m-2">Public</span>
                    </div>
                </div>
                
                <!-- Members Only Album -->
                <div class="col-md-4">
                    <div class="photo-album-card position-relative overflow-hidden rounded-4 shadow" style="height: 250px; cursor: pointer;" onclick="PhotoGallery.requestMemberAccess() && PhotoGallery.openGallery('members-collection')">
                        <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); height: 100%; display: flex; align-items: center; justify-content: center;">
                            <span style="font-size: 4rem;">🔐</span>
                        </div>
                        <div class="position-absolute bottom-0 start-0 end-0 p-3" style="background: linear-gradient(transparent, rgba(0,0,0,0.8));">
                            <h5 class="text-white mb-1">Member Photos</h5>
                            <small class="text-white-50"><i class="fas fa-lock me-1"></i>Login Required</small>
                        </div>
                        <span class="badge bg-warning text-dark position-absolute top-0 end-0 m-2">
                            <i class="fas fa-user-lock me-1"></i>Members Only
                        </span>
                    </div>
                </div>
                
                <!-- Winter Picnic 2026 -->
                <div class="col-md-4">
                    <div class="photo-album-card position-relative overflow-hidden rounded-4 shadow" style="height: 250px; cursor: pointer;" onclick="PhotoGallery.openGallery('winter-picnic-2026')">
                        <div style="background: linear-gradient(135deg, #2196F3, #03A9F4); height: 100%; display: flex; align-items: center; justify-content: center;">
                            <span style="font-size: 4rem;">🧺</span>
                        </div>
                        <div class="position-absolute bottom-0 start-0 end-0 p-3" style="background: linear-gradient(transparent, rgba(0,0,0,0.8));">
                            <h5 class="text-white mb-1">Winter Picnic 2026</h5>
                            <small class="text-white-50"><i class="fas fa-images me-1"></i>50+ Photos</small>
                        </div>
                        <span class="badge bg-success position-absolute top-0 end-0 m-2">Public</span>
                    </div>
                </div>
                
                <!-- Spandan 2025 -->
                <div class="col-md-4">
                    <div class="photo-album-card position-relative overflow-hidden rounded-4 shadow" style="height: 250px; cursor: pointer;" onclick="PhotoGallery.openGallery('spandan-2025')">
                        <div style="background: linear-gradient(135deg, #006A4E, #00856F); height: 100%; display: flex; align-items: center; justify-content: center;">
                            <span style="font-size: 4rem;">🎭</span>
                        </div>
                        <div class="position-absolute bottom-0 start-0 end-0 p-3" style="background: linear-gradient(transparent, rgba(0,0,0,0.8));">
                            <h5 class="text-white mb-1">Spandan 2025</h5>
                            <small class="text-white-50"><i class="fas fa-images me-1"></i>100+ Photos</small>
                        </div>
                        <span class="badge bg-success position-absolute top-0 end-0 m-2">Public</span>
                    </div>
                </div>
                
                <!-- View All Albums -->
                <div class="col-md-4">
                    <div class="photo-album-card position-relative overflow-hidden rounded-4" style="height: 250px; cursor: pointer; border: 3px dashed #dee2e6; background: white; display: flex; align-items: center; justify-content: center;" onclick="if(window.parent){window.parent.postMessage({type:'NAVIGATE',target:'/photos'},'*');}">
                        <div class="text-center">
                            <i class="fas fa-photo-video fa-4x mb-3" style="color: #6c757d;"></i>
                            <h5 style="color: #333;">View All Albums</h5>
                            <p class="text-muted small mb-0">Browse complete photo collection</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Photo Submission CTA -->
            <div class="row mt-5">
                <div class="col-12">
                    <div class="p-4 rounded-4 text-center" style="background: linear-gradient(135deg, var(--banf-saffron), var(--banf-orange));">
                        <h5 class="text-white mb-2"><i class="fas fa-upload me-2"></i>Share Your Photos!</h5>
                        <p class="text-white opacity-85 mb-3">Members can submit photos from events for the community gallery</p>
                        <button class="btn btn-light" onclick="openMemberPortal('login')">
                            <i class="fas fa-cloud-upload-alt me-2"></i>Submit Photos
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ========== CONTACT SECTION ========== -->
    <section class="contact-section" id="contact">
        <div class="container">
            <div class="section-header">
                <h2>Get in Touch</h2>
                <p>Have questions? We'd love to hear from you</p>
            </div>
            <div class="row g-4">
                <div class="col-lg-6">
                    <form class="contact-form">
                        <div class="form-group">
                            <label><i class="fas fa-user me-2"></i>Your Name</label>
                            <input type="text" class="form-control" placeholder="Enter your name" required>
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-envelope me-2"></i>Email Address</label>
                            <input type="email" class="form-control" placeholder="Enter your email" required>
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-tag me-2"></i>Subject</label>
                            <select class="form-control">
                                <option>General Inquiry</option>
                                <option>Membership Question</option>
                                <option>Event Information</option>
                                <option>Sponsorship</option>
                                <option>Volunteer</option>
                                <option>Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-comment me-2"></i>Message</label>
                            <textarea class="form-control" placeholder="Your message..." required></textarea>
                        </div>
                        <button type="submit" class="submit-btn">
                            <i class="fas fa-paper-plane me-2"></i>Send Message
                        </button>
                    </form>
                </div>
                <div class="col-lg-6">
                    <div class="contact-info-card">
                        <h4 class="mb-4"><i class="fas fa-address-card me-2" style="color: var(--banf-orange);"></i>Contact Information</h4>
                        
                        <div class="contact-info-item">
                            <i class="fas fa-envelope"></i>
                            <div>
                                <strong>Email</strong><br>
                                <a href="mailto:info@jaxbengali.org">info@jaxbengali.org</a>
                            </div>
                        </div>
                        
                        <div class="contact-info-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <div>
                                <strong>Location</strong><br>
                                Jacksonville, Florida, USA
                            </div>
                        </div>
                        
                        <div class="contact-info-item">
                            <i class="fas fa-globe"></i>
                            <div>
                                <strong>Website</strong><br>
                                <a href="https://www.jaxbengali.org">www.jaxbengali.org</a>
                            </div>
                        </div>
                        
                        <div class="contact-info-item">
                            <i class="fas fa-clock"></i>
                            <div>
                                <strong>Office Hours</strong><br>
                                By Appointment Only
                            </div>
                        </div>
                        
                        <hr class="my-4">
                        
                        <h5 class="mb-3">Follow Us</h5>
                        <div class="social-links">
                            <a href="https://facebook.com/banfjax" class="social-link" target="_blank" title="Facebook">
                                <i class="fab fa-facebook-f"></i>
                            </a>
                            <a href="https://instagram.com/banfjax" class="social-link" target="_blank" title="Instagram">
                                <i class="fab fa-instagram"></i>
                            </a>
                            <a href="https://youtube.com/@banfjacksonville" class="social-link" target="_blank" title="YouTube">
                                <i class="fab fa-youtube"></i>
                            </a>
                            <a href="https://twitter.com/banfjax" class="social-link" target="_blank" title="Twitter">
                                <i class="fab fa-twitter"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Profile modals are now dynamically generated by openProfileModal() from EC_MEMBERS data -->

    <!-- ========== FOOTER ========== -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h5><i class="fas fa-om me-2"></i>About BANF</h5>
                    <p>Bengali Association of North Florida — Preserving and celebrating Bengali culture, heritage, and traditions in Jacksonville since 2008.</p>
                    <div class="social-links">
                        <a href="https://facebook.com/banfjax" class="social-link"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://instagram.com/banfjax" class="social-link"><i class="fab fa-instagram"></i></a>
                        <a href="https://youtube.com/@banfjacksonville" class="social-link"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                <div class="footer-section">
                    <h5>Quick Links</h5>
                    <a href="#about"><i class="fas fa-info-circle me-2"></i>About Us</a>
                    <a href="#events"><i class="fas fa-calendar me-2"></i>Events</a>
                    <a href="#membership"><i class="fas fa-users me-2"></i>Membership</a>
                    <a href="#ec-team"><i class="fas fa-user-tie me-2"></i>Leadership</a>
                    <a href="#sponsors"><i class="fas fa-handshake me-2"></i>Sponsors</a>
                </div>
                <div class="footer-section">
                    <h5>Services</h5>
                    <a href="#radio"><i class="fas fa-broadcast-tower me-2"></i>BANF Radio</a>
                    <a href="#magazine"><i class="fas fa-book-open me-2"></i>E-Magazine</a>
                    <a href="#guide"><i class="fas fa-map me-2"></i>Jax Guide</a>
                    <a href="#surveys"><i class="fas fa-poll me-2"></i>Surveys</a>
                    <a href="#complaints"><i class="fas fa-shield-alt me-2"></i>Complaints</a>
                </div>
                <div class="footer-section">
                    <h5>Contact Info</h5>
                    <p><i class="fas fa-envelope me-2"></i>info@jaxbengali.org</p>
                    <p><i class="fas fa-map-marker-alt me-2"></i>Jacksonville, FL</p>
                    <p><i class="fas fa-globe me-2"></i>www.jaxbengali.org</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>© 2026 Bengali Association of North Florida (BANF). All rights reserved.</p>
                <p class="mt-2" style="font-size: 0.85rem; opacity: 0.7;">
                    <i class="fas fa-code me-1"></i>Built with ❤️ for the Jacksonville Bengali Community
                </p>
            </div>
        </div>
    </footer>

    <!-- ========== SCRIPTS ========== -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- SheetJS for Excel (.xlsx/.xls) parsing — Feature 7 -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <script>
        // ========== PROFILE MODAL FUNCTIONS ==========

        // ===== Feature 4: EC Member Data Array (single source of truth) =====
        const EC_MEMBERS = [
            {
                id: 'rana',
                name: 'Dr. Ranadhir Ghosh',
                firstName: 'Ranadhir',
                role: 'President',
                positionStyle: '',
                photoUrl: 'https://static.wixstatic.com/media/c62f94_d6f7e8a5b3c14f4f8a7f9e0d1c2b3a4d~mv2.jpg/v1/fill/w_200,h_200,al_c,q_80/rana.jpg',
                fallbackInitials: 'RG',
                fallbackGradient: 'linear-gradient(135deg, #DC143C, #8B0000)',
                bio: 'AI thought leader & educator. Rooted in philosophy, arts & music.',
                email: 'president@jaxbengali.org',
                linkedin: '#',
                hasProfile: true,
                profileData: {
                    fullBio: 'Visionary leader blending technology, philosophy, and community building. Dr. Ghosh brings expertise in AI/ML, data engineering, and cultural arts to drive BANF\'s digital transformation.',
                    education: 'Ph.D., Computer Science',
                    profession: 'AI/ML Engineering Lead',
                    interests: ['AI & Machine Learning', 'Bengali Literature', 'Rabindra Sangeet', 'Philosophy'],
                    quote: '"Technology should serve culture, and culture should inspire technology."',
                    yearJoined: 2020
                }
            },
            {
                id: 'partha',
                name: 'Partha Mukhopadhyay',
                firstName: 'Partha',
                role: 'Vice President',
                positionStyle: 'background: var(--gradient-green);',
                photoUrl: 'https://static.wixstatic.com/media/c62f94_vp_partha~mv2.jpg/v1/fill/w_200,h_200,al_c,q_80/partha.jpg',
                fallbackInitials: 'PM',
                fallbackGradient: 'linear-gradient(135deg, #006A4E, #00856F)',
                bio: 'Deputy Executive & Operations Leadership',
                email: 'vp@jaxbengali.org',
                linkedin: '#',
                hasProfile: false,
                profileData: {
                    fullBio: 'Deputy executive overseeing operations and strategic planning for BANF community initiatives.',
                    profession: 'Operations Leader',
                    interests: ['Community Service', 'Strategic Planning'],
                    yearJoined: 2021
                }
            },
            {
                id: 'amit',
                name: 'Amit Chandak',
                firstName: 'Amit',
                role: 'Treasurer',
                positionStyle: 'background: linear-gradient(135deg, #D4AF37, #E5C158);',
                photoUrl: null,
                fallbackInitials: 'AC',
                fallbackGradient: 'linear-gradient(135deg, #D4AF37, #E5C158)',
                bio: 'Financial Management',
                email: 'treasurer@jaxbengali.org',
                linkedin: '#',
                hasProfile: false,
                profileData: {
                    fullBio: 'Managing BANF\'s financial operations including budgeting, payments, and sponsorship accounting.',
                    profession: 'Finance Professional',
                    interests: ['Financial Planning', 'Community Volunteering'],
                    yearJoined: 2022
                }
            },
            {
                id: 'rajanya',
                name: 'Rajanya Ghosh',
                firstName: 'Rajanya',
                role: 'Gen. Secretary',
                positionStyle: 'background: linear-gradient(135deg, #8B0000, #a52a2a);',
                photoUrl: 'https://static.wixstatic.com/media/c62f94_gs_rajanya~mv2.jpg/v1/fill/w_200,h_200,al_c,q_80/rajanya.jpg',
                fallbackInitials: 'RG',
                fallbackGradient: 'linear-gradient(135deg, #8B0000, #a52a2a)',
                bio: 'Future leader, passionate about culture & community service.',
                email: 'secretary@jaxbengali.org',
                linkedin: '#',
                hasProfile: true,
                profileData: {
                    fullBio: 'Young, passionate leader dedicated to bridging generations within the Bengali community. Rajanya drives organizational excellence and community engagement.',
                    profession: 'Student Leader',
                    interests: ['Cultural Arts', 'Youth Leadership', 'Community Outreach'],
                    yearJoined: 2023
                }
            },
            {
                id: 'moumita',
                name: 'Dr. Moumita Ghosh',
                firstName: 'Moumita',
                role: 'Cultural Sec.',
                positionStyle: 'background: linear-gradient(135deg, #9C27B0, #E91E63);',
                photoUrl: 'https://static.wixstatic.com/media/c62f94_cs_moumita~mv2.jpg/v1/fill/w_200,h_200,al_c,q_80/moumita.jpg',
                fallbackInitials: 'MG',
                fallbackGradient: 'linear-gradient(135deg, #9C27B0, #E91E63)',
                bio: 'Creative visionary, educator, and cultural program director.',
                email: 'cultural@jaxbengali.org',
                linkedin: '#',
                hasProfile: false,
                profileData: {
                    fullBio: 'A creative visionary and educator who directs BANF\'s cultural programs — from Rabindra Jayanti to Durga Puja cultural evenings.',
                    education: 'Ph.D., Education',
                    profession: 'Educator & Cultural Director',
                    interests: ['Dance', 'Rabindra Sangeet', 'Cultural Programming', 'Education'],
                    yearJoined: 2021
                }
            },
            {
                id: 'banty',
                name: 'Banty Dutta',
                firstName: 'Banty',
                role: 'Food Coord.',
                positionStyle: 'background: linear-gradient(135deg, #FF5722, #FF9800);',
                photoUrl: null,
                fallbackInitials: 'BD',
                fallbackGradient: 'linear-gradient(135deg, #FF5722, #FF9800)',
                bio: 'Food & Catering',
                email: 'food@jaxbengali.org',
                linkedin: '#',
                hasProfile: false,
                profileData: {
                    fullBio: 'Coordinates authentic Bengali cuisine for all BANF events, managing vendor relationships and menu planning.',
                    profession: 'Food & Catering Coordinator',
                    interests: ['Bengali Cuisine', 'Event Catering', 'Vendor Management'],
                    yearJoined: 2023
                }
            },
            {
                id: 'sumanta',
                name: 'Dr. Sumanta Ghosh',
                firstName: 'Sumanta',
                role: 'Event Coord.',
                positionStyle: 'background: linear-gradient(135deg, #2196F3, #03A9F4);',
                photoUrl: null,
                fallbackInitials: 'SG',
                fallbackGradient: 'linear-gradient(135deg, #2196F3, #03A9F4)',
                bio: 'Event Planning & Logistics',
                email: 'events@jaxbengali.org',
                linkedin: '#',
                hasProfile: false,
                profileData: {
                    fullBio: 'Manages end-to-end event planning and logistics for BANF\'s community gatherings and celebrations.',
                    profession: 'Event Planner',
                    interests: ['Event Management', 'Community Building', 'Logistics'],
                    yearJoined: 2022
                }
            },
            {
                id: 'rwiti',
                name: 'Rwiti Choudhury',
                firstName: 'Rwiti',
                role: 'Puja Coord.',
                positionStyle: 'background: linear-gradient(135deg, #673AB7, #9C27B0);',
                photoUrl: null,
                fallbackInitials: 'RC',
                fallbackGradient: 'linear-gradient(135deg, #673AB7, #9C27B0)',
                bio: 'Puja Coordination',
                email: 'puja@jaxbengali.org',
                linkedin: '#',
                hasProfile: false,
                profileData: {
                    fullBio: 'Coordinates Durga Puja and other religious/cultural ceremonies for the BANF community.',
                    profession: 'Puja Coordinator',
                    interests: ['Puja Organization', 'Cultural Traditions', 'Volunteer Management'],
                    yearJoined: 2023
                }
            }
        ];

        /**
         * Render EC team cards dynamically from EC_MEMBERS data array (Feature 4)
         */
        function renderECTeam() {
            const grid = document.getElementById('ec-team-grid');
            if (!grid) return;
            grid.innerHTML = EC_MEMBERS.map(m => `
                <div class="col-lg-3 col-md-4 col-6">
                    <div class="ec-card">
                        <div class="ec-avatar-wrapper">
                            ${m.photoUrl
                                ? `<img src="${m.photoUrl}" alt="${m.name}" class="ec-avatar-img" onerror="this.style.display='none';this.nextElementSibling.style.display='flex';">
                                   <div class="ec-avatar" style="background:${m.fallbackGradient};display:none;">${m.fallbackInitials}</div>`
                                : `<div class="ec-avatar" style="background:${m.fallbackGradient};">${m.fallbackInitials}</div>`
                            }
                        </div>
                        <span class="ec-position" ${m.positionStyle ? `style="${m.positionStyle}"` : ''}>${m.role}</span>
                        <h6>${m.name}</h6>
                        <p class="ec-short-bio">${m.bio}</p>
                        <a class="ec-view-profile" onclick="openProfileModal('${m.id}')" style="cursor:pointer;"><i class="fas fa-user-circle me-1"></i>View Profile</a>
                        <div class="ec-contact mt-2">
                            <a href="mailto:${m.email}" title="Email"><i class="fas fa-envelope"></i></a>
                            <a href="${m.linkedin}" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        /**
         * Open EC Member Profile Modal (Feature 5: dynamic modal from EC_MEMBERS data)
         */
        function openProfileModal(memberId) {
            const member = EC_MEMBERS.find(m => m.id === memberId);
            if (!member) return;

            // Remove existing dynamic modal if any
            const existing = document.getElementById('ecProfileModal');
            if (existing) existing.remove();

            const pd = member.profileData || {};
            const interestsHtml = (pd.interests || []).map(i => `<span class="badge bg-primary bg-opacity-75 me-1 mb-1">${i}</span>`).join('');
            
            const modalHtml = `
            <div class="modal fade" id="ecProfileModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content" style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border: 2px solid var(--gold); border-radius: 20px; overflow: hidden;">
                        <div class="modal-header border-0" style="background: ${member.fallbackGradient}; padding: 2rem;">
                            <div class="d-flex align-items-center gap-3 w-100">
                                <div style="width:80px;height:80px;border-radius:50%;overflow:hidden;border:3px solid rgba(255,255,255,0.5);flex-shrink:0;">
                                    ${member.photoUrl
                                        ? `<img src="${member.photoUrl}" alt="${member.name}" style="width:100%;height:100%;object-fit:cover;" onerror="this.parentElement.innerHTML='<div style=\\'display:flex;align-items:center;justify-content:center;width:100%;height:100%;font-size:1.5rem;font-weight:bold;color:#fff;background:${member.fallbackGradient.replace(/'/g, "\\'")}\\'>${member.fallbackInitials}</div>'">`
                                        : `<div style="display:flex;align-items:center;justify-content:center;width:100%;height:100%;font-size:1.5rem;font-weight:bold;color:#fff;background:${member.fallbackGradient}">${member.fallbackInitials}</div>`
                                    }
                                </div>
                                <div>
                                    <h4 class="text-white mb-1">${member.name}</h4>
                                    <span class="badge" style="background: rgba(255,255,255,0.2); font-size: 0.9rem;">${member.role}</span>
                                </div>
                            </div>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body p-4">
                            ${pd.quote ? `<blockquote class="blockquote text-center mb-4"><p class="text-warning fst-italic" style="font-size:1rem;">${pd.quote}</p></blockquote>` : ''}
                            <div class="row g-4">
                                <div class="col-md-8">
                                    <h6 class="text-warning mb-2"><i class="fas fa-user me-2"></i>About</h6>
                                    <p class="text-light">${pd.fullBio || member.bio}</p>
                                    ${pd.education ? `<p class="text-light mb-1"><i class="fas fa-graduation-cap me-2 text-info"></i><strong>Education:</strong> ${pd.education}</p>` : ''}
                                    ${pd.profession ? `<p class="text-light mb-3"><i class="fas fa-briefcase me-2 text-info"></i><strong>Profession:</strong> ${pd.profession}</p>` : ''}
                                </div>
                                <div class="col-md-4">
                                    <h6 class="text-warning mb-2"><i class="fas fa-info-circle me-2"></i>Details</h6>
                                    <p class="text-light mb-1"><i class="fas fa-envelope me-2 text-muted"></i><a href="mailto:${member.email}" class="text-info" style="text-decoration:none">${member.email}</a></p>
                                    ${pd.yearJoined ? `<p class="text-light mb-1"><i class="fas fa-calendar-alt me-2 text-muted"></i>EC since ${pd.yearJoined}</p>` : ''}
                                    ${interestsHtml ? `<div class="mt-3"><h6 class="text-warning mb-2"><i class="fas fa-heart me-2"></i>Interests</h6>${interestsHtml}</div>` : ''}
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer border-0">
                            <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>`;

            document.body.insertAdjacentHTML('beforeend', modalHtml);
            const modal = new bootstrap.Modal(document.getElementById('ecProfileModal'));
            modal.show();

            // Clean up on close
            document.getElementById('ecProfileModal').addEventListener('hidden.bs.modal', function() {
                this.remove();
            });
        }

        // ========== RADIO PLAYER FUNCTIONALITY ==========
        let radioAudio = null;
        let isRadioPlaying = false;
        let currentSchedule = [];
        let currentProgramIndex = 0;
        let currentProgram = null;
        
        // ========== API CONFIGURATION ==========
        // All API calls route through Wix Velo HTTP Functions at /_functions/
        const WIX_SITE_URL = (() => {
            // Auto-detect API base URL based on hosting context
            const hostname = window.location.hostname || '';
            if (hostname.includes('jaxbengali.org')) {
                // Custom domain - route API through Wix staging (/_functions not configured on custom domain yet)
                return 'https://banfwix.wixsite.com/banf1';
            }
            // Default: Wix staging site where backend v2.1.0 is deployed and confirmed working
            return 'https://banfwix.wixsite.com/banf1';
        })();
        const WIX_API_BASE = WIX_SITE_URL + '/_functions';
        const GMAIL_API_BASE = WIX_API_BASE;
        const RADIO_API_BASE = WIX_API_BASE;
        const RADIO_ENDPOINTS = {
            schedule: `${WIX_API_BASE}/radio_schedule`,
            currentStatus: `${WIX_API_BASE}/radio_status`,
            startCurrent: `${WIX_API_BASE}/radio_start`,
            nextTrack: `${WIX_API_BASE}/radio_next`,
            previousTrack: `${WIX_API_BASE}/radio_previous`
        };
        
        /**
         * API endpoint mapper - translates REST paths to Wix Velo HTTP Function paths
         * e.g. '/send-evite' → https://www.jaxbengali.org/_functions/send_evite
         */
        function apiUrl(endpoint) {
            // Accept both '/foo' and '/email/foo' styles for backward compatibility
            if (endpoint === '/email/status') endpoint = '/status';
            if (endpoint === '/email/unread') endpoint = '/unread';
            if (endpoint === '/email/send') endpoint = '/send';

            // Map REST paths → Wix flat function names
            const routeMap = {
                '/status':          '/email_status',
                '/unread':          '/email_unread',
                '/send':            '/send_email',
                '/send-evite':      '/send_evite',
                '/contacts':        '/contacts',
                '/contacts/group':  '/contact_group_create',
                '/rsvp-check':      '/rsvp_check'
            };
            
            // Direct mapping
            if (routeMap[endpoint]) return WIX_API_BASE + routeMap[endpoint];
            
            // Dynamic paths with parameters
            if (endpoint.startsWith('/inbox'))   return WIX_API_BASE + '/email_inbox' + endpoint.replace('/inbox', '');
            if (endpoint.startsWith('/search'))  return WIX_API_BASE + '/email_search' + endpoint.replace('/search', '');
            if (endpoint.startsWith('/email/'))  return WIX_API_BASE + '/email_message?id=' + endpoint.split('/email/')[1].split('?')[0] + (endpoint.includes('?') ? '&' + endpoint.split('?')[1] : '');
            if (endpoint.startsWith('/mark-read/')) return WIX_API_BASE + '/email_mark_read';
            if (endpoint.startsWith('/delete/'))    return WIX_API_BASE + '/email_delete';
            if (endpoint.includes('/contacts/group/') && endpoint.includes('/add'))    return WIX_API_BASE + '/contact_group_add';
            if (endpoint.includes('/contacts/group/') && endpoint.includes('/remove')) return WIX_API_BASE + '/contact_group_remove';
            if (endpoint.match(/\/contacts\/group\/[^/]+$/)) return WIX_API_BASE + '/contact_group_delete';
            
            // Fallback
            return WIX_API_BASE + endpoint.replace(/-/g, '_').replace(/\//g, '_');
        }
        
        /**
         * Enhanced fetch wrapper for Wix API compatibility
         * - Converts DELETE methods to POST (Wix HTTP functions only support GET/POST)
         * - Adds group_name/id to body for Wix endpoints that need it
         */
        function apiFetch(endpoint, options = {}) {
            let url = apiUrl(endpoint);
            let opts = { ...options };

            // Add timeout to prevent indefinite hangs (default 10s)
            if (!opts.signal) {
                opts.signal = AbortSignal.timeout(options.timeout || 10000);
            }
            delete opts.timeout;
            
            // Wix only supports GET and POST - convert DELETE to POST
            if (opts.method === 'DELETE') {
                opts.method = 'POST';
                const deleteIdMatch = endpoint.match(/\/delete\/(.+)/);
                if (deleteIdMatch) {
                    opts.headers = opts.headers || { 'Content-Type': 'application/json' };
                    opts.body = JSON.stringify({ id: deleteIdMatch[1] });
                }
            }
            
            // For mark-read, extract ID from URL into body
            const markReadMatch = endpoint.match(/\/mark-read\/(.+)/);
            if (markReadMatch) {
                opts.method = 'POST';
                opts.headers = { 'Content-Type': 'application/json' };
                opts.body = JSON.stringify({ id: markReadMatch[1] });
            }
            
            // For contact group operations, extract group name from URL into body
            const groupMatch = endpoint.match(/\/contacts\/group\/([^/]+)/);
            if (groupMatch) {
                const groupName = decodeURIComponent(groupMatch[1]);
                opts.method = opts.method || 'POST';
                opts.headers = opts.headers || { 'Content-Type': 'application/json' };
                
                if (endpoint.includes('/add') || endpoint.includes('/remove')) {
                    let existingBody = {};
                    try { existingBody = JSON.parse(opts.body || '{}'); } catch(e) {}
                    existingBody.group_name = groupName;
                    opts.body = JSON.stringify(existingBody);
                } else if (opts.method === 'POST' && !endpoint.includes('/add') && !endpoint.includes('/remove')) {
                    opts.body = JSON.stringify({ group_name: groupName });
                }
            }
            
            return fetch(url, opts);
        }

        /**
         * Safe API fetch — checks HTTP status and parses JSON safely.
         * Returns { ok, status, data } instead of raw Response.
         * Handles 404 (endpoint not deployed) and non-JSON responses gracefully.
         */
        async function safeApiFetch(endpoint, options = {}) {
            try {
                const r = await apiFetch(endpoint, options);
                if (r.status === 404) {
                    return { ok: false, status: 404, data: { error: 'API endpoint not found. Wix Velo backend may not be published yet.' } };
                }
                if (!r.ok) {
                    const txt = await r.text().catch(() => '');
                    return { ok: false, status: r.status, data: { error: txt || `HTTP ${r.status}` } };
                }
                const contentType = r.headers.get('content-type') || '';
                if (!contentType.includes('application/json')) {
                    const txt = await r.text().catch(() => '');
                    if (txt.startsWith('{') || txt.startsWith('[')) {
                        try { return { ok: true, status: r.status, data: JSON.parse(txt) }; } catch(e) {}
                    }
                    return { ok: false, status: r.status, data: { error: 'Non-JSON response from server' } };
                }
                const d = await r.json();
                return { ok: true, status: r.status, data: d };
            } catch(e) {
                return { ok: false, status: 0, data: { error: e.message || 'Network error' } };
            }
        }
        
        // Program categories with display info
        const PROGRAM_CATEGORIES = {
            'Classical_Music': { name: 'Classical Music', icon: '🎻', color: '#8B4513' },
            'Folk_Music': { name: 'Folk Music', icon: '🪘', color: '#228B22' },
            'Modern_Music': { name: 'Modern Music', icon: '🎵', color: '#4169E1' },
            'Literature': { name: 'Literature', icon: '📚', color: '#800080' },
            'Philosophy': { name: 'Philosophy', icon: '🧘', color: '#DAA520' },
            'Devotional': { name: 'Devotional', icon: '🙏', color: '#FF6347' },
            'Children': { name: 'Children\'s Hour', icon: '👶', color: '#FF69B4' },
            'Health_Wellness': { name: 'Health & Wellness', icon: '💪', color: '#32CD32' },
            'Cultural_Arts': { name: 'Cultural Arts', icon: '🎨', color: '#FF8C00' },
            'Family_Entertainment': { name: 'Family Entertainment', icon: '👨‍👩‍👧‍👦', color: '#9932CC' },
            'News_Current': { name: 'News & Current Affairs', icon: '📰', color: '#4682B4' },
            'Traditional_Music': { name: 'Traditional Music', icon: '🎼', color: '#CD853F' }
        };
        
        // ========== MULTI-SOURCE RADIO ENGINE ==========
        // Source: 'live' | 'archive' | 'youtube' | 'spotify'
        let radioSource = 'live';
        let currentStationIndex = Math.floor(Math.random() * 5); // Random start, not always Radio Bhumi
        let lastPlayedStation = null; // Track last station to avoid repetition
        let archiveTrackIndex = 0;
        let archivePlaylist = [];
        let progressInterval = null;

        // ---- LIVE RADIO: Verified Bengali/English streams (Feb 2026) ----
        const liveStations = [
            // Bengali - Bangladesh
            { name: 'Radio Bhumi', url: 'https://stream.zeno.fm/ybf1umk1k18uv', category: 'Modern_Music', lang: 'bn' },
            { name: 'Rajshahi FM', url: 'https://stream.zeno.fm/nxfshdayjrdvv', category: 'Modern_Music', lang: 'bn' },
            { name: 'Radio GoonGoon 192k', url: 'https://audio.streamcast.xyz/listen/radiogoongoon/radio.mp3', category: 'Modern_Music', lang: 'bn' },
            { name: 'A2Z Radio Bangladesh', url: 'https://listen.radioking.com/radio/1743/stream/125', category: 'Modern_Music', lang: 'bn' },
            { name: 'Radio Vivid Voice', url: 'https://stream.zeno.fm/xuin6ocdc2juv', category: 'Family_Entertainment', lang: 'bn' },
            // Bengali - India (Kolkata)
            { name: 'AIR Akashvani Maitree Kolkata', url: 'https://airhlspush.pc.cdn.bitgravity.com/httppush/hlspbaudio245/hlspbaudio24564kbps.m3u8', category: 'Classical_Music', lang: 'bn' },
            { name: 'AIR Kolkata Geetanjali', url: 'https://airhlspush.pc.cdn.bitgravity.com/httppush/hlspbaudio055/hlspbaudio05564kbps.m3u8', category: 'Classical_Music', lang: 'bn' },
            { name: 'Akashvani FM Rainbow Kolkata', url: 'https://airhlspush.pc.cdn.bitgravity.com/httppush/hlspbaudio058/hlspbaudio05864kbps.m3u8', category: 'Modern_Music', lang: 'bn' },
            { name: 'AIR FM Gold Kolkata', url: 'https://airhlspush.pc.cdn.bitgravity.com/httppush/hlspbaudio057/hlspbaudio05764kbps.m3u8', category: 'Traditional_Music', lang: 'bn' },
            { name: 'Radio Quarantine Kolkata', url: 'https://stream-173.zeno.fm/krk4kw830tzuv', category: 'Modern_Music', lang: 'bn' },
            { name: 'Ankora Radio', url: 'https://stream-153.zeno.fm/xush70b1cbruv', category: 'Modern_Music', lang: 'bn' },
            { name: 'Radio Bangla Net', url: 'https://playerservices.streamtheworld.com/api/livestream-redirect/SP_R3563475_SC', category: 'Folk_Music', lang: 'bn' },
            { name: 'Hot Now Bangla', url: 'https://stream.radiotreetal.com/listen', category: 'Modern_Music', lang: 'bn' },
            // English / Classical
            { name: 'Monocle 24 World Radio', url: 'https://playerservices.streamtheworld.com/api/livestream-redirect/MONOCLE_24.mp3', category: 'News_Current', lang: 'en' },
            { name: 'SomaFM Suburbs of Goa', url: 'https://ice4.somafm.com/suburbsofgoa-128-aac', category: 'Traditional_Music', lang: 'en' },
            { name: 'Radio Udaan', url: 'https://stream.radioudaan.com/listen/radio_udaan/radio.mp3', category: 'Family_Entertainment', lang: 'en' },
            { name: 'Live FM Bahrain', url: 'https://stream.aiir.com/dbv0rxpwp6ytv', category: 'Modern_Music', lang: 'en' }
        ];

        // ---- ARCHIVE.ORG: Bengali music collections ----
        const archiveCollections = {
            Classical_Music: [
                { id: 'ClassicSongVolume1', title: 'Rabindra Sangeet (A-J)', icon: '🎵' },
                { id: 'RanarRanar', title: 'Rabindra Sangeet (K-S)', icon: '🎵' },
                { id: 'TomarHoloShuru', title: 'Rabindra Sangeet (T)', icon: '🎵' },
                { id: 'EklaCholoRe', title: 'Ekla Cholo Re', icon: '🎵' }
            ],
            Modern_Music: [
                { id: 'BengaliBestEverSongs', title: 'Bengali Best Ever Songs', icon: '🎶' }
            ],
            Devotional: [
                { id: 'purvaraga', title: 'Bengali Kirtan', icon: '🙏' }
            ],
            Literature: [
                { id: 'sundaysuspenseonline', title: 'Sunday Suspense (Radio Mirchi)', icon: '📖' }
            ],
            Folk_Music: [
                { id: 'ClassicSongVolume1', title: 'Bengali Folk & Baul', icon: '🪕' }
            ]
        };

        // ---- YOUTUBE: Bengali playlists ----
        const youtubePlaylistMap = {
            Classical_Music: { id: 'PLtTLBM8bOQ2YoR0kLr7SLYEA73oP0LvZ_', title: 'Rabindra Sangeet Collection' },
            Modern_Music: { id: 'PLCiNIjnMnRO47A0QBwdXIcBB3D0xOKTbC', title: 'Bengali Modern Hits' },
            Folk_Music: { id: 'PLBKaSsmcB-h_RIKXy9hS5v2VGPaLBYJVu', title: 'Bengali Baul & Folk' },
            Devotional: { id: 'PLIHvyF39qkHl3TQO6jKXGPKCFI0iqj7cX', title: 'Bengali Devotional' },
            Literature: { id: 'PLhVChdEXoJ7NN_rRlkYQsN0TBpjVLVaQ3', title: 'Sunday Suspense Stories' },
            Children: { id: 'PLfD1S01gIFtJ42TXBZx_FJz-BgQNrMjCX', title: 'Bengali Rhymes & Songs' }
        };

        // ---- SPOTIFY: Bengali playlists ----
        const spotifyPlaylistMap = {
            Classical_Music: { id: '37i9dQZF1DX6XceWZP1znY', title: 'Rabindra Sangeet Essentials' },
            Modern_Music: { id: '37i9dQZF1DWVlMBeCqWV6S', title: 'Bengali Hits Today' },
            Folk_Music: { id: '37i9dQZF1DX0XUfTFmNBRM', title: 'Bengali Folk & Baul' },
            Devotional: { id: '37i9dQZF1DX7WNaWPc1jDN', title: 'Bengali Devotional' }
        };

        // ---- DAILY SCHEDULE (Liquidsoap-inspired auto-rotation) ----
        const dailySchedule = [
            { hour: 6,  name: 'Prabhati Sangeet',    category: 'Devotional',          icon: '🙏', preferSource: 'archive' },
            { hour: 8,  name: 'Morning Ragas',       category: 'Classical_Music',      icon: '🎻', preferSource: 'live' },
            { hour: 10, name: 'Rabindra Sangeet',    category: 'Classical_Music',      icon: '🎵', preferSource: 'archive' },
            { hour: 12, name: 'Bengali Modern Hits', category: 'Modern_Music',         icon: '🎶', preferSource: 'live' },
            { hour: 14, name: 'Folk Melodies',       category: 'Folk_Music',           icon: '🪕', preferSource: 'archive' },
            { hour: 16, name: 'Children\'s Hour',    category: 'Children',             icon: '👶', preferSource: 'youtube' },
            { hour: 18, name: 'Evening Ragas',       category: 'Classical_Music',      icon: '🎻', preferSource: 'live' },
            { hour: 20, name: 'Literature Corner',   category: 'Literature',           icon: '📖', preferSource: 'archive' },
            { hour: 22, name: 'Night Music',         category: 'Modern_Music',         icon: '🌙', preferSource: 'live' }
        ];

        /** Get the current scheduled program based on time */
        function getCurrentScheduleSlot() {
            const hour = new Date().getHours();
            let current = dailySchedule[dailySchedule.length - 1]; // default last
            for (let i = dailySchedule.length - 1; i >= 0; i--) {
                if (hour >= dailySchedule[i].hour) { current = dailySchedule[i]; break; }
            }
            return current;
        }

        /** Build the schedule strip UI */
        function buildScheduleStrip() {
            const strip = document.getElementById('scheduleStrip');
            const currentSlot = getCurrentScheduleSlot();
            if (strip) {
                strip.innerHTML = dailySchedule.map(s => {
                    const active = s.hour === currentSlot.hour ? ' active' : '';
                    const h = s.hour > 12 ? (s.hour - 12) + 'P' : (s.hour === 0 ? '12A' : s.hour + 'A');
                    return `<div class="schedule-chip${active}" onclick="playScheduleSlot(${s.hour})" title="${s.name}">
                        <span>${s.icon}</span><span class="chip-time">${h}</span>
                    </div>`;
                }).join('');
            }
            // Also populate member portal schedule list
            const memberList = document.getElementById('memberScheduleList');
            if (memberList) {
                memberList.innerHTML = dailySchedule.map(s => {
                    const isNow = s.hour === currentSlot.hour;
                    const timeStr = s.hour === 0 ? '12 AM' : s.hour < 12 ? s.hour + ' AM' : s.hour === 12 ? '12 PM' : (s.hour - 12) + ' PM';
                    const bg = isNow ? ' style="background:#e8f5e9; cursor:pointer;"' : ' style="cursor:pointer;"';
                    const label = isNow ? '<small class="text-success fw-bold">▶ Now</small>' : `<small class="text-muted">${s.category.replace(/_/g, ' ')}</small>`;
                    return `<div class="d-flex justify-content-between p-2 border-bottom"${bg} onclick="playScheduleSlot(${s.hour})">
                        <span>${s.icon} ${timeStr} — ${s.name}</span>${label}
                    </div>`;
                }).join('');
            }
        }

        /** Play a specific schedule slot */
        function playScheduleSlot(hour) {
            const slot = dailySchedule.find(s => s.hour === hour);
            if (!slot) return;
            // Switch to the slot's preferred source
            switchRadioSource(slot.preferSource, slot.category);
            // Force new random station selection by clearing last played
            lastPlayedStation = null;
            if (!isRadioPlaying) toggleRadio();
        }

        /** Switch radio source (live / archive / youtube / spotify) */
        function switchRadioSource(source, category) {
            radioSource = source;
            // Update tab UI
            document.querySelectorAll('.radio-source-tab').forEach(t => {
                t.classList.toggle('active', t.dataset.source === source);
            });
            // Update status label
            const labels = { live: '📻 LIVE RADIO', archive: '📚 ARCHIVE.ORG', youtube: '▶️ YOUTUBE', spotify: '🎧 SPOTIFY' };
            const label = document.getElementById('radioSourceLabel');
            if (label) label.textContent = labels[source] || source.toUpperCase();
            // Show/hide progress bar (only for archive tracks)
            const prog = document.getElementById('radioProgress');
            if (prog) prog.style.display = source === 'archive' ? 'block' : 'none';
            // Use current schedule slot category if not specified
            const cat = category || getCurrentScheduleSlot().category;
            // If playing, switch to new source immediately; if not, start playing
            if (isRadioPlaying) {
                if (source === 'live') playLiveByCategory(cat);
                else if (source === 'archive') playArchiveByCategory(cat);
                else if (source === 'youtube') showYouTubeEmbed(cat);
                else if (source === 'spotify') showSpotifyEmbed(cat);
            } else {
                // Start playing on source switch
                if (source === 'live') { playLiveByCategory(cat); toggleRadio(); }
                else if (source === 'archive') { toggleRadio(); }
                else if (source === 'youtube') showYouTubeEmbed(cat);
                else if (source === 'spotify') showSpotifyEmbed(cat);
            }
        }

        // ========== LIVE RADIO FUNCTIONS ==========
        function playLiveByCategory(category) {
            let matching = liveStations.filter(s => s.category === category);
            
            // If multiple matches, filter out last played station for variety
            if (matching.length > 1 && lastPlayedStation) {
                const filtered = matching.filter(s => s.url !== lastPlayedStation.url);
                if (filtered.length > 0) matching = filtered;
            }
            
            // Pick random station from matching category (not always first)
            const station = matching.length > 0 
                ? matching[Math.floor(Math.random() * matching.length)]
                : liveStations[Math.floor(Math.random() * liveStations.length)];
            
            currentStationIndex = liveStations.indexOf(station);
            lastPlayedStation = station; // Track for next call
            
            if (isRadioPlaying) {
                radioAudio.src = station.url;
                radioAudio.play().catch(() => {});
            }
            updateNowPlaying(`📻 ${station.name}`);
            updateNowPlayingSub(station.lang === 'bn' ? 'Bengali' : 'English');
        }

        // ========== ARCHIVE.ORG FUNCTIONS (Liquidsoap-style playlist) ==========
        async function loadArchivePlaylist(collectionId) {
            updateNowPlaying('⏳ Loading collection...');
            try {
                const controller = new AbortController();
                setTimeout(() => controller.abort(), 8000);
                const resp = await fetch(`https://archive.org/metadata/${collectionId}`, { signal: controller.signal });
                const meta = await resp.json();
                // Filter MP3 files only (originals)
                archivePlaylist = (meta.files || [])
                    .filter(f => f.name && f.name.endsWith('.mp3') && f.source === 'original')
                    .map(f => ({
                        name: (f.title || f.name.replace('.mp3', '')).replace(/_/g, ' '),
                        url: `https://archive.org/download/${collectionId}/${encodeURIComponent(f.name)}`,
                        duration: f.length ? parseFloat(f.length) : 0
                    }));
                // Shuffle for variety (Liquidsoap-style random rotation)
                for (let i = archivePlaylist.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [archivePlaylist[i], archivePlaylist[j]] = [archivePlaylist[j], archivePlaylist[i]];
                }
                archiveTrackIndex = 0;
                if (archivePlaylist.length > 0) {
                    playArchiveTrack();
                } else {
                    updateNowPlaying('No tracks found in this collection');
                }
            } catch (e) {
                console.warn('Archive.org load error:', e);
                updateNowPlaying('Archive.org unavailable — try Live Radio');
            }
        }

        function playArchiveTrack() {
            if (archivePlaylist.length === 0) return;
            const track = archivePlaylist[archiveTrackIndex];
            radioAudio.src = track.url;
            radioAudio.play().catch(() => {});
            isRadioPlaying = true;
            updatePlayButton(true);
            updateNowPlaying(`🎵 ${track.name}`);
            updateNowPlayingSub(`Track ${archiveTrackIndex + 1} of ${archivePlaylist.length}`);
            startProgressTracking();
        }

        function playArchiveByCategory(category) {
            const collections = archiveCollections[category] || archiveCollections['Classical_Music'];
            // Already randomized - keep existing logic
            const pick = collections[Math.floor(Math.random() * collections.length)];
            loadArchivePlaylist(pick.id);
        }

        /** Auto-advance to next track when current ends (Liquidsoap crossfade concept) */
        function setupArchiveAutoAdvance() {
            if (!radioAudio) return;
            radioAudio.addEventListener('ended', () => {
                if (radioSource === 'archive' && archivePlaylist.length > 0) {
                    archiveTrackIndex = (archiveTrackIndex + 1) % archivePlaylist.length;
                    playArchiveTrack();
                }
            });
        }

        /** Progress bar tracking */
        function startProgressTracking() {
            clearInterval(progressInterval);
            progressInterval = setInterval(() => {
                if (radioAudio && radioAudio.duration && radioSource === 'archive') {
                    const pct = (radioAudio.currentTime / radioAudio.duration) * 100;
                    const fill = document.getElementById('radioProgressFill');
                    if (fill) fill.style.width = pct + '%';
                }
            }, 500);
        }

        /** Seek within archive track */
        function seekRadio(event) {
            if (radioSource !== 'archive' || !radioAudio || !radioAudio.duration) return;
            const bar = document.getElementById('radioProgress');
            const rect = bar.getBoundingClientRect();
            const pct = (event.clientX - rect.left) / rect.width;
            radioAudio.currentTime = pct * radioAudio.duration;
        }

        // ========== YOUTUBE / SPOTIFY EMBEDS ==========
        function showYouTubeEmbed(category) {
            const entry = youtubePlaylistMap[category] || youtubePlaylistMap['Modern_Music'];
            if (!entry) return;
            // Pause native audio
            if (radioAudio) { radioAudio.pause(); radioAudio.src = ''; }
            updateNowPlaying(`▶️ ${entry.title}`);
            updateNowPlayingSub('YouTube Playlist — opens in new tab');
            // Open YouTube playlist in new tab (can't embed due to CORS on GitHub Pages)
            window.open(`https://www.youtube.com/playlist?list=${entry.id}`, '_blank');
        }

        function showSpotifyEmbed(category) {
            const entry = spotifyPlaylistMap[category] || spotifyPlaylistMap['Modern_Music'];
            if (!entry) return;
            if (radioAudio) { radioAudio.pause(); radioAudio.src = ''; }
            updateNowPlaying(`🎧 ${entry.title}`);
            updateNowPlayingSub('Spotify Playlist — opens in new tab');
            window.open(`https://open.spotify.com/playlist/${entry.id}`, '_blank');
        }

        // ========== DISCOVER LIVE STATIONS (RadioBrowser API) ==========
        async function discoverLiveStations() {
            const searchTags = ['bengali', 'bangla', 'bangladesh', 'kolkata'];
            let totalDiscovered = 0;
            for (const tag of searchTags) {
                try {
                    const controller = new AbortController();
                    setTimeout(() => controller.abort(), 5000);
                    const response = await fetch(
                        `https://de1.api.radio-browser.info/json/stations/search?tag=${tag}&limit=6&order=clickcount&reverse=true&hidebroken=true`,
                        { signal: controller.signal }
                    );
                    const stations = await response.json();
                    stations.filter(s =>
                        s.url_resolved &&
                        s.url_resolved.startsWith('https://') &&
                        (s.codec === 'MP3' || s.codec === 'AAC' || s.codec === 'AAC+')
                    ).forEach(s => {
                        if (!liveStations.some(fs => fs.url === s.url_resolved)) {
                            liveStations.push({
                                name: s.name || 'Bengali Radio',
                                url: s.url_resolved,
                                category: 'Modern_Music',
                                lang: 'bn'
                            });
                            totalDiscovered++;
                        }
                    });
                } catch (e) { /* continue */ }
            }
            if (totalDiscovered > 0) console.log(`📻 Discovered ${totalDiscovered} additional Bengali streams`);
        }
        discoverLiveStations();

        // ========== CORE PLAYER FUNCTIONS ==========
        function initRadioPlayer() {
            radioAudio = new Audio();
            radioAudio.volume = 0.8;
            radioAudio.addEventListener('playing', () => {
                isRadioPlaying = true;
                radioAudio._retryCount = 0;
                updatePlayButton(true);
            });
            radioAudio.addEventListener('pause', () => {
                isRadioPlaying = false;
                updatePlayButton(false);
            });
            radioAudio.addEventListener('error', () => {
                if (!radioAudio._retryCount) radioAudio._retryCount = 0;
                radioAudio._retryCount++;
                if (radioAudio._retryCount <= 3 && isRadioPlaying) {
                    // Auto-skip to next station/track
                    skipStation(1);
                } else {
                    radioAudio._retryCount = 0;
                    updateNowPlaying('Stream unavailable — click ▶ to retry');
                    isRadioPlaying = false;
                    updatePlayButton(false);
                }
            });
            setupArchiveAutoAdvance();
            buildScheduleStrip();
            // Auto-detect schedule slot
            const slot = getCurrentScheduleSlot();
            updateNowPlayingSub(`${slot.icon} ${slot.name} — Click play to start`);
        }

        async function toggleRadio() {
            if (!radioAudio) { initRadioPlayer(); if (!radioAudio) return; }
            if (isRadioPlaying) {
                radioAudio.pause();
                radioAudio.src = '';
                isRadioPlaying = false;
                clearInterval(progressInterval);
                updatePlayButton(false);
                updateNowPlaying('🎵 Bengali Music — Click play to start');
                updateNowPlayingSub('Rabindra Sangeet • Folk • Modern Bengali • Classical');
                return;
            }
            updateNowPlaying('⏳ Connecting...');
            updatePlayButton(true);

            // Route to current source
            if (radioSource === 'youtube') {
                const slot = getCurrentScheduleSlot();
                showYouTubeEmbed(slot.category);
                return;
            }
            if (radioSource === 'spotify') {
                const slot = getCurrentScheduleSlot();
                showSpotifyEmbed(slot.category);
                return;
            }
            if (radioSource === 'archive') {
                const slot = getCurrentScheduleSlot();
                await playArchiveByCategory(slot.category);
                return;
            }
            // Live radio
            try {
                const controller = new AbortController();
                setTimeout(() => controller.abort(), 3000);
                const resp = await fetch(RADIO_ENDPOINTS.startCurrent, { method: 'POST', signal: controller.signal });
                const data = await resp.json();
                if (data.stream_url) {
                    radioAudio.src = data.stream_url;
                    currentProgram = data;
                    updateNowPlayingFromAPI(data);
                    await radioAudio.play();
                    isRadioPlaying = true;
                    return;
                }
            } catch (e) { /* API unavailable, use fallback */ }
            // Fallback: use liveStations array
            radioAudio.src = liveStations[currentStationIndex].url;
            updateNowPlaying(`📻 ${liveStations[currentStationIndex].name}`);
            updateNowPlayingSub(liveStations[currentStationIndex].lang === 'bn' ? 'Bengali' : 'English');
            try { await radioAudio.play(); isRadioPlaying = true; updatePlayButton(true); }
            catch (err) { updateNowPlaying('Click play again to start'); isRadioPlaying = false; updatePlayButton(false); }
        }

        function skipStation(direction) {
            if (radioSource === 'archive' && archivePlaylist.length > 0) {
                archiveTrackIndex = (archiveTrackIndex + direction + archivePlaylist.length) % archivePlaylist.length;
                if (isRadioPlaying) playArchiveTrack();
                else {
                    updateNowPlaying(`🎵 ${archivePlaylist[archiveTrackIndex].name}`);
                    updateNowPlayingSub(`Track ${archiveTrackIndex + 1} of ${archivePlaylist.length}`);
                }
                return;
            }
            if (radioSource === 'youtube') {
                const categories = Object.keys(youtubePlaylistMap);
                const currentCat = getCurrentScheduleSlot().category;
                const idx = categories.indexOf(currentCat);
                const nextCat = categories[(idx + direction + categories.length) % categories.length];
                showYouTubeEmbed(nextCat);
                return;
            }
            if (radioSource === 'spotify') {
                const categories = Object.keys(spotifyPlaylistMap);
                const currentCat = getCurrentScheduleSlot().category;
                const idx = categories.indexOf(currentCat);
                const nextCat = categories[(idx + direction + categories.length) % categories.length];
                showSpotifyEmbed(nextCat);
                return;
            }
            // Live radio skip
            currentStationIndex = (currentStationIndex + direction + liveStations.length) % liveStations.length;
            const station = liveStations[currentStationIndex];
            lastPlayedStation = station;
            if (isRadioPlaying) {
                radioAudio.src = station.url;
                radioAudio.play().catch(() => {
                    updateNowPlaying('Stream unavailable — skipping...');
                    // Auto-skip on failure
                    setTimeout(() => skipStation(direction), 500);
                });
            }
            updateNowPlaying(`📻 ${station.name}`);
            updateNowPlayingSub(`${station.lang === 'bn' ? 'Bengali' : 'English'} • Station ${currentStationIndex + 1}/${liveStations.length}`);
            // Sync member portal display
            const memberNP = document.getElementById('memberNowPlaying');
            if (memberNP) memberNP.textContent = station.name;
            const memberCat = document.getElementById('memberRadioCategory');
            if (memberCat) memberCat.textContent = `${station.lang === 'bn' ? 'Bengali' : 'English'} • ${station.category.replace(/_/g, ' ')}`;
        }

        function updateNowPlayingFromAPI(data) {
            const np = document.getElementById('nowPlaying');
            if (np && data) {
                const cat = PROGRAM_CATEGORIES[data.category] || { icon: '🎵', name: data.category };
                np.innerHTML = `${cat.icon} ${data.program_name || data.title}`;
            }
        }

        async function fetchCurrentSchedule() {
            try {
                const controller = new AbortController();
                setTimeout(() => controller.abort(), 3000);
                const resp = await fetch(RADIO_ENDPOINTS.currentStatus, { signal: controller.signal });
                const data = await resp.json();
                if (data && data.current_program) { currentProgram = data.current_program; updateNowPlayingFromAPI(data.current_program); }
            } catch (e) {
                const slot = getCurrentScheduleSlot();
                updateNowPlaying(`${slot.icon} ${slot.name}`);
                updateNowPlayingSub('Click play to start');
            }
        }

        function updatePlayButton(playing) {
            const icon = document.getElementById('radioPlayIcon');
            if (icon) icon.className = playing ? 'fas fa-stop' : 'fas fa-play';
            // Animate vinyl disc and equalizer
            const vinyl = document.querySelector('.radio-vinyl');
            if (vinyl) vinyl.classList.toggle('spinning', playing);
            const eq = document.getElementById('radioEqualizer');
            if (eq) eq.classList.toggle('active', playing);
        }

        function updateNowPlaying(text) {
            const np = document.getElementById('nowPlaying');
            if (np) np.innerHTML = text || `🎵 ${liveStations[currentStationIndex].name}`;
        }

        function updateNowPlayingSub(text) {
            const sub = document.getElementById('nowPlayingSub');
            if (sub) sub.textContent = text || '';
        }

        document.addEventListener('DOMContentLoaded', () => { initRadioPlayer(); fetchCurrentSchedule(); });

        // ========== ADMIN RADIO CONTROL FUNCTIONS ==========
        function toggleRadioStatus() {
            const btn = document.getElementById('radioStatusBtn');
            const text = document.getElementById('radioStatusText');
            if (text.textContent === 'Online') {
                text.textContent = 'Offline';
                btn.style.background = '#dc3545';
                alert('Radio station paused — Demo');
            } else {
                text.textContent = 'Online';
                btn.style.background = '';
                alert('Radio station resumed — Demo');
            }
        }

        function adminTogglePlay() {
            const btn = document.getElementById('adminPlayBtn');
            if (btn.innerHTML.includes('pause')) {
                btn.innerHTML = '<i class="fas fa-play me-1"></i>Paused';
                btn.className = 'btn btn-sm btn-warning';
                alert('Radio playback paused — Demo');
            } else {
                btn.innerHTML = '<i class="fas fa-pause me-1"></i>Playing';
                btn.className = 'btn btn-sm btn-success';
                alert('Radio playback resumed — Demo');
            }
        }

        function adminSkipTrack(direction) {
            const label = direction > 0 ? 'Next track loaded' : 'Previous track loaded';
            const nowPlaying = document.getElementById('adminNowPlaying');
            const tracks = ['Rabindra Sangeet Special', 'Bengali Modern Hits', 'Folk Melodies', 'Children\'s Hour', 'Evening Ragas', 'Literature Corner'];
            if (nowPlaying) {
                const current = tracks.indexOf(nowPlaying.textContent);
                const next = (current + direction + tracks.length) % tracks.length;
                nowPlaying.textContent = tracks[next];
            }
            alert(label + ' — Demo');
        }

        function adminRefreshStatus() {
            // Simulate refresh
            const listeners = document.getElementById('radioListeners');
            if (listeners) listeners.textContent = Math.floor(Math.random() * 40) + 10;
            alert('Status refreshed — Demo');
        }

        function approveSongRequest(btn) {
            const row = btn.closest('tr');
            const song = row.cells[1].textContent;
            row.style.background = '#d4edda';
            row.cells[3].innerHTML = '<span class="badge bg-success">Approved</span>';
            alert('Song request approved: ' + song + ' — Demo');
        }

        function rejectSongRequest(btn) {
            const row = btn.closest('tr');
            const song = row.cells[1].textContent;
            row.style.background = '#f8d7da';
            row.cells[3].innerHTML = '<span class="badge bg-danger">Rejected</span>';
            alert('Song request rejected: ' + song + ' — Demo');
        }

        // Member song request handler
        function handleSongRequest(form) {
            const title = document.getElementById('songRequestTitle').value;
            const artist = document.getElementById('songRequestArtist').value;
            const category = document.getElementById('songRequestCategory').value;
            const dedication = document.getElementById('songDedication').value;

            // Add to My Requests
            const container = document.getElementById('myRadioRequests');
            const newRequest = document.createElement('div');
            newRequest.className = 'd-flex justify-content-between align-items-center p-2 border-bottom';
            newRequest.innerHTML = `
                <div>
                    <strong>${title}</strong><br>
                    <small class="text-muted">${artist || 'Unknown'} • ${category}</small>
                    ${dedication ? '<br><small class="text-info"><i class="fas fa-heart me-1"></i>' + dedication.substring(0, 50) + '</small>' : ''}
                </div>
                <span class="badge bg-info">Submitted</span>
            `;
            container.insertBefore(newRequest, container.firstChild);

            alert('🎵 Song request submitted!\n\nSong: ' + title + '\nArtist: ' + (artist || 'N/A') + '\nCategory: ' + category + (dedication ? '\nDedication: ' + dedication : '') + '\n\nYour request will be reviewed by the radio team.');
            form.reset();
        }

        // Language Toggle for President's Message
        function toggleLanguage(lang) {
            const bengaliMsg = document.getElementById('message-bengali');
            const englishMsg = document.getElementById('message-english');
            const btnBengali = document.getElementById('btn-bengali');
            const btnEnglish = document.getElementById('btn-english');
            
            if (lang === 'bengali') {
                bengaliMsg.style.display = 'block';
                englishMsg.style.display = 'none';
                btnBengali.classList.add('active', 'btn-light');
                btnBengali.classList.remove('btn-outline-light');
                btnEnglish.classList.remove('active', 'btn-light');
                btnEnglish.classList.add('btn-outline-light');
            } else {
                bengaliMsg.style.display = 'none';
                englishMsg.style.display = 'block';
                btnEnglish.classList.add('active', 'btn-light');
                btnEnglish.classList.remove('btn-outline-light');
                btnBengali.classList.remove('active', 'btn-light');
                btnBengali.classList.add('btn-outline-light');
            }
        }

        // Smooth scroll for anchor links (skip links with onclick handlers to avoid conflicts)
        document.querySelectorAll('a[href^="#"]:not([onclick])').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                const href = this.getAttribute('href');
                if (!href || href === '#') return; // Skip bare # links
                e.preventDefault();
                const target = document.querySelector(href);
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Navbar scroll effect (optional - for when standalone)
        window.addEventListener('scroll', function() {
            const navbar = document.querySelector('.navbar');
            if (window.scrollY > 50) {
                navbar.style.background = 'rgba(26, 26, 46, 1)';
            } else {
                navbar.style.background = 'rgba(26, 26, 46, 0.98)';
            }
        });

        // Radio play button icon toggling is handled by initRadioPlayer() → updatePlayButton()

        // Contact form → sends via Wix Velo email API
        document.querySelector('.contact-form')?.addEventListener('submit', async function(e) {
            e.preventDefault();
            const form = this;
            const btn = form.querySelector('button[type="submit"]');
            const origHtml = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Sending...';
            try {
                const inputs = form.querySelectorAll('input, select, textarea');
                const name = inputs[0]?.value || '';
                const email = inputs[1]?.value || '';
                const subject = inputs[2]?.value || 'General Inquiry';
                const message = inputs[3]?.value || '';
                const result = await safeApiFetch('/email/send', {
                    method: 'POST',
                    body: JSON.stringify({
                        to: 'info@jaxbengali.org',
                        subject: `[BANF Contact] ${subject} - from ${name}`,
                        body: `Name: ${name}\nEmail: ${email}\nSubject: ${subject}\n\nMessage:\n${message}\n\n---\nSent via BANF website contact form`,
                        replyTo: email
                    })
                });
                if (result.ok) {
                    alert('✅ Thank you for your message! We will get back to you soon.');
                    form.reset();
                } else {
                    // Fallback to mailto if Wix backend not deployed
                    const mailtoBody = encodeURIComponent(`Name: ${name}\nEmail: ${email}\n\n${message}`);
                    const mailtoSubject = encodeURIComponent(`[BANF Contact] ${subject}`);
                    window.location.href = `mailto:info@jaxbengali.org?subject=${mailtoSubject}&body=${mailtoBody}`;
                }
            } catch(err) {
                console.error('[Contact Form]', err);
                alert('Thank you for your message! We will get back to you soon.');
                form.reset();
            } finally {
                btn.disabled = false;
                btn.innerHTML = origHtml;
            }
        });

        // ========== WIX API INTEGRATION LAYER ==========
        
        /**
         * BANF Wix API Configuration
         * Maps landing page actions to Wix backend APIs and pages
         * Based on velo_backend/*.jsw modules
         */
        const BANF_API = {
            // Site Configuration
            siteUrl: 'https://www.jaxbengali.org',
            siteId: 'c13ae8c5-7053-4f2d-9a9a-371869be4395',
            
            // HTTP Functions Base URL (from http-functions.js)
            httpFunctionsBase: '/_functions',
            
            // API Endpoints - Maps to velo_backend/*.jsw exports
            endpoints: {
                // members.jsw - Member Management
                members: {
                    register: '/members/register',       // registerMember()
                    profile: '/members/profile',         // getMemberById(), getCurrentMemberProfile()
                    payment: '/members/payment-history', // getPaymentHistory()
                    family: '/members/family'            // getFamilyMembers()
                },
                // events.jsw - Event Management
                events: {
                    list: '/_functions/get_events',      // getUpcomingEvents(), getPastEvents()
                    register: '/events/register',        // registerForEvent()
                    feedback: '/events/feedback',        // submitEventFeedback()
                    checkin: '/events/checkin'           // checkIntoEvent()
                },
                // radio.jsw - Radio Streaming
                radio: {
                    config: '/_functions/get_radio',     // getRadioStationConfig()
                    schedule: '/radio/schedule',         // getUpcomingShows()
                    request: '/radio/request',           // submitSongRequest()
                    library: '/radio/library'            // getSongLibrary()
                },
                // magazine.jsw - E-Magazine
                magazine: {
                    list: '/magazine/issues',            // getPublishedMagazines()
                    latest: '/magazine/latest',          // getLatestMagazine()
                    articles: '/magazine/articles',      // getArticlesByCategory()
                    submit: '/magazine/submit'           // submitArticle()
                },
                // guide.jsw - Jacksonville Guide
                guide: {
                    list: '/guide/listings',             // getAllListings()
                    category: '/guide/category',         // getGuideByCategory()
                    search: '/guide/search',             // searchGuide()
                    review: '/guide/review'              // submitReview()
                },
                // surveys.jsw - Community Surveys
                surveys: {
                    active: '/surveys/active',           // getActiveSurveys()
                    submit: '/surveys/submit',           // submitSurveyResponse()
                    results: '/surveys/results'          // getSurveyResults() (members only)
                },
                // complaints.jsw - Anonymous Complaints
                complaints: {
                    submit: '/complaints/submit',        // submitComplaint()
                    status: '/complaints/status',        // checkComplaintStatus()
                    followup: '/complaints/followup'     // addComplaintFollowUp()
                },
                // sponsorship.jsw - Sponsorship Management
                sponsors: {
                    list: '/_functions/get_sponsors',    // getSponsors()
                    tiers: '/sponsors/tiers',            // SPONSORSHIP_TIERS
                    apply: '/sponsors/apply'             // createSponsor()
                },
                // documents.jsw - Meeting Minutes & Documents
                documents: {
                    minutes: '/documents/minutes',       // getDocumentsByCategory('meeting_docs')
                    list: '/documents/list'              // getAllPublicDocuments()
                },
                // gallery.jsw - Photo Gallery
                gallery: {
                    list: '/_functions/get_gallery',     // getPublicGalleries()
                    photos: '/gallery/photos'            // getGalleryPhotos()
                }
            },
            
            // Wix Page Routes - Maps to actual Wix pages (from LandingPage.velo.js)
            pages: {
                home: '/',
                about: '/about',
                events: '/events',
                radio: '/radio',
                magazine: '/magazine',
                guide: '/guide',
                surveys: '/surveys',
                complaints: '/complaints',
                sponsors: '/sponsors',
                gallery: '/gallery',
                membership: '/member-payment',
                account: '/account',
                login: '/login',
                memberDashboard: '/member-dashboard',
                adminDashboard: '/admin-dashboard',
                membersArea: '/members-area'
            },
            
            // Action Types from backend modules
            actions: {
                JOIN_NOW: 'navigate_membership',
                VIEW_EVENTS: 'navigate_events',
                LISTEN_RADIO: 'navigate_radio',
                READ_MAGAZINE: 'navigate_magazine',
                EXPLORE_GUIDE: 'navigate_guide',
                TAKE_SURVEY: 'navigate_surveys',
                SUBMIT_COMPLAINT: 'navigate_complaints',
                VIEW_SPONSORS: 'navigate_sponsors',
                VIEW_GALLERY: 'navigate_gallery',
                LOGIN: 'navigate_login',
                CONTACT: 'scroll_contact'
            }
        };

        /**
         * Navigate to Wix page from embedded iframe
         * Uses postMessage to communicate with Wix parent window
         */
        function navigateToWixPage(pageKey, queryParams = {}) {
            const pagePath = BANF_API.pages[pageKey];
            if (!pagePath) {
                console.warn('Unknown page:', pageKey);
                return;
            }
            
            // Build full URL with query params
            let url = BANF_API.siteUrl + pagePath;
            if (Object.keys(queryParams).length > 0) {
                const params = new URLSearchParams(queryParams);
                url += '?' + params.toString();
            }
            
            // Try to communicate with Wix parent
            if (window.parent !== window) {
                // Inside Wix iframe - use postMessage
                window.parent.postMessage({
                    type: 'BANF_NAVIGATION',
                    action: 'navigate',
                    url: url,
                    pagePath: pagePath
                }, '*');
                
                // Fallback: Direct navigation after short delay
                setTimeout(() => {
                    window.parent.location.href = url;
                }, 100);
            } else {
                // Standalone - direct navigation
                window.location.href = url;
            }
        }

        /**
         * Fetch data from Wix HTTP Functions
         * @param {string} endpoint - API endpoint path
         * @returns {Promise<object>} API response data
         */
        async function fetchFromAPI(endpoint) {
            try {
                const url = BANF_API.siteUrl + endpoint;
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('API fetch error:', error);
                return null;
            }
        }

        /**
         * Load dynamic content from backend APIs
         */
        async function loadDynamicContent() {
            // Load upcoming events count
            try {
                const eventsData = await fetchFromAPI(BANF_API.endpoints.events.list);
                if (eventsData && eventsData.events) {
                    // Update events section with real data
                    console.log('Events loaded:', eventsData.events.length);
                }
            } catch (e) {
                console.log('Events API not available - using static content');
            }
            
            // Load radio status
            try {
                const radioData = await fetchFromAPI(BANF_API.endpoints.radio.config);
                if (radioData) {
                    // Update radio section with current show
                    console.log('Radio status loaded');
                }
            } catch (e) {
                console.log('Radio API not available - using static content');
            }
            
            // Load sponsors
            try {
                const sponsorsData = await fetchFromAPI(BANF_API.endpoints.sponsors.list);
                if (sponsorsData && sponsorsData.sponsors) {
                    console.log('Sponsors loaded:', sponsorsData.sponsors.length);
                }
            } catch (e) {
                console.log('Sponsors API not available - using static content');
            }
        }

        /**
         * Enhanced link handler for Wix page navigation
         * Intercepts clicks on specific action buttons
         */
        function setupActionLinks() {
            // Map data-action attributes to navigation
            document.querySelectorAll('[data-action]').forEach(el => {
                el.addEventListener('click', function(e) {
                    e.preventDefault();
                    const action = this.dataset.action;
                    
                    switch(action) {
                        case 'join':
                            navigateToWixPage('membership');
                            break;
                        case 'events':
                            navigateToWixPage('events');
                            break;
                        case 'radio':
                            navigateToWixPage('radio');
                            break;
                        case 'magazine':
                            navigateToWixPage('magazine');
                            break;
                        case 'guide':
                            navigateToWixPage('guide');
                            break;
                        case 'surveys':
                            navigateToWixPage('surveys');
                            break;
                        case 'complaints':
                            navigateToWixPage('complaints');
                            break;
                        case 'sponsors':
                            navigateToWixPage('sponsors');
                            break;
                        case 'gallery':
                            navigateToWixPage('gallery');
                            break;
                        case 'login':
                            navigateToWixPage('login');
                            break;
                        default:
                            console.log('Unknown action:', action);
                    }
                });
            });
        }

        /**
         * API Integration Summary
         * -----------------------
         * This landing page integrates with the following Velo backend modules:
         * 
         * 1. members.jsw - Member registration, profiles, payment history
         *    - Used by: Membership section, Join Now buttons
         *    - Functions: registerMember(), getMemberById(), getPaymentHistory()
         * 
         * 2. events.jsw - Event management and registration
         *    - Used by: Events section, event cards
         *    - Functions: getUpcomingEvents(), registerForEvent(), submitEventFeedback()
         * 
         * 3. radio.jsw - 24/7 radio streaming
         *    - Used by: Radio section, Now Playing widget
         *    - Functions: getRadioStationConfig(), getCurrentShow(), submitSongRequest()
         * 
         * 4. magazine.jsw - E-Magazine articles and submissions
         *    - Used by: E-Magazine section
         *    - Functions: getPublishedMagazines(), submitArticle()
         * 
         * 5. guide.jsw - Jacksonville Guide listings and reviews
         *    - Used by: Jacksonville Guide section
         *    - Functions: getGuideByCategory(), searchGuide(), submitReview()
         * 
         * 6. surveys.jsw - Community surveys and polls
         *    - Used by: Surveys section
         *    - Functions: getActiveSurveys(), submitSurveyResponse()
         * 
         * 7. complaints.jsw - Anonymous complaint system
         *    - Used by: Complaints section
         *    - Functions: submitComplaint(), checkComplaintStatus()
         * 
         * 8. sponsorship.jsw - Sponsorship tiers and applications
         *    - Used by: Sponsors section
         *    - Functions: getSponsors(), createSponsor()
         *    - Tiers: Platinum ($2000), Gold ($1000), Silver ($500), Bronze ($250)
         * 
         * 9. documents.jsw - Meeting minutes and documents
         *    - Used by: Minutes section (members only)
         *    - Functions: getDocumentsByCategory()
         * 
         * 10. http-functions.js - Public REST endpoints
         *     - GET /_functions/get_events - Public events list
         *     - GET /_functions/get_radio - Radio station config
         *     - GET /_functions/get_sponsors - Active sponsors
         *     - GET /_functions/get_gallery - Photo galleries
         *     - GET /_functions/get_members (auth required)
         */

        // Initialize API integration
        document.addEventListener('DOMContentLoaded', function() {
            setupActionLinks();
            // Render EC team cards dynamically from EC_MEMBERS data
            if (typeof renderECTeam === 'function') renderECTeam();
            // Render Career Directory cards on landing page
            if (typeof renderCareerCards === 'function') renderCareerCards();
            // Uncomment to enable dynamic loading when deployed to Wix:
            // loadDynamicContent();
            console.log('BANF Landing Page - API Integration Ready');
            console.log('Site ID:', BANF_API.siteId);
            console.log('Available endpoints:', Object.keys(BANF_API.endpoints).length);
        });
    </script>

    <!-- ========== FULL-SCREEN MEMBER PORTAL OVERLAY ========== -->
    <div id="memberPortalOverlay" class="member-portal-fullscreen" style="display: none;">
        <!-- Portal Header -->
        <header class="portal-header-bar">
            <div class="portal-header-content">
                <div class="portal-logo-group">
                    <div class="portal-logo-icon">
                        <i class="fas fa-om"></i>
                    </div>
                    <div class="portal-logo-text">
                        <h1>Member Portal</h1>
                        <span>Bengali Association of North Florida</span>
                    </div>
                </div>
                <div class="portal-user-menu">
                    <button class="portal-mobile-toggle btn btn-sm btn-outline-secondary me-2" style="display:none;" onclick="togglePortalSidebar()" aria-label="Toggle sidebar">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="portal-user-avatar" id="portalUserAvatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <span class="portal-user-name" id="portalUserName">Member</span>
                    <button class="portal-btn-logout" onclick="handlePortalLogout()">
                        <i class="fas fa-sign-out-alt me-1"></i> Logout
                    </button>
                    <button class="portal-btn-close" onclick="closeFullPortal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        </header>
        
        <div class="portal-main-container">
            <!-- Mobile sidebar backdrop -->
            <div class="portal-sidebar-backdrop" onclick="togglePortalSidebar()"></div>
            <!-- Sidebar Navigation -->
            <nav class="portal-sidebar">
                <div class="sidebar-section">
                    <h6>Main</h6>
                    <a href="#" class="portal-nav-item active" onclick="showPortalSection('dashboard', this); return false;">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                    <a href="#" class="portal-nav-item" onclick="showPortalSection('profile', this); return false;">
                        <i class="fas fa-id-card"></i>
                        <span>My Profile</span>
                    </a>
                    <a href="#" class="portal-nav-item" onclick="showPortalSection('family', this); return false;">
                        <i class="fas fa-users"></i>
                        <span>Family Members</span>
                    </a>
                </div>
                
                <div class="sidebar-section">
                    <h6>Finance</h6>
                    <a href="#" class="portal-nav-item" onclick="showPortalSection('payments', this); return false;">
                        <i class="fas fa-credit-card"></i>
                        <span>Payments & Receipts</span>
                        <span class="portal-badge">Due</span>
                    </a>
                    <a href="#" class="portal-nav-item" onclick="showPortalSection('budget', this); return false;">
                        <i class="fas fa-wallet"></i>
                        <span>Budget Reports</span>
                    </a>
                </div>
                
                <div class="sidebar-section">
                    <h6>Community</h6>
                    <a href="#" class="portal-nav-item" onclick="showPortalSection('meetings', this); return false;">
                        <i class="fas fa-file-alt"></i>
                        <span>Meeting Minutes</span>
                    </a>
                    <a href="#" class="portal-nav-item" onclick="showPortalSection('events', this); return false;">
                        <i class="fas fa-calendar-check"></i>
                        <span>Events & RSVP</span>
                    </a>
                    <a href="#" class="portal-nav-item" onclick="showPortalSection('surveys', this); return false;">
                        <i class="fas fa-poll-h"></i>
                        <span>Surveys</span>
                        <span class="portal-badge">2</span>
                    </a>
                    <a href="#" class="portal-nav-item" onclick="showPortalSection('directory', this); return false;">
                        <i class="fas fa-address-book"></i>
                        <span>Member Directory</span>
                    </a>
                    <a href="#" class="portal-nav-item" onclick="showPortalSection('careerProfile', this); return false;">
                        <i class="fas fa-briefcase"></i>
                        <span>Career Profile</span>
                    </a>
                    <a href="#" class="portal-nav-item" onclick="showPortalSection('volunteer', this); return false;">
                        <i class="fas fa-hands-helping"></i>
                        <span>Volunteer</span>
                    </a>
                </div>
                
                <div class="sidebar-section">
                    <h6>Media</h6>
                    <a href="#" class="portal-nav-item" onclick="showPortalSection('radio', this); return false;">
                        <i class="fas fa-music"></i>
                        <span>Request Songs</span>
                    </a>
                    <a href="#" class="portal-nav-item" onclick="showPortalSection('magazine', this); return false;">
                        <i class="fas fa-pen-fancy"></i>
                        <span>Magazine Submission</span>
                    </a>
                </div>
            </nav>
            
            <!-- Main Content Area -->
            <main class="portal-content-area">
                <!-- DASHBOARD SECTION -->
                <section id="portalDashboard" class="portal-section active">
                    <div class="portal-page-header">
                        <h2>Welcome back, <span id="dashboardMemberName">Member</span>! 👋</h2>
                        <p>Here's your BANF membership overview</p>
                    </div>
                    
                    <!-- Stats Grid -->
                    <div class="portal-stats-grid">
                        <div class="portal-stat-card">
                            <div class="stat-icon green"><i class="fas fa-check-circle"></i></div>
                            <div class="stat-info">
                                <h3>Active</h3>
                                <p>Membership Status</p>
                            </div>
                        </div>
                        <div class="portal-stat-card">
                            <div class="stat-icon orange"><i class="fas fa-calendar"></i></div>
                            <div class="stat-info">
                                <h3>5</h3>
                                <p>Upcoming Events</p>
                            </div>
                        </div>
                        <div class="portal-stat-card">
                            <div class="stat-icon gold"><i class="fas fa-receipt"></i></div>
                            <div class="stat-info">
                                <h3>$0</h3>
                                <p>Dues Balance</p>
                            </div>
                        </div>
                        <div class="portal-stat-card">
                            <div class="stat-icon purple"><i class="fas fa-poll"></i></div>
                            <div class="stat-info">
                                <h3>2</h3>
                                <p>Active Surveys</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Access Features -->
                    <h3 style="margin: 2rem 0 1.5rem; color: var(--banf-charcoal);">Quick Access</h3>
                    <div class="portal-features-grid">
                        <div class="portal-feature-card">
                            <div class="feature-icon-box"><i class="fas fa-id-card"></i></div>
                            <h4>My Profile & Family</h4>
                            <p>Update your personal information, contact details, and manage family member profiles.</p>
                            <button class="portal-feature-btn" onclick="showPortalSection('profile')">
                                <i class="fas fa-user-edit"></i> Edit Profile
                            </button>
                        </div>
                        
                        <div class="portal-feature-card">
                            <div class="feature-icon-box" style="background: var(--gradient-primary);"><i class="fas fa-credit-card"></i></div>
                            <h4>Payments & Receipts</h4>
                            <p>View payment history, download receipts, and make membership or event payments.</p>
                            <button class="portal-feature-btn" onclick="showPortalSection('payments')">
                                <i class="fas fa-receipt"></i> View Payments
                            </button>
                        </div>
                        
                        <div class="portal-feature-card">
                            <div class="feature-icon-box" style="background: linear-gradient(135deg, #795548, #8D6E63);"><i class="fas fa-file-alt"></i></div>
                            <h4>Meeting Minutes</h4>
                            <p>Access EC meeting summaries, decisions, action items, and announcements.</p>
                            <button class="portal-feature-btn" onclick="showPortalSection('meetings')">
                                <i class="fas fa-folder-open"></i> View Minutes
                            </button>
                        </div>
                        
                        <div class="portal-feature-card">
                            <div class="feature-icon-box" style="background: linear-gradient(135deg, #2196F3, #03A9F4);"><i class="fas fa-calendar-check"></i></div>
                            <h4>Events & RSVP</h4>
                            <p>Browse upcoming events, register your family, and check-in at venues.</p>
                            <button class="portal-feature-btn" onclick="showPortalSection('events')">
                                <i class="fas fa-calendar-plus"></i> View Events
                            </button>
                        </div>
                        
                        <div class="portal-feature-card">
                            <div class="feature-icon-box" style="background: linear-gradient(135deg, #FF9800, #FFC107);"><i class="fas fa-poll-h"></i></div>
                            <h4>Surveys & Polls</h4>
                            <p>Participate in community polls and provide feedback on BANF initiatives.</p>
                            <button class="portal-feature-btn" onclick="showPortalSection('surveys')">
                                <i class="fas fa-vote-yea"></i> Take Survey
                            </button>
                        </div>
                        
                        <div class="portal-feature-card">
                            <div class="feature-icon-box" style="background: linear-gradient(135deg, #673AB7, #9C27B0);"><i class="fas fa-music"></i></div>
                            <h4>Request Songs</h4>
                            <p>Request your favorite Bengali songs to be played on BANF Radio 24/7.</p>
                            <button class="portal-feature-btn" onclick="showPortalSection('radio')">
                                <i class="fas fa-microphone"></i> Request Song
                            </button>
                        </div>

                        <div class="portal-feature-card">
                            <div class="feature-icon-box" style="background: linear-gradient(135deg, #009688, #26a69a);"><i class="fas fa-stethoscope"></i></div>
                            <h4>System Check</h4>
                            <p>Run due diligence checks for schema, data integrity, and workflow readiness.</p>
                            <button class="portal-feature-btn secondary" onclick="runDueDiligenceChecks('member')">
                                <i class="fas fa-clipboard-check"></i> Run Check
                            </button>
                        </div>
                    </div>

                    <div class="portal-form-card" style="margin-top: 2rem;">
                        <h4 style="margin-bottom: 1rem;"><i class="fas fa-list-check me-2"></i>Workflow Checklist</h4>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="checkLogin">
                                    <label class="form-check-label" for="checkLogin">Login & Session</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="checkProfile">
                                    <label class="form-check-label" for="checkProfile">Profile Update</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="checkFamily">
                                    <label class="form-check-label" for="checkFamily">Family Members</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="checkEvents">
                                    <label class="form-check-label" for="checkEvents">Events & RSVP</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="checkPayments">
                                    <label class="form-check-label" for="checkPayments">Payments & Zelle</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="checkReceipts">
                                    <label class="form-check-label" for="checkReceipts">Receipts Download</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="checkMinutes">
                                    <label class="form-check-label" for="checkMinutes">Meeting Minutes</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="checkSurveys">
                                    <label class="form-check-label" for="checkSurveys">Surveys</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="checkDirectory">
                                    <label class="form-check-label" for="checkDirectory">Member Directory</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="checkRadio">
                                    <label class="form-check-label" for="checkRadio">Radio Request</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="checkMagazine">
                                    <label class="form-check-label" for="checkMagazine">Magazine Submission</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="checkVolunteer">
                                    <label class="form-check-label" for="checkVolunteer">Volunteer Signup</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- PROFILE SECTION -->
                <section id="portalProfile" class="portal-section">
                    <div class="portal-page-header">
                        <h2>My Profile</h2>
                        <p>Update your personal information and preferences</p>
                    </div>
                    
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="portal-form-card">
                                <form id="portalProfileForm" onsubmit="handleProfileUpdate(event)">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">First Name</label>
                                            <input type="text" class="form-control" id="portalFirstName" value="">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Last Name</label>
                                            <input type="text" class="form-control" id="portalLastName" value="">
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Email Address</label>
                                        <input type="email" class="form-control" id="portalEmail" value="">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Phone Number</label>
                                        <input type="tel" class="form-control" id="portalPhone" value="">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Address</label>
                                        <textarea class="form-control" id="portalAddress" rows="2"></textarea>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">City</label>
                                            <input type="text" class="form-control" id="portalCity" value="Jacksonville">
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <label class="form-label">State</label>
                                            <input type="text" class="form-control" id="portalState" value="FL">
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <label class="form-label">ZIP Code</label>
                                            <input type="text" class="form-control" id="portalZip" value="">
                                        </div>
                                    </div>
                                    
                                    <button type="submit" class="portal-feature-btn">
                                        <i class="fas fa-save"></i> Save Changes
                                    </button>
                                </form>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="portal-form-card text-center">
                                <div style="width: 120px; height: 120px; border-radius: 50%; background: var(--gradient-green); margin: 0 auto 1rem; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-user fa-3x text-white"></i>
                                </div>
                                <h5>Member Photo</h5>
                                <p class="text-muted small">Upload a profile picture</p>
                                <button class="portal-feature-btn secondary">
                                    <i class="fas fa-camera"></i> Upload Photo
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- FAMILY SECTION -->
                <section id="portalFamily" class="portal-section">
                    <div class="portal-page-header">
                        <h2>Family Members</h2>
                        <p>Manage family members under your membership</p>
                    </div>
                    
                    <div class="portal-data-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Relationship</th>
                                    <th>Age</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="portalFamilyTable">
                                <tr>
                                    <td>Spouse Demo</td>
                                    <td>Spouse</td>
                                    <td>Adult</td>
                                    <td><span class="status-badge active">Active</span></td>
                                    <td><button class="btn btn-sm btn-outline-primary"><i class="fas fa-edit"></i></button></td>
                                </tr>
                                <tr>
                                    <td>Child Demo</td>
                                    <td>Child</td>
                                    <td>12</td>
                                    <td><span class="status-badge active">Active</span></td>
                                    <td><button class="btn btn-sm btn-outline-primary"><i class="fas fa-edit"></i></button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <button class="portal-feature-btn mt-3" onclick="alert('Add Family Member - Demo Mode')">
                        <i class="fas fa-user-plus"></i> Add Family Member
                    </button>
                </section>
                
                <!-- PAYMENTS SECTION -->
                <section id="portalPayments" class="portal-section">
                    <div class="portal-page-header">
                        <h2>Payments & Receipts</h2>
                        <p>View your payment history and download receipts</p>
                    </div>
                    
                    <div class="portal-stats-grid" style="margin-bottom: 2rem;">
                        <div class="portal-stat-card">
                            <div class="stat-icon green"><i class="fas fa-check-circle"></i></div>
                            <div class="stat-info">
                                <h3 id="portalBalanceDue">$0.00</h3>
                                <p>Balance Due</p>
                            </div>
                        </div>
                        <div class="portal-stat-card">
                            <div class="stat-icon orange"><i class="fas fa-history"></i></div>
                            <div class="stat-info">
                                <h3 id="portalTotalPaid">$250.00</h3>
                                <p>Total Paid (2026)</p>
                            </div>
                        </div>
                        <div class="portal-stat-card">
                            <div class="stat-icon" style="background:#e8e0ff; color:#6528F7;"><i class="fas fa-bolt"></i></div>
                            <div class="stat-info">
                                <h3 id="portalZelleStatus" style="font-size:0.95rem; color:#28a745;">✅ Auto-Tracking</h3>
                                <p>Zelle Detection</p>
                            </div>
                        </div>
                    </div>

                    <div class="portal-form-card">
                        <h4 style="margin-bottom: 1rem;"><i class="fas fa-university me-2"></i>Zelle Payment Info</h4>
                        <p class="text-muted">Send payments via Zelle. Your payment will be <strong>automatically detected</strong> from Gmail and matched to your account.</p>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Zelle Recipient</label>
                                <input class="form-control" value="treasurer@jaxbengali.org" readonly>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Memo Format</label>
                                <input class="form-control" value="Membership - [Your Name]" readonly>
                            </div>
                        </div>
                        <div style="padding:0.75rem; background:#e8f5e9; border-radius:8px; margin-bottom:1rem; font-size:0.9rem;">
                            <i class="fas fa-magic" style="color:#6528F7; margin-right:0.5rem;"></i>
                            <strong>Auto-Detection Active:</strong> When you send a Zelle payment, our system automatically detects the email notification and updates your account. No manual verification needed!
                        </div>
                        <button class="portal-feature-btn" onclick="portalRefreshPayments()">
                            <i class="fas fa-sync-alt"></i> Refresh Payment Status
                        </button>
                    </div>
                    
                    <h4 style="margin-bottom: 1rem;">Payment History</h4>
                    <div class="portal-data-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Description</th>
                                    <th>Amount</th>
                                    <th>Method</th>
                                    <th>Status</th>
                                    <th>Receipt</th>
                                </tr>
                            </thead>
                            <tbody id="portalPaymentHistoryBody">
                                <tr>
                                    <td>Feb 01, 2026</td>
                                    <td>Annual Membership - Family</td>
                                    <td>$150.00</td>
                                    <td><i class="fas fa-bolt" style="color:#6528F7;"></i> Zelle</td>
                                    <td><span class="status-badge active">Paid</span></td>
                                    <td><a href="#" class="text-primary" onclick="alert('Download Receipt - Demo'); return false;"><i class="fas fa-download"></i> PDF</a></td>
                                </tr>
                                <tr>
                                    <td>Feb 02, 2026</td>
                                    <td>Saraswati Puja Registration</td>
                                    <td>$100.00</td>
                                    <td><i class="fas fa-bolt" style="color:#6528F7;"></i> Zelle</td>
                                    <td><span class="status-badge active">Paid</span></td>
                                    <td><a href="#" class="text-primary" onclick="alert('Download Receipt - Demo'); return false;"><i class="fas fa-download"></i> PDF</a></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
                
                <!-- BUDGET SECTION -->
                <section id="portalBudget" class="portal-section">
                    <div class="portal-page-header">
                        <h2>Budget Reports</h2>
                        <p>View BANF financial transparency reports</p>
                    </div>
                    
                    <div class="portal-features-grid" style="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));">
                        <div class="portal-feature-card">
                            <div class="feature-icon-box" style="background: linear-gradient(135deg, #4CAF50, #8BC34A);"><i class="fas fa-file-invoice-dollar"></i></div>
                            <h4>2026 Budget</h4>
                            <p>Current fiscal year budget allocation and spending summary.</p>
                            <button class="portal-feature-btn" onclick="alert('Download 2026 Budget - Demo')">
                                <i class="fas fa-download"></i> Download PDF
                            </button>
                        </div>
                        <div class="portal-feature-card">
                            <div class="feature-icon-box" style="background: linear-gradient(135deg, #607D8B, #455A64);"><i class="fas fa-archive"></i></div>
                            <h4>2025 Annual Report</h4>
                            <p>Complete financial summary and audit report for 2025.</p>
                            <button class="portal-feature-btn secondary" onclick="alert('Download 2025 Report - Demo')">
                                <i class="fas fa-download"></i> Download PDF
                            </button>
                        </div>
                    </div>
                </section>
                
                <!-- MEETINGS SECTION -->
                <section id="portalMeetings" class="portal-section">
                    <div class="portal-page-header">
                        <h2>Meeting Minutes</h2>
                        <p>Access EC meeting summaries and decisions</p>
                    </div>
                    
                    <div class="portal-data-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Meeting Type</th>
                                    <th>Summary</th>
                                    <th>Document</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Feb 10, 2026</td>
                                    <td>EC Meeting</td>
                                    <td>Nabo Borsho planning, budget review</td>
                                    <td><a href="#" class="text-primary" onclick="alert('View PDF - Demo'); return false;"><i class="fas fa-file-pdf"></i> View PDF</a></td>
                                </tr>
                                <tr>
                                    <td>Jan 25, 2026</td>
                                    <td>General Body</td>
                                    <td>Annual review, 2026 goals</td>
                                    <td><a href="#" class="text-primary" onclick="alert('View PDF - Demo'); return false;"><i class="fas fa-file-pdf"></i> View PDF</a></td>
                                </tr>
                                <tr>
                                    <td>Jan 10, 2026</td>
                                    <td>EC Meeting</td>
                                    <td>Saraswati Puja planning</td>
                                    <td><a href="#" class="text-primary" onclick="alert('View PDF - Demo'); return false;"><i class="fas fa-file-pdf"></i> View PDF</a></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
                
                <!-- EVENTS SECTION -->
                <section id="portalEvents" class="portal-section">
                    <div class="portal-page-header">
                        <h2>Events & RSVP</h2>
                        <p>Register for upcoming events and manage your RSVPs</p>
                    </div>

                    <!-- RSVP Form (hidden by default) -->
                    <div id="memberRsvpFormContainer" style="display:none; margin-bottom:1.5rem;">
                        <div class="portal-form-card" style="border:2px solid var(--banf-orange);">
                            <h4 id="rsvpFormTitle">RSVP for Event</h4>
                            <form id="memberRsvpForm" onsubmit="return handleMemberRsvp(event)">
                                <input type="hidden" id="rsvpEventId" value="">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">RSVP Status *</label>
                                        <select class="form-control" id="rsvpStatus" required onchange="toggleRsvpDetails()">
                                            <option value="">Select...</option>
                                            <option value="attending">✅ Yes, I'll attend</option>
                                            <option value="maybe">🤔 Maybe</option>
                                            <option value="not_attending">❌ Can't make it</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label fw-bold"># Adults</label>
                                        <input type="number" class="form-control" id="rsvpAdults" min="0" max="10" value="1">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label fw-bold"># Kids</label>
                                        <input type="number" class="form-control" id="rsvpKids" min="0" max="10" value="0">
                                    </div>
                                    <div class="col-md-6" id="rsvpDietaryCol">
                                        <label class="form-label fw-bold">Dietary Requirements</label>
                                        <select class="form-control" id="rsvpDietary">
                                            <option value="None">None</option>
                                            <option value="Vegetarian">Vegetarian</option>
                                            <option value="Vegan">Vegan</option>
                                            <option value="Jain">Jain (no onion/garlic)</option>
                                            <option value="Gluten-free">Gluten-free</option>
                                            <option value="Nut allergy">Nut allergy</option>
                                            <option value="Other">Other (specify in notes)</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Notes</label>
                                        <input type="text" class="form-control" id="rsvpNotes" placeholder="Any special requests...">
                                    </div>
                                </div>
                                <div class="mt-3" style="display:flex; gap:0.5rem;">
                                    <button type="submit" class="portal-feature-btn"><i class="fas fa-check me-1"></i> Submit RSVP</button>
                                    <button type="button" class="portal-feature-btn secondary" onclick="document.getElementById('memberRsvpFormContainer').style.display='none'"><i class="fas fa-times me-1"></i> Cancel</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <div class="portal-features-grid">
                        <div class="portal-feature-card" style="border: 2px solid var(--banf-orange);">
                            <div class="feature-icon-box" style="background: linear-gradient(135deg, #E91E63, #FF5722);"><i class="fas fa-om"></i></div>
                            <h4>Nabo Borsho 1433</h4>
                            <p><strong>April 25, 2026</strong> • Bengali New Year celebration with cultural program and feast.</p>
                            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                <button class="portal-feature-btn" onclick="openMemberRsvp('EVT-001', 'Nabo Borsho 1433')">
                                    <i class="fas fa-user-check"></i> RSVP Now
                                </button>
                                <button class="portal-feature-btn secondary" onclick="alert('Event Details - Demo')">
                                    <i class="fas fa-info-circle"></i> Details
                                </button>
                            </div>
                        </div>
                        
                        <div class="portal-feature-card">
                            <div class="feature-icon-box" style="background: linear-gradient(135deg, #4CAF50, #8BC34A);"><i class="fas fa-campground"></i></div>
                            <h4>Summer Camp 2026</h4>
                            <p><strong>June 2026</strong> • Bengali language and culture camp for children ages 5-15.</p>
                            <button class="portal-feature-btn" onclick="openMemberRsvp('EVT-002', 'Summer Camp 2026')">
                                <i class="fas fa-user-check"></i> RSVP Now
                            </button>
                        </div>
                        
                        <div class="portal-feature-card">
                            <div class="feature-icon-box" style="background: linear-gradient(135deg, #2196F3, #03A9F4);"><i class="fas fa-utensils"></i></div>
                            <h4>Summer Picnic</h4>
                            <p><strong>July 2026</strong> • Annual community picnic with games, food, and music.</p>
                            <button class="portal-feature-btn secondary">
                                <i class="fas fa-clock"></i> Coming Soon
                            </button>
                        </div>
                    </div>

                    <!-- My RSVPs -->
                    <div style="margin-top: 2rem;">
                        <h4><i class="fas fa-clipboard-check me-2"></i>My RSVPs</h4>
                        <div class="portal-data-table">
                            <table>
                                <thead><tr><th>Event</th><th>Status</th><th>Adults</th><th>Kids</th><th>Dietary</th><th>Action</th></tr></thead>
                                <tbody id="myRsvpTableBody">
                                    <tr><td colspan="6" class="text-center py-3 text-muted">No RSVPs yet. RSVP to an event above!</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>
                
                <!-- SURVEYS SECTION -->
                <section id="portalSurveys" class="portal-section">
                    <div class="portal-page-header">
                        <h2>Surveys & Polls</h2>
                        <p>Share your feedback and participate in community decisions</p>
                    </div>
                    
                    <div class="portal-features-grid">
                        <div class="portal-feature-card" style="border: 2px solid var(--banf-orange);">
                            <span class="status-badge pending" style="margin-bottom: 1rem;">Active</span>
                            <h4>Nabo Borsho 2026 Menu Preferences</h4>
                            <p>Help us decide the food menu for the Bengali New Year celebration!</p>
                            <button class="portal-feature-btn" onclick="alert('Survey - Demo Mode')">
                                <i class="fas fa-vote-yea"></i> Take Survey
                            </button>
                        </div>
                        
                        <div class="portal-feature-card" style="border: 2px solid var(--banf-orange);">
                            <span class="status-badge pending" style="margin-bottom: 1rem;">Active</span>
                            <h4>Summer Camp Interest Survey</h4>
                            <p>Would you like to enroll your children in Bengali summer camp?</p>
                            <button class="portal-feature-btn" onclick="alert('Survey - Demo Mode')">
                                <i class="fas fa-vote-yea"></i> Take Survey
                            </button>
                        </div>
                    </div>
                </section>
                
                <!-- DIRECTORY SECTION -->
                <section id="portalDirectory" class="portal-section">
                    <div class="portal-page-header">
                        <h2>Member Directory</h2>
                        <p>Connect with fellow BANF members</p>
                    </div>
                    
                    <div class="portal-form-card" style="margin-bottom: 1.5rem;">
                        <div class="row">
                            <div class="col-md-8 mb-2 mb-md-0">
                                <input type="text" class="form-control" placeholder="Search by name, city, or profession..." id="portalDirectorySearch">
                            </div>
                            <div class="col-md-4">
                                <button class="portal-feature-btn w-100" onclick="alert('Search - Demo: Found 45 members')">
                                    <i class="fas fa-search"></i> Search
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="portal-data-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>City</th>
                                    <th>Member Since</th>
                                    <th>Contact</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="4" class="text-center py-4">
                                        <i class="fas fa-address-book fa-2x text-muted mb-2"></i>
                                        <p class="text-muted mb-0">Search to view member directory</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- VOLUNTEER SECTION -->
                <section id="portalVolunteer" class="portal-section">
                    <div class="portal-page-header">
                        <h2>Volunteer Opportunities</h2>
                        <p>Support BANF events and community programs</p>
                    </div>

                    <div class="portal-data-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Event</th>
                                    <th>Role</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Nabo Borsho 1433</td>
                                    <td>Registration Desk</td>
                                    <td>Apr 25, 2026</td>
                                    <td><span class="status-badge pending">Open</span></td>
                                    <td><button class="portal-feature-btn secondary" onclick="alert('Volunteer sign-up submitted (Demo)')">Sign Up</button></td>
                                </tr>
                                <tr>
                                    <td>Summer Camp 2026</td>
                                    <td>Activity Support</td>
                                    <td>Jun 2026</td>
                                    <td><span class="status-badge pending">Open</span></td>
                                    <td><button class="portal-feature-btn secondary" onclick="alert('Volunteer sign-up submitted (Demo)')">Sign Up</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
                
                <!-- RADIO SECTION -->
                <section id="portalRadio" class="portal-section">
                    <div class="portal-page-header">
                        <h2>BANF Radio 24/7</h2>
                        <p>Listen live & request your favorite Bengali songs</p>
                    </div>
                    
                    <div class="row">
                        <div class="col-lg-6 mb-4">
                            <div class="portal-form-card">
                                <h4 style="margin-bottom: 1rem;"><i class="fas fa-broadcast-tower me-2"></i>Now Playing</h4>
                                <div style="background: linear-gradient(135deg, #673AB7, #9C27B0); border-radius: 16px; padding: 2rem; color: #fff; text-align: center;" id="memberRadioPlayer">
                                    <i class="fas fa-music fa-3x mb-3"></i>
                                    <h5 id="memberNowPlaying">BANF Radio 24/7</h5>
                                    <p style="opacity: 0.8;" id="memberRadioCategory">Bengali Music Non-Stop</p>
                                    <div class="d-flex justify-content-center gap-2 mt-3">
                                        <button class="btn btn-light rounded-circle" onclick="skipStation(-1)" title="Previous" style="width:40px;height:40px;">
                                            <i class="fas fa-backward"></i>
                                        </button>
                                        <button class="btn btn-light btn-lg rounded-circle" onclick="toggleRadio()" id="memberPlayBtn" title="Play/Pause" style="width:55px;height:55px;">
                                            <i class="fas fa-play"></i>
                                        </button>
                                        <button class="btn btn-light rounded-circle" onclick="skipStation(1)" title="Next" style="width:40px;height:40px;">
                                            <i class="fas fa-forward"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Today's Schedule Preview -->
                                <h5 class="mt-4 mb-3"><i class="fas fa-clock me-2"></i>Today's Schedule</h5>
                                <div id="memberScheduleList" style="max-height: 200px; overflow-y: auto;"></div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="portal-form-card">
                                <h4 style="margin-bottom: 1.5rem;"><i class="fas fa-music me-2"></i>Song Request Form</h4>
                                <form onsubmit="event.preventDefault(); handleSongRequest(this);">
                                    <div class="mb-3">
                                        <label class="form-label">Song Title</label>
                                        <input type="text" class="form-control" id="songRequestTitle" placeholder="e.g., Amar Sonar Bangla" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Artist Name</label>
                                        <input type="text" class="form-control" id="songRequestArtist" placeholder="e.g., Rabindranath Tagore">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Category</label>
                                        <select class="form-control" id="songRequestCategory">
                                            <option value="classical">Classical / Rabindra Sangeet</option>
                                            <option value="folk">Folk Music (Baul, Bhatiyali)</option>
                                            <option value="modern">Modern Bengali</option>
                                            <option value="devotional">Devotional</option>
                                            <option value="film">Film Songs</option>
                                            <option value="children">Children's Songs</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Dedication Message (Optional)</label>
                                        <textarea class="form-control" rows="3" id="songDedication" placeholder="Dedicate this song to someone special..."></textarea>
                                    </div>
                                    <button type="submit" class="portal-feature-btn">
                                        <i class="fas fa-paper-plane"></i> Submit Request
                                    </button>
                                </form>
                                
                                <!-- My Requests -->
                                <h5 class="mt-4 mb-3"><i class="fas fa-list me-2"></i>My Recent Requests</h5>
                                <div id="myRadioRequests">
                                    <div class="d-flex justify-content-between align-items-center p-2 border-bottom">
                                        <div>
                                            <strong>Tumi Robe Nirobe</strong><br>
                                            <small class="text-muted">Rabindranath Tagore • Classical</small>
                                        </div>
                                        <span class="badge bg-success">Played</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center p-2">
                                        <div>
                                            <strong>Ami Chini Go Chini</strong><br>
                                            <small class="text-muted">Rabindranath Tagore • Classical</small>
                                        </div>
                                        <span class="badge bg-warning text-dark">Queued</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- CAREER PROFILE SECTION -->
                <section id="portalCareerProfile" class="portal-section">
                    <div class="portal-page-header">
                        <h2><i class="fas fa-briefcase me-2"></i>My Career Profile</h2>
                        <p>Create or edit your career guidance profile to appear in the BANF professional network</p>
                    </div>
                    <div class="portal-form-card">
                        <form onsubmit="event.preventDefault(); saveMyCareerProfile();">
                            <div class="d-flex align-items-center mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="careerProfileVisible" checked>
                                    <label class="form-check-label" for="careerProfileVisible"><strong>Visible in Public Directory</strong></label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Professional Title</label>
                                    <input type="text" class="form-control" id="careerTitle" placeholder="e.g. Software Engineer, Doctor, Teacher" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Company / Organization</label>
                                    <input type="text" class="form-control" id="careerCompany" placeholder="Your current employer">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Industry</label>
                                    <select class="form-select" id="careerIndustry" required>
                                        <option value="">Select...</option>
                                        <option>Technology</option><option>Healthcare</option><option>Finance</option>
                                        <option>Education</option><option>Engineering</option><option>Legal</option>
                                        <option>Business</option><option>Arts & Media</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Years of Experience</label>
                                    <input type="number" class="form-control" id="careerYears" min="0" max="60" value="5">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Education</label>
                                    <input type="text" class="form-control" id="careerEducation" placeholder="e.g. M.S. Computer Science">
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Skills (comma-separated)</label>
                                <input type="text" class="form-control" id="careerSkills" placeholder="Python, Project Management, Data Analysis...">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Guidance I Can Offer</label>
                                <div class="d-flex flex-wrap gap-2" id="guidanceCheckboxes">
                                    <label class="form-check form-check-inline"><input class="form-check-input" type="checkbox" value="Career Mentorship"> Career Mentorship</label>
                                    <label class="form-check form-check-inline"><input class="form-check-input" type="checkbox" value="Resume Review"> Resume Review</label>
                                    <label class="form-check form-check-inline"><input class="form-check-input" type="checkbox" value="Interview Prep"> Interview Prep</label>
                                    <label class="form-check form-check-inline"><input class="form-check-input" type="checkbox" value="Networking"> Networking</label>
                                    <label class="form-check form-check-inline"><input class="form-check-input" type="checkbox" value="Industry Insights"> Industry Insights</label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Short Bio</label>
                                <textarea class="form-control" id="careerBio" rows="3" placeholder="Tell other members how you can help..."></textarea>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">LinkedIn URL (optional)</label>
                                    <input type="url" class="form-control" id="careerLinkedin" placeholder="https://linkedin.com/in/...">
                                </div>
                                <div class="col-md-6 mb-3 d-flex align-items-end">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="careerAvailable" checked>
                                        <label class="form-check-label" for="careerAvailable">Available for meetings</label>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn-primary"><i class="fas fa-save me-1"></i>Save Profile</button>
                                <button type="button" class="btn btn-outline-danger" onclick="deleteMyCareerProfile()"><i class="fas fa-trash me-1"></i>Remove Profile</button>
                            </div>
                        </form>
                    </div>
                </section>

                <!-- MAGAZINE SECTION -->
                <section id="portalMagazine" class="portal-section">
                    <div class="portal-page-header">
                        <h2>Magazine Submission</h2>
                        <p>Submit your literary works for BANF E-Magazine</p>
                    </div>
                    
                    <div class="portal-form-card">
                        <form onsubmit="event.preventDefault(); alert('Submission sent for review - Demo'); this.reset();">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Submission Type</label>
                                    <select class="form-control" required>
                                        <option value="">Select type...</option>
                                        <option value="poem">Poem (কবিতা)</option>
                                        <option value="story">Short Story (গল্প)</option>
                                        <option value="article">Article (প্রবন্ধ)</option>
                                        <option value="essay">Essay (রচনা)</option>
                                        <option value="memoir">Memoir (স্মৃতিকথা)</option>
                                        <option value="review">Book/Movie Review</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Language</label>
                                    <select class="form-control" required>
                                        <option value="bengali">Bengali (বাংলা)</option>
                                        <option value="english">English</option>
                                        <option value="both">Both</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Title</label>
                                <input type="text" class="form-control" placeholder="Enter the title of your work" required>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Content</label>
                                <textarea class="form-control" rows="8" placeholder="Paste your content here..." required></textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Author Bio (Optional)</label>
                                <textarea class="form-control" rows="2" placeholder="Brief bio to be published with your work..."></textarea>
                            </div>
                            
                            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                <button type="submit" class="portal-feature-btn">
                                    <i class="fas fa-paper-plane"></i> Submit for Review
                                </button>
                                <button type="button" class="portal-feature-btn secondary" onclick="alert('Draft saved - Demo')">
                                    <i class="fas fa-save"></i> Save Draft
                                </button>
                            </div>
                        </form>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- ========== FULL-SCREEN ADMIN PORTAL OVERLAY ========== -->
    <div id="adminPortalOverlay" class="admin-portal-fullscreen" style="display: none;">
        <!-- Admin Header -->
        <header class="admin-header">
            <div class="admin-header-content">
                <div class="admin-logo-group">
                    <div class="admin-logo-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="admin-logo-text">
                        <h1>EC Admin Portal</h1>
                        <span>Bengali Association of North Florida</span>
                    </div>
                </div>
                <div class="admin-user-menu">
                    <button class="admin-mobile-toggle btn btn-sm btn-outline-light me-2" onclick="toggleAdminSidebar()" aria-label="Toggle sidebar">
                        <i class="fas fa-bars"></i> <span class="d-none d-sm-inline">Menu</span>
                    </button>
                    <span class="admin-role-badge" id="adminRoleBadge">EC Member</span>
                    <div class="admin-user-avatar">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <span class="admin-user-name" id="adminPortalName">Admin</span>
                    <button class="admin-btn" onclick="runDueDiligenceChecks('admin')">
                        <i class="fas fa-stethoscope me-1"></i> System Check
                    </button>
                    <button class="admin-btn" onclick="handleAdminLogout()">
                        <i class="fas fa-sign-out-alt me-1"></i> Logout
                    </button>
                    <button class="admin-btn admin-btn-close" onclick="closeAdminPortal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        </header>

        <div class="admin-portal-container">
            <!-- Mobile sidebar backdrop -->
            <div class="admin-sidebar-backdrop" onclick="toggleAdminSidebar()"></div>
            <!-- Sidebar Navigation -->
            <nav class="admin-sidebar">
                <div class="admin-sidebar-section">
                    <h6>Dashboard</h6>
                    <a href="#" class="admin-nav-item active" data-section="dashboard" onclick="showAdminSection('dashboard', this); return false;">
                        <i class="fas fa-chart-line"></i>
                        <span>Overview</span>
                    </a>
                    <a href="#" class="admin-nav-item" data-section="siteConfig" data-permission="site_config" onclick="showAdminSection('siteConfig', this); return false;">
                        <i class="fas fa-wrench"></i>
                        <span>Site Configuration</span>
                    </a>
                </div>

                <div class="admin-sidebar-section">
                    <h6>Member Management</h6>
                    <a href="#" class="admin-nav-item" data-section="membershipDashboard" data-permission="members" onclick="showAdminSection('membershipDashboard', this); return false;">
                        <i class="fas fa-id-card-alt"></i>
                        <span>Membership Dashboard</span>
                    </a>
                    <a href="#" class="admin-nav-item" data-section="familyUniverse" data-permission="members" onclick="showAdminSection('familyUniverse', this); return false;">
                        <i class="fas fa-sitemap"></i>
                        <span>Family Universe</span>
                    </a>
                    <a href="#" class="admin-nav-item" data-section="members" data-permission="members" onclick="showAdminSection('members', this); return false;">
                        <i class="fas fa-users"></i>
                        <span>All Members</span>
                    </a>
                    <a href="#" class="admin-nav-item" data-section="dataImport" data-permission="members" onclick="showAdminSection('dataImport', this); return false;">
                        <i class="fas fa-file-excel"></i>
                        <span>Data Import (Excel)</span>
                    </a>
                    <a href="#" class="admin-nav-item" data-section="dbExplorer" data-permission="members" onclick="showAdminSection('dbExplorer', this); return false;">
                        <i class="fas fa-database"></i>
                        <span>DB Explorer</span>
                    </a>
                    <a href="#" class="admin-nav-item" data-section="payments" data-permission="payments" onclick="showAdminSection('payments', this); return false;">
                        <i class="fas fa-credit-card"></i>
                        <span>Payment Verification</span>
                        <span class="admin-badge warning">5</span>
                    </a>
                </div>

                <div class="admin-sidebar-section">
                    <h6>Email</h6>
                    <a href="#" class="admin-nav-item" data-section="gmail" data-permission="communications" onclick="showAdminSection('gmail', this); return false;">
                        <i class="fas fa-envelope"></i>
                        <span>Email Management</span>
                        <span class="admin-badge" id="gmailUnreadBadge" style="display:none">0</span>
                    </a>
                </div>

                <div class="admin-sidebar-section">
                    <h6>Events</h6>
                    <a href="#" class="admin-nav-item" data-section="events" data-permission="events" onclick="showAdminSection('events', this); return false;">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Event Management</span>
                    </a>
                    <a href="#" class="admin-nav-item" data-section="evite" data-permission="evite" onclick="showAdminSection('evite', this); return false;">
                        <i class="fas fa-envelope-open-text"></i>
                        <span>Evite / Invitations</span>
                    </a>
                    <a href="#" class="admin-nav-item" data-section="rsvps" data-permission="rsvps" onclick="showAdminSection('rsvps', this); return false;">
                        <i class="fas fa-user-check"></i>
                        <span>RSVPs & Check-ins</span>
                    </a>
                </div>

                <div class="admin-sidebar-section">
                    <h6>Communication</h6>
                    <a href="#" class="admin-nav-item" data-section="complaints" data-permission="complaints" onclick="showAdminSection('complaints', this); return false;">
                        <i class="fas fa-exclamation-circle"></i>
                        <span>Complaints</span>
                        <span class="admin-badge">3</span>
                    </a>
                    <a href="#" class="admin-nav-item" data-section="surveys" data-permission="surveys" onclick="showAdminSection('surveys', this); return false;">
                        <i class="fas fa-poll"></i>
                        <span>Survey Admin</span>
                    </a>
                    <a href="#" class="admin-nav-item" data-section="announcements" data-permission="announcements" onclick="showAdminSection('announcements', this); return false;">
                        <i class="fas fa-bullhorn"></i>
                        <span>Announcements</span>
                    </a>
                </div>

                <div class="admin-sidebar-section">
                    <h6>Media</h6>
                    <a href="#" class="admin-nav-item" data-section="radio" data-permission="radio" onclick="showAdminSection('radio', this); return false;">
                        <i class="fas fa-broadcast-tower"></i>
                        <span>Radio Control</span>
                    </a>
                    <a href="#" class="admin-nav-item" data-section="magazine" data-permission="magazine" onclick="showAdminSection('magazine', this); return false;">
                        <i class="fas fa-newspaper"></i>
                        <span>Magazine Admin</span>
                    </a>
                </div>

                <div class="admin-sidebar-section">
                    <h6>Professional</h6>
                    <a href="#" class="admin-nav-item" data-section="careers" data-permission="careers" onclick="showAdminSection('careers', this); return false;">
                        <i class="fas fa-briefcase"></i>
                        <span>Career Directory</span>
                    </a>
                </div>

                <div class="admin-sidebar-section">
                    <h6>Finance</h6>
                    <a href="#" class="admin-nav-item" data-section="budget" data-permission="budget" onclick="showAdminSection('budget', this); return false;">
                        <i class="fas fa-wallet"></i>
                        <span>Budget & Finance</span>
                    </a>
                    <a href="#" class="admin-nav-item" data-section="vendors" data-permission="vendors" onclick="showAdminSection('vendors', this); return false;">
                        <i class="fas fa-store"></i>
                        <span>Vendors & Sponsors</span>
                    </a>
                </div>

                <div class="admin-sidebar-section">
                    <h6>Operations</h6>
                    <a href="#" class="admin-nav-item" data-section="volunteers" data-permission="volunteers" onclick="showAdminSection('volunteers', this); return false;">
                        <i class="fas fa-hands-helping"></i>
                        <span>Volunteers</span>
                    </a>
                    <a href="#" class="admin-nav-item" data-section="meetings" data-permission="meetings" onclick="showAdminSection('meetings', this); return false;">
                        <i class="fas fa-clipboard-list"></i>
                        <span>Meeting Minutes</span>
                    </a>
                </div>

                <div class="admin-sidebar-section">
                    <h6>Data & Archives</h6>
                    <a href="#" class="admin-nav-item" data-section="archiveData" data-permission="archive_data" onclick="showAdminSection('archiveData', this); return false;">
                        <i class="fas fa-archive"></i>
                        <span>Archive Data</span>
                    </a>
                    <a href="#" class="admin-nav-item" data-section="reportBuilder" data-permission="reports" onclick="showAdminSection('reportBuilder', this); return false;">
                        <i class="fas fa-chart-bar"></i>
                        <span>Report Builder</span>
                    </a>
                </div>
            </nav>

            <!-- Main Content -->
            <main class="admin-main-content">
                <section id="adminDashboard" class="admin-section active">
                    <div class="admin-page-header">
                        <div>
                            <h2>Admin Dashboard</h2>
                            <p>Welcome back! Here's your BANF management overview.</p>
                        </div>
                        <button class="admin-primary" onclick="runDueDiligenceChecks('admin')">
                            <i class="fas fa-stethoscope"></i> Run System Check
                        </button>
                    </div>

                    <div class="admin-stats-grid">
                        <div class="admin-stat-card red">
                            <div class="admin-stat-icon red"><i class="fas fa-users"></i></div>
                            <div class="admin-stat-info">
                                <h3>146</h3>
                                <p>Total Members</p>
                            </div>
                        </div>
                        <div class="admin-stat-card green">
                            <div class="admin-stat-icon green"><i class="fas fa-dollar-sign"></i></div>
                            <div class="admin-stat-info">
                                <h3>$12,450</h3>
                                <p>Revenue (YTD)</p>
                            </div>
                        </div>
                        <div class="admin-stat-card orange">
                            <div class="admin-stat-icon orange"><i class="fas fa-calendar-check"></i></div>
                            <div class="admin-stat-info">
                                <h3>5</h3>
                                <p>Upcoming Events</p>
                            </div>
                        </div>
                        <div class="admin-stat-card blue">
                            <div class="admin-stat-icon blue"><i class="fas fa-tasks"></i></div>
                            <div class="admin-stat-info">
                                <h3>8</h3>
                                <p>Pending Actions</p>
                            </div>
                        </div>
                    </div>

                    <div class="admin-card-grid">
                        <div class="admin-card">
                            <div class="admin-card-header">
                                <div class="admin-card-icon"><i class="fas fa-credit-card"></i></div>
                                <div>
                                    <h4>Payment Verification</h4>
                                    <span class="status-badge pending">5 Pending</span>
                                </div>
                            </div>
                            <p>Review and verify pending membership and event payments.</p>
                            <div class="admin-actions">
                                <button class="admin-secondary" onclick="showAdminSection('payments')"><i class="fas fa-check"></i> Review</button>
                                <button class="admin-secondary"><i class="fas fa-list"></i> View All</button>
                            </div>
                        </div>

                        <div class="admin-card">
                            <div class="admin-card-header">
                                <div class="admin-card-icon" style="background:rgba(33,150,243,0.1);color:#2196F3"><i class="fas fa-envelope"></i></div>
                                <div>
                                    <h4>Email Management</h4>
                                    <span class="status-badge active">Connected</span>
                                </div>
                            </div>
                            <p>Full inbox, compose, contact groups, search — manage all emails from <strong>banfjax@gmail.com</strong>.</p>
                            <div class="admin-actions">
                                <button class="admin-secondary" onclick="showAdminSection('gmail')"><i class="fas fa-inbox"></i> Open Inbox</button>
                                <button class="admin-secondary" onclick="showAdminSection('gmail'); setTimeout(()=>gmailShowTab('compose'),300)"><i class="fas fa-pen"></i> Compose</button>
                            </div>
                        </div>

                        <div class="admin-card">
                            <div class="admin-card-header">
                                <div class="admin-card-icon"><i class="fas fa-exclamation-circle"></i></div>
                                <div>
                                    <h4>Complaint Resolution</h4>
                                    <span class="status-badge new">3 New</span>
                                </div>
                            </div>
                            <p>Address member complaints and feedback submissions.</p>
                            <div class="admin-actions">
                                <button class="admin-secondary" onclick="showAdminSection('complaints')"><i class="fas fa-eye"></i> View</button>
                                <button class="admin-secondary"><i class="fas fa-reply"></i> Respond</button>
                            </div>
                        </div>

                        <div class="admin-card">
                            <div class="admin-card-header">
                                <div class="admin-card-icon"><i class="fas fa-music"></i></div>
                                <div>
                                    <h4>Radio Management</h4>
                                    <span class="status-badge active">Online</span>
                                </div>
                            </div>
                            <p>Manage playlists, approve song requests, and control radio.</p>
                            <div class="admin-actions">
                                <button class="admin-secondary" onclick="showAdminSection('radio')"><i class="fas fa-cog"></i> Manage</button>
                                <button class="admin-secondary"><i class="fas fa-list-music"></i> Playlist</button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- ═══════════════════════════════════════════════════════════════
                     MEMBERSHIP DASHBOARD — Year-wise membership under EC terms
                     ═══════════════════════════════════════════════════════════════ -->
                <section id="adminMembershipDashboard" class="admin-section">
                    <div class="admin-page-header">
                        <div>
                            <h2><i class="fas fa-id-card-alt me-2" style="color:#6528F7;"></i>Membership Dashboard</h2>
                            <p>Year-wise membership tracking under Executive Committee terms</p>
                        </div>
                        <div style="display:flex;gap:0.5rem;flex-wrap:wrap;align-items:center;">
                            <select id="mbrECTermSelect" class="form-select form-select-sm" style="width:auto;" onchange="renderMembershipDashboard()">
                                <option value="26-28" selected>EC 26-28 (Current)</option>
                                <option value="28-30">EC 28-30 (Future)</option>
                            </select>
                            <select id="mbrYearSelect" class="form-select form-select-sm" style="width:auto;" onchange="renderMembershipDashboard()">
                                <option value="2025-2026">2025-2026</option>
                                <option value="2026-2027" selected>2026-2027 (Current)</option>
                                <option value="2027-2028">2027-2028</option>
                            </select>
                            <button class="admin-primary" onclick="showAddMembershipModal()">
                                <i class="fas fa-plus-circle"></i> New Membership
                            </button>
                        </div>
                    </div>

                    <!-- Dashboard Stats Cards -->
                    <div id="mbrStatsCards" class="row g-3 mb-4">
                        <div class="col-6 col-md-3">
                            <div class="admin-card text-center p-3">
                                <div style="font-size:2rem;color:#6528F7;"><i class="fas fa-users"></i></div>
                                <h3 id="mbrStatTotalFamilies" style="color:#6528F7;">0</h3>
                                <small class="text-muted">Total Families</small>
                            </div>
                        </div>
                        <div class="col-6 col-md-3">
                            <div class="admin-card text-center p-3">
                                <div style="font-size:2rem;color:#28a745;"><i class="fas fa-check-circle"></i></div>
                                <h3 id="mbrStatActive" style="color:#28a745;">0</h3>
                                <small class="text-muted">Active This Year</small>
                            </div>
                        </div>
                        <div class="col-6 col-md-3">
                            <div class="admin-card text-center p-3">
                                <div style="font-size:2rem;color:#dc3545;"><i class="fas fa-times-circle"></i></div>
                                <h3 id="mbrStatInactive" style="color:#dc3545;">0</h3>
                                <small class="text-muted">Inactive / Unpaid</small>
                            </div>
                        </div>
                        <div class="col-6 col-md-3">
                            <div class="admin-card text-center p-3">
                                <div style="font-size:2rem;color:#fd7e14;"><i class="fas fa-dollar-sign"></i></div>
                                <h3 id="mbrStatRevenue" style="color:#fd7e14;">$0</h3>
                                <small class="text-muted">Revenue This Year</small>
                            </div>
                        </div>
                    </div>

                    <!-- Tier Breakdown -->
                    <div class="row g-3 mb-4" id="mbrTierBreakdown">
                        <div class="col-6 col-md-3">
                            <div class="admin-card p-3" style="border-left:4px solid #6f42c1;">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div><i class="fas fa-home me-1" style="color:#6f42c1;"></i> Family</div>
                                    <span id="mbrTierFamily" class="badge bg-purple">0</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-6 col-md-3">
                            <div class="admin-card p-3" style="border-left:4px solid #0d6efd;">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div><i class="fas fa-heart me-1" style="color:#0d6efd;"></i> Couple</div>
                                    <span id="mbrTierCouple" class="badge bg-primary">0</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-6 col-md-3">
                            <div class="admin-card p-3" style="border-left:4px solid #198754;">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div><i class="fas fa-user me-1" style="color:#198754;"></i> Individual</div>
                                    <span id="mbrTierIndividual" class="badge bg-success">0</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-6 col-md-3">
                            <div class="admin-card p-3" style="border-left:4px solid #ffc107;">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div><i class="fas fa-graduation-cap me-1" style="color:#ffc107;"></i> Student</div>
                                    <span id="mbrTierStudent" class="badge bg-warning text-dark">0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Memberships Table -->
                    <div class="admin-card p-3">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="mb-0"><i class="fas fa-list me-2"></i>Memberships</h5>
                            <div style="display:flex;gap:0.5rem;">
                                <input type="text" id="mbrSearchInput" class="form-control form-control-sm" placeholder="Search by name, ID..." onkeyup="filterMembershipTable()" style="width:220px;">
                                <select id="mbrFilterTier" class="form-select form-select-sm" style="width:auto;" onchange="filterMembershipTable()">
                                    <option value="">All Tiers</option>
                                    <option value="family">Family</option>
                                    <option value="couple">Couple</option>
                                    <option value="individual">Individual</option>
                                    <option value="student">Student</option>
                                </select>
                                <select id="mbrFilterStatus" class="form-select form-select-sm" style="width:auto;" onchange="filterMembershipTable()">
                                    <option value="">All Status</option>
                                    <option value="active">Active</option>
                                    <option value="pending">Pending</option>
                                    <option value="expired">Expired</option>
                                </select>
                            </div>
                        </div>
                        <div class="admin-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Membership ID</th>
                                        <th>Family ID</th>
                                        <th>Family Head</th>
                                        <th>Tier</th>
                                        <th>Amount</th>
                                        <th>Payment Date</th>
                                        <th>Method</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="mbrTableBody">
                                    <tr><td colspan="9" class="text-center text-muted py-4">Loading memberships...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- ═══════════════════════════════════════════════════════════════
                     FAMILY UNIVERSE — Complete family management
                     ═══════════════════════════════════════════════════════════════ -->
                <section id="adminFamilyUniverse" class="admin-section">
                    <div class="admin-page-header">
                        <div>
                            <h2><i class="fas fa-sitemap me-2" style="color:#6528F7;"></i>Family Universe</h2>
                            <p>Manage family units, members, and membership linkages</p>
                        </div>
                        <div style="display:flex;gap:0.5rem;flex-wrap:wrap;">
                            <input type="text" id="famSearchInput" class="form-control form-control-sm" placeholder="Search families..." onkeyup="renderFamilyUniverse()" style="width:220px;">
                            <select id="famFilterStatus" class="form-select form-select-sm" style="width:auto;" onchange="renderFamilyUniverse()">
                                <option value="">All Families</option>
                                <option value="active">Active (Paid Current Year)</option>
                                <option value="inactive">Inactive (Not Paid)</option>
                            </select>
                            <button class="admin-primary" onclick="showAddFamilyModal()">
                                <i class="fas fa-plus-circle"></i> New Family
                            </button>
                        </div>
                    </div>

                    <!-- Family Cards Grid -->
                    <div id="famCardsContainer" class="row g-3">
                        <div class="col-12 text-center text-muted py-5">Loading family universe...</div>
                    </div>
                </section>

                <!-- ═══════════════════════════════════════════════════════════════
                     FAMILY DETAIL PANEL — Shown when a family card is clicked
                     ═══════════════════════════════════════════════════════════════ -->
                <section id="adminFamilyDetail" class="admin-section">
                    <div class="admin-page-header">
                        <div>
                            <h2><i class="fas fa-users me-2" style="color:#6528F7;"></i><span id="famDetailTitle">Family Details</span></h2>
                            <p><span id="famDetailId" class="badge bg-dark"></span> <span id="famDetailStatus" class="status-badge"></span></p>
                        </div>
                        <div style="display:flex;gap:0.5rem;flex-wrap:wrap;">
                            <button class="admin-secondary" onclick="showAdminSection('familyUniverse')">
                                <i class="fas fa-arrow-left"></i> Back to Families
                            </button>
                            <button class="admin-primary" onclick="showEditFamilyModal()">
                                <i class="fas fa-edit"></i> Edit Family
                            </button>
                        </div>
                    </div>

                    <!-- Family Members List -->
                    <div class="admin-card p-3 mb-4">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="mb-0"><i class="fas fa-user-friends me-2"></i>Family Members</h5>
                            <div style="display:flex;gap:0.5rem;">
                                <button class="admin-secondary btn-sm" onclick="showAddFamilyMemberModal()">
                                    <i class="fas fa-user-plus"></i> Add Member
                                </button>
                                <button class="admin-secondary btn-sm" onclick="showTransferMemberModal()">
                                    <i class="fas fa-exchange-alt"></i> Transfer Member
                                </button>
                            </div>
                        </div>
                        <div class="admin-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Relationship</th>
                                        <th>Email</th>
                                        <th>Phone</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="famMembersTableBody">
                                    <tr><td colspan="5" class="text-center text-muted">No members</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Membership History -->
                    <div class="admin-card p-3 mb-4">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="mb-0"><i class="fas fa-history me-2"></i>Membership History</h5>
                            <button class="admin-primary btn-sm" onclick="showAddMembershipModal(currentFamilyDetailId)">
                                <i class="fas fa-plus"></i> Add Membership
                            </button>
                        </div>
                        <div class="admin-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Membership ID</th>
                                        <th>Year</th>
                                        <th>EC Term</th>
                                        <th>Tier</th>
                                        <th>Amount</th>
                                        <th>Payment</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="famMembershipHistoryBody">
                                    <tr><td colspan="7" class="text-center text-muted">No membership records</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Admin Notes -->
                    <div class="admin-card p-3">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="mb-0"><i class="fas fa-sticky-note me-2"></i>Admin Notes &amp; Comments</h5>
                            <button class="admin-primary btn-sm" onclick="showAddNoteModal()">
                                <i class="fas fa-plus"></i> Add Note
                            </button>
                        </div>
                        <div id="famNotesContainer">
                            <div class="text-center text-muted py-3">No notes yet</div>
                        </div>
                    </div>
                </section>

                <!-- ═══════════════════════════════════════════════════════════════
                     LEGACY MEMBER TABLE — All Members list (original)
                     ═══════════════════════════════════════════════════════════════ -->
                <section id="adminMembers" class="admin-section">
                    <div class="admin-page-header">
                        <div>
                            <h2><i class="fas fa-users me-2"></i>All Members (Legacy View)</h2>
                            <p>Quick member lookup — use Membership Dashboard for full management</p>
                        </div>
                        <button class="admin-secondary" onclick="showAdminSection('membershipDashboard')">
                            <i class="fas fa-arrow-right"></i> Go to Dashboard
                        </button>
                    </div>
                    <div class="admin-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Member ID</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="legacyMembersTableBody">
                                <!-- Populated by renderLegacyMembers() -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <section id="adminPayments" class="admin-section">
                    <div class="admin-page-header">
                        <div>
                            <h2><i class="fas fa-bolt me-2" style="color: #6528F7;"></i>Zelle Payment Automation</h2>
                            <p>Auto-detect Zelle payments from Gmail &amp; manage member payments</p>
                        </div>
                        <div style="display:flex; gap:0.5rem; flex-wrap:wrap;">
                            <button class="admin-primary" onclick="zelleManualScan()" id="btnZelleScan">
                                <i class="fas fa-search"></i> Scan Gmail Now
                            </button>
                            <button class="admin-secondary" id="btnZelleAutoToggle" onclick="zelleTogglePoller()">
                                <i class="fas fa-sync-alt"></i> Auto-Poll: OFF
                            </button>
                        </div>
                    </div>

                    <!-- Zelle Stats Cards -->
                    <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(160px,1fr)); gap:1rem; margin-bottom:1.5rem;" id="zelleStatsGrid">
                        <div class="admin-stat-card" style="border-left:4px solid #6528F7;">
                            <div class="stat-label">Total Detected</div>
                            <div class="stat-value" id="zelleTotalDetected">0</div>
                        </div>
                        <div class="admin-stat-card" style="border-left:4px solid #FFC107;">
                            <div class="stat-label">Pending Review</div>
                            <div class="stat-value" id="zellePendingCount" style="color:#FFC107;">0</div>
                        </div>
                        <div class="admin-stat-card" style="border-left:4px solid #28a745;">
                            <div class="stat-label">Verified</div>
                            <div class="stat-value" id="zelleVerifiedCount" style="color:#28a745;">0</div>
                        </div>
                        <div class="admin-stat-card" style="border-left:4px solid #17a2b8;">
                            <div class="stat-label">Auto-Matched</div>
                            <div class="stat-value" id="zelleAutoMatched">0</div>
                        </div>
                        <div class="admin-stat-card" style="border-left:4px solid #28a745;">
                            <div class="stat-label">Total Collected</div>
                            <div class="stat-value" id="zelleTotalAmount" style="color:#28a745;">$0</div>
                        </div>
                        <div class="admin-stat-card" style="border-left:4px solid #6c757d;">
                            <div class="stat-label">Last Scan</div>
                            <div class="stat-value" id="zelleLastScan" style="font-size:0.9rem;">Never</div>
                        </div>
                    </div>

                    <!-- Scan Status Banner -->
                    <div id="zelleScanBanner" style="display:none; padding:1rem; border-radius:8px; margin-bottom:1rem; background:#e8f5e9; border:1px solid #4caf50;">
                        <i class="fas fa-check-circle" style="color:#4caf50; margin-right:0.5rem;"></i>
                        <span id="zelleScanMessage">Scan complete</span>
                    </div>

                    <!-- Filter Tabs -->
                    <div style="display:flex; gap:0.5rem; margin-bottom:1rem; flex-wrap:wrap;">
                        <button class="admin-primary" onclick="zelleFilterPayments('all')" id="zelleFilterAll" style="font-size:0.85rem;">All</button>
                        <button class="admin-secondary" onclick="zelleFilterPayments('pending')" id="zelleFilterPending" style="font-size:0.85rem;">⏳ Pending</button>
                        <button class="admin-secondary" onclick="zelleFilterPayments('auto_verified')" id="zelleFilterAuto" style="font-size:0.85rem;">🤖 Auto-Verified</button>
                        <button class="admin-secondary" onclick="zelleFilterPayments('verified')" id="zelleFilterVerified" style="font-size:0.85rem;">✅ Verified</button>
                        <button class="admin-secondary" onclick="zelleFilterPayments('rejected')" id="zelleFilterRejected" style="font-size:0.85rem;">❌ Rejected</button>
                        <button class="admin-secondary" onclick="zelleSeedTestData()" style="font-size:0.85rem; margin-left:auto;">
                            <i class="fas fa-flask"></i> Load Test Data
                        </button>
                    </div>

                    <!-- Payments Table -->
                    <div class="admin-table" style="overflow-x:auto;">
                        <table id="zellePaymentsTable">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Date</th>
                                    <th>From (Zelle)</th>
                                    <th>Amount</th>
                                    <th>Memo</th>
                                    <th>Bank</th>
                                    <th>Matched Member</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="zellePaymentsBody">
                                <tr>
                                    <td colspan="9" class="text-center" style="padding:2rem; color:#999;">
                                        <i class="fas fa-inbox" style="font-size:2rem; display:block; margin-bottom:0.5rem;"></i>
                                        No Zelle payments detected yet. Click "Scan Gmail Now" or "Load Test Data" to start.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Member Match Modal (inline) -->
                    <div id="zelleMatchModal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); z-index:9999; justify-content:center; align-items:center;">
                        <div style="background:white; border-radius:12px; padding:2rem; max-width:500px; width:90%; max-height:80vh; overflow-y:auto;">
                            <h4><i class="fas fa-link me-2"></i>Match Payment to Member</h4>
                            <p style="color:#666;">Payment: <strong id="zelleMatchPaymentInfo"></strong></p>
                            <div style="margin:1rem 0;">
                                <label class="form-label">Select Member</label>
                                <select class="form-select" id="zelleMatchMemberSelect">
                                    <option value="">-- Select a member --</option>
                                </select>
                            </div>
                            <div style="display:flex; gap:0.5rem; justify-content:flex-end;">
                                <button class="admin-secondary" onclick="zelleCloseMatchModal()">Cancel</button>
                                <button class="admin-primary" onclick="zelleConfirmMatch()">
                                    <i class="fas fa-check"></i> Match & Verify
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="adminEvents" class="admin-section">
                    <div class="admin-page-header">
                        <div>
                            <h2>Event Management</h2>
                            <p>Create and manage BANF events</p>
                        </div>
                        <button class="admin-primary" onclick="openEventModal()"><i class="fas fa-plus"></i> Create Event</button>
                    </div>
                    <!-- Stats -->
                    <div class="row g-3 mb-4" id="eventStatsRow">
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #4CAF50"><div class="stat-number" style="color:#4CAF50" id="eventStatUpcoming">0</div><div class="stat-label">Upcoming Events</div></div></div>
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #2196F3"><div class="stat-number" style="color:#2196F3" id="eventStatTotal">0</div><div class="stat-label">Total Events</div></div></div>
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #FF9800"><div class="stat-number" style="color:#FF9800" id="eventStatRsvps">0</div><div class="stat-label">Total RSVPs</div></div></div>
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #9C27B0"><div class="stat-number" style="color:#9C27B0" id="eventStatDraft">0</div><div class="stat-label">Drafts</div></div></div>
                    </div>
                    <!-- Filter -->
                    <div class="d-flex gap-2 mb-3 flex-wrap">
                        <input type="text" class="form-control form-control-sm" style="max-width:250px" placeholder="Search events..." id="eventSearchInput" oninput="renderAdminEvents()">
                        <select class="form-select form-select-sm" style="max-width:160px" id="eventStatusFilter" onchange="renderAdminEvents()">
                            <option value="">All Statuses</option><option value="Published">Published</option><option value="Draft">Draft</option><option value="Cancelled">Cancelled</option><option value="Completed">Completed</option>
                        </select>
                    </div>
                    <!-- Table -->
                    <div class="admin-table">
                        <table>
                            <thead><tr><th>Event Name</th><th>Date</th><th>Venue</th><th>RSVPs</th><th>Status</th><th>Actions</th></tr></thead>
                            <tbody id="eventsTableBody"></tbody>
                        </table>
                    </div>
                    <!-- Event Modal -->
                    <div id="eventModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:10000;overflow-y:auto">
                        <div style="max-width:600px;margin:4rem auto;background:#fff;border-radius:12px;padding:2rem;position:relative">
                            <button onclick="closeEventModal()" style="position:absolute;top:1rem;right:1rem;background:none;border:none;font-size:1.5rem;cursor:pointer">&times;</button>
                            <h4 id="eventModalTitle">Create Event</h4>
                            <input type="hidden" id="eventEditId">
                            <div class="mb-3"><label class="form-label">Event Name *</label><input type="text" class="form-control" id="eventName"></div>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6"><label class="form-label">Date *</label><input type="date" class="form-control" id="eventDate"></div>
                                <div class="col-md-6"><label class="form-label">Time</label><input type="time" class="form-control" id="eventTime"></div>
                            </div>
                            <div class="mb-3"><label class="form-label">Venue</label><input type="text" class="form-control" id="eventVenue"></div>
                            <div class="mb-3"><label class="form-label">Description</label><textarea class="form-control" rows="3" id="eventDescription"></textarea></div>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6"><label class="form-label">Category</label><select class="form-select" id="eventCategory"><option>Cultural</option><option>Religious</option><option>Social</option><option>Sports</option><option>Meeting</option><option>Other</option></select></div>
                                <div class="col-md-6"><label class="form-label">Status</label><select class="form-select" id="eventStatus"><option>Published</option><option>Draft</option><option>Cancelled</option></select></div>
                            </div>
                            <div class="d-flex gap-2 justify-content-end">
                                <button class="btn btn-secondary" onclick="closeEventModal()">Cancel</button>
                                <button class="btn btn-primary" onclick="saveEvent()"><i class="fas fa-save me-1"></i>Save Event</button>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="adminRsvps" class="admin-section">
                    <div class="admin-page-header">
                        <div>
                            <h2>RSVPs & Check-ins</h2>
                            <p>Track attendee registrations and check-ins</p>
                        </div>
                        <button class="admin-primary" onclick="exportEviteReport()"><i class="fas fa-download"></i> Export Report</button>
                    </div>
                    <div id="rsvpSummaryStats" class="admin-stats-grid" style="margin-bottom: 1.5rem;">
                        <!-- Populated by renderRsvpDashboard -->
                    </div>
                    <div class="admin-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Event</th>
                                    <th>Member</th>
                                    <th>Status</th>
                                    <th>Adults</th>
                                    <th>Kids</th>
                                    <th>Dietary</th>
                                    <th>Notes</th>
                                    <th>Check-in</th>
                                </tr>
                            </thead>
                            <tbody id="rsvpTableBody">
                                <tr>
                                    <td>Nabo Borsho 1433</td>
                                    <td>Member #45</td>
                                    <td><span class="status-badge active">Registered</span></td>
                                    <td>2</td>
                                    <td>1</td>
                                    <td>None</td>
                                    <td>-</td>
                                    <td><button class="admin-secondary">Check-in</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- ========== EVITE / INVITATION SECTION ========== -->
                <section id="adminEvite" class="admin-section">
                    <div class="admin-page-header">
                        <div>
                            <h2><i class="fas fa-envelope-open-text me-2"></i>Evite / Invitations</h2>
                            <p>Send event invitations and track RSVP responses</p>
                        </div>
                        <button class="admin-primary" onclick="openSendEviteForm()"><i class="fas fa-paper-plane"></i> Send New Evite</button>
                    </div>

                    <!-- Send Evite Form (hidden by default) -->
                    <div id="sendEviteFormContainer" style="display:none; margin-bottom: 2rem;">
                        <div class="admin-card" style="border: 2px solid var(--gold);">
                            <h4><i class="fas fa-paper-plane me-2"></i>Compose Invitation</h4>
                            <form id="sendEviteForm" onsubmit="return handleSendEvite(event)">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Event Name *</label>
                                        <select class="form-control" id="eviteEventName" required>
                                            <option value="">Select event...</option>
                                            <option value="Nabo Borsho 1433">Nabo Borsho 1433 (Apr 25, 2026)</option>
                                            <option value="Summer Camp 2026">Summer Camp 2026 (Jun 15, 2026)</option>
                                            <option value="Spandan 2026">Spandan 2026 (Aug 2026)</option>
                                            <option value="Mahalaya 2026">Mahalaya 2026 (Oct 2026)</option>
                                            <option value="Durga Puja 2026">Durga Puja 2026 (Oct 2026)</option>
                                            <option value="Custom">Custom Event...</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Template</label>
                                        <select class="form-control" id="eviteTemplate" onchange="applyEviteTemplate()">
                                            <option value="">Select template...</option>
                                            <option value="TPL-001">🪷 Cultural Event</option>
                                            <option value="TPL-002">📋 Meeting</option>
                                            <option value="TPL-003">🌳 Picnic/Outing</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label fw-bold">Event Date *</label>
                                        <input type="date" class="form-control" id="eviteDate" required>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label fw-bold">Event Time</label>
                                        <input type="text" class="form-control" id="eviteTime" placeholder="e.g. 5:00 PM - 10:00 PM">
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label fw-bold">Venue</label>
                                        <input type="text" class="form-control" id="eviteVenue" placeholder="Event location">
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label fw-bold">Recipients</label>
                                        <select class="form-control" id="eviteRecipients">
                                            <option value="all">All Members (146)</option>
                                            <option value="active">Active Members Only (117)</option>
                                            <option value="family">Family Members (105)</option>
                                            <option value="ec">EC Members Only (10)</option>
                                        </select>
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label fw-bold">Subject Line</label>
                                        <input type="text" class="form-control" id="eviteSubject" placeholder="You're invited to...">
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label fw-bold">Invitation Message</label>
                                        <textarea class="form-control" id="eviteMessage" rows="6" placeholder="Write your invitation message..."></textarea>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="checkbox" id="eviteCollectDietary" checked>
                                            <label class="form-check-label">Collect dietary requirements</label>
                                        </div>
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="checkbox" id="eviteCollectKids" checked>
                                            <label class="form-check-label">Collect adult/kid count</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="eviteAllowMaybe" checked>
                                            <label class="form-check-label">Allow "Maybe" responses</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-3" style="display:flex; gap:0.5rem; flex-wrap:wrap;">
                                    <button type="submit" class="admin-primary"><i class="fas fa-paper-plane me-1"></i> Send Invitations</button>
                                    <button type="button" class="admin-secondary" onclick="previewEvite()"><i class="fas fa-eye me-1"></i> Preview</button>
                                    <button type="button" class="admin-secondary" onclick="document.getElementById('sendEviteFormContainer').style.display='none'"><i class="fas fa-times me-1"></i> Cancel</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Evite History / Sent Invitations -->
                    <div id="eviteHistoryContainer">
                        <h4 class="mb-3"><i class="fas fa-history me-2"></i>Sent Invitations</h4>
                        <div id="eviteHistoryList" class="admin-card-grid">
                            <!-- Populated by renderEviteHistory() -->
                        </div>
                    </div>

                    <!-- RSVP Report Modal Area -->
                    <div id="eviteReportArea" style="display:none; margin-top: 2rem;">
                        <div class="admin-card" style="border-left: 4px solid var(--gold);">
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                                <h4 id="eviteReportTitle"><i class="fas fa-chart-bar me-2"></i>RSVP Report</h4>
                                <div>
                                    <button class="admin-secondary" onclick="exportEviteReport()"><i class="fas fa-file-csv me-1"></i> Export CSV</button>
                                    <button class="admin-secondary" onclick="document.getElementById('eviteReportArea').style.display='none'"><i class="fas fa-times me-1"></i> Close</button>
                                </div>
                            </div>
                            <div id="eviteReportStats" class="admin-stats-grid" style="margin-bottom: 1rem;"></div>
                            <div id="eviteReportDietary" style="margin-bottom: 1rem;"></div>
                            <div class="admin-table">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Member</th>
                                            <th>Status</th>
                                            <th>Adults</th>
                                            <th>Kids</th>
                                            <th>Dietary</th>
                                            <th>Notes</th>
                                            <th>Responded</th>
                                        </tr>
                                    </thead>
                                    <tbody id="eviteReportTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- ========== DATA IMPORT (EXCEL) SECTION ========== -->
                <section id="adminDataImport" class="admin-section">
                    <div class="admin-page-header">
                        <div>
                            <h2><i class="fas fa-file-excel me-2"></i>Data Import (Excel)</h2>
                            <p>Upload member data, event data, and payment records via Excel/CSV</p>
                        </div>
                    </div>

                    <div class="admin-card-grid">
                        <div class="admin-card">
                            <div class="admin-card-header">
                                <div class="admin-card-icon"><i class="fas fa-users"></i></div>
                                <div>
                                    <h4>Member Import</h4>
                                    <span class="status-badge active">Ready</span>
                                </div>
                            </div>
                            <p>Upload member list from Excel/CSV. Required columns: First Name, Last Name, Email, Phone, Membership Type.</p>
                            <input type="file" id="memberImportFile" accept=".xlsx,.xls,.csv" style="display:none" onchange="handleExcelUpload('members', this)">
                            <div class="admin-actions">
                                <button class="admin-primary" onclick="document.getElementById('memberImportFile').click()"><i class="fas fa-upload me-1"></i> Upload</button>
                                <button class="admin-secondary" onclick="downloadTemplate('members')"><i class="fas fa-download me-1"></i> Template</button>
                            </div>
                        </div>

                        <div class="admin-card">
                            <div class="admin-card-header">
                                <div class="admin-card-icon"><i class="fas fa-calendar-alt"></i></div>
                                <div>
                                    <h4>Event Import</h4>
                                    <span class="status-badge active">Ready</span>
                                </div>
                            </div>
                            <p>Upload event schedule from Excel. Required columns: Event Name, Date, Time, Venue, Description.</p>
                            <input type="file" id="eventImportFile" accept=".xlsx,.xls,.csv" style="display:none" onchange="handleExcelUpload('events', this)">
                            <div class="admin-actions">
                                <button class="admin-primary" onclick="document.getElementById('eventImportFile').click()"><i class="fas fa-upload me-1"></i> Upload</button>
                                <button class="admin-secondary" onclick="downloadTemplate('events')"><i class="fas fa-download me-1"></i> Template</button>
                            </div>
                        </div>

                        <div class="admin-card">
                            <div class="admin-card-header">
                                <div class="admin-card-icon"><i class="fas fa-credit-card"></i></div>
                                <div>
                                    <h4>Payment Import</h4>
                                    <span class="status-badge active">Ready</span>
                                </div>
                            </div>
                            <p>Upload payment records from Excel. Required: Member Name, Amount, Date, Type, Status.</p>
                            <input type="file" id="paymentImportFile" accept=".xlsx,.xls,.csv" style="display:none" onchange="handleExcelUpload('payments', this)">
                            <div class="admin-actions">
                                <button class="admin-primary" onclick="document.getElementById('paymentImportFile').click()"><i class="fas fa-upload me-1"></i> Upload</button>
                                <button class="admin-secondary" onclick="downloadTemplate('payments')"><i class="fas fa-download me-1"></i> Template</button>
                            </div>
                        </div>
                    </div>

                    <!-- Import Preview Area -->
                    <div id="importPreviewArea" style="display:none; margin-top: 2rem;">
                        <div class="admin-card" style="border-left: 4px solid #4CAF50;">
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                                <h4 id="importPreviewTitle"><i class="fas fa-table me-2"></i>Import Preview</h4>
                                <div>
                                    <button class="admin-primary" id="confirmImportBtn" onclick="confirmImport()"><i class="fas fa-check me-1"></i> Confirm Import</button>
                                    <button class="admin-secondary" onclick="document.getElementById('importPreviewArea').style.display='none'"><i class="fas fa-times me-1"></i> Cancel</button>
                                </div>
                            </div>
                            <div id="importPreviewStats" class="mb-3"></div>
                            <div class="admin-table" style="max-height: 400px; overflow-y: auto;">
                                <table>
                                    <thead id="importPreviewHead"></thead>
                                    <tbody id="importPreviewBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Import History -->
                    <div style="margin-top: 2rem;">
                        <h4><i class="fas fa-history me-2"></i>Import History</h4>
                        <div class="admin-table">
                            <table>
                                <thead>
                                    <tr><th>Date</th><th>Type</th><th>Records</th><th>Status</th><th>Imported By</th></tr>
                                </thead>
                                <tbody id="importHistoryBody">
                                    <tr>
                                        <td>Jan 15, 2026</td>
                                        <td>Members</td>
                                        <td>45 records</td>
                                        <td><span class="status-badge active">Success</span></td>
                                        <td>Admin User</td>
                                    </tr>
                                    <tr>
                                        <td>Feb 01, 2026</td>
                                        <td>Payments</td>
                                        <td>23 records</td>
                                        <td><span class="status-badge active">Success</span></td>
                                        <td>Subir Ghosh</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- ========== DB EXPLORER SECTION (Feature 7 - Enhanced with Current/Archive Tabs) ========== -->
                <section id="adminDbExplorer" class="admin-section">
                    <div class="admin-page-header">
                        <div>
                            <h2><i class="fas fa-database me-2"></i>Database Explorer</h2>
                            <p>Browse, search, and manage current & archive data across all schema tables</p>
                        </div>
                        <div class="admin-actions">
                            <button class="admin-primary" id="dbExpAddBtn" onclick="UniversalDBExplorer.showAddModal()" style="display:none"><i class="fas fa-plus me-1"></i> Add Record</button>
                            <button class="admin-secondary" id="dbExpExportCsvBtn" onclick="UniversalDBExplorer.exportCSV()" style="display:none"><i class="fas fa-file-csv me-1"></i> Export CSV</button>
                            <button class="admin-secondary" id="dbExpExportXlsxBtn" onclick="UniversalDBExplorer.exportExcel()" style="display:none"><i class="fas fa-file-excel me-1"></i> Export Excel</button>
                            <button class="admin-secondary" onclick="UniversalDBExplorer.refresh()"><i class="fas fa-sync-alt me-1"></i> Refresh</button>
                        </div>
                    </div>

                    <!-- Current / Archive Tab Switcher -->
                    <div class="admin-card" style="margin-bottom:1.5rem; padding:0;">
                        <div style="display:flex; border-bottom:2px solid #e0e0e0;">
                            <button class="dbexp-tab active" id="dbExpTabCurrent" onclick="UniversalDBExplorer.switchTab('current')" style="flex:1; padding:0.75rem 1rem; border:none; background:none; font-weight:600; font-size:0.95rem; cursor:pointer; border-bottom:3px solid #1a237e; color:#1a237e; transition:all 0.2s;">
                                <i class="fas fa-server me-2"></i>Current Data
                            </button>
                            <button class="dbexp-tab" id="dbExpTabArchive" onclick="UniversalDBExplorer.switchTab('archive')" style="flex:1; padding:0.75rem 1rem; border:none; background:none; font-weight:600; font-size:0.95rem; cursor:pointer; border-bottom:3px solid transparent; color:#666; transition:all 0.2s;">
                                <i class="fas fa-archive me-2"></i>Archive Data <span style="font-size:0.75rem; background:#e8eaf6; color:#1a237e; padding:2px 8px; border-radius:10px; margin-left:6px;">Read-Only</span>
                            </button>
                        </div>
                    </div>

                    <!-- Stats Row -->
                    <div class="admin-card-grid" id="dbExpStats" style="margin-bottom:1.5rem;"></div>

                    <!-- Schema / Table Selector -->
                    <div class="admin-card" style="margin-bottom:1.5rem;">
                        <div style="display:flex; flex-wrap:wrap; gap:1rem; align-items:flex-end;">
                            <div style="flex:1; min-width:180px;" id="dbExpLayerWrap">
                                <label style="font-size:0.85rem; font-weight:600; margin-bottom:4px; display:block;"><i class="fas fa-layer-group me-1"></i>Schema Layer</label>
                                <select id="dbExpLayerSelect" class="form-select" onchange="UniversalDBExplorer.onLayerChange()">
                                    <option value="">All Layers</option>
                                </select>
                            </div>
                            <div style="flex:1.5; min-width:200px;">
                                <label style="font-size:0.85rem; font-weight:600; margin-bottom:4px; display:block;"><i class="fas fa-table me-1"></i>Table</label>
                                <select id="dbExpTableSelect" class="form-select" onchange="UniversalDBExplorer.onTableChange()">
                                    <option value="">Select a table…</option>
                                </select>
                            </div>
                            <div style="flex:2; min-width:200px;">
                                <label style="font-size:0.85rem; font-weight:600; margin-bottom:4px; display:block;"><i class="fas fa-search me-1"></i>Search</label>
                                <input type="text" id="dbExpSearch" class="form-control" placeholder="Search across all columns…" oninput="UniversalDBExplorer.applyFilters()">
                            </div>
                            <div style="flex:0.5; min-width:100px;">
                                <label style="font-size:0.85rem; font-weight:600; margin-bottom:4px; display:block;">Per Page</label>
                                <select id="dbExpPerPage" class="form-select" onchange="UniversalDBExplorer.applyFilters()">
                                    <option value="15">15</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- President Table Permission Manager -->
                    <div class="admin-card" id="dbExpPermissionCard" style="margin-bottom:1.5rem; display:none;">
                        <h4 style="margin-bottom:0.75rem; font-size:1rem;"><i class="fas fa-user-shield me-2" style="color:#8B0000;"></i>Table Permission Manager (President)</h4>
                        <p style="font-size:0.85rem; color:#666; margin-bottom:0.75rem;">Configure role-based access for each table and action. These permissions affect DB Explorer access for EC roles.</p>
                        <div style="display:flex; gap:0.75rem; flex-wrap:wrap; align-items:flex-end; margin-bottom:0.75rem;">
                            <div style="min-width:220px; flex:1;">
                                <label style="font-size:0.8rem; font-weight:600; display:block; margin-bottom:4px;">Table</label>
                                <select id="dbExpPermTable" class="form-select" onchange="UniversalDBExplorer.renderPermissionRoles()"></select>
                            </div>
                            <div style="min-width:180px;">
                                <label style="font-size:0.8rem; font-weight:600; display:block; margin-bottom:4px;">Action</label>
                                <select id="dbExpPermAction" class="form-select" onchange="UniversalDBExplorer.renderPermissionRoles()">
                                    <option value="view">View</option>
                                    <option value="add">Add</option>
                                    <option value="edit">Edit</option>
                                    <option value="delete">Delete</option>
                                    <option value="export">Export</option>
                                </select>
                            </div>
                        </div>
                        <div id="dbExpPermRoles" style="display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:0.5rem; margin-bottom:0.75rem;"></div>
                        <div class="d-flex gap-2">
                            <button class="admin-primary" onclick="UniversalDBExplorer.savePermissionConfig()"><i class="fas fa-save me-1"></i>Save Permissions</button>
                            <button class="admin-secondary" onclick="UniversalDBExplorer.resetPermissionConfig()"><i class="fas fa-undo me-1"></i>Reset</button>
                        </div>
                    </div>

                    <!-- Table Info Bar -->
                    <div id="dbExpTableInfo" class="admin-card" style="margin-bottom:1rem; display:none; padding:0.75rem 1rem; background:#f8f9fa;">
                        <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:0.5rem;">
                            <span id="dbExpTableInfoText" style="font-size:0.85rem; color:#555;"></span>
                            <span id="dbExpPermBadge" style="font-size:0.8rem;"></span>
                        </div>
                    </div>

                    <!-- Data Table (dynamic columns) -->
                    <div class="admin-card">
                        <div class="admin-table" style="max-height: 500px; overflow-x: auto; overflow-y: auto;">
                            <table id="dbExpTable">
                                <thead id="dbExpTableHead"></thead>
                                <tbody id="dbExpTableBody"></tbody>
                            </table>
                        </div>
                        <!-- Pagination -->
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-top:1rem; padding:0 0.5rem;">
                            <span id="dbExpPageInfo" style="font-size:0.85rem; color:#666;"></span>
                            <div>
                                <button class="admin-secondary" onclick="UniversalDBExplorer.prevPage()" id="dbExpPrevBtn" style="margin-right:0.5rem;"><i class="fas fa-chevron-left me-1"></i>Prev</button>
                                <button class="admin-secondary" onclick="UniversalDBExplorer.nextPage()" id="dbExpNextBtn">Next<i class="fas fa-chevron-right ms-1"></i></button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- ========== ARCHIVE DATA MANAGEMENT SECTION ========== -->
                <section id="adminArchiveData" class="admin-section">
                    <div class="admin-page-header">
                        <div>
                            <h2><i class="fas fa-archive me-2"></i>Archive Data Management</h2>
                            <p>Browse migrated BANF historical data — 12 schema layers, 25+ tables, 6,900+ records</p>
                        </div>
                        <div class="admin-actions">
                            <button class="admin-secondary" onclick="ArchiveDataManager.exportCurrentView()"><i class="fas fa-download me-1"></i> Export View</button>
                            <button class="admin-secondary" onclick="ArchiveDataManager.refresh()"><i class="fas fa-sync-alt me-1"></i> Refresh</button>
                        </div>
                    </div>

                    <!-- Archive Overview Stats -->
                    <div class="admin-card-grid" id="archiveOverviewStats" style="margin-bottom:1.5rem;"></div>

                    <!-- Archive Sub-Navigation Tabs -->
                    <div class="admin-card" style="margin-bottom:1.5rem; padding:0;">
                        <div style="display:flex; border-bottom:2px solid #e0e0e0; overflow-x:auto;">
                            <button class="archive-tab active" data-tab="schemaExplorer" onclick="ArchiveDataManager.switchTab('schemaExplorer', this)" style="padding:0.65rem 1rem; border:none; background:none; font-weight:600; font-size:0.85rem; cursor:pointer; border-bottom:3px solid #1a237e; color:#1a237e; white-space:nowrap; transition:all 0.2s;">
                                <i class="fas fa-sitemap me-1"></i> Schema Explorer
                            </button>
                            <button class="archive-tab" data-tab="dataViewer" onclick="ArchiveDataManager.switchTab('dataViewer', this)" style="padding:0.65rem 1rem; border:none; background:none; font-weight:600; font-size:0.85rem; cursor:pointer; border-bottom:3px solid transparent; color:#666; white-space:nowrap; transition:all 0.2s;">
                                <i class="fas fa-table me-1"></i> Data Viewer
                            </button>
                            <button class="archive-tab" data-tab="fileArchive" onclick="ArchiveDataManager.switchTab('fileArchive', this)" style="padding:0.65rem 1rem; border:none; background:none; font-weight:600; font-size:0.85rem; cursor:pointer; border-bottom:3px solid transparent; color:#666; white-space:nowrap; transition:all 0.2s;">
                                <i class="fas fa-folder-open me-1"></i> File Archives
                            </button>
                            <button class="archive-tab" data-tab="lineageView" onclick="ArchiveDataManager.switchTab('lineageView', this)" style="padding:0.65rem 1rem; border:none; background:none; font-weight:600; font-size:0.85rem; cursor:pointer; border-bottom:3px solid transparent; color:#666; white-space:nowrap; transition:all 0.2s;">
                                <i class="fas fa-project-diagram me-1"></i> Data Lineage
                            </button>
                        </div>
                    </div>

                    <!-- Schema Explorer Sub-Tab -->
                    <div id="archiveTabSchemaExplorer" class="archive-tab-panel">
                        <div style="display:flex; gap:1.5rem; flex-wrap:wrap;">
                            <!-- Left: Layer Tree -->
                            <div style="flex:1; min-width:280px;">
                                <div class="admin-card" style="height:100%;">
                                    <h4 style="margin-bottom:1rem; font-size:1rem;"><i class="fas fa-layer-group me-2" style="color:#1a237e;"></i>Schema Layers (12)</h4>
                                    <div id="archiveSchemaTree" style="max-height:500px; overflow-y:auto;"></div>
                                </div>
                            </div>
                            <!-- Right: Table Details -->
                            <div style="flex:2; min-width:400px;">
                                <div class="admin-card" style="height:100%;">
                                    <div id="archiveTableDetail">
                                        <div style="text-align:center; padding:3rem 1rem; color:#999;">
                                            <i class="fas fa-hand-pointer" style="font-size:2.5rem; margin-bottom:1rem; display:block;"></i>
                                            <p style="font-size:1rem;">Select a table from the schema tree to view its structure, columns, and sample data</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Data Viewer Sub-Tab -->
                    <div id="archiveTabDataViewer" class="archive-tab-panel" style="display:none;">
                        <div class="admin-card" style="margin-bottom:1rem;">
                            <div style="display:flex; flex-wrap:wrap; gap:1rem; align-items:flex-end;">
                                <div style="flex:1; min-width:180px;">
                                    <label style="font-size:0.85rem; font-weight:600; margin-bottom:4px; display:block;">Schema Layer</label>
                                    <select id="archiveViewerLayer" class="form-select" onchange="ArchiveDataManager.onViewerLayerChange()">
                                        <option value="">All Layers</option>
                                    </select>
                                </div>
                                <div style="flex:1.5; min-width:200px;">
                                    <label style="font-size:0.85rem; font-weight:600; margin-bottom:4px; display:block;">Table</label>
                                    <select id="archiveViewerTable" class="form-select" onchange="ArchiveDataManager.loadViewerTable()">
                                        <option value="">Select table…</option>
                                    </select>
                                </div>
                                <div style="flex:2; min-width:200px;">
                                    <label style="font-size:0.85rem; font-weight:600; margin-bottom:4px; display:block;">Search</label>
                                    <input type="text" id="archiveViewerSearch" class="form-control" placeholder="Search records…" oninput="ArchiveDataManager.filterViewerData()">
                                </div>
                                <div style="flex:0.5; min-width:80px;">
                                    <button class="admin-secondary" style="width:100%;" onclick="ArchiveDataManager.exportViewerCSV()"><i class="fas fa-download me-1"></i>CSV</button>
                                </div>
                            </div>
                        </div>
                        <div class="admin-card">
                            <div id="archiveViewerInfo" style="margin-bottom:0.75rem; font-size:0.85rem; color:#555; display:none;"></div>
                            <div class="admin-table" style="max-height:450px; overflow:auto;">
                                <table id="archiveViewerTable2">
                                    <thead id="archiveViewerHead"></thead>
                                    <tbody id="archiveViewerBody"></tbody>
                                </table>
                            </div>
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:1rem; padding:0 0.5rem;">
                                <span id="archiveViewerPageInfo" style="font-size:0.85rem; color:#666;"></span>
                                <div>
                                    <button class="admin-secondary" onclick="ArchiveDataManager.viewerPrev()" id="archiveViewerPrevBtn" style="margin-right:0.5rem;"><i class="fas fa-chevron-left me-1"></i>Prev</button>
                                    <button class="admin-secondary" onclick="ArchiveDataManager.viewerNext()" id="archiveViewerNextBtn">Next<i class="fas fa-chevron-right ms-1"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- File Archives Sub-Tab -->
                    <div id="archiveTabFileArchive" class="archive-tab-panel" style="display:none;">
                        <div class="admin-card">
                            <h4 style="margin-bottom:1rem;"><i class="fas fa-folder-open me-2" style="color:#f57c00;"></i>Original File Archives</h4>
                            <p style="font-size:0.9rem; color:#666; margin-bottom:1.5rem;">Browse and download original source documents that were migrated into the semantic archive database.</p>
                            <div style="display:flex; gap:1rem; margin-bottom:1.5rem; flex-wrap:wrap;">
                                <input type="text" id="fileArchiveSearch" class="form-control" placeholder="Search files by name or type…" style="max-width:350px;" oninput="ArchiveDataManager.filterFiles()">
                                <select id="fileArchiveTypeFilter" class="form-select" style="max-width:200px;" onchange="ArchiveDataManager.filterFiles()">
                                    <option value="">All File Types</option>
                                    <option value="pdf">PDF Documents</option>
                                    <option value="xlsx">Excel Spreadsheets</option>
                                    <option value="docx">Word Documents</option>
                                    <option value="jpg">Images (JPG/PNG)</option>
                                    <option value="txt">Text Files</option>
                                </select>
                                <select id="fileArchiveCategoryFilter" class="form-select" style="max-width:200px;" onchange="ArchiveDataManager.filterFiles()">
                                    <option value="">All Categories</option>
                                    <option value="constitution">Constitution & Bylaws</option>
                                    <option value="financial">Financial Records</option>
                                    <option value="membership">Membership Lists</option>
                                    <option value="event">Event Programs</option>
                                    <option value="meeting">Meeting Minutes</option>
                                    <option value="magazine">Magazine Issues</option>
                                    <option value="correspondence">Correspondence</option>
                                </select>
                            </div>
                            <div id="fileArchiveGrid" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(280px, 1fr)); gap:1rem;"></div>
                            <div id="fileArchiveEmpty" style="display:none; text-align:center; padding:2rem; color:#999;">
                                <i class="fas fa-folder-open" style="font-size:2rem; margin-bottom:0.5rem; display:block;"></i>
                                No files match your search criteria
                            </div>
                        </div>
                    </div>

                    <!-- Data Lineage Sub-Tab -->
                    <div id="archiveTabLineageView" class="archive-tab-panel" style="display:none;">
                        <div class="admin-card">
                            <h4 style="margin-bottom:1rem;"><i class="fas fa-project-diagram me-2" style="color:#7b1fa2;"></i>Data Lineage & Provenance</h4>
                            <p style="font-size:0.9rem; color:#666; margin-bottom:1.5rem;">Trace how data was extracted from source documents and transformed into semantic records.</p>
                            <div id="lineageStats" class="admin-card-grid" style="margin-bottom:1.5rem;"></div>
                            <div class="admin-table" style="max-height:450px; overflow:auto;">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Source Document</th>
                                            <th>Target Table</th>
                                            <th>Target ID</th>
                                            <th>Column</th>
                                            <th>Extracted Value</th>
                                            <th>Confidence</th>
                                            <th>Rule</th>
                                        </tr>
                                    </thead>
                                    <tbody id="lineageTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- ========== REPORT BUILDER SECTION ========== -->
                <section id="adminReportBuilder" class="admin-section">
                    <div class="admin-page-header">
                        <div>
                            <h2><i class="fas fa-chart-bar me-2"></i>Report Builder</h2>
                            <p>Create audit, insight, and analytics reports from archive & current data</p>
                        </div>
                        <div class="admin-actions">
                            <button class="admin-primary" onclick="ReportBuilder.createNew()"><i class="fas fa-plus me-1"></i> New Report</button>
                        </div>
                    </div>

                    <!-- Quick Report Templates -->
                    <div class="admin-card" style="margin-bottom:1.5rem;">
                        <h4 style="margin-bottom:1rem; font-size:1rem;"><i class="fas fa-bolt me-2" style="color:#f57c00;"></i>Quick Reports</h4>
                        <div style="display:grid; grid-template-columns:repeat(auto-fill, minmax(240px, 1fr)); gap:1rem;" id="reportTemplateGrid">
                        </div>
                    </div>

                    <!-- Report Configuration Panel -->
                    <div id="reportConfigPanel" class="admin-card" style="margin-bottom:1.5rem; display:none;">
                        <h4 style="margin-bottom:1rem;"><i class="fas fa-cogs me-2"></i>Report Configuration</h4>
                        <div style="display:flex; flex-wrap:wrap; gap:1rem; margin-bottom:1rem;">
                            <div style="flex:1; min-width:200px;">
                                <label style="font-size:0.85rem; font-weight:600; margin-bottom:4px; display:block;">Report Name</label>
                                <input type="text" id="reportName" class="form-control" placeholder="Enter report name…">
                            </div>
                            <div style="flex:1; min-width:200px;">
                                <label style="font-size:0.85rem; font-weight:600; margin-bottom:4px; display:block;">Data Source</label>
                                <select id="reportDataSource" class="form-select" onchange="ReportBuilder.onSourceChange()">
                                    <option value="">Select data source…</option>
                                    <option value="archive">Archive Data</option>
                                    <option value="current">Current Data</option>
                                </select>
                            </div>
                            <div style="flex:1; min-width:200px;">
                                <label style="font-size:0.85rem; font-weight:600; margin-bottom:4px; display:block;">Table</label>
                                <select id="reportTable" class="form-select" onchange="ReportBuilder.onTableChange()">
                                    <option value="">Select table…</option>
                                </select>
                            </div>
                        </div>
                        <div style="display:flex; flex-wrap:wrap; gap:1rem; margin-bottom:1rem;">
                            <div style="flex:1; min-width:200px;">
                                <label style="font-size:0.85rem; font-weight:600; margin-bottom:4px; display:block;">Report Type</label>
                                <select id="reportType" class="form-select">
                                    <option value="table">Table / Data Grid</option>
                                    <option value="summary">Summary Statistics</option>
                                    <option value="groupby">Group By Analysis</option>
                                    <option value="timeline">Timeline View</option>
                                    <option value="audit">Audit Trail</option>
                                </select>
                            </div>
                            <div style="flex:1; min-width:200px;">
                                <label style="font-size:0.85rem; font-weight:600; margin-bottom:4px; display:block;">Group By Column</label>
                                <select id="reportGroupBy" class="form-select">
                                    <option value="">None</option>
                                </select>
                            </div>
                            <div style="flex:0.5; min-width:120px;">
                                <label style="font-size:0.85rem; font-weight:600; margin-bottom:4px; display:block;">&nbsp;</label>
                                <button class="admin-primary" style="width:100%;" onclick="ReportBuilder.generate()"><i class="fas fa-play me-1"></i> Generate</button>
                            </div>
                        </div>
                    </div>

                    <!-- Report Output -->
                    <div id="reportOutput" class="admin-card" style="display:none;">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                            <h4 id="reportOutputTitle" style="margin:0;"><i class="fas fa-file-alt me-2"></i>Report Results</h4>
                            <div>
                                <button class="admin-secondary" onclick="ReportBuilder.exportReport('csv')"><i class="fas fa-file-csv me-1"></i>CSV</button>
                                <button class="admin-secondary" onclick="ReportBuilder.exportReport('xlsx')" style="margin-left:0.5rem;"><i class="fas fa-file-excel me-1"></i>Excel</button>
                                <button class="admin-secondary" onclick="ReportBuilder.printReport()" style="margin-left:0.5rem;"><i class="fas fa-print me-1"></i>Print</button>
                            </div>
                        </div>
                        <div id="reportSummaryStats" class="admin-card-grid" style="margin-bottom:1rem;"></div>
                        <div id="reportChartArea" style="margin-bottom:1rem;"></div>
                        <div class="admin-table" style="max-height:500px; overflow:auto;">
                            <table id="reportResultTable">
                                <thead id="reportResultHead"></thead>
                                <tbody id="reportResultBody"></tbody>
                            </table>
                        </div>
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-top:0.75rem;">
                            <span id="reportPageInfo" style="font-size:0.85rem; color:#666;"></span>
                            <div>
                                <button class="admin-secondary" onclick="ReportBuilder.prevPage()" id="reportPrevBtn"><i class="fas fa-chevron-left me-1"></i>Prev</button>
                                <button class="admin-secondary" onclick="ReportBuilder.nextPage()" id="reportNextBtn" style="margin-left:0.5rem;">Next<i class="fas fa-chevron-right ms-1"></i></button>
                            </div>
                        </div>
                    </div>

                    <!-- Saved Reports List -->
                    <div class="admin-card" style="margin-top:1.5rem;">
                        <h4 style="margin-bottom:1rem;"><i class="fas fa-history me-2"></i>Generated Reports</h4>
                        <div id="savedReportsList">
                            <p style="text-align:center; color:#999; padding:1rem;">No reports generated yet. Use Quick Reports or create a custom report above.</p>
                        </div>
                    </div>
                </section>

                <section id="adminComplaints" class="admin-section">
                    <div class="admin-page-header">
                        <div>
                            <h2>Complaint Resolution</h2>
                            <p>Address member concerns and feedback</p>
                        </div>
                        <button class="admin-primary" onclick="openComplaintModal()"><i class="fas fa-plus"></i> Log Complaint</button>
                    </div>
                    <!-- Stats -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #f44336"><div class="stat-number" style="color:#f44336" id="complaintStatNew">0</div><div class="stat-label">New</div></div></div>
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #FF9800"><div class="stat-number" style="color:#FF9800" id="complaintStatInProgress">0</div><div class="stat-label">In Progress</div></div></div>
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #4CAF50"><div class="stat-number" style="color:#4CAF50" id="complaintStatResolved">0</div><div class="stat-label">Resolved</div></div></div>
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #2196F3"><div class="stat-number" style="color:#2196F3" id="complaintStatTotal">0</div><div class="stat-label">Total</div></div></div>
                    </div>
                    <!-- Filter -->
                    <div class="d-flex gap-2 mb-3 flex-wrap">
                        <input type="text" class="form-control form-control-sm" style="max-width:250px" placeholder="Search complaints..." id="complaintSearchInput" oninput="renderAdminComplaints()">
                        <select class="form-select form-select-sm" style="max-width:150px" id="complaintStatusFilter" onchange="renderAdminComplaints()">
                            <option value="">All</option><option value="New">New</option><option value="In Progress">In Progress</option><option value="Resolved">Resolved</option><option value="Closed">Closed</option>
                        </select>
                    </div>
                    <div class="admin-table">
                        <table>
                            <thead><tr><th>ID</th><th>Date</th><th>Member</th><th>Category</th><th>Subject</th><th>Priority</th><th>Status</th><th>Actions</th></tr></thead>
                            <tbody id="complaintsTableBody"></tbody>
                        </table>
                    </div>
                    <!-- Complaint Modal -->
                    <div id="adminComplaintModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:10000;overflow-y:auto">
                        <div style="max-width:550px;margin:4rem auto;background:#fff;border-radius:12px;padding:2rem;position:relative">
                            <button onclick="closeComplaintModal()" style="position:absolute;top:1rem;right:1rem;background:none;border:none;font-size:1.5rem;cursor:pointer">&times;</button>
                            <h4 id="admComplaintModalTitle">Log Complaint</h4>
                            <input type="hidden" id="admComplaintEditId">
                            <div class="mb-3"><label class="form-label">Member Name</label><input type="text" class="form-control" id="admComplaintMember"></div>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6"><label class="form-label">Category</label><select class="form-select" id="admComplaintCategory"><option>Event</option><option>Service</option><option>Communication</option><option>Financial</option><option>Facility</option><option>Other</option></select></div>
                                <div class="col-md-6"><label class="form-label">Priority</label><select class="form-select" id="admComplaintPriority"><option>Low</option><option>Medium</option><option>High</option><option>Urgent</option></select></div>
                            </div>
                            <div class="mb-3"><label class="form-label">Subject *</label><input type="text" class="form-control" id="admComplaintSubject"></div>
                            <div class="mb-3"><label class="form-label">Details</label><textarea class="form-control" rows="3" id="admComplaintDetails"></textarea></div>
                            <div class="mb-3"><label class="form-label">Status</label><select class="form-select" id="admComplaintStatus"><option>New</option><option>In Progress</option><option>Resolved</option><option>Closed</option></select></div>
                            <div class="mb-3"><label class="form-label">Resolution Notes</label><textarea class="form-control" rows="2" id="admComplaintResolution"></textarea></div>
                            <div class="d-flex gap-2 justify-content-end">
                                <button class="btn btn-secondary" onclick="closeComplaintModal()">Cancel</button>
                                <button class="btn btn-primary" onclick="saveComplaint()"><i class="fas fa-save me-1"></i>Save</button>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="adminSurveys" class="admin-section">
                    <div class="admin-page-header">
                        <div>
                            <h2>Survey Administration</h2>
                            <p>Create and manage member surveys</p>
                        </div>
                        <button class="admin-primary" onclick="openAdminSurveyModal()"><i class="fas fa-plus"></i> Create Survey</button>
                    </div>
                    <!-- Stats -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #4CAF50"><div class="stat-number" style="color:#4CAF50" id="surveyStatActive">0</div><div class="stat-label">Active Surveys</div></div></div>
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #2196F3"><div class="stat-number" style="color:#2196F3" id="surveyStatResponses">0</div><div class="stat-label">Total Responses</div></div></div>
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #FF9800"><div class="stat-number" style="color:#FF9800" id="surveyStatAvgRate">0%</div><div class="stat-label">Avg Response Rate</div></div></div>
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #9C27B0"><div class="stat-number" style="color:#9C27B0" id="surveyStatClosed">0</div><div class="stat-label">Closed</div></div></div>
                    </div>
                    <div class="admin-table">
                        <table>
                            <thead><tr><th>Survey Name</th><th>Questions</th><th>Responses</th><th>Created</th><th>Deadline</th><th>Status</th><th>Actions</th></tr></thead>
                            <tbody id="surveysTableBody"></tbody>
                        </table>
                    </div>
                    <!-- Survey Modal -->
                    <div id="adminSurveyModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:10000;overflow-y:auto">
                        <div style="max-width:650px;margin:4rem auto;background:#fff;border-radius:12px;padding:2rem;position:relative">
                            <button onclick="closeSurveyModal()" style="position:absolute;top:1rem;right:1rem;background:none;border:none;font-size:1.5rem;cursor:pointer">&times;</button>
                            <h4 id="surveyModalTitle">Create Survey</h4>
                            <input type="hidden" id="surveyEditId">
                            <div class="mb-3"><label class="form-label">Survey Title *</label><input type="text" class="form-control" id="surveyTitle"></div>
                            <div class="mb-3"><label class="form-label">Description</label><textarea class="form-control" rows="2" id="surveyDescription"></textarea></div>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6"><label class="form-label">Deadline</label><input type="date" class="form-control" id="surveyDeadline"></div>
                                <div class="col-md-6"><label class="form-label">Status</label><select class="form-select" id="surveyStatus"><option>Active</option><option>Draft</option><option>Closed</option></select></div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Questions <small class="text-muted">(one per line)</small></label>
                                <textarea class="form-control" rows="5" id="surveyQuestions" placeholder="What did you enjoy most?\nHow can we improve?\nWould you attend again?"></textarea>
                            </div>
                            <div class="d-flex gap-2 justify-content-end">
                                <button class="btn btn-secondary" onclick="closeSurveyModal()">Cancel</button>
                                <button class="btn btn-primary" onclick="saveSurvey()"><i class="fas fa-save me-1"></i>Save Survey</button>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="adminAnnouncements" class="admin-section">
                    <div class="admin-page-header">
                        <div>
                            <h2>Announcements</h2>
                            <p>Publish updates to members and the community</p>
                        </div>
                        <button class="admin-primary" onclick="openAnnouncementModal()"><i class="fas fa-bullhorn"></i> New Announcement</button>
                    </div>
                    <!-- Stats -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #4CAF50"><div class="stat-number" style="color:#4CAF50" id="annStatPublished">0</div><div class="stat-label">Published</div></div></div>
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #FF9800"><div class="stat-number" style="color:#FF9800" id="annStatDraft">0</div><div class="stat-label">Drafts</div></div></div>
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #2196F3"><div class="stat-number" style="color:#2196F3" id="annStatPinned">0</div><div class="stat-label">Pinned</div></div></div>
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #9C27B0"><div class="stat-number" style="color:#9C27B0" id="annStatTotal">0</div><div class="stat-label">Total</div></div></div>
                    </div>
                    <div class="admin-table">
                        <table>
                            <thead><tr><th>Title</th><th>Category</th><th>Author</th><th>Date</th><th>Pinned</th><th>Status</th><th>Actions</th></tr></thead>
                            <tbody id="announcementsTableBody"></tbody>
                        </table>
                    </div>
                    <!-- Announcement Modal -->
                    <div id="announcementModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:10000;overflow-y:auto">
                        <div style="max-width:600px;margin:4rem auto;background:#fff;border-radius:12px;padding:2rem;position:relative">
                            <button onclick="closeAnnouncementModal()" style="position:absolute;top:1rem;right:1rem;background:none;border:none;font-size:1.5rem;cursor:pointer">&times;</button>
                            <h4 id="announcementModalTitle">New Announcement</h4>
                            <input type="hidden" id="announcementEditId">
                            <div class="mb-3"><label class="form-label">Title *</label><input type="text" class="form-control" id="announcementTitle"></div>
                            <div class="mb-3"><label class="form-label">Content *</label><textarea class="form-control" rows="4" id="announcementContent"></textarea></div>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6"><label class="form-label">Category</label><select class="form-select" id="announcementCategory"><option>General</option><option>Event</option><option>Urgent</option><option>Financial</option><option>Community</option></select></div>
                                <div class="col-md-6"><label class="form-label">Status</label><select class="form-select" id="announcementStatus"><option>Published</option><option>Draft</option></select></div>
                            </div>
                            <div class="form-check mb-3"><input class="form-check-input" type="checkbox" id="announcementPinned"><label class="form-check-label" for="announcementPinned">Pin this announcement</label></div>
                            <div class="d-flex gap-2 justify-content-end">
                                <button class="btn btn-secondary" onclick="closeAnnouncementModal()">Cancel</button>
                                <button class="btn btn-primary" onclick="saveAnnouncement()"><i class="fas fa-save me-1"></i>Save</button>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="adminRadio" class="admin-section">
                    <div class="admin-page-header">
                        <div>
                            <h2>Radio Control Panel</h2>
                            <p>Manage BANF Radio 24/7 broadcasting & schedule</p>
                        </div>
                        <button class="admin-primary" id="radioStatusBtn" onclick="toggleRadioStatus()"><i class="fas fa-broadcast-tower"></i> <span id="radioStatusText">Online</span></button>
                    </div>

                    <!-- Radio Status Dashboard -->
                    <div class="row g-4 mb-4">
                        <div class="col-md-3">
                            <div class="stat-card" style="border-left: 4px solid #4CAF50;">
                                <div class="stat-number" style="color: #4CAF50;" id="radioListeners">24</div>
                                <div class="stat-label">Active Listeners</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card" style="border-left: 4px solid #2196F3;">
                                <div class="stat-number" style="color: #2196F3;" id="radioUptime">99.2%</div>
                                <div class="stat-label">Uptime (30 days)</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card" style="border-left: 4px solid #FF9800;">
                                <div class="stat-number" style="color: #FF9800;" id="radioSongRequests">12</div>
                                <div class="stat-label">Song Requests</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card" style="border-left: 4px solid #9C27B0;">
                                <div class="stat-number" style="color: #9C27B0;" id="radioLibrarySize">1,247</div>
                                <div class="stat-label">Songs in Library</div>
                            </div>
                        </div>
                    </div>

                    <!-- Now Playing & Controls -->
                    <div class="row g-4 mb-4">
                        <div class="col-lg-6">
                            <div class="admin-card">
                                <h5><i class="fas fa-play-circle me-2 text-success"></i>Now Playing</h5>
                                <div class="p-3 rounded-3 mb-3" style="background: linear-gradient(135deg, #673AB7, #9C27B0); color: #fff;">
                                    <div class="d-flex align-items-center">
                                        <div class="me-3" style="font-size: 2.5rem;">🎵</div>
                                        <div>
                                            <h5 class="mb-1" id="adminNowPlaying">Rabindra Sangeet Special</h5>
                                            <p class="mb-0 opacity-75" id="adminNowCategory">Classical Music</p>
                                            <small class="opacity-50" id="adminNowTime">Playing since 2:00 PM</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-flex gap-2 flex-wrap">
                                    <button class="btn btn-sm btn-outline-primary" onclick="adminSkipTrack(-1)"><i class="fas fa-backward me-1"></i>Previous</button>
                                    <button class="btn btn-sm btn-success" onclick="adminTogglePlay()" id="adminPlayBtn"><i class="fas fa-pause me-1"></i>Playing</button>
                                    <button class="btn btn-sm btn-outline-primary" onclick="adminSkipTrack(1)"><i class="fas fa-forward me-1"></i>Next</button>
                                    <button class="btn btn-sm btn-outline-warning" onclick="adminRefreshStatus()"><i class="fas fa-sync-alt me-1"></i>Refresh</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="admin-card">
                                <h5><i class="fas fa-list me-2 text-info"></i>Today's Schedule</h5>
                                <div class="table-responsive" style="max-height: 250px; overflow-y: auto;">
                                    <table class="table table-sm mb-0" id="radioScheduleTable">
                                        <thead><tr><th>Time</th><th>Program</th><th>Category</th><th>Status</th></tr></thead>
                                        <tbody>
                                            <tr class="table-success"><td>6:00 AM</td><td>Prabhati Sangeet</td><td>Devotional</td><td><span class="badge bg-success">Completed</span></td></tr>
                                            <tr class="table-success"><td>8:00 AM</td><td>Morning Ragas</td><td>Classical</td><td><span class="badge bg-success">Completed</span></td></tr>
                                            <tr class="table-success"><td>10:00 AM</td><td>Rabindra Sangeet</td><td>Classical</td><td><span class="badge bg-success">Completed</span></td></tr>
                                            <tr class="table-warning"><td>12:00 PM</td><td>Bengali Modern Hits</td><td>Modern Music</td><td><span class="badge bg-warning text-dark">Now Playing</span></td></tr>
                                            <tr><td>2:00 PM</td><td>Folk Melodies</td><td>Folk Music</td><td><span class="badge bg-secondary">Upcoming</span></td></tr>
                                            <tr><td>4:00 PM</td><td>Children's Hour</td><td>Children</td><td><span class="badge bg-secondary">Upcoming</span></td></tr>
                                            <tr><td>6:00 PM</td><td>Evening Ragas</td><td>Classical</td><td><span class="badge bg-secondary">Upcoming</span></td></tr>
                                            <tr><td>8:00 PM</td><td>Literature Corner</td><td>Literature</td><td><span class="badge bg-secondary">Upcoming</span></td></tr>
                                            <tr><td>10:00 PM</td><td>Night Music</td><td>Modern Music</td><td><span class="badge bg-secondary">Upcoming</span></td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Song Requests & Library -->
                    <div class="row g-4">
                        <div class="col-lg-6">
                            <div class="admin-card">
                                <h5><i class="fas fa-hand-paper me-2 text-warning"></i>Pending Song Requests</h5>
                                <div class="table-responsive">
                                    <table class="table table-sm" id="songRequestsTable">
                                        <thead><tr><th>Member</th><th>Song</th><th>Artist</th><th>Actions</th></tr></thead>
                                        <tbody>
                                            <tr>
                                                <td>Amit Roy</td>
                                                <td>Amar Sonar Bangla</td>
                                                <td>Rabindranath Tagore</td>
                                                <td>
                                                    <button class="btn btn-sm btn-success" onclick="approveSongRequest(this)" title="Approve"><i class="fas fa-check"></i></button>
                                                    <button class="btn btn-sm btn-danger" onclick="rejectSongRequest(this)" title="Reject"><i class="fas fa-times"></i></button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Shreya Das</td>
                                                <td>Ekla Cholo Re</td>
                                                <td>Rabindranath Tagore</td>
                                                <td>
                                                    <button class="btn btn-sm btn-success" onclick="approveSongRequest(this)" title="Approve"><i class="fas fa-check"></i></button>
                                                    <button class="btn btn-sm btn-danger" onclick="rejectSongRequest(this)" title="Reject"><i class="fas fa-times"></i></button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Rina Mukherjee</td>
                                                <td>Ami Tomay Joto</td>
                                                <td>Kishore Kumar</td>
                                                <td>
                                                    <button class="btn btn-sm btn-success" onclick="approveSongRequest(this)" title="Approve"><i class="fas fa-check"></i></button>
                                                    <button class="btn btn-sm btn-danger" onclick="rejectSongRequest(this)" title="Reject"><i class="fas fa-times"></i></button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="admin-card">
                                <h5><i class="fas fa-database me-2 text-primary"></i>Music Library</h5>
                                <div class="row g-3 mb-3">
                                    <div class="col-6">
                                        <div class="p-2 rounded text-center" style="background: rgba(139,69,19,0.1);">
                                            <strong>🎻 Classical</strong><br><span class="text-muted">342 songs</span>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="p-2 rounded text-center" style="background: rgba(34,139,34,0.1);">
                                            <strong>🪘 Folk</strong><br><span class="text-muted">218 songs</span>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="p-2 rounded text-center" style="background: rgba(65,105,225,0.1);">
                                            <strong>🎵 Modern</strong><br><span class="text-muted">405 songs</span>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="p-2 rounded text-center" style="background: rgba(255,99,71,0.1);">
                                            <strong>🙏 Devotional</strong><br><span class="text-muted">157 songs</span>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="p-2 rounded text-center" style="background: rgba(128,0,128,0.1);">
                                            <strong>📚 Literature</strong><br><span class="text-muted">89 readings</span>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="p-2 rounded text-center" style="background: rgba(255,105,180,0.1);">
                                            <strong>👶 Children</strong><br><span class="text-muted">36 programs</span>
                                        </div>
                                    </div>
                                </div>
                                <button class="btn btn-sm btn-outline-primary" onclick="alert('Upload Song - Demo: Opens file browser to add songs to library')">
                                    <i class="fas fa-upload me-1"></i>Upload Song
                                </button>
                                <button class="btn btn-sm btn-outline-secondary ms-1" onclick="alert('Manage Library - Demo: Opens full library management view')">
                                    <i class="fas fa-list me-1"></i>Full Library
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="adminMagazine" class="admin-section">
                    <div class="admin-page-header">
                        <div>
                            <h2>Magazine Administration</h2>
                            <p>Review submissions and manage BANF magazine content</p>
                        </div>
                        <button class="admin-primary" onclick="openMagazineModal()"><i class="fas fa-plus"></i> New Submission</button>
                    </div>
                    <div class="row g-3 mb-4">
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #4CAF50"><div class="stat-number" style="color:#4CAF50" id="magStatApproved">0</div><div class="stat-label">Approved</div></div></div>
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #FF9800"><div class="stat-number" style="color:#FF9800" id="magStatPending">0</div><div class="stat-label">Pending Review</div></div></div>
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #f44336"><div class="stat-number" style="color:#f44336" id="magStatRejected">0</div><div class="stat-label">Rejected</div></div></div>
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #2196F3"><div class="stat-number" style="color:#2196F3" id="magStatTotal">0</div><div class="stat-label">Total Submissions</div></div></div>
                    </div>
                    <div class="admin-table">
                        <table>
                            <thead><tr><th>Title</th><th>Author</th><th>Type</th><th>Submitted</th><th>Word Count</th><th>Status</th><th>Actions</th></tr></thead>
                            <tbody id="magazineTableBody"></tbody>
                        </table>
                    </div>
                    <div id="magazineModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:10000;overflow-y:auto">
                        <div style="max-width:600px;margin:4rem auto;background:#fff;border-radius:12px;padding:2rem;position:relative">
                            <button onclick="closeMagazineModal()" style="position:absolute;top:1rem;right:1rem;background:none;border:none;font-size:1.5rem;cursor:pointer">&times;</button>
                            <h4 id="magazineModalTitle">Add Submission</h4>
                            <input type="hidden" id="magazineEditId">
                            <div class="mb-3"><label class="form-label">Title *</label><input type="text" class="form-control" id="magazineTitle"></div>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6"><label class="form-label">Author</label><input type="text" class="form-control" id="magazineAuthor"></div>
                                <div class="col-md-6"><label class="form-label">Type</label><select class="form-select" id="magazineType"><option>Article</option><option>Poem</option><option>Short Story</option><option>Essay</option><option>Photo Essay</option><option>Interview</option></select></div>
                            </div>
                            <div class="mb-3"><label class="form-label">Content Summary</label><textarea class="form-control" rows="3" id="magazineContent"></textarea></div>
                            <div class="mb-3"><label class="form-label">Status</label><select class="form-select" id="magazineStatus"><option>Pending</option><option>Approved</option><option>Rejected</option><option>Published</option></select></div>
                            <div class="d-flex gap-2 justify-content-end">
                                <button class="btn btn-secondary" onclick="closeMagazineModal()">Cancel</button>
                                <button class="btn btn-primary" onclick="saveMagazineSubmission()"><i class="fas fa-save me-1"></i>Save</button>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="adminBudget" class="admin-section">
                    <div class="admin-page-header">
                        <div>
                            <h2>Budget & Finance</h2>
                            <p>Manage BANF financial records</p>
                        </div>
                        <div class="d-flex gap-2">
                            <button class="admin-secondary" onclick="exportBudgetReport()"><i class="fas fa-file-pdf"></i> Export Report</button>
                            <button class="admin-primary" onclick="openBudgetModal()"><i class="fas fa-plus"></i> Add Transaction</button>
                        </div>
                    </div>
                    <div class="row g-3 mb-4">
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #4CAF50"><div class="stat-number" style="color:#4CAF50" id="budgetStatIncome">$0</div><div class="stat-label">Total Income</div></div></div>
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #f44336"><div class="stat-number" style="color:#f44336" id="budgetStatExpense">$0</div><div class="stat-label">Total Expenses</div></div></div>
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #2196F3"><div class="stat-number" style="color:#2196F3" id="budgetStatBalance">$0</div><div class="stat-label">Net Balance</div></div></div>
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #9C27B0"><div class="stat-number" style="color:#9C27B0" id="budgetStatTxns">0</div><div class="stat-label">Transactions</div></div></div>
                    </div>
                    <div class="d-flex gap-2 mb-3 flex-wrap">
                        <select class="form-select form-select-sm" style="max-width:150px" id="budgetTypeFilter" onchange="renderAdminBudget()"><option value="">All Types</option><option value="Income">Income</option><option value="Expense">Expense</option></select>
                        <select class="form-select form-select-sm" style="max-width:150px" id="budgetCatFilter" onchange="renderAdminBudget()"><option value="">All Categories</option><option>Membership Dues</option><option>Event Revenue</option><option>Donations</option><option>Venue Rental</option><option>Catering</option><option>Supplies</option><option>Marketing</option><option>Insurance</option></select>
                    </div>
                    <div class="admin-table">
                        <table>
                            <thead><tr><th>Date</th><th>Description</th><th>Category</th><th>Type</th><th>Amount</th><th>Actions</th></tr></thead>
                            <tbody id="budgetTableBody"></tbody>
                        </table>
                    </div>
                    <div id="budgetModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:10000;overflow-y:auto">
                        <div style="max-width:500px;margin:4rem auto;background:#fff;border-radius:12px;padding:2rem;position:relative">
                            <button onclick="closeBudgetModal()" style="position:absolute;top:1rem;right:1rem;background:none;border:none;font-size:1.5rem;cursor:pointer">&times;</button>
                            <h4 id="budgetModalTitle">Add Transaction</h4>
                            <input type="hidden" id="budgetEditId">
                            <div class="mb-3"><label class="form-label">Description *</label><input type="text" class="form-control" id="budgetDescription"></div>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6"><label class="form-label">Amount ($) *</label><input type="number" step="0.01" class="form-control" id="budgetAmount"></div>
                                <div class="col-md-6"><label class="form-label">Date</label><input type="date" class="form-control" id="budgetDate"></div>
                            </div>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6"><label class="form-label">Type</label><select class="form-select" id="budgetType"><option>Income</option><option>Expense</option></select></div>
                                <div class="col-md-6"><label class="form-label">Category</label><select class="form-select" id="budgetCategory"><option>Membership Dues</option><option>Event Revenue</option><option>Donations</option><option>Venue Rental</option><option>Catering</option><option>Supplies</option><option>Marketing</option><option>Insurance</option><option>Other</option></select></div>
                            </div>
                            <div class="mb-3"><label class="form-label">Notes</label><textarea class="form-control" rows="2" id="budgetNotes"></textarea></div>
                            <div class="d-flex gap-2 justify-content-end">
                                <button class="btn btn-secondary" onclick="closeBudgetModal()">Cancel</button>
                                <button class="btn btn-primary" onclick="saveBudgetTransaction()"><i class="fas fa-save me-1"></i>Save</button>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="adminVendors" class="admin-section">
                    <div class="admin-page-header">
                        <div>
                            <h2>Vendors & Sponsors</h2>
                            <p>Manage event vendors and sponsors</p>
                        </div>
                        <button class="admin-primary" onclick="openVendorModal()"><i class="fas fa-plus"></i> Add Vendor</button>
                    </div>
                    <div class="row g-3 mb-4">
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #4CAF50"><div class="stat-number" style="color:#4CAF50" id="vendorStatActive">0</div><div class="stat-label">Active Vendors</div></div></div>
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #FF9800"><div class="stat-number" style="color:#FF9800" id="vendorStatSponsors">0</div><div class="stat-label">Sponsors</div></div></div>
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #2196F3"><div class="stat-number" style="color:#2196F3" id="vendorStatTotal">0</div><div class="stat-label">Total</div></div></div>
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #9C27B0"><div class="stat-number" style="color:#9C27B0" id="vendorStatRating">-</div><div class="stat-label">Avg Rating</div></div></div>
                    </div>
                    <div class="d-flex gap-2 mb-3 flex-wrap">
                        <input type="text" class="form-control form-control-sm" style="max-width:250px" placeholder="Search vendors..." id="vendorSearchInput" oninput="renderAdminVendors()">
                        <select class="form-select form-select-sm" style="max-width:150px" id="vendorTypeFilter" onchange="renderAdminVendors()"><option value="">All Types</option><option>Caterer</option><option>Decorator</option><option>Sound/AV</option><option>Photographer</option><option>Sponsor</option><option>Venue</option><option>Other</option></select>
                    </div>
                    <div class="admin-table">
                        <table>
                            <thead><tr><th>Name</th><th>Type</th><th>Contact</th><th>Phone</th><th>Rating</th><th>Status</th><th>Actions</th></tr></thead>
                            <tbody id="vendorsTableBody"></tbody>
                        </table>
                    </div>
                    <div id="vendorModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:10000;overflow-y:auto">
                        <div style="max-width:550px;margin:4rem auto;background:#fff;border-radius:12px;padding:2rem;position:relative">
                            <button onclick="closeVendorModal()" style="position:absolute;top:1rem;right:1rem;background:none;border:none;font-size:1.5rem;cursor:pointer">&times;</button>
                            <h4 id="vendorModalTitle">Add Vendor</h4>
                            <input type="hidden" id="vendorEditId">
                            <div class="mb-3"><label class="form-label">Vendor/Sponsor Name *</label><input type="text" class="form-control" id="vendorName"></div>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6"><label class="form-label">Type</label><select class="form-select" id="vendorType"><option>Caterer</option><option>Decorator</option><option>Sound/AV</option><option>Photographer</option><option>Sponsor</option><option>Venue</option><option>Other</option></select></div>
                                <div class="col-md-6"><label class="form-label">Status</label><select class="form-select" id="vendorStatus"><option>Active</option><option>Inactive</option><option>Preferred</option></select></div>
                            </div>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6"><label class="form-label">Contact Person</label><input type="text" class="form-control" id="vendorContact"></div>
                                <div class="col-md-6"><label class="form-label">Phone</label><input type="tel" class="form-control" id="vendorPhone"></div>
                            </div>
                            <div class="mb-3"><label class="form-label">Email</label><input type="email" class="form-control" id="vendorEmail"></div>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6"><label class="form-label">Rating (1-5)</label><input type="number" min="1" max="5" class="form-control" id="vendorRating"></div>
                                <div class="col-md-6"><label class="form-label">Sponsorship Tier</label><select class="form-select" id="vendorTier"><option value="">N/A</option><option>Platinum</option><option>Gold</option><option>Silver</option><option>Bronze</option></select></div>
                            </div>
                            <div class="mb-3"><label class="form-label">Notes</label><textarea class="form-control" rows="2" id="vendorNotes"></textarea></div>
                            <div class="d-flex gap-2 justify-content-end">
                                <button class="btn btn-secondary" onclick="closeVendorModal()">Cancel</button>
                                <button class="btn btn-primary" onclick="saveVendor()"><i class="fas fa-save me-1"></i>Save</button>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="adminVolunteers" class="admin-section">
                    <div class="admin-page-header">
                        <div>
                            <h2>Volunteers</h2>
                            <p>Coordinate volunteer assignments and availability</p>
                        </div>
                        <button class="admin-primary" onclick="openVolunteerModal()"><i class="fas fa-plus"></i> Add Volunteer</button>
                    </div>
                    <div class="row g-3 mb-4">
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #4CAF50"><div class="stat-number" style="color:#4CAF50" id="volStatActive">0</div><div class="stat-label">Active Volunteers</div></div></div>
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #2196F3"><div class="stat-number" style="color:#2196F3" id="volStatAssigned">0</div><div class="stat-label">Currently Assigned</div></div></div>
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #FF9800"><div class="stat-number" style="color:#FF9800" id="volStatHours">0</div><div class="stat-label">Total Hours</div></div></div>
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #9C27B0"><div class="stat-number" style="color:#9C27B0" id="volStatTotal">0</div><div class="stat-label">Total Volunteers</div></div></div>
                    </div>
                    <div class="d-flex gap-2 mb-3 flex-wrap">
                        <input type="text" class="form-control form-control-sm" style="max-width:250px" placeholder="Search volunteers..." id="volunteerSearchInput" oninput="renderAdminVolunteers()">
                        <select class="form-select form-select-sm" style="max-width:150px" id="volunteerSkillFilter" onchange="renderAdminVolunteers()"><option value="">All Skills</option><option>Cooking</option><option>Decoration</option><option>Sound/AV</option><option>Photography</option><option>MC/Hosting</option><option>Setup/Cleanup</option><option>Registration</option><option>Security</option></select>
                    </div>
                    <div class="admin-table">
                        <table>
                            <thead><tr><th>Name</th><th>Email</th><th>Skills</th><th>Hours</th><th>Availability</th><th>Status</th><th>Actions</th></tr></thead>
                            <tbody id="volunteersTableBody"></tbody>
                        </table>
                    </div>
                    <div id="volunteerModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:10000;overflow-y:auto">
                        <div style="max-width:550px;margin:4rem auto;background:#fff;border-radius:12px;padding:2rem;position:relative">
                            <button onclick="closeVolunteerModal()" style="position:absolute;top:1rem;right:1rem;background:none;border:none;font-size:1.5rem;cursor:pointer">&times;</button>
                            <h4 id="volunteerModalTitle">Add Volunteer</h4>
                            <input type="hidden" id="volunteerEditId">
                            <div class="row g-3 mb-3">
                                <div class="col-md-6"><label class="form-label">Name *</label><input type="text" class="form-control" id="volunteerName"></div>
                                <div class="col-md-6"><label class="form-label">Email</label><input type="email" class="form-control" id="volunteerEmail"></div>
                            </div>
                            <div class="mb-3"><label class="form-label">Phone</label><input type="tel" class="form-control" id="volunteerPhone"></div>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6"><label class="form-label">Primary Skill</label><select class="form-select" id="volunteerSkill"><option>Cooking</option><option>Decoration</option><option>Sound/AV</option><option>Photography</option><option>MC/Hosting</option><option>Setup/Cleanup</option><option>Registration</option><option>Security</option><option>General</option></select></div>
                                <div class="col-md-6"><label class="form-label">Availability</label><select class="form-select" id="volunteerAvailability"><option>Weekends</option><option>Weekdays</option><option>Anytime</option><option>Event-only</option></select></div>
                            </div>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6"><label class="form-label">Hours Logged</label><input type="number" class="form-control" id="volunteerHours" value="0"></div>
                                <div class="col-md-6"><label class="form-label">Status</label><select class="form-select" id="volunteerStatus"><option>Active</option><option>Inactive</option><option>On Break</option></select></div>
                            </div>
                            <div class="mb-3"><label class="form-label">Notes</label><textarea class="form-control" rows="2" id="volunteerNotes"></textarea></div>
                            <div class="d-flex gap-2 justify-content-end">
                                <button class="btn btn-secondary" onclick="closeVolunteerModal()">Cancel</button>
                                <button class="btn btn-primary" onclick="saveVolunteer()"><i class="fas fa-save me-1"></i>Save</button>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="adminMeetings" class="admin-section">
                    <div class="admin-page-header">
                        <div>
                            <h2>Meeting Minutes</h2>
                            <p>Upload and manage EC meeting minutes</p>
                        </div>
                        <button class="admin-primary" onclick="openMeetingModal()"><i class="fas fa-plus"></i> Add Meeting</button>
                    </div>
                    <div class="row g-3 mb-4">
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #4CAF50"><div class="stat-number" style="color:#4CAF50" id="meetStatThisYear">0</div><div class="stat-label">This Year</div></div></div>
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #2196F3"><div class="stat-number" style="color:#2196F3" id="meetStatTotal">0</div><div class="stat-label">Total Meetings</div></div></div>
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #FF9800"><div class="stat-number" style="color:#FF9800" id="meetStatPending">0</div><div class="stat-label">Pending Approval</div></div></div>
                        <div class="col-md-3"><div class="stat-card" style="border-left:4px solid #9C27B0"><div class="stat-number" style="color:#9C27B0" id="meetStatActions">0</div><div class="stat-label">Open Action Items</div></div></div>
                    </div>
                    <div class="admin-table">
                        <table>
                            <thead><tr><th>Date</th><th>Type</th><th>Attendees</th><th>Action Items</th><th>Status</th><th>Actions</th></tr></thead>
                            <tbody id="meetingsTableBody"></tbody>
                        </table>
                    </div>
                    <div id="meetingModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:10000;overflow-y:auto">
                        <div style="max-width:600px;margin:4rem auto;background:#fff;border-radius:12px;padding:2rem;position:relative">
                            <button onclick="closeMeetingModal()" style="position:absolute;top:1rem;right:1rem;background:none;border:none;font-size:1.5rem;cursor:pointer">&times;</button>
                            <h4 id="meetingModalTitle">Add Meeting</h4>
                            <input type="hidden" id="meetingEditId">
                            <div class="row g-3 mb-3">
                                <div class="col-md-6"><label class="form-label">Date *</label><input type="date" class="form-control" id="meetingDate"></div>
                                <div class="col-md-6"><label class="form-label">Type</label><select class="form-select" id="meetingType"><option>EC Meeting</option><option>General Body</option><option>Sub-Committee</option><option>Special Meeting</option><option>AGM</option></select></div>
                            </div>
                            <div class="mb-3"><label class="form-label">Attendees</label><input type="text" class="form-control" id="meetingAttendees" placeholder="e.g. President, Secretary, Treasurer..."></div>
                            <div class="mb-3"><label class="form-label">Agenda</label><textarea class="form-control" rows="3" id="meetingAgenda"></textarea></div>
                            <div class="mb-3"><label class="form-label">Minutes / Summary</label><textarea class="form-control" rows="4" id="meetingMinutes"></textarea></div>
                            <div class="mb-3"><label class="form-label">Action Items <small class="text-muted">(one per line)</small></label><textarea class="form-control" rows="3" id="meetingActionItems" placeholder="Action item 1\nAction item 2"></textarea></div>
                            <div class="mb-3"><label class="form-label">Status</label><select class="form-select" id="meetingStatus"><option>Draft</option><option>Approved</option><option>Published</option></select></div>
                            <div class="d-flex gap-2 justify-content-end">
                                <button class="btn btn-secondary" onclick="closeMeetingModal()">Cancel</button>
                                <button class="btn btn-primary" onclick="saveMeeting()"><i class="fas fa-save me-1"></i>Save</button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- ========== GMAIL / EMAIL SECTION ========== -->
                <section id="adminGmail" class="admin-section">
                    <div class="admin-page-header">
                        <div>
                            <h2><i class="fas fa-envelope me-2"></i>Email Management (Gmail)</h2>
                            <p>Read, send, and manage emails from <strong>banfjax@gmail.com</strong></p>
                        </div>
                        <div style="display:flex;gap:0.5rem;">
                            <button class="admin-secondary" onclick="gmailCheckConnection()"><i class="fas fa-plug me-1"></i> Check Connection</button>
                            <button class="admin-primary" onclick="gmailOpenCompose()"><i class="fas fa-pen me-1"></i> Compose Email</button>
                        </div>
                    </div>

                    <!-- Connection Status -->
                    <div id="gmailConnectionStatus" class="admin-card" style="border-left:4px solid #ccc;margin-bottom:1rem;">
                        <div style="display:flex;align-items:center;gap:1rem;">
                            <i class="fas fa-circle" id="gmailStatusIcon" style="color:#ccc;font-size:1.2rem;"></i>
                            <div>
                                <strong id="gmailStatusText">Checking connection...</strong>
                                <p class="mb-0 text-muted" id="gmailStatusDetail">Click "Check Connection" to verify Gmail access</p>
                            </div>
                        </div>
                    </div>

                    <!-- Stats Row -->
                    <div class="admin-stats-grid" id="gmailStatsRow" style="margin-bottom:1.5rem;">
                        <div class="admin-stat-card"><div class="admin-stat-value" id="gmailStatInbox">--</div><div class="admin-stat-label">Inbox</div></div>
                        <div class="admin-stat-card"><div class="admin-stat-value" id="gmailStatUnread" style="color:#f44336">--</div><div class="admin-stat-label">Unread</div></div>
                        <div class="admin-stat-card"><div class="admin-stat-value" id="gmailStatSent">--</div><div class="admin-stat-label">Sent Today</div></div>
                        <div class="admin-stat-card"><div class="admin-stat-value" id="gmailStatGroups">--</div><div class="admin-stat-label">Contact Groups</div></div>
                    </div>

                    <!-- Tab Navigation -->
                    <ul class="nav nav-tabs mb-3" id="gmailTabs">
                        <li class="nav-item"><a class="nav-link active" href="#" onclick="gmailShowTab('inbox');return false;"><i class="fas fa-inbox me-1"></i> Inbox</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" onclick="gmailShowTab('compose');return false;"><i class="fas fa-pen me-1"></i> Compose</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" onclick="gmailShowTab('contacts');return false;"><i class="fas fa-address-book me-1"></i> Contact Groups</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" onclick="gmailShowTab('search');return false;"><i class="fas fa-search me-1"></i> Search</a></li>
                    </ul>

                    <!-- INBOX TAB -->
                    <div id="gmailTabInbox" class="gmail-tab-content">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
                            <h4><i class="fas fa-inbox me-2"></i>Inbox</h4>
                            <div style="display:flex;gap:0.5rem;">
                                <select class="form-control" id="gmailFolderSelect" style="width:auto" onchange="gmailLoadInbox()">
                                    <option value="INBOX">Inbox</option>
                                    <option value="[Gmail]/Sent Mail">Sent</option>
                                    <option value="[Gmail]/Drafts">Drafts</option>
                                    <option value="[Gmail]/Starred">Starred</option>
                                    <option value="[Gmail]/Spam">Spam</option>
                                    <option value="[Gmail]/Trash">Trash</option>
                                </select>
                                <button class="admin-secondary" onclick="gmailLoadInbox()"><i class="fas fa-sync-alt"></i> Refresh</button>
                            </div>
                        </div>
                        <div class="admin-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th style="width:25%">From</th>
                                        <th style="width:40%">Subject</th>
                                        <th style="width:15%">Date</th>
                                        <th style="width:5%"><i class="fas fa-paperclip"></i></th>
                                        <th style="width:15%">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="gmailInboxTableBody">
                                    <tr><td colspan="5" class="text-center text-muted"><i class="fas fa-spinner fa-spin me-2"></i>Loading emails...</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div style="display:flex;justify-content:center;gap:0.5rem;margin-top:1rem;" id="gmailPagination"></div>
                    </div>

                    <!-- COMPOSE TAB -->
                    <div id="gmailTabCompose" class="gmail-tab-content" style="display:none">
                        <div class="admin-card" style="border:2px solid var(--gold);">
                            <h4><i class="fas fa-pen-fancy me-2"></i>Compose Email</h4>
                            <form id="gmailComposeForm" onsubmit="return gmailSendEmail(event)">
                                <div class="row g-3">
                                    <div class="col-12">
                                        <label class="form-label fw-bold">To *</label>
                                        <input type="text" class="form-control" id="gmailComposeTo" required placeholder="recipient@email.com (comma-separated for multiple)">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">CC</label>
                                        <input type="text" class="form-control" id="gmailComposeCc" placeholder="cc@email.com">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">BCC</label>
                                        <input type="text" class="form-control" id="gmailComposeBcc" placeholder="bcc@email.com">
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label fw-bold">Subject *</label>
                                        <input type="text" class="form-control" id="gmailComposeSubject" required placeholder="Email subject">
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label fw-bold">Message</label>
                                        <textarea class="form-control" id="gmailComposeBody" rows="10" placeholder="Write your message here..."></textarea>
                                    </div>
                                </div>
                                <div class="mt-3" style="display:flex;gap:0.5rem;">
                                    <button type="submit" class="admin-primary"><i class="fas fa-paper-plane me-1"></i> Send Email</button>
                                    <button type="button" class="admin-secondary" onclick="gmailShowTab('inbox')"><i class="fas fa-times me-1"></i> Cancel</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- CONTACT GROUPS TAB -->
                    <div id="gmailTabContacts" class="gmail-tab-content" style="display:none">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
                            <h4><i class="fas fa-address-book me-2"></i>Contact Groups</h4>
                            <button class="admin-primary" onclick="gmailCreateGroupPrompt()"><i class="fas fa-plus me-1"></i> New Group</button>
                        </div>
                        <div id="gmailContactGroupsList" class="admin-card-grid">
                            <div class="text-muted"><i class="fas fa-spinner fa-spin me-2"></i>Loading groups...</div>
                        </div>

                        <!-- Add Contact Form (hidden) -->
                        <div id="gmailAddContactForm" style="display:none;margin-top:1.5rem;">
                            <div class="admin-card" style="border:2px solid var(--gold);">
                                <h5><i class="fas fa-user-plus me-2"></i>Add Contact to <span id="gmailAddContactGroupName"></span></h5>
                                <div class="row g-3">
                                    <div class="col-md-5">
                                        <input type="text" class="form-control" id="gmailAddContactName" placeholder="Full Name">
                                    </div>
                                    <div class="col-md-5">
                                        <input type="email" class="form-control" id="gmailAddContactEmail" placeholder="email@example.com">
                                    </div>
                                    <div class="col-md-2">
                                        <button class="admin-primary w-100" onclick="gmailAddContactToGroup()"><i class="fas fa-plus"></i> Add</button>
                                    </div>
                                </div>
                                <button class="admin-secondary mt-2" onclick="document.getElementById('gmailAddContactForm').style.display='none'"><i class="fas fa-times me-1"></i> Close</button>
                            </div>
                        </div>
                    </div>

                    <!-- SEARCH TAB -->
                    <div id="gmailTabSearch" class="gmail-tab-content" style="display:none">
                        <div class="admin-card">
                            <h4><i class="fas fa-search me-2"></i>Search Emails</h4>
                            <div class="row g-3">
                                <div class="col-md-10">
                                    <input type="text" class="form-control" id="gmailSearchQuery" placeholder="Search by subject, sender, or content..." onkeydown="if(event.key==='Enter')gmailSearchEmails()">
                                </div>
                                <div class="col-md-2">
                                    <button class="admin-primary w-100" onclick="gmailSearchEmails()"><i class="fas fa-search"></i> Search</button>
                                </div>
                            </div>
                        </div>
                        <div id="gmailSearchResults" style="margin-top:1rem;"></div>
                    </div>

                    <!-- EMAIL READER MODAL -->
                    <div id="gmailReaderArea" style="display:none;margin-top:1.5rem;">
                        <div class="admin-card" style="border-left:4px solid var(--gold);">
                            <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1rem;">
                                <div>
                                    <h4 id="gmailReaderSubject" style="margin-bottom:0.25rem;"></h4>
                                    <p class="text-muted mb-1" id="gmailReaderFrom"></p>
                                    <small class="text-muted" id="gmailReaderDate"></small>
                                </div>
                                <div style="display:flex;gap:0.5rem;">
                                    <button class="admin-secondary" onclick="gmailReplyTo()"><i class="fas fa-reply me-1"></i> Reply</button>
                                    <button class="admin-secondary" onclick="gmailForwardEmail()"><i class="fas fa-share me-1"></i> Forward</button>
                                    <button class="admin-secondary" onclick="document.getElementById('gmailReaderArea').style.display='none'"><i class="fas fa-times"></i></button>
                                </div>
                            </div>
                            <hr>
                            <div id="gmailReaderBody" style="white-space:pre-wrap;line-height:1.6;max-height:500px;overflow-y:auto;"></div>
                            <div id="gmailReaderAttachments" style="margin-top:1rem;"></div>
                        </div>
                    </div>
                </section>

                <!-- ========== CAREERS DIRECTORY ADMIN (Feature 6) ========== -->
                <section id="adminCareers" class="admin-section" style="display:none;">
                    <div class="admin-page-header">
                        <div>
                            <h2><i class="fas fa-briefcase me-2"></i>Career Directory Management</h2>
                            <p>Review, approve, and manage member career profiles</p>
                        </div>
                        <div class="d-flex gap-2">
                            <button class="admin-btn" onclick="exportCareerDirectory()"><i class="fas fa-download me-1"></i>Export CSV</button>
                            <button class="admin-btn admin-btn-primary" onclick="openAddCareerModal()"><i class="fas fa-plus me-1"></i>Add Profile</button>
                        </div>
                    </div>

                    <!-- Stats Row -->
                    <div class="row g-3 mb-4">
                        <div class="col-sm-3"><div class="admin-stat-card"><div class="admin-stat-number" id="careerTotalStat">0</div><div class="admin-stat-label">Total Profiles</div></div></div>
                        <div class="col-sm-3"><div class="admin-stat-card"><div class="admin-stat-number text-success" id="careerVisibleStat">0</div><div class="admin-stat-label">Visible</div></div></div>
                        <div class="col-sm-3"><div class="admin-stat-card"><div class="admin-stat-number text-warning" id="careerHiddenStat">0</div><div class="admin-stat-label">Hidden</div></div></div>
                        <div class="col-sm-3"><div class="admin-stat-card"><div class="admin-stat-number text-info" id="careerIndustryStat">0</div><div class="admin-stat-label">Industries</div></div></div>
                    </div>

                    <!-- Profiles Table -->
                    <div class="admin-table">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Title</th>
                                    <th>Industry</th>
                                    <th>Guidance Types</th>
                                    <th>Visible</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="adminCareerTableBody">
                                <tr><td colspan="6" class="text-center text-muted py-3">Loading career profiles...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- ========== SITE CONFIGURATION SECTION (Feature 1) ========== -->
                <section id="adminSiteConfig" class="admin-section" style="display:none;">
                    <div class="admin-page-header">
                        <div>
                            <h2><i class="fas fa-wrench me-2"></i>Site Configuration</h2>
                            <p>Manage landing page sections, membership plans, sponsorship tiers, and ad slots</p>
                        </div>
                    </div>
                    <div id="siteConfigContent">
                        <div class="text-center text-muted py-4"><i class="fas fa-spinner fa-spin me-2"></i>Loading configuration...</div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- ========== MEMBER PORTAL MODAL ========== -->
    <div class="modal fade" id="memberPortalModal" tabindex="-1" aria-labelledby="memberPortalModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content" style="border-radius: 16px; overflow: hidden; border: none;">
                
                <!-- Modal Header with gradient -->
                <div class="modal-header" style="background: var(--gradient-hero); border: none; padding: 1.5rem;">
                    <div class="d-flex align-items-center">
                        <div class="me-3" style="width: 50px; height: 50px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-user-circle fa-2x text-white"></i>
                        </div>
                        <div>
                            <h5 class="modal-title text-white mb-0" id="memberPortalModalLabel">Member Portal</h5>
                            <small class="text-white-50" id="modalSubtitle">Access your BANF account</small>
                        </div>
                    </div>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                
                <!-- Modal Body -->
                <div class="modal-body p-0">
                    
                    <!-- Visitor Notice (shown by default) -->
                    <div id="visitorNotice" class="p-4" style="background: linear-gradient(135deg, #fff8f0, #fff); display: block;">
                        <div class="alert alert-info mb-3" style="background: linear-gradient(135deg, #e3f2fd, #fff); border: 1px solid #bbdefb;">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Members-Only Portal</strong><br>
                            <small>This area is for registered BANF members only. If you have paid your membership fee, you can create your account here.</small>
                        </div>
                        
                        <!-- Tab Navigation -->
                        <ul class="nav nav-pills nav-justified mb-4" id="memberPortalTabs">
                            <li class="nav-item">
                                <button class="nav-link active" id="login-tab" onclick="showPortalTab('login')" style="border-radius: 50px;">
                                    <i class="fas fa-sign-in-alt me-1"></i> Login
                                </button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-link" id="signup-tab" onclick="showPortalTab('signup')" style="border-radius: 50px;">
                                    <i class="fas fa-user-plus me-1"></i> Sign Up
                                </button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-link" id="code-tab" onclick="showPortalTab('code')" style="border-radius: 50px;">
                                    <i class="fas fa-key me-1"></i> Registration Code
                                </button>
                            </li>
                        </ul>
                        
                        <!-- LOGIN FORM -->
                        <div id="loginForm" class="portal-form">
                            <form onsubmit="return handleLogin(event)">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-envelope me-2"></i>Email or Username</label>
                                    <input type="text" class="form-control form-control-lg" id="loginEmail" placeholder="Enter email or username" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-lock me-2"></i>Password</label>
                                    <div class="input-group">
                                        <input type="password" class="form-control form-control-lg" id="loginPassword" placeholder="Enter password" required>
                                        <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordVisibility('loginPassword', this)">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="rememberMe">
                                        <label class="form-check-label" for="rememberMe">Remember me</label>
                                    </div>
                                    <a href="#" onclick="showPortalTab('forgot'); return false;" class="small">Forgot Password?</a>
                                </div>
                                <button type="submit" class="btn btn-lg w-100" style="background: var(--gradient-primary); color: #fff; border: none;">
                                    <i class="fas fa-sign-in-alt me-2"></i>Login
                                </button>
                            </form>
                            <div class="text-center mt-3">
                                <small class="text-muted">Don't have an account? <a href="#" onclick="showPortalTab('signup'); return false;">Sign up here</a></small>
                            </div>

                        </div>
                        
                        <!-- SIGN UP FORM (Step 1: Basic Info) -->
                        <div id="signupForm" class="portal-form" style="display: none;">
                            <div class="alert alert-warning mb-3">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <strong>Important:</strong> You must have paid your membership fee before signing up. We will verify your payment in our records.
                            </div>
                            <form onsubmit="return handleSignup(event)">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label"><i class="fas fa-user me-2"></i>First Name *</label>
                                        <input type="text" class="form-control" id="signupFirstName" placeholder="Enter first name" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label"><i class="fas fa-user me-2"></i>Last Name *</label>
                                        <input type="text" class="form-control" id="signupLastName" placeholder="Enter last name" required>
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label"><i class="fas fa-envelope me-2"></i>Email Address *</label>
                                        <input type="email" class="form-control" id="signupEmail" placeholder="Enter email address" required>
                                        <small class="text-muted">Use the same email used for payment</small>
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label"><i class="fas fa-phone me-2"></i>Phone Number *</label>
                                        <input type="tel" class="form-control" id="signupPhone" placeholder="(904) 555-1234" required>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-lg w-100 mt-4" style="background: var(--gradient-green); color: #fff; border: none;">
                                    <i class="fas fa-search me-2"></i>Verify Payment & Get Registration Code
                                </button>
                            </form>
                            <div class="text-center mt-3">
                                <small class="text-muted">Already have an account? <a href="#" onclick="showPortalTab('login'); return false;">Login here</a></small>
                            </div>
                        </div>
                        
                        <!-- REGISTRATION CODE FORM (Step 2) -->
                        <div id="codeForm" class="portal-form" style="display: none;">
                            <div class="alert alert-success mb-3">
                                <i class="fas fa-envelope-open me-2"></i>
                                <strong>Check Your Email!</strong> Enter the registration code sent to your email address.
                            </div>
                            <form onsubmit="return handleCodeVerification(event)">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-key me-2"></i>Registration Code</label>
                                    <input type="text" class="form-control form-control-lg text-center" id="registrationCode" 
                                           placeholder="BANF-XXXX-XXXX" style="letter-spacing: 2px; font-family: monospace; font-size: 1.25rem;" required>
                                    <small class="text-muted">Code is valid for 7 days</small>
                                </div>
                                <button type="submit" class="btn btn-lg w-100" style="background: var(--gradient-primary); color: #fff; border: none;">
                                    <i class="fas fa-check-circle me-2"></i>Verify Code
                                </button>
                            </form>
                            <div class="text-center mt-3">
                                <small class="text-muted">Didn't receive code? <a href="#" onclick="resendRegistrationCode(); return false;">Resend Code</a></small>
                            </div>
                        </div>
                        
                        <!-- SETUP ACCOUNT FORM (Step 3: Username & Password) -->
                        <div id="setupForm" class="portal-form" style="display: none;">
                            <div class="alert alert-info mb-3">
                                <i class="fas fa-user-check me-2"></i>
                                <strong>Final Step!</strong> Set up your username and password to complete registration.
                            </div>
                            <form onsubmit="return handleAccountSetup(event)">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-at me-2"></i>Username</label>
                                    <input type="text" class="form-control" id="setupUsername" placeholder="Choose a username">
                                    <small class="text-muted">Leave blank to use your email as username</small>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-lock me-2"></i>Password *</label>
                                    <div class="input-group">
                                        <input type="password" class="form-control" id="setupPassword" placeholder="Create a strong password" required>
                                        <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordVisibility('setupPassword', this)">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                    <small class="text-muted">Min 8 chars, uppercase, lowercase, and number required</small>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-lock me-2"></i>Confirm Password *</label>
                                    <input type="password" class="form-control" id="setupConfirmPassword" placeholder="Confirm your password" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-home me-2"></i>Address (Optional)</label>
                                    <input type="text" class="form-control" id="setupAddress" placeholder="Street address">
                                </div>
                                <div class="row g-2 mb-3">
                                    <div class="col-6">
                                        <input type="text" class="form-control" id="setupCity" placeholder="City" value="Jacksonville">
                                    </div>
                                    <div class="col-3">
                                        <input type="text" class="form-control" id="setupState" placeholder="State" value="FL">
                                    </div>
                                    <div class="col-3">
                                        <input type="text" class="form-control" id="setupZip" placeholder="ZIP">
                                    </div>
                                </div>
                                <input type="hidden" id="setupRegistrationId">
                                <input type="hidden" id="setupRegistrationCode">
                                <button type="submit" class="btn btn-lg w-100" style="background: var(--gradient-primary); color: #fff; border: none;">
                                    <i class="fas fa-check-circle me-2"></i>Complete Registration
                                </button>
                            </form>
                        </div>
                        
                        <!-- FORGOT PASSWORD FORM -->
                        <div id="forgotForm" class="portal-form" style="display: none;">
                            <form onsubmit="return handleForgotPassword(event)">
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-envelope me-2"></i>Email Address</label>
                                    <input type="email" class="form-control form-control-lg" id="forgotEmail" placeholder="Enter your registered email" required>
                                </div>
                                <button type="submit" class="btn btn-lg w-100 mb-2" style="background: var(--gradient-primary); color: #fff; border: none;">
                                    <i class="fas fa-key me-2"></i>Reset Password
                                </button>
                                <button type="button" onclick="handleForgotUsername(event)" class="btn btn-outline-warning btn-lg w-100">
                                    <i class="fas fa-user me-2"></i>Forgot Username?
                                </button>
                            </form>
                            <div class="text-center mt-3">
                                <small class="text-muted"><a href="#" onclick="showPortalTab('login'); return false;"><i class="fas fa-arrow-left me-1"></i>Back to Login</a></small>
                            </div>
                            <div class="mt-4 p-3 rounded" style="background: rgba(255,193,7,0.1); border: 1px dashed var(--gold);">
                                <small class="text-muted">
                                    <strong><i class="fas fa-lightbulb me-1"></i>Demo Mode:</strong><br>
                                    Test with email: <code>member@test.com</code><br>
                                    Or: <code>admin@test.com</code>
                                </small>
                            </div>
                        </div>
                        
                        <!-- PROFILE MANAGEMENT (shown after login) -->
                        <div id="profileSection" class="portal-form" style="display: none;">
                            <div class="text-center mb-4">
                                <div class="mx-auto mb-3" style="width: 80px; height: 80px; border-radius: 50%; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center;">
                                    <span id="profileInitials" class="text-white" style="font-size: 2rem; font-weight: bold;">--</span>
                                </div>
                                <h5 id="profileName" class="mb-1">Member Name</h5>
                                <span id="profileRole" class="badge" style="background: var(--gold); color: #1a1a2e;">Member</span>
                            </div>
                            
                            <div class="list-group mb-4">
                                <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" onclick="showProfileEdit(); return false;">
                                    <span><i class="fas fa-user-edit me-2"></i>Edit Profile</span>
                                    <i class="fas fa-chevron-right text-muted"></i>
                                </a>
                                <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" data-action="profile-payments">
                                    <span><i class="fas fa-credit-card me-2"></i>Payment History</span>
                                    <i class="fas fa-chevron-right text-muted"></i>
                                </a>
                                <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" data-action="profile-events">
                                    <span><i class="fas fa-calendar-check me-2"></i>My Events</span>
                                    <i class="fas fa-chevron-right text-muted"></i>
                                </a>
                                <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" data-action="profile-family">
                                    <span><i class="fas fa-users me-2"></i>Family Members</span>
                                    <i class="fas fa-chevron-right text-muted"></i>
                                </a>
                            </div>
                            
                            <button class="btn btn-outline-danger w-100" onclick="handleLogout()">
                                <i class="fas fa-sign-out-alt me-2"></i>Logout
                            </button>
                        </div>
                        
                        <!-- Status Messages -->
                        <div id="portalStatusMessage" class="mt-3" style="display: none;"></div>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== DIAGNOSTICS MODAL ========== -->
    <div class="modal fade" id="diagnosticsModal" tabindex="-1" aria-labelledby="diagnosticsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content" style="border-radius: 16px; overflow: hidden;">
                <div class="modal-header" style="background: linear-gradient(135deg, #006A4E, #00856F); color: white;">
                    <h5 class="modal-title" id="diagnosticsModalLabel"><i class="fas fa-stethoscope me-2"></i>System Check</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="diagnosticsResults"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== EVENT DETAILS MODAL ========== -->
    <div class="modal fade" id="eventDetailsModal" tabindex="-1" aria-labelledby="eventDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content" style="border-radius: 16px; overflow: hidden;">
                <div class="modal-header" style="background: var(--gradient-primary); color: white;">
                    <h5 class="modal-title" id="eventDetailsModalLabel"><i class="fas fa-calendar-alt me-2"></i>Event Details</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="eventDetailsBody">
                    <div class="text-muted">Loading event details...</div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn" style="background: var(--gradient-green); color: #fff;" onclick="openMemberLoginModal()">
                        <i class="fas fa-user-check me-1"></i> RSVP (Members)
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== SURVEY MODAL ========== -->
    <div class="modal fade" id="surveyModal" tabindex="-1" aria-labelledby="surveyModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content" style="border-radius: 16px; overflow: hidden;">
                <div class="modal-header" style="background: var(--gradient-green); color: white;">
                    <h5 class="modal-title" id="surveyModalLabel"><i class="fas fa-poll me-2"></i>Active Surveys</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="surveyModalBody">
                    <div class="text-muted">Loading surveys...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== COMPLAINT FORM MODAL ========== -->
    <div class="modal fade" id="complaintModal" tabindex="-1" aria-labelledby="complaintModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content" style="border-radius: 16px; overflow: hidden;">
                <div class="modal-header" style="background: linear-gradient(135deg, #607D8B, #455A64); color: white;">
                    <h5 class="modal-title" id="complaintModalLabel"><i class="fas fa-shield-alt me-2"></i>Anonymous Complaint</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="complaintForm" onsubmit="return submitComplaint(event)">
                        <div class="mb-3">
                            <label class="form-label">Category</label>
                            <select class="form-control" id="complaintCategory" required>
                                <option value="">Select category...</option>
                                <option value="membership">Membership</option>
                                <option value="event">Event</option>
                                <option value="payment">Payment</option>
                                <option value="behavior">Conduct</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Subject</label>
                            <input type="text" class="form-control" id="complaintSubject" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Details</label>
                            <textarea class="form-control" id="complaintDetails" rows="5" required></textarea>
                        </div>
                        <div id="complaintStatus" class="mb-3"></div>
                        <button type="submit" class="btn w-100" style="background: linear-gradient(135deg, #607D8B, #455A64); color: #fff;">
                            <i class="fas fa-paper-plane me-1"></i> Submit Complaint
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- ═══════════════════════════════════════════════════════════════
         MEMBERSHIP & FAMILY MANAGEMENT MODALS
         ═══════════════════════════════════════════════════════════════ -->

    <!-- ADD/EDIT MEMBERSHIP MODAL -->
    <div class="modal fade" id="addMembershipModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content" style="border-radius:16px;overflow:hidden;">
                <div class="modal-header" style="background:linear-gradient(135deg,#6528F7,#9b59b6);color:#fff;">
                    <h5 class="modal-title" id="addMembershipModalLabel"><i class="fas fa-id-card me-2"></i>New Membership</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addMembershipForm" onsubmit="return submitMembership(event)">
                        <input type="hidden" id="mbrFormEditId">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Family <span class="text-danger">*</span></label>
                                <select class="form-select" id="mbrFormFamily" required>
                                    <option value="">Select family...</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Membership Year <span class="text-danger">*</span></label>
                                <select class="form-select" id="mbrFormYear" required>
                                    <option value="2025-2026">2025-2026</option>
                                    <option value="2026-2027" selected>2026-2027</option>
                                    <option value="2027-2028">2027-2028</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Tier <span class="text-danger">*</span></label>
                                <select class="form-select" id="mbrFormTier" required onchange="updateMbrFormAmount()">
                                    <option value="">Select tier...</option>
                                    <option value="student">Student — $165</option>
                                    <option value="individual">Individual Premium — $240</option>
                                    <option value="couple">Couple — $330</option>
                                    <option value="family">Family Premium — $410</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Amount Paid ($) <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" id="mbrFormAmount" min="0" step="0.01" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Payment Date <span class="text-danger">*</span></label>
                                <input type="date" class="form-control" id="mbrFormPaymentDate" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Payment Method</label>
                                <select class="form-select" id="mbrFormPaymentMethod">
                                    <option value="zelle">Zelle</option>
                                    <option value="check">Check</option>
                                    <option value="cash">Cash</option>
                                    <option value="card">Card</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">EC Term</label>
                                <select class="form-select" id="mbrFormECTerm">
                                    <option value="26-28" selected>EC 26-28</option>
                                    <option value="28-30">EC 28-30</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="mbrFormStatus">
                                    <option value="active" selected>Active</option>
                                    <option value="pending">Pending (Future Date)</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="mbrFormFutureDate">
                                    <label class="form-check-label" for="mbrFormFutureDate">
                                        <i class="fas fa-calendar-alt me-1"></i> President/VP discretion — agreed future payment date
                                    </label>
                                </div>
                                <input type="date" class="form-control mt-2 d-none" id="mbrFormAgreedDate" placeholder="Agreed future date">
                            </div>
                        </div>
                        <div id="mbrFormStatus_msg" class="mt-3"></div>
                        <button type="submit" class="btn w-100 mt-3" style="background:linear-gradient(135deg,#6528F7,#9b59b6);color:#fff;">
                            <i class="fas fa-save me-1"></i> Save Membership
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- ADD/EDIT FAMILY MODAL -->
    <div class="modal fade" id="addFamilyModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content" style="border-radius:16px;overflow:hidden;">
                <div class="modal-header" style="background:linear-gradient(135deg,#6528F7,#9b59b6);color:#fff;">
                    <h5 class="modal-title" id="addFamilyModalLabel"><i class="fas fa-users me-2"></i>New Family</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addFamilyForm" onsubmit="return submitFamily(event)">
                        <input type="hidden" id="famFormEditId">
                        <div class="mb-3">
                            <label class="form-label">Head of Family <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="famFormHeadName" required placeholder="Full name of family head">
                        </div>
                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" id="famFormHeadEmail" placeholder="Email address">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Phone</label>
                                <input type="tel" class="form-control" id="famFormHeadPhone" placeholder="Phone number">
                            </div>
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h6 class="mb-0"><i class="fas fa-user-friends me-1"></i>Family Members</h6>
                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="addFamilyMemberRow()">
                                <i class="fas fa-plus"></i> Add Member
                            </button>
                        </div>
                        <div id="famFormMembersList">
                            <!-- Dynamic member rows added here -->
                        </div>
                        <div id="famFormStatus_msg" class="mt-3"></div>
                        <button type="submit" class="btn w-100 mt-3" style="background:linear-gradient(135deg,#6528F7,#9b59b6);color:#fff;">
                            <i class="fas fa-save me-1"></i> Save Family
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- TRANSFER MEMBER MODAL -->
    <div class="modal fade" id="transferMemberModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="border-radius:16px;overflow:hidden;">
                <div class="modal-header" style="background:linear-gradient(135deg,#fd7e14,#e74c3c);color:#fff;">
                    <h5 class="modal-title"><i class="fas fa-exchange-alt me-2"></i>Transfer Family Member</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning"><i class="fas fa-exclamation-triangle me-1"></i> Transferring a member will create a <strong>new Family ID</strong> and remove them from the current family.</div>
                    <form id="transferMemberForm" onsubmit="return submitTransferMember(event)">
                        <input type="hidden" id="xferSourceFamilyId">
                        <div class="mb-3">
                            <label class="form-label">Member to Transfer <span class="text-danger">*</span></label>
                            <select class="form-select" id="xferMemberSelect" required>
                                <option value="">Select member...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Transfer To</label>
                            <select class="form-select" id="xferDestination">
                                <option value="new" selected>Create New Family</option>
                                <option value="existing">Existing Family</option>
                            </select>
                        </div>
                        <div class="mb-3 d-none" id="xferExistingFamilyDiv">
                            <label class="form-label">Destination Family</label>
                            <select class="form-select" id="xferExistingFamily"></select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Reason</label>
                            <textarea class="form-control" id="xferReason" rows="2" placeholder="Reason for transfer..."></textarea>
                        </div>
                        <button type="submit" class="btn w-100" style="background:linear-gradient(135deg,#fd7e14,#e74c3c);color:#fff;">
                            <i class="fas fa-exchange-alt me-1"></i> Confirm Transfer
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- ADD ADMIN NOTE MODAL -->
    <div class="modal fade" id="addNoteModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="border-radius:16px;overflow:hidden;">
                <div class="modal-header" style="background:linear-gradient(135deg,#20c997,#198754);color:#fff;">
                    <h5 class="modal-title"><i class="fas fa-sticky-note me-2"></i>Add Admin Note</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addNoteForm" onsubmit="return submitAdminNote(event)">
                        <input type="hidden" id="noteFormTargetType" value="family">
                        <input type="hidden" id="noteFormTargetId">
                        <div class="mb-3">
                            <label class="form-label">Target</label>
                            <input type="text" class="form-control" id="noteFormTargetLabel" readonly>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Note <span class="text-danger">*</span></label>
                            <textarea class="form-control" id="noteFormText" rows="4" required placeholder="Add your note or comment..."></textarea>
                        </div>
                        <button type="submit" class="btn w-100" style="background:linear-gradient(135deg,#20c997,#198754);color:#fff;">
                            <i class="fas fa-save me-1"></i> Save Note
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- ADD FAMILY MEMBER MODAL (single member to existing family) -->
    <div class="modal fade" id="addFamilyMemberModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="border-radius:16px;overflow:hidden;">
                <div class="modal-header" style="background:linear-gradient(135deg,#6528F7,#9b59b6);color:#fff;">
                    <h5 class="modal-title"><i class="fas fa-user-plus me-2"></i>Add Family Member</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addFamilyMemberForm" onsubmit="return submitAddFamilyMember(event)">
                        <input type="hidden" id="addMemFamilyId">
                        <div class="mb-3">
                            <label class="form-label">Full Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="addMemName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Relationship</label>
                            <select class="form-select" id="addMemRelation">
                                <option value="spouse">Spouse</option>
                                <option value="child">Child</option>
                                <option value="parent">Parent</option>
                                <option value="sibling">Sibling</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="addMemEmail">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Phone</label>
                            <input type="tel" class="form-control" id="addMemPhone">
                        </div>
                        <button type="submit" class="btn w-100" style="background:linear-gradient(135deg,#6528F7,#9b59b6);color:#fff;">
                            <i class="fas fa-user-plus me-1"></i> Add Member
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Additional CSS for Member Portal Modal -->
    <style>
        /* Member Portal Modal Styles */
        #memberPortalModal .nav-pills .nav-link {
            color: var(--banf-deep-red);
            background: rgba(139,0,0,0.1);
            transition: all 0.3s ease;
        }
        #memberPortalModal .nav-pills .nav-link.active {
            background: var(--gradient-primary);
            color: #fff;
        }
        #memberPortalModal .nav-pills .nav-link:hover:not(.active) {
            background: rgba(139,0,0,0.2);
        }
        #memberPortalModal .form-control:focus {
            border-color: var(--banf-orange);
            box-shadow: 0 0 0 0.2rem rgba(255,107,53,0.25);
        }
        .portal-form {
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Role badges */
        .role-badge-super_admin { background: linear-gradient(135deg, #1a1a1a, #333) !important; }
        .role-badge-president { background: linear-gradient(135deg, #8B0000, #a50000) !important; }
        .role-badge-treasurer { background: linear-gradient(135deg, #00A86B, #008a64) !important; }
        .role-badge-vp { background: linear-gradient(135deg, #FF6B35, #ff8b5c) !important; }
        .role-badge-secretary { background: linear-gradient(135deg, #5c6bc0, #7986cb) !important; }
        .role-badge-ec { background: linear-gradient(135deg, #26a69a, #4db6ac) !important; }
        .role-badge-moderator { background: linear-gradient(135deg, #7e57c2, #9575cd) !important; }
        .role-badge-member { background: linear-gradient(135deg, #D4AF37, #e5c158) !important; color: #1a1a2e !important; }
        .role-badge-cultural_secretary { background: linear-gradient(135deg, #9C27B0, #E91E63) !important; }
        .role-badge-food_coord { background: linear-gradient(135deg, #FF5722, #FF9800) !important; }
        .role-badge-event_coord { background: linear-gradient(135deg, #2196F3, #03A9F4) !important; }
        .role-badge-puja_coord { background: linear-gradient(135deg, #673AB7, #9C27B0) !important; }
        .role-badge-joint_secretary { background: linear-gradient(135deg, #8B0000, #DC143C) !important; }
        .role-badge-assistant_secretary { background: linear-gradient(135deg, #546E7A, #90A4AE) !important; }
        .role-badge-assistant_treasurer { background: linear-gradient(135deg, #00A86B, #00C389) !important; }
        .role-badge-webmaster { background: linear-gradient(135deg, #1a237e, #3949ab) !important; }
        .role-badge-editor { background: linear-gradient(135deg, #5d4037, #8d6e63) !important; }
        .role-badge-communications { background: linear-gradient(135deg, #006A4E, #00A86B) !important; }
        .role-badge-community { background: linear-gradient(135deg, #2E7D32, #66BB6A) !important; }
        
        /* ========== FULL-SCREEN MEMBER PORTAL STYLES ========== */
        .member-portal-fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #f5f7fa;
            z-index: 9999;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .portal-header-bar {
            background: var(--gradient-green);
            color: #fff;
            padding: 0.75rem 1.5rem;
            flex-shrink: 0;  /* Don't shrink header in flex column */
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        
        .portal-header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .portal-logo-group {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .portal-logo-icon {
            width: 45px;
            height: 45px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }
        
        .portal-logo-text h1 {
            font-size: 1.25rem;
            margin: 0;
            font-weight: 700;
            font-family: 'Playfair Display', serif;
        }
        
        .portal-logo-text span {
            font-size: 0.8rem;
            opacity: 0.9;
        }
        
        .portal-user-menu {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .portal-user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }
        
        .portal-user-name {
            font-weight: 500;
        }
        
        .portal-btn-logout, .portal-btn-close {
            background: rgba(255,255,255,0.2);
            color: #fff;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .portal-btn-logout:hover, .portal-btn-close:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .portal-btn-close {
            padding: 0.5rem 0.75rem;
            margin-left: 0.5rem;
        }
        
        .portal-main-container {
            display: flex;
            flex: 1;
            min-height: 0;
            overflow: hidden;
        }
        
        /* Sidebar */
        .portal-sidebar {
            width: 260px;
            background: #fff;
            border-right: 1px solid #e0e0e0;
            padding: 1.25rem 0;
            overflow-y: auto;
            flex-shrink: 0;
        }
        
        .sidebar-section {
            margin-bottom: 1.25rem;
            padding: 0 0.75rem;
        }
        
        .sidebar-section h6 {
            font-size: 0.7rem;
            text-transform: uppercase;
            color: #888;
            font-weight: 600;
            margin-bottom: 0.5rem;
            padding-left: 0.75rem;
            letter-spacing: 0.5px;
        }
        
        .portal-nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: 10px;
            color: var(--banf-charcoal, #2D2D2D);
            text-decoration: none;
            margin-bottom: 0.2rem;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .portal-nav-item:hover {
            background: rgba(0,106,78,0.08);
            color: var(--banf-green);
        }
        
        .portal-nav-item.active {
            background: var(--gradient-green);
            color: #fff;
        }
        
        .portal-nav-item i {
            width: 22px;
            text-align: center;
            font-size: 1rem;
        }
        
        .portal-badge {
            margin-left: auto;
            background: var(--banf-orange);
            color: #fff;
            font-size: 0.65rem;
            padding: 0.15rem 0.4rem;
            border-radius: 10px;
            font-weight: 600;
        }
        
        /* Content Area */
        .portal-content-area {
            flex: 1;
            min-height: 0;  /* Required for flex child overflow scrolling */
            padding: 1.5rem 2rem;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
            touch-action: pan-y;
        }
        
        .portal-page-header {
            margin-bottom: 1.5rem;
        }
        
        .portal-page-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--banf-charcoal, #2D2D2D);
            margin-bottom: 0.25rem;
            font-family: 'Playfair Display', serif;
        }
        
        .portal-page-header p {
            color: #666;
            margin: 0;
        }
        
        .portal-section {
            display: none;
            animation: fadeIn 0.4s ease;
        }
        
        .portal-section.active {
            display: block;
        }
        
        /* Stats Grid */
        .portal-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .portal-stat-card {
            background: #fff;
            border-radius: 14px;
            padding: 1.25rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.3s;
        }
        
        .portal-stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .stat-icon {
            width: 55px;
            height: 55px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: #fff;
        }
        
        .stat-icon.green { background: var(--gradient-green); }
        .stat-icon.orange { background: var(--gradient-primary); }
        .stat-icon.gold { background: linear-gradient(135deg, #D4AF37, #FFD700); }
        .stat-icon.purple { background: linear-gradient(135deg, #673AB7, #9C27B0); }
        
        .stat-info h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
            color: var(--banf-charcoal, #2D2D2D);
        }
        
        .stat-info p {
            font-size: 0.8rem;
            color: #888;
            margin: 0;
        }
        
        /* Features Grid */
        .portal-features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.25rem;
        }
        
        .portal-feature-card {
            background: #fff;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .portal-feature-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.1);
            border-color: var(--banf-green);
        }
        
        .feature-icon-box {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            background: var(--gradient-green);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: #fff;
            margin-bottom: 1rem;
        }
        
        .portal-feature-card h4 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--banf-charcoal, #2D2D2D);
        }
        
        .portal-feature-card p {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 1rem;
            line-height: 1.5;
        }
        
        .portal-feature-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.65rem 1.25rem;
            background: var(--gradient-green);
            color: #fff;
            border: none;
            border-radius: 25px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }
        
        .portal-feature-btn:hover {
            transform: scale(1.03);
            box-shadow: 0 6px 20px rgba(0,106,78,0.3);
            color: #fff;
        }
        
        .portal-feature-btn.secondary {
            background: #f0f0f0;
            color: var(--banf-charcoal, #2D2D2D);
        }
        
        .portal-feature-btn.secondary:hover {
            background: #e0e0e0;
            color: var(--banf-charcoal, #2D2D2D);
        }
        
        /* Form Card */
        .portal-form-card {
            background: #fff;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            margin-bottom: 1.5rem;
        }
        
        /* Data Table */
        .portal-data-table {
            background: #fff;
            border-radius: 14px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        
        .portal-data-table table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .portal-data-table th {
            background: var(--banf-green);
            color: #fff;
            padding: 0.85rem 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.85rem;
        }
        
        .portal-data-table td {
            padding: 0.85rem 1rem;
            border-bottom: 1px solid #eee;
            font-size: 0.85rem;
        }
        
        .portal-data-table tr:hover td {
            background: rgba(0,106,78,0.03);
        }
        
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.65rem;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        .status-badge.active { background: #d4edda; color: #155724; }
        .status-badge.pending { background: #fff3cd; color: #856404; }
        .status-badge.expired { background: #f8d7da; color: #721c24; }

        /* ========== FULL-SCREEN ADMIN PORTAL STYLES ========== */
        .admin-portal-fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #f5f7fa;
            z-index: 10000;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .admin-portal-fullscreen .admin-header {
            background: linear-gradient(135deg, #8B0000, #DC143C);
            color: #fff;
            padding: 0.75rem 1.5rem;
            flex-shrink: 0;  /* Don't shrink header in flex column */
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(139,0,0,0.3);
        }

        .admin-header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1600px;
            margin: 0 auto;
        }

        .admin-logo-group {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .admin-logo-icon {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .admin-logo-text h1 {
            font-size: 1.25rem;
            margin: 0;
            font-weight: 700;
        }

        .admin-logo-text span {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        .admin-user-menu {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .admin-user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .admin-user-name {
            font-weight: 600;
        }

        .admin-role-badge {
            background: rgba(255,255,255,0.2);
            padding: 0.3rem 0.9rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .admin-btn {
            background: rgba(255,255,255,0.2);
            color: #fff;
            border: none;
            padding: 0.45rem 0.9rem;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .admin-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .admin-btn-close {
            padding: 0.45rem 0.7rem;
        }

        .admin-mobile-toggle {
            display: none;
        }

        .admin-portal-container {
            display: flex;
            flex: 1;
            min-height: 0;
            overflow: hidden;
        }

        .admin-sidebar {
            width: 270px;
            background: #fff;
            border-right: 1px solid #e0e0e0;
            padding: 1.25rem 0;
            overflow-y: auto;
            flex-shrink: 0;
        }

        .admin-sidebar-section {
            margin-bottom: 1.25rem;
            padding: 0 0.75rem;
        }

        .admin-sidebar-section h6 {
            font-size: 0.7rem;
            text-transform: uppercase;
            color: #888;
            font-weight: 600;
            margin-bottom: 0.5rem;
            padding-left: 0.75rem;
            letter-spacing: 0.5px;
        }

        .admin-nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: 10px;
            color: #2D2D2D;
            text-decoration: none;
            margin-bottom: 0.2rem;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .admin-nav-item:hover {
            background: rgba(139,0,0,0.08);
            color: #8B0000;
        }

        .admin-nav-item.active {
            background: linear-gradient(135deg, #8B0000, #DC143C);
            color: #fff;
        }

        .admin-nav-item i {
            width: 22px;
            text-align: center;
            font-size: 1rem;
        }

        .admin-badge {
            margin-left: auto;
            background: #DC143C;
            color: #fff;
            font-size: 0.65rem;
            padding: 0.15rem 0.4rem;
            border-radius: 10px;
            font-weight: 600;
        }

        .admin-badge.warning { background: #FFA000; }

        .admin-main-content {
            flex: 1;
            min-height: 0;  /* Required for flex child overflow scrolling */
            padding: 1.5rem 2rem;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
            touch-action: pan-y;
        }

        .admin-page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .admin-page-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
        }

        .admin-page-header p {
            margin: 0;
            color: #666;
        }

        .admin-section { display: none; }
        .admin-section.active { display: block; animation: fadeIn 0.4s ease; }

        .admin-primary {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.65rem 1.25rem;
            background: linear-gradient(135deg, #8B0000, #DC143C);
            color: #fff;
            border: none;
            border-radius: 25px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
        }

        .admin-secondary {
            padding: 0.5rem 0.9rem;
            border-radius: 8px;
            font-size: 0.8rem;
            border: 1px solid #ddd;
            background: #fff;
            cursor: pointer;
        }

        .admin-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .admin-stat-card {
            background: #fff;
            border-radius: 16px;
            padding: 1.25rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            display: flex;
            gap: 1rem;
            align-items: center;
            border-left: 4px solid transparent;
        }

        .admin-stat-card.red { border-color: #DC143C; }
        .admin-stat-card.green { border-color: #4CAF50; }
        .admin-stat-card.orange { border-color: #FF6B35; }
        .admin-stat-card.blue { border-color: #2196F3; }

        .admin-stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: #fff;
        }

        .admin-stat-icon.red { background: linear-gradient(135deg, #8B0000, #DC143C); }
        .admin-stat-icon.green { background: linear-gradient(135deg, #4CAF50, #8BC34A); }
        .admin-stat-icon.orange { background: linear-gradient(135deg, #FF6B35, #FF9800); }
        .admin-stat-icon.blue { background: linear-gradient(135deg, #2196F3, #03A9F4); }

        .admin-stat-info h3 { margin: 0; font-size: 1.4rem; font-weight: 700; }
        .admin-stat-info p { margin: 0; color: #777; font-size: 0.8rem; }

        .admin-card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 1rem;
        }

        .admin-card {
            background: #fff;
            border-radius: 16px;
            padding: 1.25rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .admin-card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .admin-card-icon {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            background: linear-gradient(135deg, #8B0000, #DC143C);
        }

        .admin-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .admin-table {
            background: #fff;
            border-radius: 14px;
            overflow: hidden;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .admin-table table {
            min-width: 600px;
        }

        .admin-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .admin-table th {
            background: #8B0000;
            color: #fff;
            padding: 0.85rem 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .admin-table td {
            padding: 0.85rem 1rem;
            border-bottom: 1px solid #eee;
            font-size: 0.85rem;
        }

        /* Admin responsive — tablet: slide-in drawer with full nav labels */
        @media (max-width: 992px) {
            .admin-portal-container { flex-direction: column; position: relative; }
            .admin-sidebar {
                position: fixed;
                left: -290px;
                top: 70px;
                width: 280px;
                height: calc(100vh - 70px);
                z-index: 1050;
                transition: left 0.3s ease;
                flex-direction: column;
                overflow-y: auto;
                overflow-x: hidden;
                border-right: 1px solid #e0e0e0;
                box-shadow: 4px 0 15px rgba(0,0,0,0.1);
            }
            .admin-sidebar.open { left: 0; }
            .admin-sidebar-section { flex-direction: column; margin-bottom: 1rem; padding: 0 0.75rem; }
            .admin-sidebar-section h6 { display: block; }
            .admin-nav-item { white-space: nowrap; padding: 0.65rem 1rem; font-size: 0.85rem; }
            .admin-nav-item span { display: inline; }
            .admin-mobile-toggle { display: flex !important; }
            .admin-sidebar-backdrop { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 1049; }
            .admin-sidebar-backdrop.show { display: block; }
            .admin-main-content { padding: 1rem; flex: 1; min-height: 0; overflow-y: auto; -webkit-overflow-scrolling: touch; }
            /* Compact admin header on tablet */
            .admin-header-content { gap: 0.5rem; }
            .admin-logo-text span { font-size: 0.7rem; }
            .admin-user-name { display: none; }
            .admin-btn { padding: 0.4rem 0.7rem; font-size: 0.78rem; }
        }
        
        /* Mobile Responsive */
        @media (max-width: 992px) {
            .portal-main-container {
                flex-direction: column;
            }
            
            .portal-sidebar {
                width: 100%;
                height: auto;
                border-right: none;
                border-bottom: 1px solid #e0e0e0;
                display: flex;
                overflow-x: auto;
                padding: 0.75rem;
                gap: 0.5rem;
            }
            
            .sidebar-section {
                display: flex;
                gap: 0.25rem;
                margin-bottom: 0;
                padding: 0;
            }
            
            .sidebar-section h6 {
                display: none;
            }
            
            .portal-nav-item {
                white-space: nowrap;
                padding: 0.5rem 0.75rem;
                font-size: 0.8rem;
            }
            
            .portal-nav-item span {
                display: none;
            }
            
            .portal-content-area {
                padding: 1rem;
                flex: 1;
                min-height: 0;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .portal-features-grid {
                grid-template-columns: 1fr;
            }
            
            .portal-user-name {
                display: none;
            }
        }
        
        @media (max-width: 576px) {
            .portal-header-bar {
                padding: 0.5rem 1rem;
            }
            
            .portal-logo-text h1 {
                font-size: 1rem;
            }
            
            .portal-logo-text span {
                display: none;
            }
            
            .portal-page-header h2 {
                font-size: 1.25rem;
            }

            /* Portal sidebar — slide-in drawer on small screens */
            .portal-main-container { flex-direction: column; position: relative; }
            .portal-sidebar {
                position: fixed;
                left: -270px;
                top: 70px;
                width: 260px;
                height: calc(100vh - 70px);
                z-index: 1050;
                transition: left 0.3s ease;
                flex-direction: column;
                overflow-y: auto;
                overflow-x: hidden;
                border-right: 1px solid #e0e0e0;
                box-shadow: 4px 0 15px rgba(0,0,0,0.1);
            }
            .portal-sidebar.open { left: 0; }
            .sidebar-section { flex-direction: column; }
            .sidebar-section h6 { display: block; }
            .portal-nav-item span { display: inline; }
            .portal-content-area { margin-left: 0; padding: 1rem; flex: 1; min-height: 0; overflow-y: auto; -webkit-overflow-scrolling: touch; }
            .portal-mobile-toggle { display: flex !important; }
            .portal-sidebar-backdrop {
                display: none;
                position: fixed;
                inset: 0;
                background: rgba(0,0,0,0.4);
                z-index: 1049;
            }
            .portal-sidebar-backdrop.show { display: block; }

            /* Admin sidebar — smaller drawer on phones (already slide-in from 992px) */
            .admin-sidebar {
                left: -280px;
                width: 270px;
            }
            .admin-sidebar.open { left: 0; }

            /* Admin user menu — compact on mobile */
            .admin-user-name { display: none; }
            .admin-role-badge { font-size: 0.6rem; padding: 0.2rem 0.4rem; }
            .admin-btn { padding: 0.35rem 0.5rem; font-size: 0.75rem; }

            /* Modals — fullscreen on small screens */
            .modal-dialog { margin: 0; max-width: 100%; height: 100%; }
            .modal-content { border-radius: 0; height: 100%; }
        }

        /* ===== iPhone SE / very small phones — portal & admin (375px) ===== */
        @media (max-width: 375px) {
            /* Portal sidebar drawer — narrower for tiny screens */
            .portal-sidebar {
                left: -240px;
                width: 230px;
            }
            .portal-sidebar.open { left: 0; }
            .portal-nav-item { font-size: 0.8rem; padding: 0.5rem 0.75rem; }
            .portal-content-area { padding: 0.5rem !important; }
            .portal-page-header h2 { font-size: 1.1rem; }
            .portal-page-header p { font-size: 0.8rem; }
            .portal-features-grid { gap: 0.5rem; }
            .portal-feature-card { padding: 0.75rem; }
            .portal-feature-card h5 { font-size: 0.9rem; }
            .portal-feature-card p { font-size: 0.75rem; }
            .portal-header-bar { padding: 0.4rem 0.75rem; }
            .portal-logo-text h1 { font-size: 0.9rem; }

            /* Admin sidebar drawer — narrower for tiny screens */
            .admin-sidebar {
                left: -240px;
                width: 230px;
            }
            .admin-sidebar.open { left: 0; }
            .admin-nav-item { font-size: 0.8rem; padding: 0.5rem 0.75rem; }
            .admin-main-content { padding: 0.5rem !important; }
            .admin-section-header h3 { font-size: 1rem; }
            .admin-section-header p { font-size: 0.75rem; }
            .admin-btn { padding: 0.3rem 0.4rem; font-size: 0.7rem; }
            .admin-role-badge { font-size: 0.55rem; }
            .admin-stat-card h4 { font-size: 1.1rem; }
            .admin-stat-card p { font-size: 0.7rem; }
            .admin-stat-card { padding: 0.75rem; }

            /* Login/Registration forms — compact */
            .portal-login-card { padding: 1rem; }
            .portal-login-card h3 { font-size: 1.1rem; }
            .portal-login-card .form-control { font-size: 16px; padding: 0.5rem; }
            .portal-login-card .btn { width: 100%; font-size: 0.85rem; }

            /* Tables inside portals */
            .admin-main-content table th,
            .admin-main-content table td,
            .portal-content-area table th,
            .portal-content-area table td { font-size: 0.7rem; padding: 0.3rem; }

            /* Modals — tighter on tiny screens */
            .modal-header { padding: 0.5rem 0.75rem; }
            .modal-header h5 { font-size: 0.95rem; }
            .modal-body { padding: 0.5rem 0.75rem; font-size: 0.8rem; }
            .modal-footer { padding: 0.5rem 0.75rem; }
            .modal-footer .btn { font-size: 0.8rem; }
        }
    </style>
    
    <!-- Member Portal JavaScript -->
    <script>
        // Member Portal State
        const MemberPortal = {
            currentTab: 'login',
            isLoggedIn: false,
            member: null,
            registrationId: null,
            apiBase: BANF_API.siteUrl,
            pendingServiceAction: null  // Stores intended service after login (survey/complaint/magazineSubmit)
        };

        // Admin Portal State
        const AdminPortal = {
            isLoggedIn: false,
            admin: null,
            currentSection: 'dashboard'
        };

        // Wix Collection Schema (expected fields)
        const WIX_MEMBER_SCHEMA = {
            required: ['id', 'firstName', 'lastName', 'email', 'role'],
            optional: ['phone', 'membershipType', 'memberSince', 'expiresOn', 'address', 'roles', 'adminRole', 'ecRole', 'isAdmin']
        };

        // Admin role allowlist (normalized values)
        const ADMIN_ROLE_ALLOWLIST = new Set([
            'super_admin', 'admin', 'ec_member', 'ec', 'president', 'vice_president', 'vp',
            'treasurer', 'assistant_treasurer', 'secretary', 'assistant_secretary', 'joint_secretary',
            'cultural_secretary', 'food_coord', 'event_coord', 'puja_coord', 'webmaster',
            'editor', 'communications', 'community', 'moderator'
        ]);

        const ADMIN_ROLE_LABELS = {
            super_admin: 'Super Admin',
            admin: 'Admin',
            ec_member: 'EC Member',
            ec: 'EC Member',
            president: 'President',
            vice_president: 'Vice President',
            vp: 'Vice President',
            treasurer: 'Treasurer',
            assistant_treasurer: 'Asst. Treasurer',
            secretary: 'Secretary',
            assistant_secretary: 'Asst. Secretary',
            joint_secretary: 'Joint Secretary',
            cultural_secretary: 'Cultural Secretary',
            food_coord: 'Food Coordinator',
            event_coord: 'Event Coordinator',
            puja_coord: 'Puja Coordinator',
            webmaster: 'Webmaster',
            editor: 'Editor',
            communications: 'Communications',
            community: 'Community Lead',
            moderator: 'Moderator'
        };

        /**
         * Escape HTML special characters to prevent XSS
         */
        function escapeHtml(str) {
            if (str == null) return '';
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#39;');
        }

        function normalizeRoleValue(role) {
            return (role || '').toString().trim().toLowerCase().replace(/[^a-z0-9]+/g, '_');
        }

        function isAdminRoleValue(roleValue) {
            return ADMIN_ROLE_ALLOWLIST.has(normalizeRoleValue(roleValue));
        }

        // ===== SECTION-TO-PERMISSION MAPPING (Feature 3: Role-Based Enforcement) =====
        // Maps each admin sidebar section to the ecPermission string required to access it.
        // null = always visible (e.g. dashboard).  President/super_admin bypass all checks.
        const SECTION_PERMISSIONS = {
            dashboard:      null,           // always visible
            members:        'members',
            dataImport:     'members',      // data-import is a sub-feature of member mgmt
            dbExplorer:     'members',      // DB Explorer is a sub-feature of member mgmt
            payments:       'payments',
            gmail:          'communications',
            events:         'events',
            evite:          'evite',
            rsvps:          'rsvps',
            complaints:     'complaints',
            surveys:        'surveys',
            announcements:  'announcements',
            radio:          'radio',
            magazine:       'magazine',
            budget:         'budget',
            vendors:        'vendors',
            volunteers:     'volunteers',
            meetings:       'meetings',
            siteConfig:     'site_config',
            careers:        'careers',
            archiveData:    'archive_data',  // Archive Data Management
            reportBuilder:  'reports',       // Report Builder
            membershipDashboard: 'members',  // Membership Dashboard
            familyUniverse: 'members',       // Family Universe
            familyDetail:   'members'        // Family Detail (sub-view)
        };

        // Roles that bypass all permission checks (full access)
        const FULL_ACCESS_ROLES = new Set([
            'super_admin', 'admin', 'president', 'vice_president', 'vp'
        ]);

        function getRoleBadgeClass(roleValue) {
            const normalized = normalizeRoleValue(roleValue) || 'member';
            if (normalized === 'vice_president') return 'role-badge-vp';
            if (normalized === 'ec_member') return 'role-badge-ec';
            return `role-badge-${normalized}`;
        }

        function extractRolesFromMember(member) {
            const roles = [];
            if (!member) return roles;
            const candidates = [member.role, member.memberRole, member.ecRole, member.adminRole, member.roleTitle];
            candidates.forEach(role => {
                if (role) roles.push(normalizeRoleValue(role));
            });
            if (Array.isArray(member.roles)) {
                member.roles.forEach(role => roles.push(normalizeRoleValue(role)));
            }
            return Array.from(new Set(roles.filter(Boolean)));
        }

        function normalizeMemberRecord(raw = {}) {
            const roles = extractRolesFromMember(raw);
            const primaryRole = roles[0] || normalizeRoleValue(raw.role) || (raw.isAdmin ? 'ec_member' : 'member');
            const isAdmin = raw.isAdmin === true || roles.some(isAdminRoleValue) || isAdminRoleValue(primaryRole);
            const adminRoleLabel = raw.adminRole || raw.ecRole || raw.roleTitle || (isAdmin ? (ADMIN_ROLE_LABELS[primaryRole] || 'EC Member') : null);

            const normalizedAddress = raw.address || {
                street: raw.street || raw.addressLine1 || raw.address_line1 || '',
                city: raw.city || raw.addressCity || raw.address_city || 'Jacksonville',
                state: raw.state || raw.addressState || raw.address_state || 'FL',
                zip: raw.zip || raw.addressZip || raw.address_zip || ''
            };

            const normalizedMember = {
                id: raw.id || raw._id || raw.memberId || raw.member_id || '',
                firstName: raw.firstName || raw.first_name || raw.givenName || raw.given_name || '',
                lastName: raw.lastName || raw.last_name || raw.familyName || raw.family_name || '',
                fullName: raw.fullName || raw.full_name || raw.name || '',
                email: raw.email || raw.memberEmail || raw.member_email || raw.loginEmail || '',
                phone: raw.phone || raw.mobile || raw.phoneNumber || raw.phone_number || '',
                membershipType: raw.membershipType || raw.membership_type || raw.memberType || raw.member_type || '',
                memberSince: raw.memberSince || raw.member_since || raw.joinedOn || raw.joined_on || '',
                expiresOn: raw.expiresOn || raw.expires_on || raw.expirationDate || raw.expiration_date || '',
                address: normalizedAddress
            };

            return {
                ...raw,
                ...normalizedMember,
                role: raw.role || primaryRole || 'member',
                roleNormalized: primaryRole || 'member',
                roles: roles.length ? roles : [primaryRole || 'member'],
                isAdmin,
                adminRoleLabel
            };
        }

        function validateMemberSchema(member) {
            const missing = [];
            WIX_MEMBER_SCHEMA.required.forEach(key => {
                if (!member || member[key] === undefined || member[key] === null || member[key] === '') {
                    missing.push(key);
                }
            });
            return {
                valid: missing.length === 0,
                missing
            };
        }

        function findAccountByCredentials(credential, password) {
            const normalizedCredential = (credential || '').trim().toLowerCase();
            const testAccount = DemoData.testAccounts[normalizedCredential];
            if (testAccount && testAccount.password === password) {
                return { member: normalizeMemberRecord(testAccount.member), source: 'demo' };
            }

            const dynamicAccount = Object.values(DemoData.pendingRegistrations).find(
                reg => reg.completed && (reg.username === normalizedCredential || reg.email.toLowerCase() === normalizedCredential) && reg.password === password
            );
            if (dynamicAccount) {
                return { member: normalizeMemberRecord(dynamicAccount.memberData), source: 'dynamic' };
            }

            return null;
        }

        /**
         * Open Member Portal Modal
         */
        function openMemberPortal(tab = 'login') {
            if (window.BANF_MEMBER_PORTAL_DISABLED) {
                alert('⛔ Member portal is temporarily disabled by BANF administration. Please check back later.');
                return;
            }
            const modal = new bootstrap.Modal(document.getElementById('memberPortalModal'));
            showPortalTab(tab);
            modal.show();
        }

        /**
         * Switch Membership Section Tabs (Plans / Event Coverage / Value Analysis)
         */
        function switchMembershipTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.membership-tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.membership-tab-btn').classList.add('active');
            // Update tab content
            document.querySelectorAll('.membership-tab-content').forEach(el => el.classList.remove('active'));
            const targetTab = document.getElementById('tab-' + tabName);
            if (targetTab) targetTab.classList.add('active');
        }

        /**
         * Show specific tab in portal
         */
        function showPortalTab(tab) {
            MemberPortal.currentTab = tab;
            
            // Hide all forms
            document.querySelectorAll('.portal-form').forEach(form => {
                form.style.display = 'none';
            });
            
            // Update tab buttons
            document.querySelectorAll('#memberPortalTabs .nav-link').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected form and activate tab
            switch(tab) {
                case 'login':
                    document.getElementById('loginForm').style.display = 'block';
                    document.getElementById('login-tab').classList.add('active');
                    hideStatusMessage();
                    break;
                case 'signup':
                    document.getElementById('signupForm').style.display = 'block';
                    document.getElementById('signup-tab').classList.add('active');
                    hideStatusMessage();
                    break;
                case 'code':
                    document.getElementById('codeForm').style.display = 'block';
                    document.getElementById('code-tab').classList.add('active');
                    // Don't hide status - user needs to see the registration code
                    break;
                case 'setup':
                    document.getElementById('setupForm').style.display = 'block';
                    // Don't hide status - user needs to see "Code verified" message
                    break;
                case 'forgot':
                    document.getElementById('forgotForm').style.display = 'block';
                    hideStatusMessage();
                    break;
                case 'profile':
                    document.getElementById('profileSection').style.display = 'block';
                    hideStatusMessage();
                    break;
            }
        }

        // ========== DEMO/TEST MODE DATA ==========
        // Global demo data object for testing without backend
        window.DemoData = {
            // Test accounts that work without backend
            testAccounts: {
                'member_test': {
                    password: 'test',
                    member: {
                        id: 'demo_001',
                        firstName: 'Test',
                        lastName: 'Member',
                        fullName: 'Test Member',
                        email: 'member@test.com',
                        phone: '(904) 555-1234',
                        role: 'member',
                        membershipType: 'Family',
                        memberSince: '2024-01-15',
                        expiresOn: '2026-12-31',
                        address: {
                            street: '123 Demo Street',
                            city: 'Jacksonville',
                            state: 'FL',
                            zip: '32256'
                        },
                        familyMembers: ['Spouse Demo', 'Child Demo (12)'],
                        paymentHistory: [
                            { date: '2024-01-15', amount: '$150', type: 'Family Membership', status: 'Paid' },
                            { date: '2024-10-01', amount: '$75', type: 'Durga Puja 2024', status: 'Paid' }
                        ]
                    }
                },
                'admin_test': {
                    password: 'admin',
                    member: {
                        id: 'demo_admin',
                        firstName: 'Admin',
                        lastName: 'User',
                        fullName: 'Admin User',
                        email: 'admin@test.com',
                        phone: '(904) 555-9999',
                        role: 'ec_member',
                        roles: ['member', 'ec_member', 'president'],
                        adminRole: 'President',
                        isAdmin: true,
                        membershipType: 'Family',
                        memberSince: '2020-01-01',
                        expiresOn: '2026-12-31'
                    }
                },
                // ===== EC ROLE-SPECIFIC ACCOUNTS =====
                'ec_events': {
                    password: 'events123',
                    member: {
                        id: 'ec_events_001',
                        firstName: 'Priya',
                        lastName: 'Sen',
                        fullName: 'Priya Sen',
                        email: 'events@banf.org',
                        phone: '(904) 555-2001',
                        role: 'event_coord',
                        roles: ['member', 'ec_member', 'event_coord'],
                        adminRole: 'Event Coordinator',
                        isAdmin: true,
                        membershipType: 'Family',
                        memberSince: '2023-01-15',
                        expiresOn: '2026-12-31',
                        ecPermissions: ['events', 'rsvps', 'evite', 'volunteers']
                    }
                },
                'ec_sponsorship': {
                    password: 'sponsor123',
                    member: {
                        id: 'ec_sponsor_001',
                        firstName: 'Amit',
                        lastName: 'Roy',
                        fullName: 'Amit Roy',
                        email: 'sponsor@banf.org',
                        phone: '(904) 555-2002',
                        role: 'ec_member',
                        roles: ['member', 'ec_member'],
                        adminRole: 'Sponsorship Manager',
                        isAdmin: true,
                        membershipType: 'Family',
                        memberSince: '2022-06-01',
                        expiresOn: '2026-12-31',
                        ecPermissions: ['vendors', 'budget']
                    }
                },
                'ec_members': {
                    password: 'members123',
                    member: {
                        id: 'ec_members_001',
                        firstName: 'Shreya',
                        lastName: 'Das',
                        fullName: 'Shreya Das',
                        email: 'members@banf.org',
                        phone: '(904) 555-2003',
                        role: 'secretary',
                        roles: ['member', 'ec_member', 'secretary'],
                        adminRole: 'Secretary',
                        isAdmin: true,
                        membershipType: 'Individual',
                        memberSince: '2021-01-01',
                        expiresOn: '2026-12-31',
                        ecPermissions: ['members', 'meetings', 'directory']
                    }
                },
                'ec_vendors': {
                    password: 'vendor123',
                    member: {
                        id: 'ec_vendor_001',
                        firstName: 'Rina',
                        lastName: 'Mukherjee',
                        fullName: 'Rina Mukherjee',
                        email: 'vendors@banf.org',
                        phone: '(904) 555-2004',
                        role: 'food_coord',
                        roles: ['member', 'ec_member', 'food_coord'],
                        adminRole: 'Food/Vendor Coordinator',
                        isAdmin: true,
                        membershipType: 'Family',
                        memberSince: '2023-06-15',
                        expiresOn: '2026-12-31',
                        ecPermissions: ['vendors', 'events']
                    }
                },
                'ec_accounts': {
                    password: 'accounts123',
                    member: {
                        id: 'ec_accounts_001',
                        firstName: 'Subir',
                        lastName: 'Ghosh',
                        fullName: 'Subir Ghosh',
                        email: 'accounts@banf.org',
                        phone: '(904) 555-2005',
                        role: 'treasurer',
                        roles: ['member', 'ec_member', 'treasurer'],
                        adminRole: 'Treasurer',
                        isAdmin: true,
                        membershipType: 'Family',
                        memberSince: '2020-01-01',
                        expiresOn: '2026-12-31',
                        ecPermissions: ['payments', 'budget', 'vendors']
                    }
                },
                'ec_payments': {
                    password: 'payment123',
                    member: {
                        id: 'ec_payment_001',
                        firstName: 'Deepa',
                        lastName: 'Banerjee',
                        fullName: 'Deepa Banerjee',
                        email: 'payments@banf.org',
                        phone: '(904) 555-2006',
                        role: 'assistant_treasurer',
                        roles: ['member', 'ec_member', 'assistant_treasurer'],
                        adminRole: 'Asst. Treasurer',
                        isAdmin: true,
                        membershipType: 'Couple',
                        memberSince: '2022-01-01',
                        expiresOn: '2026-12-31',
                        ecPermissions: ['payments']
                    }
                },
                'ec_comms': {
                    password: 'comms123',
                    member: {
                        id: 'ec_comms_001',
                        firstName: 'Tanmay',
                        lastName: 'Chatterjee',
                        fullName: 'Tanmay Chatterjee',
                        email: 'comms@banf.org',
                        phone: '(904) 555-2007',
                        role: 'communications',
                        roles: ['member', 'ec_member', 'communications'],
                        adminRole: 'Communications',
                        isAdmin: true,
                        membershipType: 'Family',
                        memberSince: '2023-03-01',
                        expiresOn: '2026-12-31',
                        ecPermissions: ['announcements', 'surveys', 'complaints', 'magazine']
                    }
                },
                'ec_ads': {
                    password: 'ads123',
                    member: {
                        id: 'ec_ads_001',
                        firstName: 'Mousumi',
                        lastName: 'Basu',
                        fullName: 'Mousumi Basu',
                        email: 'ads@banf.org',
                        phone: '(904) 555-2008',
                        role: 'ec_member',
                        roles: ['member', 'ec_member'],
                        adminRole: 'Ad Manager',
                        isAdmin: true,
                        membershipType: 'Individual',
                        memberSince: '2024-01-01',
                        expiresOn: '2026-12-31',
                        ecPermissions: ['vendors', 'announcements']
                    }
                },
                // ===== NEW EC ACCOUNTS (Feature 3: VP, Cultural Sec, Puja Coord) =====
                'ec_vp': {
                    password: 'vp123',
                    member: {
                        id: 'ec_vp_001',
                        firstName: 'Debashis',
                        lastName: 'Majumdar',
                        fullName: 'Debashis Majumdar',
                        email: 'vp@banf.org',
                        phone: '(904) 555-2009',
                        role: 'vice_president',
                        roles: ['member', 'ec_member', 'vice_president'],
                        adminRole: 'Vice President',
                        isAdmin: true,
                        membershipType: 'Family',
                        memberSince: '2021-01-01',
                        expiresOn: '2026-12-31',
                        ecPermissions: ['events', 'members', 'meetings', 'budget']
                    }
                },
                'ec_cultural': {
                    password: 'cultural123',
                    member: {
                        id: 'ec_cultural_001',
                        firstName: 'Indrani',
                        lastName: 'Chakraborty',
                        fullName: 'Indrani Chakraborty',
                        email: 'cultural@banf.org',
                        phone: '(904) 555-2010',
                        role: 'cultural_secretary',
                        roles: ['member', 'ec_member', 'cultural_secretary'],
                        adminRole: 'Cultural Secretary',
                        isAdmin: true,
                        membershipType: 'Family',
                        memberSince: '2022-06-01',
                        expiresOn: '2026-12-31',
                        ecPermissions: ['events', 'evite', 'magazine', 'announcements']
                    }
                },
                'ec_puja': {
                    password: 'puja123',
                    member: {
                        id: 'ec_puja_001',
                        firstName: 'Sanjib',
                        lastName: 'Bhattacharya',
                        fullName: 'Sanjib Bhattacharya',
                        email: 'puja@banf.org',
                        phone: '(904) 555-2011',
                        role: 'puja_coord',
                        roles: ['member', 'ec_member', 'puja_coord'],
                        adminRole: 'Puja Coordinator',
                        isAdmin: true,
                        membershipType: 'Family',
                        memberSince: '2023-01-01',
                        expiresOn: '2026-12-31',
                        ecPermissions: ['events', 'volunteers', 'budget']
                    }
                }
            },
            // ===== EVITE / INVITATION DATA =====
            eviteData: {
                invitations: [
                    {
                        id: 'EVT-2026-001',
                        eventName: 'Nabo Borsho 1433',
                        eventDate: '2026-04-25',
                        eventTime: '5:00 PM - 10:00 PM',
                        venue: 'Jacksonville Civic Center',
                        sentDate: '2026-03-15',
                        sentBy: 'ec_events',
                        totalSent: 146,
                        responses: [
                            { memberId: 'demo_001', name: 'Test Member', status: 'attending', adults: 2, kids: 1, dietary: 'Vegetarian', notes: 'Need high chair', respondedAt: '2026-03-16' },
                            { memberId: 'BANF-2024-001', name: 'Rajib Das', status: 'attending', adults: 2, kids: 2, dietary: 'None', notes: '', respondedAt: '2026-03-17' },
                            { memberId: 'BANF-2024-002', name: 'Anita Sharma', status: 'attending', adults: 1, kids: 0, dietary: 'Vegan', notes: 'Gluten-free needed', respondedAt: '2026-03-17' },
                            { memberId: 'BANF-2024-003', name: 'Suman Pal', status: 'not_attending', adults: 0, kids: 0, dietary: '', notes: 'Out of town', respondedAt: '2026-03-18' },
                            { memberId: 'BANF-2024-004', name: 'Ritu Dey', status: 'attending', adults: 3, kids: 1, dietary: 'Halal', notes: '', respondedAt: '2026-03-19' },
                            { memberId: 'BANF-2024-005', name: 'Kamal Bose', status: 'maybe', adults: 2, kids: 0, dietary: 'None', notes: 'Will confirm later', respondedAt: '2026-03-20' },
                            { memberId: 'BANF-2024-006', name: 'Priti Guha', status: 'attending', adults: 2, kids: 3, dietary: 'Vegetarian, Nut-free', notes: 'Peanut allergy', respondedAt: '2026-03-20' }
                        ]
                    },
                    {
                        id: 'EVT-2026-002',
                        eventName: 'Summer Camp 2026',
                        eventDate: '2026-06-15',
                        eventTime: '9:00 AM - 5:00 PM',
                        venue: 'Hanna Park',
                        sentDate: '2026-05-01',
                        sentBy: 'ec_events',
                        totalSent: 80,
                        responses: [
                            { memberId: 'demo_001', name: 'Test Member', status: 'attending', adults: 1, kids: 2, dietary: 'None', notes: 'Bringing board games', respondedAt: '2026-05-02' },
                            { memberId: 'BANF-2024-002', name: 'Anita Sharma', status: 'attending', adults: 1, kids: 0, dietary: 'Vegan', notes: '', respondedAt: '2026-05-03' }
                        ]
                    }
                ],
                templates: [
                    { id: 'TPL-001', name: 'Cultural Event', subject: '🪷 You\'re Invited to {eventName}!', body: 'Dear {memberName},\n\nYou are cordially invited to {eventName} on {eventDate}.\n\nVenue: {venue}\nTime: {eventTime}\n\nPlease RSVP by clicking the link below.\n\nজয় বাংলা!\nBANF Executive Committee' },
                    { id: 'TPL-002', name: 'Meeting', subject: '📋 BANF Meeting Invitation: {eventName}', body: 'Dear {memberName},\n\nPlease join us for {eventName} on {eventDate}.\n\nAgenda will be shared prior to the meeting.\n\nRegards,\nBANF EC' },
                    { id: 'TPL-003', name: 'Picnic/Outing', subject: '🌳 BANF {eventName} - Save the Date!', body: 'Dear {memberName},\n\nJoin us for a fun day out at {eventName}!\n\nDate: {eventDate}\nLocation: {venue}\nTime: {eventTime}\n\nPlease bring your family and friends!\n\nBANF Team' }
                ]
            },
            // ===== MEMBER DIRECTORY DATA =====
            memberDirectory: [
                { id: 'BANF-0001', familyId: 'FAM-2624A6CA', firstName: 'Sajal', lastName: 'Bagchi', email: 'sajal.bagchi@email.com', phone: '(904) 555-1001', type: 'Family', status: 'Inactive', joinDate: '2022-01-15' },
                { id: 'BANF-0002', familyId: 'FAM-1E654AE6', firstName: 'Amitabh', lastName: 'Banerjee', email: 'amitabh.banerjee@email.com', phone: '(904) 555-1002', type: 'Family', status: 'Active', joinDate: '2025-01-15' },
                { id: 'BANF-0003', familyId: 'FAM-1E654AE6', firstName: 'Payel', lastName: 'Banerjee', email: 'payel.banerjee@email.com', phone: '(904) 555-1003', type: 'Family', status: 'Active', joinDate: '2025-01-15' },
                { id: 'BANF-0004', familyId: 'FAM-1E654AE6', firstName: 'Rahul', lastName: 'Banerjee', email: 'rahul.banerjee@email.com', phone: '(904) 555-1004', type: 'Family', status: 'Active', joinDate: '2025-01-15' },
                { id: 'BANF-0005', familyId: 'FAM-1E654AE6', firstName: 'Tanmoy', lastName: 'Banerjee', email: 'tanmoy.banerjee@email.com', phone: '(904) 555-1005', type: 'Family', status: 'Active', joinDate: '2025-01-15' },
                { id: 'BANF-0006', familyId: 'FAM-6FCD7242', firstName: 'Chandrachur', lastName: 'Bannerjee', email: 'chandrachur.bannerjee@email.com', phone: '(904) 555-1006', type: 'Family', status: 'Inactive', joinDate: '2022-01-15' },
                { id: 'BANF-0007', familyId: 'FAM-6FCD7242', firstName: 'Samrat', lastName: 'Bannerjee', email: 'samrat.bannerjee@email.com', phone: '(904) 555-1007', type: 'Family', status: 'Inactive', joinDate: '2022-01-15' },
                { id: 'BANF-0008', familyId: 'FAM-6FCD7242', firstName: 'Varsha', lastName: 'Bannerjee', email: 'varsha.bannerjee@email.com', phone: '(904) 555-1008', type: 'Family', status: 'Inactive', joinDate: '2022-01-15' },
                { id: 'BANF-0009', familyId: 'FAM-2A7A82B3', firstName: 'Shilpi', lastName: 'Bannerji', email: 'shilpi.bannerji@email.com', phone: '(904) 555-1009', type: 'Family', status: 'Inactive', joinDate: '2023-01-15' },
                { id: 'BANF-0010', familyId: 'FAM-C238129A', firstName: 'Barnali', lastName: 'Basu', email: 'barnali.basu@email.com', phone: '(904) 555-1010', type: 'Family', status: 'Inactive', joinDate: '2022-01-15' },
                { id: 'BANF-0011', familyId: 'FAM-C238129A', firstName: 'Purab', lastName: 'Basu', email: 'purab.basu@email.com', phone: '(904) 555-1011', type: 'Family', status: 'Inactive', joinDate: '2022-01-15' },
                { id: 'BANF-0012', familyId: 'FAM-C238129A', firstName: 'Subir', lastName: 'Basu', email: 'subir.basu@email.com', phone: '(904) 555-1012', type: 'Family', status: 'Inactive', joinDate: '2022-01-15' },
                { id: 'BANF-0013', familyId: 'FAM-C238129A', firstName: 'Sunetra', lastName: 'Basu', email: 'sunetra.basu@email.com', phone: '(904) 555-1013', type: 'Family', status: 'Inactive', joinDate: '2022-01-15' },
                { id: 'BANF-0014', familyId: 'FAM-B7C9FE9C', firstName: 'Tanay', lastName: 'Bhaduri', email: 'tanay.bhaduri@email.com', phone: '(904) 555-1014', type: 'Family', status: 'Active', joinDate: '2025-01-15' },
                { id: 'BANF-0015', familyId: 'FAM-B7C9FE9C', firstName: 'Tani', lastName: 'Bhaduri', email: 'tani.bhaduri@email.com', phone: '(904) 555-1015', type: 'Family', status: 'Active', joinDate: '2025-01-15' },
                { id: 'BANF-0016', familyId: 'FAM-178F672B', firstName: 'Kaushiki', lastName: 'Bhattacharya', email: 'kaushiki.bhattacharya@email.com', phone: '(904) 555-1016', type: 'Family', status: 'Inactive', joinDate: '2022-01-15' },
                { id: 'BANF-0017', familyId: 'FAM-178F672B', firstName: 'Santanu', lastName: 'Bhattacharya', email: 'santanu.bhattacharya@email.com', phone: '(904) 555-1017', type: 'Family', status: 'Inactive', joinDate: '2022-01-15' },
                { id: 'BANF-0018', familyId: 'FAM-EAC1A423', firstName: 'Biltu', lastName: 'Bhowmick', email: 'biltu.bhowmick@email.com', phone: '(904) 555-1018', type: 'Family', status: 'Inactive', joinDate: '2022-01-15' },
                { id: 'BANF-0019', familyId: 'FAM-C648F5E0', firstName: 'Dhiman', lastName: 'Biswas', email: 'dhiman.biswas@email.com', phone: '(904) 555-1019', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0020', familyId: 'FAM-C648F5E0', firstName: 'Suchitra', lastName: 'Biswas', email: 'suchitra.biswas@email.com', phone: '(904) 555-1020', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0021', familyId: 'FAM-561EB728', firstName: 'Anita', lastName: 'Chakrabarti', email: 'anita.chakrabarti@email.com', phone: '(904) 555-1021', type: 'Family', status: 'Inactive', joinDate: '2022-01-15' },
                { id: 'BANF-0022', familyId: 'FAM-46A6BE6A', firstName: 'Jay', lastName: 'Chakraborty', email: 'jay.chakraborty@email.com', phone: '(904) 555-1022', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0023', familyId: 'FAM-46A6BE6A', firstName: 'Pallavi', lastName: 'Chakraborty', email: 'pallavi.chakraborty@email.com', phone: '(904) 555-1023', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0024', familyId: 'FAM-46A6BE6A', firstName: 'Souvik', lastName: 'Chakraborty', email: 'souvik.chakraborty@email.com', phone: '(904) 555-1024', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0025', familyId: 'FAM-F9EB367D', firstName: 'Aparna', lastName: 'Chakravarthy', email: 'aparna.chakravarthy@email.com', phone: '(904) 555-1025', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0026', familyId: 'FAM-57E9CF65', firstName: 'Surajit', lastName: 'Chakravarty', email: 'surajit.chakravarty@email.com', phone: '(904) 555-1026', type: 'Family', status: 'Inactive', joinDate: '2022-01-15' },
                { id: 'BANF-0027', familyId: 'FAM-B67E34F9', firstName: 'Amit', lastName: 'Chandak', email: 'amit.chandak@email.com', phone: '(904) 555-1027', type: 'Family', status: 'Active', joinDate: '2025-01-15' },
                { id: 'BANF-0028', familyId: 'FAM-1D204FDE', firstName: 'Jiniya', lastName: 'Chandra', email: 'jiniya.chandra@email.com', phone: '(904) 555-1028', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0029', familyId: 'FAM-1D204FDE', firstName: 'Nilay', lastName: 'Chandra', email: 'nilay.chandra@email.com', phone: '(904) 555-1029', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0030', familyId: 'FAM-1D204FDE', firstName: 'Sanjukta', lastName: 'Chandra', email: 'sanjukta.chandra@email.com', phone: '(904) 555-1030', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0031', familyId: 'FAM-4ADC227C', firstName: 'Supriya', lastName: 'Chaterjee', email: 'supriya.chaterjee@email.com', phone: '(904) 555-1031', type: 'Family', status: 'Inactive', joinDate: '2024-01-15' },
                { id: 'BANF-0032', familyId: 'FAM-045C088E', firstName: 'Chiradip', lastName: 'Chatterjee', email: 'chiradip.chatterjee@email.com', phone: '(904) 555-1032', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0033', familyId: 'FAM-045C088E', firstName: 'Subhra', lastName: 'Chatterjee', email: 'subhra.chatterjee@email.com', phone: '(904) 555-1033', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0034', familyId: 'FAM-045C088E', firstName: 'Supriya', lastName: 'Chatterjee', email: 'supriya.chatterjee@email.com', phone: '(904) 555-1034', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0035', familyId: 'FAM-07E9DC4A', firstName: 'Asok', lastName: 'Chaudhuri', email: 'asok.chaudhuri@email.com', phone: '(904) 555-1035', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0036', familyId: 'FAM-486E4AB1', firstName: 'Jyoti', lastName: 'Choudhury', email: 'jyoti.choudhury@email.com', phone: '(904) 555-1036', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0037', familyId: 'FAM-486E4AB1', firstName: 'Partha', lastName: 'Choudhury', email: 'partha.choudhury@email.com', phone: '(904) 555-1037', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0038', familyId: 'FAM-486E4AB1', firstName: 'Rwiti', lastName: 'Choudhury', email: 'rwiti.choudhury@email.com', phone: '(904) 555-1038', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0039', familyId: 'FAM-486E4AB1', firstName: 'Soma', lastName: 'Choudhury', email: 'soma.choudhury@email.com', phone: '(904) 555-1039', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0040', familyId: 'FAM-76312069', firstName: 'Bidhan', lastName: 'Das', email: 'bidhan.das@email.com', phone: '(904) 555-1040', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0041', familyId: 'FAM-76312069', firstName: 'Diyasini', lastName: 'Das', email: 'diyasini.das@email.com', phone: '(904) 555-1041', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0042', familyId: 'FAM-76312069', firstName: 'Reshma', lastName: 'Das', email: 'reshma.das@email.com', phone: '(904) 555-1042', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0043', familyId: 'FAM-76312069', firstName: 'Saugata', lastName: 'Das', email: 'saugata.das@email.com', phone: '(904) 555-1043', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0044', familyId: 'FAM-76312069', firstName: 'Suman', lastName: 'Das', email: 'suman.das@email.com', phone: '(904) 555-1044', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0045', familyId: 'FAM-76312069', firstName: 'Tanmay', lastName: 'Das', email: 'tanmay.das@email.com', phone: '(904) 555-1045', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0046', familyId: 'FAM-76312069', firstName: 'Tanmoy', lastName: 'Das', email: 'tanmoy.das@email.com', phone: '(904) 555-1046', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0047', familyId: 'FAM-6502F9DB', firstName: 'Banani', lastName: 'Dhar', email: 'banani.dhar@email.com', phone: '(904) 555-1047', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0048', familyId: 'FAM-6502F9DB', firstName: 'Bhupal', lastName: 'Dhar', email: 'bhupal.dhar@email.com', phone: '(904) 555-1048', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0049', familyId: 'FAM-39025B22', firstName: 'Ayan', lastName: 'Dutta', email: 'ayan.dutta@email.com', phone: '(904) 555-1049', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0050', familyId: 'FAM-39025B22', firstName: 'Debu', lastName: 'Dutta', email: 'debu.dutta@email.com', phone: '(904) 555-1050', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0051', familyId: 'FAM-39025B22', firstName: 'Indrani', lastName: 'Dutta', email: 'indrani.dutta@email.com', phone: '(904) 555-1051', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0052', familyId: 'FAM-39025B22', firstName: 'Nandini', lastName: 'Dutta', email: 'nandini.dutta@email.com', phone: '(904) 555-1052', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0053', familyId: 'FAM-39025B22', firstName: 'Nandita', lastName: 'Dutta', email: 'nandita.dutta@email.com', phone: '(904) 555-1053', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0054', familyId: 'FAM-39025B22', firstName: 'Shridham', lastName: 'Dutta', email: 'shridham.dutta@email.com', phone: '(904) 555-1054', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0055', familyId: 'FAM-39025B22', firstName: 'Soumali', lastName: 'Dutta', email: 'soumali.dutta@email.com', phone: '(904) 555-1055', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0056', familyId: 'FAM-39025B22', firstName: 'Soumyajit', lastName: 'Dutta', email: 'soumyajit.dutta@email.com', phone: '(904) 555-1056', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0057', familyId: 'FAM-39025B22', firstName: 'Urmi', lastName: 'Dutta', email: 'urmi.dutta@email.com', phone: '(904) 555-1057', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0058', familyId: 'FAM-2E1CEE29', firstName: 'Anirban', lastName: 'Ghosh', email: 'anirban.ghosh@email.com', phone: '(904) 555-1058', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0059', familyId: 'FAM-2E1CEE29', firstName: 'Chandrani', lastName: 'Ghosh', email: 'chandrani.ghosh@email.com', phone: '(904) 555-1059', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0060', familyId: 'FAM-2E1CEE29', firstName: 'Dipra', lastName: 'Ghosh', email: 'dipra.ghosh@email.com', phone: '(904) 555-1060', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0061', familyId: 'FAM-2E1CEE29', firstName: 'Liton', lastName: 'Ghosh', email: 'liton.ghosh@email.com', phone: '(904) 555-1061', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0062', familyId: 'FAM-2E1CEE29', firstName: 'Moumita', lastName: 'Ghosh', email: 'moumita.ghosh@email.com', phone: '(904) 555-1062', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0063', familyId: 'FAM-2E1CEE29', firstName: 'Priyanka', lastName: 'Ghosh', email: 'priyanka.ghosh@email.com', phone: '(904) 555-1063', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0064', familyId: 'FAM-2E1CEE29', firstName: 'Rajanya', lastName: 'Ghosh', email: 'rajanya.ghosh@email.com', phone: '(904) 555-1064', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0065', familyId: 'FAM-2E1CEE29', firstName: 'Ranadhir', lastName: 'Ghosh', email: 'ranadhir.ghosh@email.com', phone: '(904) 555-1065', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0066', familyId: 'FAM-2E1CEE29', firstName: 'Roopkatha', lastName: 'Ghosh', email: 'roopkatha.ghosh@email.com', phone: '(904) 555-1066', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0067', familyId: 'FAM-2E1CEE29', firstName: 'Sreya', lastName: 'Ghosh', email: 'sreya.ghosh@email.com', phone: '(904) 555-1067', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0068', familyId: 'FAM-2E1CEE29', firstName: 'Subrata', lastName: 'Ghosh', email: 'subrata.ghosh@email.com', phone: '(904) 555-1068', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0069', familyId: 'FAM-2E1CEE29', firstName: 'Suman', lastName: 'Ghosh', email: 'suman.ghosh@email.com', phone: '(904) 555-1069', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0070', familyId: 'FAM-2E1CEE29', firstName: 'Sumanta', lastName: 'Ghosh', email: 'sumanta.ghosh@email.com', phone: '(904) 555-1070', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0071', familyId: 'FAM-E6D1FDB1', firstName: 'Holly', lastName: 'Goswami', email: 'holly.goswami@email.com', phone: '(904) 555-1071', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0072', familyId: 'FAM-E6D1FDB1', firstName: 'Raj', lastName: 'Goswami', email: 'raj.goswami@email.com', phone: '(904) 555-1072', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0073', familyId: 'FAM-CE6FFBBA', firstName: 'Paulami', lastName: 'Guha', email: 'paulami.guha@email.com', phone: '(904) 555-1073', type: 'Family', status: 'Inactive', joinDate: '2022-01-15' },
                { id: 'BANF-0074', familyId: 'FAM-179E776E', firstName: 'Anjali', lastName: 'Gupta', email: 'anjali.gupta@email.com', phone: '(904) 555-1074', type: 'Family', status: 'Inactive', joinDate: '2022-01-15' },
                { id: 'BANF-0075', familyId: 'FAM-11F05085', firstName: 'Keya', lastName: 'Jatkar', email: 'keya.jatkar@email.com', phone: '(904) 555-1075', type: 'Family', status: 'Active', joinDate: '2025-01-15' },
                { id: 'BANF-0076', familyId: 'FAM-13749BB9', firstName: 'Bithika', lastName: 'Karmakar', email: 'bithika.karmakar@email.com', phone: '(904) 555-1076', type: 'Family', status: 'Inactive', joinDate: '2022-01-15' },
                { id: 'BANF-0077', familyId: 'FAM-13749BB9', firstName: 'Kaushik', lastName: 'Karmakar', email: 'kaushik.karmakar@email.com', phone: '(904) 555-1077', type: 'Family', status: 'Inactive', joinDate: '2022-01-15' },
                { id: 'BANF-0078', familyId: 'FAM-B53C8357', firstName: 'Mummun', lastName: 'Maitra', email: 'mummun.maitra@email.com', phone: '(904) 555-1078', type: 'Family', status: 'Inactive', joinDate: '2022-01-15' },
                { id: 'BANF-0079', familyId: 'FAM-C11E726C', firstName: 'Lopita', lastName: 'Majumdar', email: 'lopita.majumdar@email.com', phone: '(904) 555-1079', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0080', familyId: 'FAM-C11E726C', firstName: 'Rajarshi', lastName: 'Majumdar', email: 'rajarshi.majumdar@email.com', phone: '(904) 555-1080', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0081', familyId: 'FAM-F7508B48', firstName: 'Atmadeep', lastName: 'Majumder', email: 'atmadeep.majumder@email.com', phone: '(904) 555-1081', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0082', familyId: 'FAM-F7508B48', firstName: 'Madhumita', lastName: 'Majumder', email: 'madhumita.majumder@email.com', phone: '(904) 555-1082', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0083', familyId: 'FAM-B2665A3D', firstName: 'Anita', lastName: 'Mandal', email: 'anita.mandal@email.com', phone: '(904) 555-1083', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0084', familyId: 'FAM-B2665A3D', firstName: 'Mousumi', lastName: 'Mandal', email: 'mousumi.mandal@email.com', phone: '(904) 555-1084', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0085', familyId: 'FAM-B2665A3D', firstName: 'Subrata', lastName: 'Mandal', email: 'subrata.mandal@email.com', phone: '(904) 555-1085', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0086', familyId: 'FAM-3C65088A', firstName: 'Alak', lastName: 'Manna', email: 'alak.manna@email.com', phone: '(904) 555-1086', type: 'Family', status: 'Active', joinDate: '2025-01-15' },
                { id: 'BANF-0087', familyId: 'FAM-82CD440F', firstName: 'Avishek', lastName: 'Mitra', email: 'avishek.mitra@email.com', phone: '(904) 555-1087', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0088', familyId: 'FAM-82CD440F', firstName: 'Moumita', lastName: 'Mitra', email: 'moumita.mitra@email.com', phone: '(904) 555-1088', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0089', familyId: 'FAM-B43EA6D7', firstName: 'Moushumi', lastName: 'Mondal', email: 'moushumi.mondal@email.com', phone: '(904) 555-1089', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0090', familyId: 'FAM-B43EA6D7', firstName: 'Subrata', lastName: 'Mondal', email: 'subrata.mondal@email.com', phone: '(904) 555-1090', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0091', familyId: 'FAM-B43EA6D7', firstName: 'Tarit', lastName: 'Mondal', email: 'tarit.mondal@email.com', phone: '(904) 555-1091', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0092', familyId: 'FAM-045C088E', firstName: 'Barnali', lastName: 'Mondol', email: 'barnali.mondol@email.com', phone: '(904) 555-1092', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0093', familyId: 'FAM-4F32B5C0', firstName: 'Amrita', lastName: 'Mukherjee', email: 'amrita.mukherjee@email.com', phone: '(904) 555-1093', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0094', familyId: 'FAM-4F32B5C0', firstName: 'Annindita', lastName: 'Mukherjee', email: 'annindita.mukherjee@email.com', phone: '(904) 555-1094', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0095', familyId: 'FAM-4F32B5C0', firstName: 'Depanjan', lastName: 'Mukherjee', email: 'depanjan.mukherjee@email.com', phone: '(904) 555-1095', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0096', familyId: 'FAM-4F32B5C0', firstName: 'Latika', lastName: 'Mukherjee', email: 'latika.mukherjee@email.com', phone: '(904) 555-1096', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0097', familyId: 'FAM-4F32B5C0', firstName: 'Partha', lastName: 'Mukherjee', email: 'partha.mukherjee@email.com', phone: '(904) 555-1097', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0098', familyId: 'FAM-5761E0CE', firstName: 'Partha', lastName: 'Mukhopadhyay', email: 'partha.mukhopadhyay@email.com', phone: '(904) 555-1098', type: 'Family', status: 'Active', joinDate: '2025-01-15' },
                { id: 'BANF-0099', familyId: 'FAM-A464AEAF', firstName: 'Saikat', lastName: 'Natta', email: 'saikat.natta@email.com', phone: '(904) 555-1099', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0100', familyId: 'FAM-13E7DBA7', firstName: 'Joyeeta', lastName: 'Pal', email: 'joyeeta.pal@email.com', phone: '(904) 555-1100', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0101', familyId: 'FAM-13E7DBA7', firstName: 'Krishnendu', lastName: 'Pal', email: 'krishnendu.pal@email.com', phone: '(904) 555-1101', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0102', familyId: 'FAM-13E7DBA7', firstName: 'Paromita', lastName: 'Pal', email: 'paromita.pal@email.com', phone: '(904) 555-1102', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0103', familyId: 'FAM-13E7DBA7', firstName: 'Sourav', lastName: 'Pal', email: 'sourav.pal@email.com', phone: '(904) 555-1103', type: 'Family', status: 'Active', joinDate: '2025-01-15' },
                { id: 'BANF-0104', familyId: 'FAM-13E7DBA7', firstName: 'Sumit', lastName: 'Pal', email: 'sumit.pal@email.com', phone: '(904) 555-1104', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0105', familyId: 'FAM-13E7DBA7', firstName: 'Suvankar', lastName: 'Pal', email: 'suvankar.pal@email.com', phone: '(904) 555-1105', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0106', familyId: 'FAM-271D134E', firstName: 'Suvankal', lastName: 'Paul', email: 'suvankal.paul@email.com', phone: '(904) 555-1106', type: 'Family', status: 'Active', joinDate: '2025-01-15' },
                { id: 'BANF-0107', familyId: 'FAM-19C4E90A', firstName: 'Jitendra', lastName: 'Prusty', email: 'jitendra.prusty@email.com', phone: '(904) 555-1107', type: 'Family', status: 'Inactive', joinDate: '2024-01-15' },
                { id: 'BANF-0108', familyId: 'FAM-C1523DDC', firstName: 'Dia', lastName: 'Ray', email: 'dia.ray@email.com', phone: '(904) 555-1108', type: 'Family', status: 'Inactive', joinDate: '2022-01-15' },
                { id: 'BANF-0109', familyId: 'FAM-C1523DDC', firstName: 'Souvik', lastName: 'Ray', email: 'souvik.ray@email.com', phone: '(904) 555-1109', type: 'Family', status: 'Inactive', joinDate: '2022-01-15' },
                { id: 'BANF-0110', familyId: 'FAM-39D036C3', firstName: 'Bhaskar', lastName: 'Roy', email: 'bhaskar.roy@email.com', phone: '(904) 555-1110', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0111', familyId: 'FAM-39D036C3', firstName: 'Debasmita', lastName: 'Roy', email: 'debasmita.roy@email.com', phone: '(904) 555-1111', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0112', familyId: 'FAM-39D036C3', firstName: 'Dipak', lastName: 'Roy', email: 'dipak.roy@email.com', phone: '(904) 555-1112', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0113', familyId: 'FAM-39D036C3', firstName: 'Ipsita', lastName: 'Roy', email: 'ipsita.roy@email.com', phone: '(904) 555-1113', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0114', familyId: 'FAM-39D036C3', firstName: 'Mitu', lastName: 'Roy', email: 'mitu.roy@email.com', phone: '(904) 555-1114', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0115', familyId: 'FAM-39D036C3', firstName: 'Nabo', lastName: 'Roy', email: 'nabo.roy@email.com', phone: '(904) 555-1115', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0116', familyId: 'FAM-39D036C3', firstName: 'Padmoja', lastName: 'Roy', email: 'padmoja.roy@email.com', phone: '(904) 555-1116', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0117', familyId: 'FAM-39D036C3', firstName: 'Sanat', lastName: 'Roy', email: 'sanat.roy@email.com', phone: '(904) 555-1117', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0118', familyId: 'FAM-39D036C3', firstName: 'Sanhita', lastName: 'Roy', email: 'sanhita.roy@email.com', phone: '(904) 555-1118', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0119', familyId: 'FAM-39D036C3', firstName: 'Sayani', lastName: 'Roy', email: 'sayani.roy@email.com', phone: '(904) 555-1119', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0120', familyId: 'FAM-39D036C3', firstName: 'Sonu', lastName: 'Roy', email: 'sonu.roy@email.com', phone: '(904) 555-1120', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0121', familyId: 'FAM-39D036C3', firstName: 'Subhro', lastName: 'Roy', email: 'subhro.roy@email.com', phone: '(904) 555-1121', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0122', familyId: 'FAM-39D036C3', firstName: 'Sudip', lastName: 'Roy', email: 'sudip.roy@email.com', phone: '(904) 555-1122', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0123', familyId: 'FAM-39D036C3', firstName: 'Suvro', lastName: 'Roy', email: 'suvro.roy@email.com', phone: '(904) 555-1123', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0124', familyId: 'FAM-39D036C3', firstName: 'Swapnoneel', lastName: 'Roy', email: 'swapnoneel.roy@email.com', phone: '(904) 555-1124', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0125', familyId: 'FAM-39D036C3', firstName: 'Tapas', lastName: 'Roy', email: 'tapas.roy@email.com', phone: '(904) 555-1125', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0126', familyId: 'FAM-7383B39B', firstName: 'Saurav', lastName: 'Roychoudhury', email: 'saurav.roychoudhury@email.com', phone: '(904) 555-1126', type: 'Family', status: 'Active', joinDate: '2025-01-15' },
                { id: 'BANF-0127', familyId: 'FAM-7383B39B', firstName: 'Sourav', lastName: 'Roychoudhury', email: 'sourav.roychoudhury@email.com', phone: '(904) 555-1127', type: 'Family', status: 'Active', joinDate: '2025-01-15' },
                { id: 'BANF-0128', familyId: 'FAM-83D8EA90', firstName: 'Kapil', lastName: 'Sadhu', email: 'kapil.sadhu@email.com', phone: '(904) 555-1128', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0129', familyId: 'FAM-83D8EA90', firstName: 'Sanghamitra', lastName: 'Sadhu', email: 'sanghamitra.sadhu@email.com', phone: '(904) 555-1129', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0130', familyId: 'FAM-D81B5923', firstName: 'Amit', lastName: 'Saha', email: 'amit.saha@email.com', phone: '(904) 555-1130', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0131', familyId: 'FAM-D81B5923', firstName: 'Debabrata', lastName: 'Saha', email: 'debabrata.saha@email.com', phone: '(904) 555-1131', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0132', familyId: 'FAM-D81B5923', firstName: 'Mukul', lastName: 'Saha', email: 'mukul.saha@email.com', phone: '(904) 555-1132', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0133', familyId: 'FAM-D81B5923', firstName: 'Papri', lastName: 'Saha', email: 'papri.saha@email.com', phone: '(904) 555-1133', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0134', familyId: 'FAM-8C6DE0D1', firstName: 'Arnab', lastName: 'Sanyal', email: 'arnab.sanyal@email.com', phone: '(904) 555-1134', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0135', familyId: 'FAM-8C6DE0D1', firstName: 'Sudeshna', lastName: 'Sanyal', email: 'sudeshna.sanyal@email.com', phone: '(904) 555-1135', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0136', familyId: 'FAM-23975513', firstName: 'Baidya', lastName: 'Sarkar', email: 'baidya.sarkar@email.com', phone: '(904) 555-1136', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0137', familyId: 'FAM-23975513', firstName: 'Mita', lastName: 'Sarkar', email: 'mita.sarkar@email.com', phone: '(904) 555-1137', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0138', familyId: 'FAM-2E1CEE29', firstName: 'Swarnendu', lastName: 'Sen', email: 'swarnendu.sen@email.com', phone: '(904) 555-1138', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0139', familyId: 'FAM-71891E07', firstName: 'Rajib', lastName: 'Sengupta', email: 'rajib.sengupta@email.com', phone: '(904) 555-1139', type: 'Family', status: 'Inactive', joinDate: '2022-01-15' },
                { id: 'BANF-0140', familyId: 'FAM-71891E07', firstName: 'Rita', lastName: 'Sengupta', email: 'rita.sengupta@email.com', phone: '(904) 555-1140', type: 'Family', status: 'Inactive', joinDate: '2022-01-15' },
                { id: 'BANF-0141', familyId: 'FAM-4C9F3F2C', firstName: 'Jigar', lastName: 'Shah', email: 'jigar.shah@email.com', phone: '(904) 555-1141', type: 'Family', status: 'Inactive', joinDate: '2024-01-15' },
                { id: 'BANF-0142', familyId: 'FAM-D234EAFA', firstName: 'Madhu', lastName: 'Sindhuvalli', email: 'madhu.sindhuvalli@email.com', phone: '(904) 555-1142', type: 'Family', status: 'Active', joinDate: '2025-01-15' },
                { id: 'BANF-0143', familyId: 'FAM-2E0E1EC3', firstName: 'Dola', lastName: 'Sinha', email: 'dola.sinha@email.com', phone: '(904) 555-1143', type: 'Family', status: 'Inactive', joinDate: '2023-01-15' },
                { id: 'BANF-0144', familyId: 'FAM-2E0E1EC3', firstName: 'Ujjal', lastName: 'Sinha', email: 'ujjal.sinha@email.com', phone: '(904) 555-1144', type: 'Family', status: 'Inactive', joinDate: '2023-01-15' },
                { id: 'BANF-0145', familyId: 'FAM-EFFE048D', firstName: 'Nilanjana', lastName: 'Snyder', email: 'nilanjana.snyder@email.com', phone: '(904) 555-1145', type: 'Family', status: 'Active', joinDate: '2022-01-15' },
                { id: 'BANF-0146', familyId: 'FAM-1BBD53D7', firstName: 'Shivani', lastName: 'Tomasovitch', email: 'shivani.tomasovitch@email.com', phone: '(904) 555-1146', type: 'Family', status: 'Inactive', joinDate: '2022-01-15' }
            ],
            // Demo registration data
            pendingRegistrations: {},
            registrationCodeCounter: 100000
        };
        
        // Alias for compatibility
        const DemoData = window.DemoData;
        console.log('✅ DemoData initialized:', Object.keys(DemoData.testAccounts));

        // ========== MEMBERSHIP & FAMILY MANAGEMENT SYSTEM ==========
        /**
         * Comprehensive year-wise membership under EC terms
         * - EC Terms: 26-28, 28-30, etc. (2-year terms)
         * - Membership Years: 2026-2027, 2027-2028, etc.
         * - Family Universe: Immutable family IDs with mutable member lists
         * - Membership IDs: Unique per year per membership unit upon payment
         */
        const MembershipManager = {
            STORAGE_KEY: 'banf_membership_data',
            
            // EC Terms configuration
            ecTerms: {
                '26-28': { start: 2026, end: 2028, label: 'EC 2026-2028', current: true },
                '28-30': { start: 2028, end: 2030, label: 'EC 2028-2030', current: false }
            },
            
            // Membership tiers with pricing
            tiers: {
                student:    { name: 'Student',        amount: 165, earlyBird: null,  icon: 'fas fa-graduation-cap', color: '#17a2b8' },
                individual: { name: 'Individual Premium', amount: 240, earlyBird: null,  icon: 'fas fa-user',           color: '#6c757d' },
                couple:     { name: 'Couple',         amount: 330, earlyBird: null,  icon: 'fas fa-heart',          color: '#6f42c1' },
                family:     { name: 'Family Premium', amount: 410, earlyBird: 375,   icon: 'fas fa-users',          color: '#e67e22' }
            },
            
            // Current context
            currentECTerm: '26-28',
            currentMembershipYear: '2026-2027',
            
            // Data stores (persisted to localStorage)
            data: {
                families: {},          // familyId → { id, name, members[], createdAt, createdBy }
                memberships: {},       // membershipId → { id, familyId, tier, year, ecTerm, paidAmount, paymentDate, paymentMethod, paymentRef, addedBy, futureDate, status }
                adminNotes: [],        // { id, targetType, targetId, note, addedBy, addedAt }
                familyIdCounter: 1000,
                membershipIdCounter: 1
            },
            
            init() {
                this.load();
                this.normalizeData();
                if (Object.keys(this.data.families).length === 0) this._seedDemoData();
                console.log('✅ MembershipManager initialized:', Object.keys(this.data.families).length, 'families');
            },
            
            load() {
                try {
                    const saved = localStorage.getItem(this.STORAGE_KEY);
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        this.data = { ...this.data, ...parsed };
                    }
                } catch(e) { console.warn('[Membership] Load failed:', e); }
            },
            
            save() {
                try {
                    localStorage.setItem(this.STORAGE_KEY, JSON.stringify(this.data));
                } catch(e) { console.error('[Membership] Save failed:', e); }
            },

            // Backward compatibility alias used by UI code
            _save() {
                this.save();
            },

            normalizeData() {
                // Families
                Object.keys(this.data.families || {}).forEach(fid => {
                    const f = this.data.families[fid] || {};
                    f.id = f.id || fid;
                    f.familyId = f.familyId || f.id || fid;
                    f.members = Array.isArray(f.members) ? f.members : [];

                    f.members = f.members.map((m, idx) => {
                        const relationship = (m.relationship || (idx === 0 ? 'head' : 'member')).toString().toLowerCase();
                        const firstName = m.firstName || (m.name ? String(m.name).split(' ').slice(0, -1).join(' ') : '') || '';
                        const lastName = m.lastName || (m.name ? String(m.name).split(' ').slice(-1).join(' ') : '') || '';
                        const name = (m.name || `${firstName} ${lastName}`).trim();
                        return {
                            ...m,
                            id: m.id || `${f.familyId}-M${idx + 1}`,
                            firstName,
                            lastName,
                            name,
                            relationship,
                            addedAt: m.addedAt || m.createdAt || new Date().toISOString()
                        };
                    });

                    if (!f.headName) {
                        const head = f.members.find(m => m.relationship === 'head') || f.members[0];
                        f.headName = head?.name || '';
                    }

                    this.data.families[fid] = f;
                });

                // Memberships
                Object.keys(this.data.memberships || {}).forEach(mid => {
                    const m = this.data.memberships[mid] || {};
                    m.id = m.id || mid;
                    m.membershipId = m.membershipId || m.id || mid;
                    m.amountPaid = Number(m.amountPaid ?? m.paidAmount ?? 0);
                    m.paidAmount = Number(m.paidAmount ?? m.amountPaid ?? 0);
                    m.status = m.status || 'active';
                    this.data.memberships[mid] = m;
                });

                // Notes
                this.data.adminNotes = (this.data.adminNotes || []).map(n => ({
                    ...n,
                    date: n.date || n.addedAt || new Date().toISOString(),
                    addedAt: n.addedAt || n.date || new Date().toISOString()
                }));

                this.save();
            },
            
            // ---- Family Universe Management ----
            generateFamilyId() {
                this.data.familyIdCounter++;
                return `FAM-${String(this.data.familyIdCounter).padStart(5, '0')}`;
            },
            
            createFamily(headName, members, createdBy) {
                // Backward-compatible signatures:
                // 1) createFamily(headName, membersArray, createdBy)
                // 2) createFamily(headName, headEmail, headPhone, additionalMembersArray)
                let normalizedMembers = [];
                let createdByUser = createdBy;

                if (Array.isArray(members)) {
                    normalizedMembers = members;
                } else {
                    const headEmail = typeof members === 'string' ? members : '';
                    const headPhone = typeof createdBy === 'string' ? createdBy : '';
                    const additional = Array.isArray(arguments[3]) ? arguments[3] : [];
                    createdByUser = 'admin';
                    normalizedMembers = [{
                        firstName: String(headName || '').split(' ')[0] || '',
                        lastName: String(headName || '').split(' ').slice(1).join(' '),
                        name: headName || '',
                        email: headEmail || '',
                        phone: headPhone || '',
                        relationship: 'head'
                    }, ...additional];
                }

                const familyId = this.generateFamilyId();
                this.data.families[familyId] = {
                    id: familyId,
                    familyId: familyId,
                    headName: headName,
                    members: normalizedMembers.map((m, i) => {
                        const relationship = (m.relationship || (i === 0 ? 'head' : 'member')).toString().toLowerCase();
                        const firstName = m.firstName || (m.name ? String(m.name).split(' ').slice(0, -1).join(' ') : '') || '';
                        const lastName = m.lastName || (m.name ? String(m.name).split(' ').slice(-1).join(' ') : '') || '';
                        const name = (m.name || `${firstName} ${lastName}`).trim();
                        return ({
                        id: `${familyId}-M${i + 1}`,
                        firstName,
                        lastName,
                        name,
                        email: m.email || '',
                        phone: m.phone || '',
                        relationship,
                        dob: m.dob || '',
                        addedAt: new Date().toISOString()
                    })}),
                    createdAt: new Date().toISOString(),
                    createdBy: createdByUser || 'admin',
                    updatedAt: new Date().toISOString()
                };
                this.save();
                return familyId;
            },
            
            getFamily(familyId) {
                return this.data.families[familyId] || null;
            },
            
            updateFamilyMember(familyId, memberId, updates) {
                const family = this.data.families[familyId];
                if (!family) return false;
                const member = typeof memberId === 'number'
                    ? family.members[memberId]
                    : family.members.find(m => m.id === memberId);
                if (!member) return false;
                Object.assign(member, updates, { updatedAt: new Date().toISOString() });
                if (updates?.name) {
                    const parts = String(updates.name).trim().split(' ');
                    member.firstName = parts[0] || member.firstName || '';
                    member.lastName = parts.slice(1).join(' ') || member.lastName || '';
                } else {
                    member.name = (member.name || `${member.firstName || ''} ${member.lastName || ''}`).trim();
                }
                member.relationship = (member.relationship || 'member').toString().toLowerCase();
                family.updatedAt = new Date().toISOString();
                this.save();
                return true;
            },
            
            addFamilyMember(familyId, memberData) {
                const family = this.data.families[familyId];
                if (!family) return null;

                // Backward-compatible signatures:
                // addFamilyMember(familyId, memberDataObj)
                // addFamilyMember(familyId, name, relationship, email, phone)
                let payload;
                if (typeof memberData === 'object' && memberData !== null) {
                    payload = memberData;
                } else {
                    payload = {
                        name: memberData || '',
                        relationship: arguments[2] || 'member',
                        email: arguments[3] || '',
                        phone: arguments[4] || ''
                    };
                }

                const firstName = payload.firstName || (payload.name ? String(payload.name).split(' ').slice(0, -1).join(' ') : '') || '';
                const lastName = payload.lastName || (payload.name ? String(payload.name).split(' ').slice(-1).join(' ') : '') || '';
                const name = (payload.name || `${firstName} ${lastName}`).trim();
                const memberId = `${familyId}-M${family.members.length + 1}`;
                const newMember = {
                    id: memberId,
                    firstName,
                    lastName,
                    name,
                    email: payload.email || '',
                    phone: payload.phone || '',
                    relationship: (payload.relationship || 'member').toString().toLowerCase(),
                    dob: payload.dob || '',
                    addedAt: new Date().toISOString()
                };
                family.members.push(newMember);
                family.updatedAt = new Date().toISOString();
                this.save();
                return memberId;
            },
            
            removeFamilyMember(familyId, memberId) {
                const family = this.data.families[familyId];
                if (!family) return false;
                const idx = typeof memberId === 'number'
                    ? memberId
                    : family.members.findIndex(m => m.id === memberId);
                if (idx < 0) return false;
                family.members.splice(idx, 1);
                family.updatedAt = new Date().toISOString();
                this.save();
                return true;
            },
            
            transferMemberToNewFamily(sourceFamilyId, memberId, newFamilyHeadName) {
                const sourceFamily = this.data.families[sourceFamilyId];
                if (!sourceFamily) return null;
                const member = typeof memberId === 'number'
                    ? sourceFamily.members[memberId]
                    : sourceFamily.members.find(m => m.id === memberId);
                if (!member) return null;
                // Create new family with this member as head
                const newFamilyId = this.createFamily(newFamilyHeadName || `${member.firstName} ${member.lastName}`, [{
                    firstName: member.firstName, lastName: member.lastName,
                    email: member.email, phone: member.phone, relationship: 'Head'
                }], 'admin-transfer');
                // Remove from old family
                this.removeFamilyMember(sourceFamilyId, memberId);
                this.addAdminNote('family', sourceFamilyId, `Member ${member.firstName} ${member.lastName} transferred to new family ${newFamilyId}`, 'system');
                this.addAdminNote('family', newFamilyId, `Family created via transfer from ${sourceFamilyId}`, 'system');
                return { familyId: newFamilyId };
            },
            
            getAllFamilies() {
                return Object.values(this.data.families).map(f => ({ ...f, familyId: f.familyId || f.id }));
            },
            
            // ---- Membership Management ----
            generateMembershipId(year) {
                this.data.membershipIdCounter++;
                const yr = year.split('-')[0];
                return `BANF-${yr}-${String(this.data.membershipIdCounter).padStart(4, '0')}`;
            },
            
            createMembership(familyId, tier, paymentDetails, addedBy) {
                // Backward-compatible signatures:
                // 1) createMembership(familyId, tier, paymentDetailsObj, addedBy)
                // 2) createMembership(familyId, year, tier, amount, paymentDate, paymentMethod, ecTerm)
                let year = this.currentMembershipYear;
                let tierVal = tier;
                let details = paymentDetails;
                let addedByUser = addedBy;
                let ecTerm = this.currentECTerm;

                if (typeof paymentDetails !== 'object' || paymentDetails === null) {
                    year = tier || this.currentMembershipYear;
                    tierVal = arguments[2];
                    details = {
                        amount: arguments[3],
                        date: arguments[4],
                        method: arguments[5],
                        futureDate: null,
                        ref: ''
                    };
                    ecTerm = arguments[6] || this.currentECTerm;
                    addedByUser = 'admin';
                }

                const membershipId = this.generateMembershipId(year);
                
                this.data.memberships[membershipId] = {
                    id: membershipId,
                    membershipId: membershipId,
                    familyId: familyId,
                    tier: tierVal,
                    year: year,
                    ecTerm: ecTerm,
                    paidAmount: details?.amount || this.tiers[tierVal]?.amount || 0,
                    amountPaid: details?.amount || this.tiers[tierVal]?.amount || 0,
                    paymentDate: details?.date || new Date().toISOString().split('T')[0],
                    paymentMethod: details?.method || 'Zelle',
                    paymentRef: details?.ref || '',
                    addedBy: addedByUser || 'admin',
                    futureDate: details?.futureDate || null,  // President/VP discretionary
                    status: details?.futureDate ? 'pending_future' : 'active',
                    createdAt: new Date().toISOString()
                };
                this.save();
                return this.data.memberships[membershipId];
            },
            
            getMembership(membershipId) {
                return this.data.memberships[membershipId] || null;
            },
            
            getMembershipsByFamily(familyId, year) {
                return Object.values(this.data.memberships).filter(m => 
                    m.familyId === familyId && (!year || m.year === year)
                );
            },
            
            getMembershipsByYear(year) {
                return Object.values(this.data.memberships).filter(m => m.year === (year || this.currentMembershipYear));
            },
            
            getMembershipsByECTerm(ecTerm) {
                return Object.values(this.data.memberships).filter(m => m.ecTerm === (ecTerm || this.currentECTerm));
            },
            
            isFamilyMemberCurrentYear(familyId, year) {
                const memberships = this.getMembershipsByFamily(familyId, year || this.currentMembershipYear);
                return memberships.some(m => m.status === 'active' || m.status === 'pending_future');
            },
            
            // ---- Admin Notes ----
            addAdminNote(targetType, targetId, note, addedBy) {
                const noteId = `NOTE-${Date.now()}-${Math.random().toString(36).substr(2, 4)}`;
                this.data.adminNotes.push({
                    id: noteId,
                    targetType: targetType,  // 'family' | 'member' | 'membership'
                    targetId: targetId,
                    note: note,
                    addedBy: addedBy || 'admin',
                    addedAt: new Date().toISOString(),
                    date: new Date().toISOString()
                });
                this.save();
                return noteId;
            },
            
            getNotesFor(targetType, targetId) {
                return this.data.adminNotes.filter(n => n.targetType === targetType && n.targetId === targetId)
                    .sort((a, b) => new Date(b.addedAt || b.date) - new Date(a.addedAt || a.date));
            },
            
            // ---- Dashboard Stats ----
            getDashboardStats() {
                const yearMemberships = this.getMembershipsByYear();
                const allFamilies = this.getAllFamilies();
                const activeFamilies = allFamilies.filter(f => this.isFamilyMemberCurrentYear(f.id));
                const byTier = {};
                let totalRevenue = 0;
                yearMemberships.forEach(m => {
                    byTier[m.tier] = (byTier[m.tier] || 0) + 1;
                    totalRevenue += m.paidAmount;
                });
                return {
                    totalFamilies: allFamilies.length,
                    activeFamilies: activeFamilies.length,
                    inactiveFamilies: allFamilies.length - activeFamilies.length,
                    totalMembershipsCurrentYear: yearMemberships.length,
                    byTier: byTier,
                    totalRevenue: totalRevenue,
                    totalMembers: allFamilies.reduce((sum, f) => sum + f.members.length, 0),
                    totalNotes: this.data.adminNotes.length
                };
            },
            
            // ---- Demo Data ----
            _seedDemoData() {
                // Seed families from the real memberDirectory (which includes familyId from family_universe.json)
                // Group members by familyId to create proper family records
                const membersByFamily = {};
                (window.DemoData?.memberDirectory || []).forEach(m => {
                    if (!m.familyId) return;
                    if (!membersByFamily[m.familyId]) membersByFamily[m.familyId] = [];
                    membersByFamily[m.familyId].push({
                        firstName: m.firstName,
                        lastName: m.lastName,
                        email: m.email || '',
                        phone: m.phone || '',
                        relationship: membersByFamily[m.familyId].length === 0 ? 'Head' : 'Family Member'
                    });
                });
                
                const familyEntries = Object.entries(membersByFamily);
                const tiers = ['family', 'couple', 'individual', 'family', 'couple'];
                const familyIds = [];
                
                familyEntries.forEach(([famUniverseId, members], i) => {
                    const headName = `${members[0].firstName} ${members[0].lastName}`;
                    const fid = this.createFamily(headName, members, 'universe-seed');
                    familyIds.push(fid);
                    // Create active memberships for active members
                    const isActive = (window.DemoData?.memberDirectory || [])
                        .find(m => m.familyId === famUniverseId)?.status === 'Active';
                    if (isActive) {
                        const tier = members.length >= 3 ? 'family' : members.length === 2 ? 'couple' : 'individual';
                        this.createMembership(fid, tier, {
                            amount: this.tiers[tier]?.amount || 100,
                            date: '2026-01-15',
                            method: i % 2 === 0 ? 'Zelle' : 'Cash',
                            ref: i % 2 === 0 ? `ZELLE-SEED-${i}` : `CASH-SEED-${i}`
                        }, 'universe-seed');
                    }
                });
                
                console.log(`✅ Seeded ${familyIds.length} families from family_universe data`);
                this.save();
            }
        };

        // Initialize MembershipManager
        MembershipManager.init();

        /**
         * ========== FULL-SCREEN MEMBER PORTAL FUNCTIONS ==========
         */
        
        /**
         * Show the full-screen member portal
         */
        function showFullPortal(memberData) {
            const normalizedMember = normalizeMemberRecord(memberData);
            MemberPortal.member = normalizedMember;
            memberData = normalizedMember;
            console.log('🏠 Opening full member portal for:', memberData.firstName);
            
            const overlay = document.getElementById('memberPortalOverlay');
            if (!overlay) {
                console.error('❌ memberPortalOverlay not found');
                return;
            }
            
            // Set user info in header
            document.getElementById('portalUserName').textContent = memberData.firstName || 'Member';
            document.getElementById('dashboardMemberName').textContent = memberData.firstName || 'Member';
            
            // Populate profile form
            const profileFields = ['firstName', 'lastName', 'email', 'phone'];
            profileFields.forEach(field => {
                const input = document.getElementById('portal' + capitalizeFirst(field));
                if (input && memberData[field]) {
                    input.value = memberData[field];
                }
            });
            const addressInput = document.getElementById('portalAddress');
            if (addressInput) addressInput.value = memberData.address?.street || memberData.address || '';
            const cityInput = document.getElementById('portalCity');
            if (cityInput) cityInput.value = memberData.address?.city || memberData.city || 'Jacksonville';
            const stateInput = document.getElementById('portalState');
            if (stateInput) stateInput.value = memberData.address?.state || memberData.state || 'FL';
            const zipInput = document.getElementById('portalZip');
            if (zipInput) zipInput.value = memberData.address?.zip || memberData.zip || '';
            
            // Set membership status badge
            const statusEl = document.querySelector('#portalDashboard .portal-stat-card .status-badge');
            if (statusEl) {
                const isActive = memberData.expiresOn && new Date(memberData.expiresOn) > new Date();
                statusEl.textContent = isActive ? 'Active' : 'Expired';
                statusEl.className = 'status-badge ' + (isActive ? 'active' : 'expired');
            }
            
            // Show dashboard section by default
            showPortalSection('dashboard', document.querySelector('.portal-nav-item.active'));
            
            // Hide the modal if open
            const modal = document.getElementById('memberPortalModal');
            if (modal) {
                const bsModal = bootstrap.Modal.getInstance(modal);
                if (bsModal) bsModal.hide();
            }
            
            // Show full portal overlay
            overlay.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            // Ensure mobile content area is scrollable
            const contentArea = overlay.querySelector('.portal-content-area');
            if (contentArea) contentArea.scrollTop = 0;
            
            console.log('✅ Full portal opened');

            // If user came from a service link, redirect them after login
            if (MemberPortal.pendingServiceAction) {
                handlePendingServiceAction();
                return; // skip showing portal — go straight to the service
            }
        }
        
        /**
         * Close full-screen portal
         */
        function closeFullPortal() {
            const overlay = document.getElementById('memberPortalOverlay');
            if (overlay) {
                overlay.style.display = 'none';
                document.body.style.overflow = '';
            }
            console.log('✅ Portal closed');
        }

        // Safety: Escape key closes portal and restores scrolling
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const overlay = document.getElementById('memberPortalOverlay');
                if (overlay && overlay.style.display !== 'none' && overlay.style.display !== '') {
                    closeFullPortal();
                }
                // Always restore body overflow as safety net
                if (document.body.style.overflow === 'hidden') {
                    document.body.style.overflow = '';
                }
            }
        });
        
        /**
         * Toggle portal sidebar drawer on mobile (≤576px)
         */
        function togglePortalSidebar() {
            const sidebar = document.querySelector('.portal-sidebar');
            const backdrop = document.querySelector('.portal-sidebar-backdrop');
            if (!sidebar) return;
            sidebar.classList.toggle('open');
            if (backdrop) backdrop.classList.toggle('show');
        }

        /**
         * Toggle admin sidebar drawer on mobile (≤576px)
         */
        function toggleAdminSidebar() {
            const sidebar = document.querySelector('.admin-sidebar');
            const backdrop = document.querySelector('.admin-sidebar-backdrop');
            if (!sidebar) return;
            sidebar.classList.toggle('open');
            if (backdrop) backdrop.classList.toggle('show');
        }
        
        /**
         * Switch between portal sections
         */
        function showPortalSection(sectionId, clickedNav) {
            console.log('📑 Switching to section:', sectionId);
            
            // Hide all sections
            document.querySelectorAll('.portal-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show target section
            const targetId = 'portal' + capitalizeFirst(sectionId);
            const targetSection = document.getElementById(targetId);
            if (targetSection) {
                targetSection.classList.add('active');
            } else {
                console.warn('⚠️ Section not found:', targetId);
                // Fallback to dashboard
                document.getElementById('portalDashboard')?.classList.add('active');
            }
            
            // Update navigation active state
            document.querySelectorAll('.portal-nav-item').forEach(nav => {
                nav.classList.remove('active');
            });
            if (clickedNav) {
                clickedNav.classList.add('active');
            }

            // Close sidebar drawer on mobile after nav click
            if (window.innerWidth <= 576) {
                const sidebar = document.querySelector('.portal-sidebar');
                const backdrop = document.querySelector('.portal-sidebar-backdrop');
                if (sidebar) sidebar.classList.remove('open');
                if (backdrop) backdrop.classList.remove('show');
            }

            // Auto-render content for specific sections
            if (sectionId === 'events') renderMyRsvps();
        }

        /* ================================================================
         *  MEMBER RSVP FUNCTIONS
         * ================================================================ */

        let memberRsvps = []; // Track member's RSVPs

        function openMemberRsvp(eventId, eventName) {
            document.getElementById('memberRsvpFormContainer').style.display = 'block';
            document.getElementById('rsvpFormTitle').textContent = 'RSVP — ' + eventName;
            document.getElementById('rsvpEventId').value = eventId;
            document.getElementById('rsvpStatus').value = '';
            document.getElementById('rsvpAdults').value = 1;
            document.getElementById('rsvpKids').value = 0;
            document.getElementById('rsvpDietary').value = 'None';
            document.getElementById('rsvpNotes').value = '';
            document.getElementById('memberRsvpFormContainer').scrollIntoView({ behavior: 'smooth' });
        }

        function toggleRsvpDetails() {
            const status = document.getElementById('rsvpStatus').value;
            const show = (status === 'attending' || status === 'maybe');
            document.getElementById('rsvpDietaryCol').style.display = show ? '' : 'none';
        }

        function handleMemberRsvp(e) {
            e.preventDefault();
            const eventId = document.getElementById('rsvpEventId').value;
            const status = document.getElementById('rsvpStatus').value;
            const adults = parseInt(document.getElementById('rsvpAdults').value) || 0;
            const kids = parseInt(document.getElementById('rsvpKids').value) || 0;
            const dietary = document.getElementById('rsvpDietary').value;
            const notes = document.getElementById('rsvpNotes').value;

            const memberName = MemberPortal.member ? MemberPortal.member.name : 'Demo Member';

            // Find the invitation and add/update response
            const inv = DemoData.eviteData.invitations.find(i => i.id === eventId);
            if (inv) {
                const existingIdx = inv.responses.findIndex(r => r.name === memberName);
                const response = {
                    memberId: MemberPortal.member ? MemberPortal.member.id : 'DEMO',
                    name: memberName,
                    status: status,
                    adults: status === 'attending' ? adults : 0,
                    kids: status === 'attending' ? kids : 0,
                    dietary: status === 'attending' ? dietary : '',
                    notes: notes,
                    respondedAt: new Date().toISOString().split('T')[0]
                };
                if (existingIdx >= 0) {
                    inv.responses[existingIdx] = response;
                } else {
                    inv.responses.push(response);
                }
            }

            // Track in local array
            const localIdx = memberRsvps.findIndex(r => r.eventId === eventId);
            const rsvpRecord = { eventId, eventName: inv ? inv.eventName : eventId, status, adults, kids, dietary, notes };
            if (localIdx >= 0) memberRsvps[localIdx] = rsvpRecord;
            else memberRsvps.push(rsvpRecord);

            document.getElementById('memberRsvpFormContainer').style.display = 'none';
            renderMyRsvps();

            const statusEmoji = { attending: '✅', maybe: '🤔', not_attending: '❌' };
            alert(`${statusEmoji[status] || ''} RSVP submitted!\n\nEvent: ${inv ? inv.eventName : eventId}\nStatus: ${status}\nAdults: ${adults} • Kids: ${kids}\nDietary: ${dietary}`);
            return false;
        }

        function renderMyRsvps() {
            const tbody = document.getElementById('myRsvpTableBody');
            if (!tbody) return;

            if (memberRsvps.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center py-3 text-muted">No RSVPs yet. RSVP to an event above!</td></tr>';
                return;
            }

            tbody.innerHTML = memberRsvps.map(r => {
                const statusBadge = r.status === 'attending' ? '<span class="status-badge active">✅ Attending</span>'
                    : r.status === 'maybe' ? '<span class="status-badge pending">🤔 Maybe</span>'
                    : '<span class="status-badge inactive">❌ Declined</span>';
                return `<tr>
                    <td>${r.eventName}</td>
                    <td>${statusBadge}</td>
                    <td>${r.adults}</td>
                    <td>${r.kids}</td>
                    <td>${r.dietary || '-'}</td>
                    <td><button class="portal-feature-btn secondary" style="padding:0.25rem 0.75rem; font-size:0.8rem;" onclick="openMemberRsvp('${r.eventId}', '${r.eventName}')"><i class="fas fa-edit"></i> Edit</button></td>
                </tr>`;
            }).join('');
        }
        
        /**
         * Handle portal logout
         */
        function handlePortalLogout() {
            MemberPortal.isLoggedIn = false;
            MemberPortal.member = null;
            closeFullPortal();
            
            // Reset login form
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
            
            showStatusMessage('info', '<i class="fas fa-sign-out-alt me-2"></i>You have been logged out.');
            console.log('✅ User logged out');
        }

        /**
         * Show the full-screen admin portal
         */
        function showAdminPortal(adminData) {
            const normalizedAdmin = normalizeMemberRecord(adminData);
            AdminPortal.isLoggedIn = true;
            AdminPortal.admin = normalizedAdmin;

            const overlay = document.getElementById('adminPortalOverlay');
            if (!overlay) {
                console.error('❌ adminPortalOverlay not found');
                return;
            }

            const roleLabel = ADMIN_ROLE_LABELS[normalizedAdmin.roleNormalized] || normalizedAdmin.adminRoleLabel || 'EC Member';
            document.getElementById('adminRoleBadge').textContent = roleLabel;
            document.getElementById('adminPortalName').textContent = normalizedAdmin.firstName || normalizedAdmin.email || 'Admin';

            // ===== Feature 3: Permission-based sidebar filtering =====
            const adminPermissions = adminData.ecPermissions || normalizedAdmin.ecPermissions || [];
            const adminRoles = extractRolesFromMember(adminData);
            const hasFullAccess = adminRoles.some(r => FULL_ACCESS_ROLES.has(r));
            AdminPortal.permissions = adminPermissions;
            AdminPortal.hasFullAccess = hasFullAccess;

            enforceAdminPermissions(adminPermissions, hasFullAccess);
            console.log(`🔐 Admin permissions: ${hasFullAccess ? 'FULL ACCESS' : adminPermissions.join(', ') || 'none'}`);

            showAdminSection('dashboard', document.querySelector('.admin-nav-item.active'));

            const adminModal = document.getElementById('adminLoginModal');
            if (adminModal) {
                const bsModal = bootstrap.Modal.getInstance(adminModal);
                if (bsModal) bsModal.hide();
            }

            overlay.style.display = 'flex';
            document.body.style.overflow = 'hidden';

            // Ensure mobile content area is scrollable
            const adminContent = overlay.querySelector('.admin-main-content');
            if (adminContent) adminContent.scrollTop = 0;
        }

        /**
         * Enforce admin permissions: hide/show sidebar nav items and section headers
         * based on the logged-in admin's ecPermissions array.
         */
        function enforceAdminPermissions(permissions, hasFullAccess) {
            const navItems = document.querySelectorAll('.admin-nav-item[data-permission]');
            const permsSet = new Set(permissions);

            navItems.forEach(nav => {
                const requiredPerm = nav.getAttribute('data-permission');
                if (!requiredPerm || hasFullAccess || permsSet.has(requiredPerm)) {
                    nav.style.display = '';
                } else {
                    nav.style.display = 'none';
                }
            });

            // Hide sidebar section headers if ALL their child nav items are hidden
            document.querySelectorAll('.admin-sidebar-section').forEach(section => {
                const visibleNavs = section.querySelectorAll('.admin-nav-item:not([style*="display: none"])');
                const header = section.querySelector('h6');
                if (header) {
                    header.style.display = visibleNavs.length > 0 ? '' : 'none';
                }
            });
        }

        /**
         * Close admin portal
         */
        function closeAdminPortal() {
            const overlay = document.getElementById('adminPortalOverlay');
            if (overlay) {
                overlay.style.display = 'none';
                document.body.style.overflow = '';
            }
        }

        /**
         * Switch admin sections (with permission enforcement)
         */
        function showAdminSection(sectionId, clickedNav) {
            // ===== Feature 3: Check permission before switching =====
            const requiredPerm = SECTION_PERMISSIONS[sectionId];
            if (requiredPerm && AdminPortal.admin && !AdminPortal.hasFullAccess) {
                const perms = AdminPortal.permissions || [];
                if (!perms.includes(requiredPerm)) {
                    console.warn(`🚫 Access denied to "${sectionId}" — requires "${requiredPerm}" permission`);
                    // Show brief toast instead of hard-blocking
                    const toast = document.createElement('div');
                    toast.className = 'position-fixed top-0 start-50 translate-middle-x mt-3 px-4 py-2 rounded-pill shadow';
                    toast.style.cssText = 'background:#dc3545;color:#fff;z-index:99999;font-size:0.9rem;opacity:0;transition:opacity 0.3s';
                    toast.innerHTML = '<i class="fas fa-lock me-2"></i>You don\'t have access to this section';
                    document.body.appendChild(toast);
                    requestAnimationFrame(() => toast.style.opacity = '1');
                    setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 300); }, 2500);
                    return;
                }
            }

            const targetId = 'admin' + capitalizeFirst(sectionId);
            document.querySelectorAll('.admin-section').forEach(section => section.classList.remove('active'));
            const target = document.getElementById(targetId);
            if (target) {
                target.classList.add('active');
                // Feature 1: Render site config panel when section is activated
                if (sectionId === 'siteConfig') {
                    SiteConfigManager.renderConfigPanel();
                }
                // Feature 7: Render DB Explorer when section is activated
                if (sectionId === 'dbExplorer') {
                    UniversalDBExplorer.render();
                }
                // Archive Data Management
                if (sectionId === 'archiveData') {
                    ArchiveDataManager.render();
                }
                // Report Builder
                if (sectionId === 'reportBuilder') {
                    ReportBuilder.render();
                }
                // Membership Dashboard
                if (sectionId === 'membershipDashboard') {
                    renderMembershipDashboard();
                }
                // Family Universe
                if (sectionId === 'familyUniverse') {
                    renderFamilyUniverse();
                }
                // Family Detail (internal navigation)
                if (sectionId === 'familyDetail') {
                    // Already rendered by showFamilyDetail()
                }
                // Feature 6: Render Career Directory when section is activated
                if (sectionId === 'careers') {
                    renderAdminCareerTable();
                }
                // Legacy Members table
                if (sectionId === 'members') {
                    renderLegacyMembers();
                }
                // Zelle: Check service availability and load payment data when payments section is activated
                if (sectionId === 'payments') {
                    zelleCheckService().then(available => {
                        if (available) {
                            zelleLoadPayments();
                            zelleLoadStats();
                        }
                    });
                }
            } else {
                document.getElementById('adminDashboard')?.classList.add('active');
            }

            document.querySelectorAll('.admin-nav-item').forEach(nav => nav.classList.remove('active'));
            if (clickedNav) clickedNav.classList.add('active');
            AdminPortal.currentSection = sectionId;

            // Close sidebar drawer on mobile/tablet after nav click
            if (window.innerWidth <= 992) {
                const sidebar = document.querySelector('.admin-sidebar');
                const backdrop = document.querySelector('.admin-sidebar-backdrop');
                if (sidebar) sidebar.classList.remove('open');
                if (backdrop) backdrop.classList.remove('show');
            }
        }

        /**
         * Admin logout
         */
        function handleAdminLogout() {
            AdminPortal.isLoggedIn = false;
            AdminPortal.admin = null;
            closeAdminPortal();
        }

        /* ================================================================
         *  EVITE / INVITATION MANAGEMENT FUNCTIONS
         * ================================================================ */

        function openSendEviteForm() {
            document.getElementById('sendEviteFormContainer').style.display = 'block';
            document.getElementById('sendEviteForm').reset();
        }

        function applyEviteTemplate() {
            const tplId = document.getElementById('eviteTemplate').value;
            if (!tplId) return;
            const tpl = DemoData.eviteData.templates.find(t => t.id === tplId);
            if (!tpl) return;
            document.getElementById('eviteSubject').value = tpl.subject;
            document.getElementById('eviteMessage').value = tpl.body;
        }

        function handleSendEvite(e) {
            if (e && e.preventDefault) e.preventDefault();
            const eventName = document.getElementById('eviteEventName').value;
            const date = document.getElementById('eviteDate').value;
            const venue = document.getElementById('eviteVenue').value || 'TBD';
            const recipients = document.getElementById('eviteRecipients').value;
            const subject = document.getElementById('eviteSubject').value;
            const message = document.getElementById('eviteMessage').value;

            const recipientCount = { all: 146, active: 117, family: 105, ec: 10 }[recipients] || 146;

            // Create new invitation record
            const newInvite = {
                id: 'EVT-' + String(DemoData.eviteData.invitations.length + 1).padStart(3, '0'),
                eventName: eventName,
                eventDate: date,
                venue: venue,
                sentDate: new Date().toISOString().split('T')[0],
                sentTo: recipientCount,
                sentBy: AdminPortal.admin ? AdminPortal.admin.name : 'Admin',
                subject: subject,
                collectDietary: document.getElementById('eviteCollectDietary').checked,
                collectKids: document.getElementById('eviteCollectKids').checked,
                responses: []
            };

            DemoData.eviteData.invitations.push(newInvite);
            document.getElementById('sendEviteFormContainer').style.display = 'none';
            renderEviteHistory();

            // === SEND REAL EMAIL VIA GMAIL BACKEND ===
            (async function sendRealEviteEmail() {
                try {
                    // Build recipient list from member directory (use test email for now)
                    const testRecipient = 'ranadhir.ghosh@gmail.com';
                    let recipientEmails = [testRecipient];

                    // In production, gather all member emails from DemoData.memberDirectory
                    // For now we use the test recipient
                    const time = document.getElementById('eviteTime') ? document.getElementById('eviteTime').value : '';

                    const evitePayload = {
                        recipients: recipientEmails.map(em => ({ name: em.split('@')[0], email: em })),
                        event_name: eventName,
                        event_date: date,
                        event_time: time || '6:00 PM',
                        venue: venue,
                        message: message || subject,
                        rsvp_deadline: date
                    };

                    const r = await apiFetch('/send-evite', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(evitePayload)
                    });
                    const d = await r.json();
                    if (d.success) {
                        alert(`✅ Evite sent successfully!\n\n📧 Real email delivered via Gmail!\nEvent: ${eventName}\nRecipients: ${recipientEmails.join(', ')}\nDate: ${date}\n\nSent ${d.sent_count} email(s) from banfjax@gmail.com`);
                    } else {
                        alert(`⚠️ Evite recorded but email delivery failed:\n${d.error || 'Unknown error'}\n\nNote: The evite was saved locally. Fix Gmail connection to resend.`);
                    }
                } catch(emailErr) {
                    console.error('Gmail send error:', emailErr);
                    alert(`✅ Evite recorded locally!\n\n⚠️ Could not send real email (Gmail service may be offline).\nEvent: ${eventName}\nRecipients: ${recipientCount} members\nDate: ${date}`);
                }
            })();

            return false;
        }

        function previewEvite() {
            const eventName = document.getElementById('eviteEventName').value || 'Event Name';
            const date = document.getElementById('eviteDate').value || 'TBD';
            const venue = document.getElementById('eviteVenue').value || 'TBD';
            const time = document.getElementById('eviteTime').value || '';
            const subject = document.getElementById('eviteSubject').value || 'You\'re invited!';
            let message = document.getElementById('eviteMessage').value || 'Please join us for this wonderful event.';

            message = message.replace(/{eventName}/g, eventName)
                           .replace(/{eventDate}/g, date)
                           .replace(/{venue}/g, venue)
                           .replace(/{eventTime}/g, time)
                           .replace(/{memberName}/g, 'Dear Member');

            alert(`📧 EVITE PREVIEW\n\nSubject: ${subject}\n\n${message}\n\n📍 Venue: ${venue}\n📅 Date: ${date}\n🕐 Time: ${time}`);
        }

        function renderEviteHistory() {
            const container = document.getElementById('eviteHistoryList');
            if (!container) return;
            const invitations = DemoData.eviteData.invitations;

            container.innerHTML = invitations.map(inv => {
                const attending = inv.responses.filter(r => r.status === 'attending').length;
                const maybe = inv.responses.filter(r => r.status === 'maybe').length;
                const declined = inv.responses.filter(r => r.status === 'not_attending').length;
                const totalAdults = inv.responses.filter(r => r.status === 'attending').reduce((s, r) => s + (r.adults || 0), 0);
                const totalKids = inv.responses.filter(r => r.status === 'attending').reduce((s, r) => s + (r.kids || 0), 0);
                const responseRate = inv.sentTo > 0 ? Math.round((inv.responses.length / inv.sentTo) * 100) : 0;

                return `
                    <div class="admin-card">
                        <div class="admin-card-header">
                            <div class="admin-card-icon"><i class="fas fa-envelope"></i></div>
                            <div>
                                <h4>${inv.eventName}</h4>
                                <small>Sent: ${inv.sentDate} • ${inv.sentTo} recipients</small>
                            </div>
                        </div>
                        <div style="display:flex; gap:1rem; flex-wrap:wrap; margin: 0.5rem 0;">
                            <span class="status-badge active">✅ ${attending} Attending</span>
                            <span class="status-badge pending">🤔 ${maybe} Maybe</span>
                            <span class="status-badge inactive">❌ ${declined} Declined</span>
                        </div>
                        <p style="margin:0.5rem 0;">
                            <strong>Response Rate:</strong> ${responseRate}% (${inv.responses.length}/${inv.sentTo})<br>
                            <strong>Expected Headcount:</strong> ${totalAdults} adults, ${totalKids} kids
                        </p>
                        <div class="admin-actions">
                            <button class="admin-primary" onclick="showEviteReport('${inv.id}')"><i class="fas fa-chart-bar me-1"></i> Report</button>
                            <button class="admin-secondary" onclick="sendEviteReminder('${inv.id}')"><i class="fas fa-bell me-1"></i> Remind</button>
                        </div>
                    </div>`;
            }).join('');
        }

        function showEviteReport(inviteId) {
            const inv = DemoData.eviteData.invitations.find(i => i.id === inviteId);
            if (!inv) return;

            const reportArea = document.getElementById('eviteReportArea');
            reportArea.style.display = 'block';
            document.getElementById('eviteReportTitle').innerHTML = `<i class="fas fa-chart-bar me-2"></i>RSVP Report — ${inv.eventName}`;

            const attending = inv.responses.filter(r => r.status === 'attending');
            const maybe = inv.responses.filter(r => r.status === 'maybe');
            const declined = inv.responses.filter(r => r.status === 'not_attending');
            const totalAdults = attending.reduce((s, r) => s + (r.adults || 0), 0);
            const totalKids = attending.reduce((s, r) => s + (r.kids || 0), 0);

            // Stats
            document.getElementById('eviteReportStats').innerHTML = `
                <div class="admin-stat-card"><div class="admin-stat-value">${inv.responses.length}</div><div class="admin-stat-label">Total Responses</div></div>
                <div class="admin-stat-card"><div class="admin-stat-value" style="color:#4CAF50">${attending.length}</div><div class="admin-stat-label">Attending</div></div>
                <div class="admin-stat-card"><div class="admin-stat-value" style="color:#FF9800">${maybe.length}</div><div class="admin-stat-label">Maybe</div></div>
                <div class="admin-stat-card"><div class="admin-stat-value" style="color:#f44336">${declined.length}</div><div class="admin-stat-label">Declined</div></div>
                <div class="admin-stat-card"><div class="admin-stat-value">${totalAdults}</div><div class="admin-stat-label">Total Adults</div></div>
                <div class="admin-stat-card"><div class="admin-stat-value">${totalKids}</div><div class="admin-stat-label">Total Kids</div></div>
            `;

            // Dietary summary
            const dietaryCounts = {};
            attending.forEach(r => {
                const d = r.dietary || 'Not specified';
                dietaryCounts[d] = (dietaryCounts[d] || 0) + (r.adults || 0);
            });
            document.getElementById('eviteReportDietary').innerHTML = `
                <h5><i class="fas fa-utensils me-2"></i>Dietary Summary</h5>
                <div style="display:flex; gap:0.5rem; flex-wrap:wrap;">
                    ${Object.entries(dietaryCounts).map(([diet, count]) =>
                        `<span class="status-badge active">${diet}: ${count} adults</span>`
                    ).join('')}
                </div>`;

            // Response table
            document.getElementById('eviteReportTableBody').innerHTML = inv.responses.map(r => `
                <tr>
                    <td>${r.name}</td>
                    <td><span class="status-badge ${r.status === 'attending' ? 'active' : r.status === 'maybe' ? 'pending' : 'inactive'}">${r.status === 'attending' ? '✅ Attending' : r.status === 'maybe' ? '🤔 Maybe' : '❌ Declined'}</span></td>
                    <td>${r.adults || '-'}</td>
                    <td>${r.kids || '-'}</td>
                    <td>${r.dietary || '-'}</td>
                    <td>${r.notes || '-'}</td>
                    <td>${r.respondedAt || '-'}</td>
                </tr>
            `).join('');
        }

        function sendEviteReminder(inviteId) {
            const inv = DemoData.eviteData.invitations.find(i => i.id === inviteId);
            if (!inv) return;
            const noResponse = inv.sentTo - inv.responses.length;
            alert(`📬 Reminder sent!\n\nEvent: ${inv.eventName}\nSent to: ${noResponse} members who haven't responded yet.`);
        }

        function exportEviteReport() {
            let csv = 'Event,Member,Status,Adults,Kids,Dietary,Notes,Responded\n';
            DemoData.eviteData.invitations.forEach(inv => {
                inv.responses.forEach(r => {
                    csv += `"${inv.eventName}","${r.name}","${r.status}",${r.adults || 0},${r.kids || 0},"${r.dietary || ''}","${r.notes || ''}","${r.respondedAt || ''}"\n`;
                });
            });
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = 'evite_rsvp_report.csv'; a.click();
            URL.revokeObjectURL(url);
        }

        function renderRsvpDashboard() {
            const statsEl = document.getElementById('rsvpSummaryStats');
            const tbody = document.getElementById('rsvpTableBody');
            if (!statsEl || !tbody) return;

            let totalAttending = 0, totalMaybe = 0, totalDeclined = 0, totalAdults = 0, totalKids = 0;
            const allRows = [];

            DemoData.eviteData.invitations.forEach(inv => {
                inv.responses.forEach(r => {
                    if (r.status === 'attending') { totalAttending++; totalAdults += (r.adults || 0); totalKids += (r.kids || 0); }
                    else if (r.status === 'maybe') totalMaybe++;
                    else totalDeclined++;
                    allRows.push({ event: inv.eventName, ...r });
                });
            });

            statsEl.innerHTML = `
                <div class="admin-stat-card"><div class="admin-stat-value" style="color:#4CAF50">${totalAttending}</div><div class="admin-stat-label">Attending</div></div>
                <div class="admin-stat-card"><div class="admin-stat-value" style="color:#FF9800">${totalMaybe}</div><div class="admin-stat-label">Maybe</div></div>
                <div class="admin-stat-card"><div class="admin-stat-value">${totalAdults + totalKids}</div><div class="admin-stat-label">Total Headcount</div></div>
                <div class="admin-stat-card"><div class="admin-stat-value">${totalAdults}</div><div class="admin-stat-label">Adults</div></div>
                <div class="admin-stat-card"><div class="admin-stat-value">${totalKids}</div><div class="admin-stat-label">Kids</div></div>
            `;

            tbody.innerHTML = allRows.map(r => `
                <tr>
                    <td>${r.event}</td>
                    <td>${r.name}</td>
                    <td><span class="status-badge ${r.status === 'attending' ? 'active' : r.status === 'maybe' ? 'pending' : 'inactive'}">${r.status === 'attending' ? '✅ Attending' : r.status === 'maybe' ? '🤔 Maybe' : '❌ Declined'}</span></td>
                    <td>${r.adults || '-'}</td>
                    <td>${r.kids || '-'}</td>
                    <td>${r.dietary || '-'}</td>
                    <td>${r.notes || '-'}</td>
                    <td><button class="admin-secondary" onclick="alert('✅ ${r.name} checked in!')">Check-in</button></td>
                </tr>
            `).join('');
        }

        /* ================================================================
         *  EXCEL / CSV IMPORT FUNCTIONS
         * ================================================================ */

        let pendingImportData = { type: '', rows: [], headers: [] };

        function handleExcelUpload(type, inputEl) {
            const file = inputEl.files[0];
            if (!file) return;
            const ext = file.name.split('.').pop().toLowerCase();

            if (ext === 'csv') {
                const reader = new FileReader();
                reader.onload = function(e) {
                    parseCSVData(e.target.result, type, file.name);
                };
                reader.readAsText(file);
            } else if (ext === 'xlsx' || ext === 'xls') {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const workbook = XLSX.read(e.target.result, { type: 'array' });
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                        if (jsonData.length < 2) { alert('❌ Excel file is empty or has no data rows.'); inputEl.value = ''; return; }
                        const headers = jsonData[0].map(h => String(h || '').trim());
                        const rows = jsonData.slice(1).map(row => {
                            const obj = {};
                            headers.forEach((h, i) => obj[h] = row[i] !== undefined ? String(row[i]).trim() : '');
                            return obj;
                        }).filter(row => Object.values(row).some(v => v));
                        if (rows.length === 0) { alert('❌ No valid data rows found in Excel file.'); inputEl.value = ''; return; }
                        pendingImportData = { type, rows, headers };
                        showImportPreview(type, headers, rows, file.name);
                    } catch (err) {
                        alert('❌ Error reading Excel file: ' + err.message);
                        inputEl.value = '';
                    }
                };
                reader.readAsArrayBuffer(file);
            } else {
                alert('❌ Unsupported file format. Please use .xlsx, .xls, or .csv files.');
                inputEl.value = '';
            }
        }

        function parseCSVData(csvText, type, fileName) {
            const lines = csvText.split('\n').filter(l => l.trim());
            if (lines.length < 2) { alert('❌ File is empty or has no data rows.'); return; }

            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const rows = [];
            for (let i = 1; i < lines.length; i++) {
                const vals = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                if (vals.length === headers.length) {
                    const row = {};
                    headers.forEach((h, idx) => row[h] = vals[idx]);
                    rows.push(row);
                }
            }

            if (rows.length === 0) { alert('❌ No valid data rows found.'); return; }

            pendingImportData = { type, rows, headers };
            showImportPreview(type, headers, rows, fileName);
        }

        function showImportPreview(type, headers, rows, fileName) {
            const area = document.getElementById('importPreviewArea');
            area.style.display = 'block';
            document.getElementById('importPreviewTitle').innerHTML = `<i class="fas fa-table me-2"></i>Preview: ${fileName} (${rows.length} rows)`;

            document.getElementById('importPreviewStats').innerHTML = `
                <span class="status-badge active"><i class="fas fa-columns me-1"></i>${headers.length} columns</span>
                <span class="status-badge active"><i class="fas fa-rows me-1"></i>${rows.length} rows</span>
                <span class="status-badge pending"><i class="fas fa-tag me-1"></i>Type: ${type}</span>
            `;

            document.getElementById('importPreviewHead').innerHTML = `<tr>${headers.map(h => `<th>${h}</th>`).join('')}<th>Valid</th></tr>`;
            document.getElementById('importPreviewBody').innerHTML = rows.slice(0, 20).map(row => {
                const cells = headers.map(h => `<td>${row[h] || ''}</td>`).join('');
                return `<tr>${cells}<td><span class="status-badge active">✓</span></td></tr>`;
            }).join('') + (rows.length > 20 ? `<tr><td colspan="${headers.length + 1}" style="text-align:center;color:#666;">... and ${rows.length - 20} more rows</td></tr>` : '');
        }

        function confirmImport() {
            const { type, rows } = pendingImportData;
            if (!rows.length) return;

            if (type === 'members') {
                rows.forEach(row => {
                    DemoData.memberDirectory.push({
                        id: 'MEM-' + String(DemoData.memberDirectory.length + 1).padStart(3, '0'),
                        firstName: row['First Name'] || row['FirstName'] || '',
                        lastName: row['Last Name'] || row['LastName'] || '',
                        email: row['Email'] || '',
                        phone: row['Phone'] || '',
                        type: row['Membership Type'] || row['Type'] || 'Individual',
                        status: 'Active',
                        joinDate: row['Join Date'] || row['JoinDate'] || new Date().toISOString().split('T')[0],
                        address: row['Address'] || '',
                        city: row['City'] || '',
                        state: row['State'] || '',
                        zip: row['Zip'] || '',
                        familyMembers: row['Family Members'] || '',
                        expiryDate: row['Expiry Date'] || row['ExpiryDate'] || ''
                    });
                });
            }

            // Add import history
            const historyBody = document.getElementById('importHistoryBody');
            if (historyBody) {
                const newRow = document.createElement('tr');
                newRow.innerHTML = `
                    <td>${new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</td>
                    <td>${type.charAt(0).toUpperCase() + type.slice(1)}</td>
                    <td>${rows.length} records</td>
                    <td><span class="status-badge active">Success</span></td>
                    <td>${AdminPortal.admin ? AdminPortal.admin.name : 'Admin'}</td>
                `;
                historyBody.insertBefore(newRow, historyBody.firstChild);
            }

            document.getElementById('importPreviewArea').style.display = 'none';
            alert(`✅ Import Successful!\n\n${rows.length} ${type} records imported successfully.`);
            pendingImportData = { type: '', rows: [], headers: [] };
        }

        function downloadTemplate(type) {
            let csv = '';
            if (type === 'members') {
                csv = 'First Name,Last Name,Email,Phone,Membership Type,Address,City,State,Zip,Family Members,Join Date,Expiry Date\n'
                    + 'John,Doe,john@example.com,555-0101,Family,123 Main St,Jacksonville,FL,32256,3,2026-01-01,2027-01-01\n'
                    + 'Jane,Smith,jane@example.com,555-0102,Individual,456 Oak Ave,Jacksonville,FL,32257,1,2026-02-15,2027-02-15\n';
            } else if (type === 'events') {
                csv = 'Event Name,Date,Time,Venue,Description\nSample Event,2026-06-01,5:00 PM,Community Center,Annual celebration\n';
            } else if (type === 'payments') {
                csv = 'Member Name,Amount,Date,Type,Status\nJohn Doe,100,2026-01-15,Annual Dues,Completed\n';
            }
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = `banf_${type}_template.csv`; a.click();
            URL.revokeObjectURL(url);
        }

        /* ================================================================
         *  ARCHIVE SCHEMA METADATA (12-Layer Semantic Schema Definition)
         * ================================================================ */
        const ArchiveSchema = {
            layers: [
                { id: 0, name: 'Reference / Metadata', icon: 'fas fa-cog', color: '#607d8b',
                  tables: [
                    { name: 'semantic_domains', label: 'Semantic Domains', desc: 'Domain classification ontology', rowCount: 12,
                      columns: ['domain_id TEXT PK', 'domain_name TEXT', 'description TEXT', 'parent_domain TEXT FK'] },
                    { name: 'synonym_registry', label: 'Synonym Registry', desc: 'Name variant resolution rules', rowCount: 285,
                      columns: ['synonym_id INT PK', 'canonical_name TEXT', 'variant_text TEXT', 'domain_id TEXT FK', 'resolution_rule TEXT', 'confidence REAL'] },
                    { name: 'extraction_provenance', label: 'Extraction Provenance', desc: 'Data lineage & extraction audit trail', rowCount: 1840,
                      columns: ['provenance_id INT PK', 'target_table TEXT', 'target_id TEXT', 'target_column TEXT', 'source_doc_id TEXT', 'raw_text TEXT', 'normalized_text TEXT', 'extraction_rule TEXT', 'confidence REAL', 'extracted_at TEXT'] }
                  ]},
                { id: 1, name: 'People', icon: 'fas fa-users', color: '#1a237e',
                  tables: [
                    { name: 'persons', label: 'Persons', desc: 'All identified individuals in BANF history', rowCount: 1247,
                      columns: ['person_id TEXT PK', 'display_name TEXT', 'first_name TEXT', 'last_name TEXT', 'alt_names TEXT', 'name_confidence REAL', 'gender TEXT', 'is_member INT', 'is_ec_officer INT', 'is_vendor INT', 'is_contributor INT', 'is_sponsor INT', 'first_seen_fy TEXT', 'last_seen_fy TEXT', 'family_id TEXT FK', 'notes TEXT'] },
                    { name: 'sem_families', label: 'Families', desc: 'Family unit linkages', rowCount: 438,
                      columns: ['family_id TEXT PK', 'primary_surname TEXT', 'display_name TEXT', 'member_count INT', 'alt_surnames TEXT', 'years_active TEXT', 'year_count INT', 'retention_status TEXT', 'source_doc_id TEXT'] },
                    { name: 'person_roles', label: 'Person Roles', desc: 'Role assignments across contexts', rowCount: 320,
                      columns: ['role_id INT PK', 'person_id TEXT FK', 'role_name TEXT', 'context_type TEXT', 'context_id TEXT', 'fy_id TEXT', 'start_date TEXT', 'end_date TEXT', 'source_doc_id TEXT'] },
                    { name: 'person_relationships', label: 'Person Relationships', desc: 'Family and social relationships', rowCount: 156,
                      columns: ['rel_id INT PK', 'person_id_1 TEXT FK', 'person_id_2 TEXT FK', 'relationship TEXT', 'confidence REAL', 'source_doc_id TEXT'] }
                  ]},
                { id: 2, name: 'Financial', icon: 'fas fa-dollar-sign', color: '#2e7d32',
                  tables: [
                    { name: 'transactions', label: 'Transactions', desc: 'All financial transactions (income & expense)', rowCount: 892,
                      columns: ['txn_id TEXT PK', 'txn_type TEXT', 'txn_direction TEXT', 'amount REAL', 'currency TEXT', 'person_id TEXT FK', 'organization_id TEXT FK', 'event_id TEXT FK', 'fy_id TEXT', 'payment_method TEXT', 'payment_date TEXT', 'description TEXT', 'raw_amount_text TEXT', 'source_doc_id TEXT'] },
                    { name: 'budgets', label: 'Budgets', desc: 'Budget planning vs actuals', rowCount: 178,
                      columns: ['budget_id TEXT PK', 'budget_category TEXT', 'event_id TEXT FK', 'fy_id TEXT', 'estimated_amount REAL', 'actual_amount REAL', 'variance REAL', 'notes TEXT', 'source_doc_id TEXT'] },
                    { name: 'fee_schedules', label: 'Fee Schedules', desc: 'Membership fee tiers by year', rowCount: 64,
                      columns: ['fee_id TEXT PK', 'fy_id TEXT', 'tier_code TEXT', 'size_category TEXT', 'annual_fee REAL', 'event_fee REAL', 'included_events INT', 'total_value REAL', 'source_doc_id TEXT'] }
                  ]},
                { id: 3, name: 'Membership', icon: 'fas fa-id-card', color: '#0277bd',
                  tables: [
                    { name: 'sem_memberships', label: 'Memberships', desc: 'Annual membership records', rowCount: 624,
                      columns: ['membership_id TEXT PK', 'person_id TEXT FK', 'family_id TEXT FK', 'fy_id TEXT', 'tier_code TEXT', 'size_category TEXT', 'amount_paid REAL', 'payment_method TEXT', 'payment_date TEXT', 'txn_id TEXT FK', 'is_active INT', 'source_doc_id TEXT', 'raw_entry TEXT'] }
                  ]},
                { id: 4, name: 'Events', icon: 'fas fa-calendar-alt', color: '#e65100',
                  tables: [
                    { name: 'sem_events', label: 'Events', desc: 'All BANF events, pujas, and gatherings', rowCount: 215,
                      columns: ['event_id TEXT PK', 'canonical_name TEXT', 'display_name TEXT', 'event_type TEXT', 'event_subtype TEXT', 'event_date TEXT', 'event_end_date TEXT', 'fy_id TEXT', 'ec_term_id TEXT FK', 'venue TEXT', 'venue_address TEXT', 'description TEXT', 'estimated_cost REAL', 'actual_cost REAL', 'attendee_count INT', 'is_recurring INT', 'source_doc_ids TEXT'] },
                    { name: 'event_participants', label: 'Event Participants', desc: 'Performance and participation records', rowCount: 340,
                      columns: ['participation_id INT PK', 'event_id TEXT FK', 'person_id TEXT FK', 'role TEXT', 'performance_type TEXT', 'duration_minutes INT', 'notes TEXT', 'source_doc_id TEXT'] },
                    { name: 'event_tasks', label: 'Event Tasks', desc: 'Task assignments for events', rowCount: 89,
                      columns: ['task_id INT PK', 'event_id TEXT FK', 'task_name TEXT', 'assigned_to TEXT FK', 'status TEXT', 'notes TEXT', 'source_doc_id TEXT'] }
                  ]},
                { id: 5, name: 'Governance', icon: 'fas fa-landmark', color: '#4a148c',
                  tables: [
                    { name: 'sem_ec_terms', label: 'EC Terms', desc: 'Executive Committee term periods', rowCount: 24,
                      columns: ['ec_term_id TEXT PK', 'term_name TEXT', 'start_date TEXT', 'end_date TEXT', 'status TEXT'] },
                    { name: 'ec_officers', label: 'EC Officers', desc: 'Officer appointments by term', rowCount: 168,
                      columns: ['officer_id INT PK', 'ec_term_id TEXT FK', 'person_id TEXT FK', 'role_name TEXT', 'appointed_date TEXT', 'source_doc_id TEXT'] },
                    { name: 'meetings', label: 'Meetings', desc: 'Meeting minutes and decisions', rowCount: 92,
                      columns: ['meeting_id TEXT PK', 'meeting_type TEXT', 'meeting_date TEXT', 'fy_id TEXT', 'ec_term_id TEXT FK', 'agenda_items TEXT', 'decisions TEXT', 'attendee_count INT', 'minutes_text TEXT', 'source_doc_id TEXT'] }
                  ]},
                { id: 6, name: 'Publications', icon: 'fas fa-newspaper', color: '#c62828',
                  tables: [
                    { name: 'magazine_issues', label: 'Magazine Issues', desc: 'Jagriti magazine editions', rowCount: 22,
                      columns: ['issue_id TEXT PK', 'magazine_name TEXT', 'fy_id TEXT', 'year INT', 'total_pages INT', 'contribution_count INT', 'ad_count INT', 'source_doc_id TEXT'] },
                    { name: 'sem_magazine_contributions', label: 'Magazine Contributions', desc: 'Articles, poems, art submitted to Jagriti', rowCount: 187,
                      columns: ['contribution_id TEXT PK', 'issue_id TEXT FK', 'person_id TEXT FK', 'contributor_name TEXT', 'contribution_type TEXT', 'page_count REAL', 'title TEXT', 'notes TEXT', 'source_doc_id TEXT'] },
                    { name: 'sem_magazine_advertisements', label: 'Magazine Advertisements', desc: 'Ad placements in Jagriti', rowCount: 95,
                      columns: ['ad_id TEXT PK', 'issue_id TEXT FK', 'organization_id TEXT FK', 'advertiser_name TEXT', 'ad_size TEXT', 'ad_amount REAL', 'contact_person TEXT', 'contact_info TEXT', 'source_doc_id TEXT'] }
                  ]},
                { id: 7, name: 'Vendors / Catering', icon: 'fas fa-store', color: '#bf360c',
                  tables: [
                    { name: 'organizations', label: 'Organizations', desc: 'Vendors, caterers, and external orgs', rowCount: 45,
                      columns: ['org_id TEXT PK', 'org_name TEXT', 'org_type TEXT', 'contact_person TEXT', 'contact_phone TEXT', 'contact_email TEXT', 'address TEXT', 'notes TEXT', 'source_doc_id TEXT'] },
                    { name: 'menu_items', label: 'Menu Items', desc: 'Catering menu & pricing', rowCount: 112,
                      columns: ['item_id INT PK', 'item_name TEXT', 'item_category TEXT', 'vendor_id TEXT FK', 'price_per_unit REAL', 'unit TEXT', 'event_id TEXT FK', 'fy_id TEXT', 'source_doc_id TEXT'] }
                  ]},
                { id: 8, name: 'Sponsorship', icon: 'fas fa-handshake', color: '#00695c',
                  tables: [
                    { name: 'sem_sponsorship_packages', label: 'Sponsorship Packages', desc: 'Sponsorship tiers and benefits', rowCount: 28,
                      columns: ['package_id TEXT PK', 'fy_id TEXT', 'tier_name TEXT', 'amount REAL', 'ad_size TEXT', 'benefits TEXT', 'availability TEXT', 'source_doc_id TEXT'] },
                    { name: 'sponsor_payments', label: 'Sponsor Payments', desc: 'Sponsorship payment records', rowCount: 67,
                      columns: ['payment_id INT PK', 'organization_id TEXT FK', 'person_id TEXT FK', 'package_id TEXT FK', 'fy_id TEXT', 'amount REAL', 'payment_method TEXT', 'txn_id TEXT FK', 'source_doc_id TEXT'] }
                  ]},
                { id: 9, name: 'Communication', icon: 'fas fa-bullhorn', color: '#1565c0',
                  tables: [
                    { name: 'sem_communications', label: 'Communications', desc: 'Announcements, invitations, circulars', rowCount: 34,
                      columns: ['comm_id TEXT PK', 'comm_type TEXT', 'title TEXT', 'target_audience TEXT', 'channel TEXT', 'related_event_id TEXT FK', 'created_date TEXT', 'ec_term_id TEXT FK', 'source_doc_id TEXT'] }
                  ]},
                { id: 10, name: 'Document Archive', icon: 'fas fa-file-archive', color: '#4e342e',
                  tables: [
                    { name: 'sem_documents', label: 'Documents', desc: 'Original source documents with extracted text', rowCount: 44,
                      columns: ['doc_id TEXT PK', 'filename TEXT', 'file_path TEXT', 'file_type TEXT', 'file_size_kb INT', 'ec_term_id TEXT FK', 'category TEXT', 'subcategory TEXT', 'extraction_method TEXT', 'extraction_status TEXT', 'extracted_text TEXT', 'entities_json TEXT', 'page_count INT', 'char_count INT', 'file_blob BLOB', 'extracted_at TEXT', 'created_at TEXT'] }
                  ]},
                { id: 11, name: 'Fiscal Year / Calendar', icon: 'fas fa-calendar-check', color: '#ad1457',
                  tables: [
                    { name: 'sem_fiscal_years', label: 'Fiscal Years', desc: 'Annual fiscal year summary data', rowCount: 24,
                      columns: ['fy_id TEXT PK', 'ec_term_id TEXT FK', 'start_date TEXT', 'end_date TEXT', 'total_members INT', 'total_families INT', 'total_revenue REAL', 'total_expenses REAL', 'total_events INT'] }
                  ]}
            ],
            getTotalRows()  { return this.layers.reduce((s, l) => s + l.tables.reduce((ts, t) => ts + t.rowCount, 0), 0); },
            getTotalTables() { return this.layers.reduce((s, l) => s + l.tables.length, 0); },
            getTableByName(name) { for (const l of this.layers) { const t = l.tables.find(t => t.name === name); if (t) return { ...t, layer: l }; } return null; },
            getTablesForLayer(layerId) { const l = this.layers.find(l => l.id === layerId); return l ? l.tables : []; }
        };

        /* ================================================================
         *  ARCHIVE DEMO DATA (Client-Side Sample Records)
         * ================================================================ */
        const ArchiveDemoData = {
            persons: [
                { person_id: 'PER-a1b2c3d4', display_name: 'Ranadhir Ghosh', first_name: 'Ranadhir', last_name: 'Ghosh', gender: 'M', is_member: 1, is_ec_officer: 1, first_seen_fy: 'FY-2000', last_seen_fy: 'FY-2025', family_id: 'FAM-gh01' },
                { person_id: 'PER-e5f6g7h8', display_name: 'Subir Ganguly', first_name: 'Subir', last_name: 'Ganguly', gender: 'M', is_member: 1, is_ec_officer: 1, first_seen_fy: 'FY-2001', last_seen_fy: 'FY-2024', family_id: 'FAM-ga01' },
                { person_id: 'PER-i9j0k1l2', display_name: 'Anita Basu', first_name: 'Anita', last_name: 'Basu', gender: 'F', is_member: 1, is_contributor: 1, first_seen_fy: 'FY-2003', last_seen_fy: 'FY-2025', family_id: 'FAM-ba01' },
                { person_id: 'PER-m3n4o5p6', display_name: 'Priya Chatterjee', first_name: 'Priya', last_name: 'Chatterjee', gender: 'F', is_member: 1, is_ec_officer: 0, first_seen_fy: 'FY-2005', last_seen_fy: 'FY-2025', family_id: 'FAM-ch01' },
                { person_id: 'PER-q7r8s9t0', display_name: 'Arun Mukherjee', first_name: 'Arun', last_name: 'Mukherjee', gender: 'M', is_member: 1, is_sponsor: 1, first_seen_fy: 'FY-2002', last_seen_fy: 'FY-2023', family_id: 'FAM-mu01' }
            ],
            sem_families: [
                { family_id: 'FAM-gh01', primary_surname: 'Ghosh', display_name: 'Ghosh Family', member_count: 4, years_active: '2000-2025', year_count: 25, retention_status: 'active' },
                { family_id: 'FAM-ga01', primary_surname: 'Ganguly', display_name: 'Ganguly Family', member_count: 3, years_active: '2001-2024', year_count: 23, retention_status: 'active' },
                { family_id: 'FAM-ba01', primary_surname: 'Basu', display_name: 'Basu Family', member_count: 2, years_active: '2003-2025', year_count: 22, retention_status: 'active' }
            ],
            sem_events: [
                { event_id: 'EVT-dp2024', canonical_name: 'Durga Puja', display_name: 'Durga Puja 2024', event_type: 'religious', event_date: '2024-10-09', fy_id: 'FY-2024', venue: 'Community Center', attendee_count: 450 },
                { event_id: 'EVT-sp2024', canonical_name: 'Saraswati Puja', display_name: 'Saraswati Puja 2024', event_type: 'religious', event_date: '2024-02-14', fy_id: 'FY-2024', venue: 'BANF Hall', attendee_count: 180 },
                { event_id: 'EVT-pc2024', canonical_name: 'Annual Picnic', display_name: 'Summer Picnic 2024', event_type: 'social', event_date: '2024-06-15', fy_id: 'FY-2024', venue: 'Hanna Park', attendee_count: 220 }
            ],
            transactions: [
                { txn_id: 'TXN-001', txn_type: 'membership_fee', txn_direction: 'income', amount: 150.00, person_id: 'PER-a1b2c3d4', fy_id: 'FY-2024', payment_method: 'Zelle', payment_date: '2024-01-15', description: 'Annual family membership' },
                { txn_id: 'TXN-002', txn_type: 'event_expense', txn_direction: 'expense', amount: 2500.00, event_id: 'EVT-dp2024', fy_id: 'FY-2024', payment_method: 'Check', payment_date: '2024-10-05', description: 'Durga Puja catering' },
                { txn_id: 'TXN-003', txn_type: 'sponsorship', txn_direction: 'income', amount: 500.00, person_id: 'PER-q7r8s9t0', fy_id: 'FY-2024', payment_method: 'Check', payment_date: '2024-09-01', description: 'Gold sponsorship' }
            ],
            sem_ec_terms: [
                { ec_term_id: 'EC-2024-2025', term_name: '2024-2025 EC', start_date: '2024-07-01', end_date: '2025-06-30', status: 'active' },
                { ec_term_id: 'EC-2022-2023', term_name: '2022-2023 EC', start_date: '2022-07-01', end_date: '2023-06-30', status: 'completed' }
            ],
            sem_documents: [
                { doc_id: 'DOC-001', filename: 'BANF_Constitution_2020.pdf', file_type: 'pdf', file_size_kb: 245, category: 'constitution', page_count: 12, extraction_status: 'completed' },
                { doc_id: 'DOC-002', filename: 'MemberList_2024.xlsx', file_type: 'xlsx', file_size_kb: 89, category: 'membership', page_count: 1, extraction_status: 'completed' },
                { doc_id: 'DOC-003', filename: 'Jagriti_2024.pdf', file_type: 'pdf', file_size_kb: 8500, category: 'magazine', page_count: 48, extraction_status: 'completed' },
                { doc_id: 'DOC-004', filename: 'Budget_FY2024.xlsx', file_type: 'xlsx', file_size_kb: 34, category: 'financial', page_count: 1, extraction_status: 'completed' },
                { doc_id: 'DOC-005', filename: 'EC_Meeting_Oct2024.docx', file_type: 'docx', file_size_kb: 28, category: 'meeting', page_count: 3, extraction_status: 'completed' }
            ],
            sem_fiscal_years: [
                { fy_id: 'FY-2024', ec_term_id: 'EC-2024-2025', start_date: '2024-07-01', end_date: '2025-06-30', total_members: 185, total_families: 78, total_revenue: 45200, total_expenses: 38700, total_events: 14 },
                { fy_id: 'FY-2023', ec_term_id: 'EC-2022-2023', start_date: '2023-07-01', end_date: '2024-06-30', total_members: 172, total_families: 72, total_revenue: 41800, total_expenses: 36200, total_events: 12 }
            ],
            // Provide a universal getter that returns demo data for any table
            getTableData(tableName) {
                return this[tableName] || this._generateSampleData(tableName);
            },
            _generateSampleData(tableName) {
                const meta = ArchiveSchema.getTableByName(tableName);
                if (!meta) return [];
                const count = Math.min(meta.rowCount, 5);
                const rows = [];
                for (let i = 0; i < count; i++) {
                    const row = {};
                    meta.columns.forEach(colDef => {
                        const colName = colDef.split(' ')[0];
                        const colType = colDef.split(' ')[1] || 'TEXT';
                        if (colName.endsWith('_id') && colDef.includes('PK')) row[colName] = `${tableName.substring(0,3).toUpperCase()}-${String(i+1).padStart(3,'0')}`;
                        else if (colType === 'INT') row[colName] = Math.floor(Math.random() * 100);
                        else if (colType === 'REAL') row[colName] = +(Math.random() * 1000).toFixed(2);
                        else row[colName] = `Sample ${colName} ${i+1}`;
                    });
                    rows.push(row);
                }
                return rows;
            }
        };

        /* ================================================================
         *  UNIVERSAL DB EXPLORER (Replaces MemberDBExplorer)
         *  Supports Current Data + Archive Data via tab switching
         * ================================================================ */
        const UniversalDBExplorer = {
            STORAGE_KEY: 'banf_db_table_permissions',
            currentPage: 1,
            perPage: 15,
            filtered: [],
            activeTab: 'current', // 'current' or 'archive'
            selectedTable: '',
            selectedLayer: '',
            allData: [],
            columns: [],

            // Role-based CRUD permissions (for current data only)
            CRUD_ROLES: {
                view:     new Set(['president', 'vice_president', 'vp', 'secretary', 'treasurer', 'assistant_treasurer', 'assistant_secretary', 'joint_secretary', 'event_coord', 'food_coord', 'communications', 'super_admin', 'admin']),
                add:      new Set(['president', 'secretary', 'super_admin']),
                edit:     new Set(['president', 'secretary', 'super_admin']),
                delete:   new Set(['president', 'super_admin']),
                export:   new Set(['president', 'treasurer', 'secretary', 'super_admin']),
                bulkImport: new Set(['president', 'secretary', 'super_admin'])
            },

            ROLE_OPTIONS: [
                'president', 'vice_president', 'vp', 'secretary', 'assistant_secretary', 'joint_secretary',
                'treasurer', 'assistant_treasurer', 'event_coord', 'food_coord', 'communications',
                'admin', 'super_admin'
            ],

            tableRolePolicies: { view: {}, add: {}, edit: {}, delete: {}, export: {} },

            // Current data tables
            CURRENT_TABLES: {
                memberDirectory: { label: 'Member Directory', layer: 'Member Management', columns: ['id','firstName','lastName','email','phone','type','status','joinDate'] },
                recentPayments:  { label: 'Recent Payments', layer: 'Finance', columns: ['id','member','amount','method','status','date'] },
                activeEvents:    { label: 'Active Events', layer: 'Events', columns: ['id','name','date','venue','rsvpCount','status'] },
                complaints:      { label: 'Complaints', layer: 'Communication', columns: ['id','date','category','subject','status'] }
            },

            getActionRoleSet(action, tableName) {
                const perTable = this.tableRolePolicies?.[action]?.[tableName];
                if (Array.isArray(perTable) && perTable.length > 0) {
                    return new Set(perTable.map(normalizeRoleValue));
                }
                return this.CRUD_ROLES[action] || new Set();
            },

            canDo(action, tableName) {
                if (this.activeTab === 'archive') return action === 'export'; // Archive is read-only
                if (!AdminPortal.admin) return false;
                if (AdminPortal.hasFullAccess) return true;
                const roles = (typeof extractRolesFromMember === 'function')
                    ? extractRolesFromMember(AdminPortal.admin)
                    : [normalizeRoleValue(AdminPortal.admin.role || '')].filter(Boolean);
                if (roles.some(r => FULL_ACCESS_ROLES.has(r))) return true;
                const tbl = tableName || this.selectedTable;
                const allowed = this.getActionRoleSet(action, tbl);
                return roles.some(r => allowed.has(r));
            },

            canManagePermissions() {
                if (!AdminPortal.admin) return false;
                if (AdminPortal.hasFullAccess) return true;
                const roles = (typeof extractRolesFromMember === 'function')
                    ? extractRolesFromMember(AdminPortal.admin)
                    : [normalizeRoleValue(AdminPortal.admin.role || '')].filter(Boolean);
                return roles.some(r => r === 'president' || r === 'super_admin' || r === 'admin');
            },

            loadPermissionConfig() {
                try {
                    const raw = localStorage.getItem(this.STORAGE_KEY);
                    const parsed = raw ? JSON.parse(raw) : {};
                    this.tableRolePolicies = {
                        view: parsed.view || {},
                        add: parsed.add || {},
                        edit: parsed.edit || {},
                        delete: parsed.delete || {},
                        export: parsed.export || {}
                    };
                } catch (e) {
                    console.warn('[DBExplorer] Permission config load failed:', e);
                    this.tableRolePolicies = { view: {}, add: {}, edit: {}, delete: {}, export: {} };
                }
            },

            savePermissionConfig() {
                const table = document.getElementById('dbExpPermTable')?.value;
                const action = document.getElementById('dbExpPermAction')?.value;
                if (!table || !action) return;
                const selectedRoles = Array.from(document.querySelectorAll('#dbExpPermRoles input[type="checkbox"]:checked')).map(cb => cb.value);
                if (!this.tableRolePolicies[action]) this.tableRolePolicies[action] = {};
                this.tableRolePolicies[action][table] = selectedRoles;
                localStorage.setItem(this.STORAGE_KEY, JSON.stringify(this.tableRolePolicies));
                this.populateTableSelect();
                this.renderActionButtons();
                this.showTableInfo();
                if (typeof SiteConfigManager?.showToast === 'function') SiteConfigManager.showToast('DB table permissions updated', 'success');
            },

            resetPermissionConfig() {
                this.tableRolePolicies = { view: {}, add: {}, edit: {}, delete: {}, export: {} };
                localStorage.removeItem(this.STORAGE_KEY);
                this.renderPermissionManager();
                this.populateTableSelect();
                this.renderActionButtons();
                if (typeof SiteConfigManager?.showToast === 'function') SiteConfigManager.showToast('DB permissions reset to defaults', 'info');
            },

            renderPermissionManager() {
                const card = document.getElementById('dbExpPermissionCard');
                if (!card) return;
                if (this.activeTab !== 'current' || !this.canManagePermissions()) {
                    card.style.display = 'none';
                    return;
                }
                card.style.display = '';
                const tableSel = document.getElementById('dbExpPermTable');
                if (!tableSel) return;
                tableSel.innerHTML = Object.entries(this.CURRENT_TABLES)
                    .map(([k, m]) => `<option value="${k}">${m.label}</option>`)
                    .join('');
                if (!tableSel.value) tableSel.value = this.selectedTable || 'memberDirectory';
                this.renderPermissionRoles();
            },

            renderPermissionRoles() {
                const table = document.getElementById('dbExpPermTable')?.value;
                const action = document.getElementById('dbExpPermAction')?.value;
                const wrap = document.getElementById('dbExpPermRoles');
                if (!table || !action || !wrap) return;
                const assigned = this.getActionRoleSet(action, table);
                wrap.innerHTML = this.ROLE_OPTIONS.map(r => {
                    const checked = assigned.has(r) ? 'checked' : '';
                    const label = (ADMIN_ROLE_LABELS[r] || r).replace(/_/g, ' ');
                    return `<label class="form-check" style="padding:0.35rem 0.5rem; border:1px solid #e0e0e0; border-radius:6px; margin:0;">
                        <input class="form-check-input" type="checkbox" value="${r}" ${checked}>
                        <span class="form-check-label" style="margin-left:0.35rem; font-size:0.85rem;">${label}</span>
                    </label>`;
                }).join('');
            },

            render() {
                this.loadPermissionConfig();
                this.populateLayerSelect();
                this.populateTableSelect();
                this.renderStats();
                this.renderActionButtons();
                this.renderPermissionManager();
                // Auto-load first table
                if (!this.selectedTable) {
                    if (this.activeTab === 'current') {
                        const sel = document.getElementById('dbExpTableSelect');
                        const firstCurrent = sel && sel.options.length > 1 ? sel.options[1].value : '';
                        this.selectedTable = firstCurrent || '';
                        if (sel && firstCurrent) sel.value = firstCurrent;
                    } else {
                        this.selectedTable = 'persons';
                        const sel = document.getElementById('dbExpTableSelect');
                        if (sel) sel.value = 'persons';
                    }
                }
                this.onTableChange();
            },

            refresh() { this.render(); },

            switchTab(tab) {
                this.activeTab = tab;
                this.selectedTable = '';
                this.selectedLayer = '';
                this.currentPage = 1;
                // Update tab UI
                const curBtn = document.getElementById('dbExpTabCurrent');
                const arcBtn = document.getElementById('dbExpTabArchive');
                if (tab === 'current') {
                    curBtn.style.borderBottomColor = '#1a237e'; curBtn.style.color = '#1a237e';
                    arcBtn.style.borderBottomColor = 'transparent'; arcBtn.style.color = '#666';
                } else {
                    arcBtn.style.borderBottomColor = '#1a237e'; arcBtn.style.color = '#1a237e';
                    curBtn.style.borderBottomColor = 'transparent'; curBtn.style.color = '#666';
                }
                this.render();
            },

            populateLayerSelect() {
                const sel = document.getElementById('dbExpLayerSelect');
                if (!sel) return;
                sel.innerHTML = '<option value="">All Layers</option>';
                if (this.activeTab === 'archive') {
                    ArchiveSchema.layers.forEach(l => {
                        sel.innerHTML += `<option value="${l.id}">L${l.id}: ${l.name}</option>`;
                    });
                } else {
                    const currentLayers = [...new Set(Object.values(this.CURRENT_TABLES).map(t => t.layer))];
                    currentLayers.forEach(l => { sel.innerHTML += `<option value="${l}">${l}</option>`; });
                }
            },

            populateTableSelect() {
                const sel = document.getElementById('dbExpTableSelect');
                if (!sel) return;
                sel.innerHTML = '<option value="">Select a table…</option>';
                if (this.activeTab === 'archive') {
                    const layerFilter = this.selectedLayer;
                    ArchiveSchema.layers.forEach(l => {
                        if (layerFilter !== '' && String(l.id) !== String(layerFilter)) return;
                        l.tables.forEach(t => {
                            sel.innerHTML += `<option value="${t.name}">${t.label} (${t.rowCount} rows)</option>`;
                        });
                    });
                } else {
                    Object.entries(this.CURRENT_TABLES).forEach(([key, t]) => {
                        if (this.selectedLayer && t.layer !== this.selectedLayer) return;
                        if (!this.canDo('view', key)) return;
                        sel.innerHTML += `<option value="${key}">${t.label}</option>`;
                    });
                }
            },

            onLayerChange() {
                this.selectedLayer = document.getElementById('dbExpLayerSelect')?.value || '';
                this.populateTableSelect();
            },

            onTableChange() {
                this.selectedTable = document.getElementById('dbExpTableSelect')?.value || '';
                if (!this.selectedTable) {
                    document.getElementById('dbExpTableHead').innerHTML = '';
                    document.getElementById('dbExpTableBody').innerHTML = '<tr><td style="text-align:center;color:#999;padding:2rem;">Select a table to view data</td></tr>';
                    document.getElementById('dbExpTableInfo').style.display = 'none';
                    return;
                }
                this.loadTableData();
            },

            loadTableData() {
                if (this.activeTab === 'archive') {
                    const data = ArchiveDemoData.getTableData(this.selectedTable);
                    this.allData = data;
                    this.columns = data.length > 0 ? Object.keys(data[0]) : [];
                    const meta = ArchiveSchema.getTableByName(this.selectedTable);
                    if (meta && this.columns.length === 0) {
                        this.columns = meta.columns.map(c => c.split(' ')[0]);
                    }
                } else {
                    const tblKey = this.selectedTable;
                    const tblMeta = this.CURRENT_TABLES[tblKey];
                    if (!tblMeta) return;
                    this.columns = tblMeta.columns;
                    if (tblKey === 'memberDirectory') {
                        this.allData = (DemoData.memberDirectory || []).slice();
                    } else {
                        this.allData = (DemoData[tblKey] || []).slice();
                    }
                }
                // Show table info bar
                this.showTableInfo();
                this.currentPage = 1;
                this.applyFilters();
            },

            showTableInfo() {
                const infoBar = document.getElementById('dbExpTableInfo');
                const infoText = document.getElementById('dbExpTableInfoText');
                const permBadge = document.getElementById('dbExpPermBadge');
                if (!infoBar) return;
                infoBar.style.display = '';
                let tableName = this.selectedTable;
                if (this.activeTab === 'archive') {
                    const meta = ArchiveSchema.getTableByName(this.selectedTable);
                    if (meta) tableName = `${meta.label} (Layer ${meta.layer.id}: ${meta.layer.name})`;
                    infoText.innerHTML = `<i class="fas fa-archive me-1"></i><strong>${tableName}</strong> — ${this.allData.length} sample records | ${meta ? meta.columns.length : this.columns.length} columns`;
                    permBadge.innerHTML = '<span style="background:#fff3e0; color:#e65100; padding:2px 10px; border-radius:10px; font-size:0.8rem;"><i class="fas fa-lock me-1"></i>Read-Only (Archive)</span>';
                } else {
                    const meta = this.CURRENT_TABLES[this.selectedTable];
                    infoText.innerHTML = `<i class="fas fa-server me-1"></i><strong>${meta ? meta.label : tableName}</strong> — ${this.allData.length} records | ${this.columns.length} columns`;
                    const canWrite = this.canDo('edit');
                    permBadge.innerHTML = canWrite
                        ? '<span style="background:#e8f5e9; color:#2e7d32; padding:2px 10px; border-radius:10px; font-size:0.8rem;"><i class="fas fa-edit me-1"></i>Read/Write</span>'
                        : '<span style="background:#fce4ec; color:#c62828; padding:2px 10px; border-radius:10px; font-size:0.8rem;"><i class="fas fa-eye me-1"></i>Read-Only</span>';
                }
            },

            renderStats() {
                const statsEl = document.getElementById('dbExpStats');
                if (!statsEl) return;
                if (this.activeTab === 'archive') {
                    const totalTables = ArchiveSchema.getTotalTables();
                    const totalRows = ArchiveSchema.getTotalRows();
                    statsEl.innerHTML = `
                        <div class="admin-card" style="text-align:center;"><h3 style="color:#4a148c;">${ArchiveSchema.layers.length}</h3><p style="margin:0;font-size:0.85rem;">Schema Layers</p></div>
                        <div class="admin-card" style="text-align:center;"><h3 style="color:#1a237e;">${totalTables}</h3><p style="margin:0;font-size:0.85rem;">Tables</p></div>
                        <div class="admin-card" style="text-align:center;"><h3 style="color:#2e7d32;">${totalRows.toLocaleString()}</h3><p style="margin:0;font-size:0.85rem;">Total Records</p></div>
                        <div class="admin-card" style="text-align:center;"><h3 style="color:#e65100;">19</h3><p style="margin:0;font-size:0.85rem;">Indexes</p></div>
                        <div class="admin-card" style="text-align:center;"><h3 style="color:#c62828;">44</h3><p style="margin:0;font-size:0.85rem;">Source Documents</p></div>`;
                } else {
                    const members = DemoData.memberDirectory || [];
                    const active = members.filter(m => (m.status || '').toLowerCase() === 'active').length;
                    const expired = members.filter(m => (m.status || '').toLowerCase() === 'expired').length;
                    const tables = Object.keys(this.CURRENT_TABLES).length;
                    statsEl.innerHTML = `
                        <div class="admin-card" style="text-align:center;"><h3 style="color:#1a237e;">${tables}</h3><p style="margin:0;font-size:0.85rem;">Data Tables</p></div>
                        <div class="admin-card" style="text-align:center;"><h3 style="color:#4CAF50;">${members.length}</h3><p style="margin:0;font-size:0.85rem;">Total Members</p></div>
                        <div class="admin-card" style="text-align:center;"><h3 style="color:#2e7d32;">${active}</h3><p style="margin:0;font-size:0.85rem;">Active</p></div>
                        <div class="admin-card" style="text-align:center;"><h3 style="color:#f44336;">${expired}</h3><p style="margin:0;font-size:0.85rem;">Expired</p></div>
                        <div class="admin-card" style="text-align:center;"><h3 style="color:#673ab7;">${members.length ? 'Live' : 'N/A'}</h3><p style="margin:0;font-size:0.85rem;">Status</p></div>`;
                }
            },

            renderActionButtons() {
                const show = (id, action) => { const el = document.getElementById(id); if (el) el.style.display = this.canDo(action) ? '' : 'none'; };
                show('dbExpAddBtn', 'add');
                show('dbExpExportCsvBtn', 'export');
                show('dbExpExportXlsxBtn', 'export');
            },

            applyFilters() {
                const search = (document.getElementById('dbExpSearch')?.value || '').toLowerCase();
                this.perPage = parseInt(document.getElementById('dbExpPerPage')?.value || '15');
                let data = this.allData.slice();
                if (search) {
                    data = data.filter(row => {
                        return Object.values(row).some(v => String(v || '').toLowerCase().includes(search));
                    });
                }
                this.filtered = data;
                this.currentPage = 1;
                this.renderTable();
            },

            renderTable() {
                const thead = document.getElementById('dbExpTableHead');
                const tbody = document.getElementById('dbExpTableBody');
                if (!thead || !tbody) return;

                const cols = this.columns;
                const canEdit = this.activeTab === 'current' && this.canDo('edit');
                const canDelete = this.activeTab === 'current' && this.canDo('delete');
                const showActions = canEdit || canDelete;

                // Render header
                thead.innerHTML = '<tr>' + '<th>#</th>' + cols.map(c => `<th>${c}</th>`).join('') + (showActions ? '<th>Actions</th>' : '') + '</tr>';

                // Paginate
                const start = (this.currentPage - 1) * this.perPage;
                const page = this.filtered.slice(start, start + this.perPage);
                const totalPages = Math.max(1, Math.ceil(this.filtered.length / this.perPage));

                tbody.innerHTML = page.map((row, i) => {
                    let actions = '';
                    if (showActions && this.activeTab === 'current' && this.selectedTable === 'memberDirectory') {
                        if (canEdit) actions += `<button class="admin-secondary" style="padding:2px 8px;font-size:0.8rem;" onclick="UniversalDBExplorer.editRecord('${row.id}')"><i class="fas fa-edit"></i></button> `;
                        if (canDelete) actions += `<button class="admin-secondary" style="padding:2px 8px;font-size:0.8rem;color:#f44336;" onclick="UniversalDBExplorer.deleteRecord('${row.id}')"><i class="fas fa-trash"></i></button>`;
                    }
                    const cells = cols.map(c => {
                        let v = row[c];
                        if (v === null || v === undefined) v = '';
                        if (typeof v === 'string' && v.length > 80) v = v.substring(0, 77) + '…';
                        // Status badge
                        if (c === 'status' || c === 'extraction_status') {
                            const sl = String(v).toLowerCase();
                            const cls = sl === 'active' || sl === 'completed' ? 'active' : sl === 'expired' ? 'danger' : 'pending';
                            return `<td><span class="status-badge ${cls}">${v}</span></td>`;
                        }
                        // Amount formatting
                        if ((c === 'amount' || c.includes('amount') || c.includes('fee') || c.includes('revenue') || c.includes('expense') || c.includes('cost')) && typeof row[c] === 'number') {
                            return `<td style="text-align:right;">$${Number(row[c]).toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}</td>`;
                        }
                        return `<td>${v}</td>`;
                    }).join('');
                    return `<tr><td>${start + i + 1}</td>${cells}${showActions ? '<td>'+actions+'</td>' : ''}</tr>`;
                }).join('');

                if (page.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="${cols.length + 2}" style="text-align:center;color:#999;padding:2rem;">No records found</td></tr>`;
                }

                document.getElementById('dbExpPageInfo').textContent = `Showing ${this.filtered.length ? start + 1 : 0}–${Math.min(start + this.perPage, this.filtered.length)} of ${this.filtered.length} records (Page ${this.currentPage}/${totalPages})`;
                document.getElementById('dbExpPrevBtn').disabled = this.currentPage <= 1;
                document.getElementById('dbExpNextBtn').disabled = this.currentPage >= totalPages;
            },

            prevPage() { if (this.currentPage > 1) { this.currentPage--; this.renderTable(); } },
            nextPage() { const tp = Math.ceil(this.filtered.length / this.perPage); if (this.currentPage < tp) { this.currentPage++; this.renderTable(); } },

            showAddModal() {
                if (this.activeTab !== 'current' || this.selectedTable !== 'memberDirectory') return;
                if (!this.canDo('add', this.selectedTable)) { alert('⛔ You do not have permission to add records for this table.'); return; }
                const fields = ['firstName', 'lastName', 'email', 'phone'];
                const vals = {};
                fields.forEach(f => vals[f] = prompt(`Enter ${f.replace(/([A-Z])/g, ' $1').trim()}:`) || '');
                if (!vals.firstName && !vals.lastName) return;
                const mType = prompt('Membership Type (Family/Individual/Couple/Student/Senior):', 'Family') || 'Family';
                const newMember = { id: 'BANF-' + new Date().getFullYear() + '-' + String(DemoData.memberDirectory.length + 1).padStart(3, '0'), ...vals, type: mType, status: 'Active', joinDate: new Date().toISOString().split('T')[0] };
                DemoData.memberDirectory.push(newMember);
                alert('✅ Member added: ' + newMember.firstName + ' ' + newMember.lastName);
                this.render();
            },

            editRecord(id) {
                if (this.activeTab === 'archive') { alert('⚠️ Archive data is read-only.'); return; }
                if (!this.canDo('edit', this.selectedTable)) { alert('⛔ You do not have permission to edit this table.'); return; }
                const idx = DemoData.memberDirectory.findIndex(m => m.id === id);
                if (idx === -1) return;
                const m = DemoData.memberDirectory[idx];
                const newFirst = prompt('First Name:', m.firstName); if (newFirst === null) return;
                m.firstName = newFirst || m.firstName;
                m.lastName = prompt('Last Name:', m.lastName) || m.lastName;
                m.email = prompt('Email:', m.email) || m.email;
                m.phone = prompt('Phone:', m.phone) || m.phone;
                m.type = prompt('Type (Family/Individual/Couple/Student/Senior):', m.type) || m.type;
                m.status = prompt('Status (Active/Expired/Pending):', m.status) || m.status;
                alert('✅ Member updated.'); this.render();
            },

            deleteRecord(id) {
                if (this.activeTab === 'archive') { alert('⚠️ Archive data is read-only.'); return; }
                if (!this.canDo('delete', this.selectedTable)) { alert('⛔ You do not have permission to delete from this table.'); return; }
                const idx = DemoData.memberDirectory.findIndex(m => m.id === id);
                if (idx === -1) return;
                const m = DemoData.memberDirectory[idx];
                if (!confirm(`⚠️ Delete "${m.firstName} ${m.lastName}" (${m.id})?`)) return;
                DemoData.memberDirectory.splice(idx, 1);
                alert('🗑️ Deleted.'); this.render();
            },

            exportCSV() {
                if (!this.canDo('export', this.selectedTable)) { alert('⛔ You do not have permission to export this table.'); return; }
                const headers = this.columns;
                const rows = this.filtered.map(r => headers.map(h => '"' + String(r[h] || '').replace(/"/g,'""') + '"').join(','));
                const csv = [headers.join(','), ...rows].join('\n');
                const blob = new Blob([csv], { type: 'text/csv' });
                const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
                a.download = `banf_${this.activeTab}_${this.selectedTable}_${new Date().toISOString().slice(0,10)}.csv`;
                a.click(); URL.revokeObjectURL(a.href);
            },

            exportExcel() {
                if (!this.canDo('export', this.selectedTable)) { alert('⛔ You do not have permission to export this table.'); return; }
                if (typeof XLSX === 'undefined') { alert('❌ SheetJS not loaded.'); return; }
                const ws = XLSX.utils.json_to_sheet(this.filtered);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, this.selectedTable || 'Data');
                XLSX.writeFile(wb, `banf_${this.activeTab}_${this.selectedTable}_${new Date().toISOString().slice(0,10)}.xlsx`);
            }
        };

        // Backward compatibility: MemberDBExplorer points to UniversalDBExplorer
        const MemberDBExplorer = UniversalDBExplorer;

        /* ================================================================
         *  ARCHIVE DATA MANAGER
         * ================================================================ */
        const ArchiveDataManager = {
            activeTab: 'schemaExplorer',
            viewerPage: 1, viewerPerPage: 20,
            viewerData: [], viewerFiltered: [], viewerColumns: [],

            render() {
                this.renderOverviewStats();
                this.renderSchemaTree();
                this.populateViewerSelects();
                this.renderFileArchive();
                this.renderLineage();
            },

            refresh() { this.render(); },

            switchTab(tabId, btn) {
                this.activeTab = tabId;
                document.querySelectorAll('.archive-tab-panel').forEach(p => p.style.display = 'none');
                const panel = document.getElementById('archiveTab' + tabId.charAt(0).toUpperCase() + tabId.slice(1));
                if (panel) panel.style.display = '';
                document.querySelectorAll('.archive-tab').forEach(b => { b.style.borderBottomColor = 'transparent'; b.style.color = '#666'; b.classList.remove('active'); });
                if (btn) { btn.style.borderBottomColor = '#1a237e'; btn.style.color = '#1a237e'; btn.classList.add('active'); }
            },

            renderOverviewStats() {
                const el = document.getElementById('archiveOverviewStats');
                if (!el) return;
                el.innerHTML = `
                    <div class="admin-card" style="text-align:center;"><h3 style="color:#4a148c;">${ArchiveSchema.layers.length}</h3><p style="margin:0;font-size:0.85rem;">Schema Layers</p></div>
                    <div class="admin-card" style="text-align:center;"><h3 style="color:#1a237e;">${ArchiveSchema.getTotalTables()}</h3><p style="margin:0;font-size:0.85rem;">Tables</p></div>
                    <div class="admin-card" style="text-align:center;"><h3 style="color:#2e7d32;">${ArchiveSchema.getTotalRows().toLocaleString()}</h3><p style="margin:0;font-size:0.85rem;">Total Records</p></div>
                    <div class="admin-card" style="text-align:center;"><h3 style="color:#e65100;">44</h3><p style="margin:0;font-size:0.85rem;">Source Docs</p></div>
                    <div class="admin-card" style="text-align:center;"><h3 style="color:#c62828;">24+</h3><p style="margin:0;font-size:0.85rem;">Years of History</p></div>`;
            },

            renderSchemaTree() {
                const tree = document.getElementById('archiveSchemaTree');
                if (!tree) return;
                tree.innerHTML = ArchiveSchema.layers.map(l => `
                    <div style="margin-bottom:0.75rem;">
                        <div onclick="ArchiveDataManager.toggleLayer(${l.id})" style="cursor:pointer; padding:0.5rem 0.75rem; background:#f5f5f5; border-radius:6px; display:flex; align-items:center; gap:0.5rem; transition:background 0.2s;" onmouseover="this.style.background='#e8eaf6'" onmouseout="this.style.background='#f5f5f5'">
                            <i class="${l.icon}" style="color:${l.color}; width:20px; text-align:center;"></i>
                            <strong style="flex:1; font-size:0.9rem;">L${l.id}: ${l.name}</strong>
                            <span style="font-size:0.75rem; background:${l.color}22; color:${l.color}; padding:1px 8px; border-radius:10px;">${l.tables.length} tables</span>
                            <i class="fas fa-chevron-down" id="archiveLayerChev${l.id}" style="font-size:0.7rem; color:#999; transition:transform 0.2s;"></i>
                        </div>
                        <div id="archiveLayerBody${l.id}" style="display:none; padding-left:1.5rem; margin-top:0.35rem;">
                            ${l.tables.map(t => `
                                <div onclick="ArchiveDataManager.showTableDetail('${t.name}')" style="cursor:pointer; padding:0.4rem 0.75rem; border-radius:4px; font-size:0.85rem; display:flex; justify-content:space-between; align-items:center; transition:background 0.15s;" onmouseover="this.style.background='#e3f2fd'" onmouseout="this.style.background='transparent'">
                                    <span><i class="fas fa-table me-2" style="color:#90a4ae; font-size:0.75rem;"></i>${t.label}</span>
                                    <span style="font-size:0.75rem; color:#888;">${t.rowCount} rows</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('');
            },

            toggleLayer(layerId) {
                const body = document.getElementById('archiveLayerBody' + layerId);
                const chev = document.getElementById('archiveLayerChev' + layerId);
                if (!body) return;
                const showing = body.style.display !== 'none';
                body.style.display = showing ? 'none' : '';
                if (chev) chev.style.transform = showing ? '' : 'rotate(180deg)';
            },

            showTableDetail(tableName) {
                const meta = ArchiveSchema.getTableByName(tableName);
                if (!meta) return;
                const data = ArchiveDemoData.getTableData(tableName);
                const el = document.getElementById('archiveTableDetail');
                if (!el) return;
                el.innerHTML = `
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem; flex-wrap:wrap; gap:0.5rem;">
                        <div>
                            <h4 style="margin:0;"><i class="${meta.layer.icon} me-2" style="color:${meta.layer.color};"></i>${meta.label}</h4>
                            <p style="margin:0.25rem 0 0; font-size:0.85rem; color:#666;">Layer ${meta.layer.id}: ${meta.layer.name} — ${meta.desc}</p>
                        </div>
                        <span style="background:#fff3e0; color:#e65100; padding:3px 12px; border-radius:10px; font-size:0.8rem;"><i class="fas fa-lock me-1"></i>Read-Only</span>
                    </div>
                    <div style="display:flex; gap:1rem; margin-bottom:1rem; flex-wrap:wrap;">
                        <div style="background:#f5f5f5; padding:0.5rem 1rem; border-radius:6px; text-align:center;"><strong>${meta.rowCount}</strong><br><span style="font-size:0.8rem; color:#666;">Rows</span></div>
                        <div style="background:#f5f5f5; padding:0.5rem 1rem; border-radius:6px; text-align:center;"><strong>${meta.columns.length}</strong><br><span style="font-size:0.8rem; color:#666;">Columns</span></div>
                        <div style="background:#f5f5f5; padding:0.5rem 1rem; border-radius:6px; text-align:center;"><strong>${meta.columns.filter(c => c.includes('FK')).length}</strong><br><span style="font-size:0.8rem; color:#666;">Foreign Keys</span></div>
                    </div>
                    <h5 style="margin-bottom:0.5rem; font-size:0.9rem;"><i class="fas fa-columns me-2"></i>Columns</h5>
                    <div class="admin-table" style="max-height:200px; overflow:auto; margin-bottom:1rem;">
                        <table><thead><tr><th>Column</th><th>Type</th><th>Constraints</th></tr></thead>
                        <tbody>${meta.columns.map(c => {
                            const parts = c.split(' ');
                            const name = parts[0]; const type = parts[1] || 'TEXT';
                            const constraints = parts.slice(2).join(' ');
                            return `<tr><td><code>${name}</code></td><td>${type}</td><td>${constraints || '—'}</td></tr>`;
                        }).join('')}</tbody></table>
                    </div>
                    <h5 style="margin-bottom:0.5rem; font-size:0.9rem;"><i class="fas fa-eye me-2"></i>Sample Data (${Math.min(data.length, 5)} rows)</h5>
                    <div class="admin-table" style="max-height:200px; overflow:auto;">
                        <table><thead><tr>${Object.keys(data[0] || {}).map(k => `<th>${k}</th>`).join('')}</tr></thead>
                        <tbody>${data.slice(0, 5).map(row => '<tr>' + Object.values(row).map(v => {
                            let sv = String(v ?? '');
                            if (sv.length > 50) sv = sv.substring(0,47) + '…';
                            return `<td style="font-size:0.8rem;">${sv}</td>`;
                        }).join('') + '</tr>').join('')}</tbody></table>
                    </div>
                    <div style="margin-top:1rem;">
                        <button class="admin-primary" onclick="ArchiveDataManager.switchTab('dataViewer', document.querySelector('[data-tab=dataViewer]')); document.getElementById('archiveViewerTable').value='${tableName}'; ArchiveDataManager.loadViewerTable();" style="font-size:0.85rem;">
                            <i class="fas fa-table me-1"></i> Open in Data Viewer
                        </button>
                    </div>
                `;
            },

            populateViewerSelects() {
                const layerSel = document.getElementById('archiveViewerLayer');
                const tableSel = document.getElementById('archiveViewerTable');
                if (layerSel) {
                    layerSel.innerHTML = '<option value="">All Layers</option>';
                    ArchiveSchema.layers.forEach(l => { layerSel.innerHTML += `<option value="${l.id}">L${l.id}: ${l.name}</option>`; });
                }
                if (tableSel) {
                    tableSel.innerHTML = '<option value="">Select table…</option>';
                    ArchiveSchema.layers.forEach(l => {
                        l.tables.forEach(t => { tableSel.innerHTML += `<option value="${t.name}">${t.label} (${t.rowCount})</option>`; });
                    });
                }
            },

            onViewerLayerChange() {
                const layerVal = document.getElementById('archiveViewerLayer')?.value;
                const tableSel = document.getElementById('archiveViewerTable');
                if (!tableSel) return;
                tableSel.innerHTML = '<option value="">Select table…</option>';
                ArchiveSchema.layers.forEach(l => {
                    if (layerVal && String(l.id) !== layerVal) return;
                    l.tables.forEach(t => { tableSel.innerHTML += `<option value="${t.name}">${t.label} (${t.rowCount})</option>`; });
                });
            },

            loadViewerTable() {
                const tableName = document.getElementById('archiveViewerTable')?.value;
                if (!tableName) return;
                this.viewerData = ArchiveDemoData.getTableData(tableName);
                this.viewerColumns = this.viewerData.length > 0 ? Object.keys(this.viewerData[0]) : [];
                const meta = ArchiveSchema.getTableByName(tableName);
                if (meta && this.viewerColumns.length === 0) {
                    this.viewerColumns = meta.columns.map(c => c.split(' ')[0]);
                }
                const info = document.getElementById('archiveViewerInfo');
                if (info) { info.style.display = ''; info.innerHTML = `<i class="fas fa-info-circle me-1"></i>Viewing <strong>${meta ? meta.label : tableName}</strong> — ${this.viewerData.length} sample records | <span style="color:#e65100;"><i class="fas fa-lock me-1"></i>Read-Only</span>`; }
                this.viewerPage = 1;
                this.filterViewerData();
            },

            filterViewerData() {
                const search = (document.getElementById('archiveViewerSearch')?.value || '').toLowerCase();
                this.viewerFiltered = search ? this.viewerData.filter(r => Object.values(r).some(v => String(v || '').toLowerCase().includes(search))) : this.viewerData.slice();
                this.viewerPage = 1;
                this.renderViewerTable();
            },

            renderViewerTable() {
                const thead = document.getElementById('archiveViewerHead');
                const tbody = document.getElementById('archiveViewerBody');
                if (!thead || !tbody) return;
                thead.innerHTML = '<tr><th>#</th>' + this.viewerColumns.map(c => `<th>${c}</th>`).join('') + '</tr>';
                const start = (this.viewerPage - 1) * this.viewerPerPage;
                const page = this.viewerFiltered.slice(start, start + this.viewerPerPage);
                const tp = Math.max(1, Math.ceil(this.viewerFiltered.length / this.viewerPerPage));
                tbody.innerHTML = page.map((row, i) => '<tr><td>' + (start+i+1) + '</td>' + this.viewerColumns.map(c => { let v = String(row[c] ?? ''); if (v.length > 60) v = v.substring(0,57)+'…'; return `<td style="font-size:0.85rem;">${v}</td>`; }).join('') + '</tr>').join('') || '<tr><td colspan="99" style="text-align:center;color:#999;padding:2rem;">No records found</td></tr>';
                document.getElementById('archiveViewerPageInfo').textContent = `${this.viewerFiltered.length ? start+1 : 0}–${Math.min(start+this.viewerPerPage, this.viewerFiltered.length)} of ${this.viewerFiltered.length} (Page ${this.viewerPage}/${tp})`;
                document.getElementById('archiveViewerPrevBtn').disabled = this.viewerPage <= 1;
                document.getElementById('archiveViewerNextBtn').disabled = this.viewerPage >= tp;
            },

            viewerPrev() { if (this.viewerPage > 1) { this.viewerPage--; this.renderViewerTable(); } },
            viewerNext() { const tp = Math.ceil(this.viewerFiltered.length / this.viewerPerPage); if (this.viewerPage < tp) { this.viewerPage++; this.renderViewerTable(); } },

            exportViewerCSV() {
                if (!this.viewerFiltered.length) return;
                const rows = [this.viewerColumns.join(','), ...this.viewerFiltered.map(r => this.viewerColumns.map(c => '"'+String(r[c]||'').replace(/"/g,'""')+'"').join(','))];
                const blob = new Blob([rows.join('\n')], { type: 'text/csv' });
                const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
                a.download = `banf_archive_${document.getElementById('archiveViewerTable')?.value || 'data'}_${new Date().toISOString().slice(0,10)}.csv`;
                a.click(); URL.revokeObjectURL(a.href);
            },

            exportCurrentView() { this.exportViewerCSV(); },

            renderFileArchive() {
                const grid = document.getElementById('fileArchiveGrid');
                if (!grid) return;
                const docs = ArchiveDemoData.sem_documents || [];
                grid.innerHTML = docs.map(d => {
                    const iconMap = { pdf: 'fa-file-pdf', xlsx: 'fa-file-excel', docx: 'fa-file-word', jpg: 'fa-file-image', png: 'fa-file-image', txt: 'fa-file-alt' };
                    const colorMap = { pdf: '#c62828', xlsx: '#2e7d32', docx: '#1565c0', jpg: '#e65100', png: '#e65100', txt: '#607d8b' };
                    const icon = iconMap[d.file_type] || 'fa-file';
                    const color = colorMap[d.file_type] || '#666';
                    return `<div style="border:1px solid #e0e0e0; border-radius:8px; padding:1rem; display:flex; gap:1rem; align-items:center; transition:box-shadow 0.2s;" onmouseover="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'" onmouseout="this.style.boxShadow=''">
                        <i class="fas ${icon}" style="font-size:2rem; color:${color};"></i>
                        <div style="flex:1; min-width:0;">
                            <strong style="font-size:0.9rem; display:block; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${d.filename}</strong>
                            <span style="font-size:0.8rem; color:#888;">${d.file_type.toUpperCase()} · ${d.file_size_kb} KB · ${d.page_count || 1} page(s)</span><br>
                            <span style="font-size:0.75rem; background:#f5f5f5; padding:1px 6px; border-radius:4px; color:#666;">${d.category || 'uncategorized'}</span>
                            <span style="font-size:0.75rem; margin-left:4px; color:${d.extraction_status === 'completed' ? '#2e7d32' : '#e65100'};">${d.extraction_status === 'completed' ? '✅ Extracted' : '⏳ Pending'}</span>
                        </div>
                    </div>`;
                }).join('');
                if (docs.length === 0) document.getElementById('fileArchiveEmpty').style.display = '';
            },

            filterFiles() {
                const search = (document.getElementById('fileArchiveSearch')?.value || '').toLowerCase();
                const typeFilter = document.getElementById('fileArchiveTypeFilter')?.value || '';
                const catFilter = document.getElementById('fileArchiveCategoryFilter')?.value || '';
                const docs = (ArchiveDemoData.sem_documents || []).filter(d => {
                    if (search && !d.filename.toLowerCase().includes(search)) return false;
                    if (typeFilter && d.file_type !== typeFilter) return false;
                    if (catFilter && d.category !== catFilter) return false;
                    return true;
                });
                const grid = document.getElementById('fileArchiveGrid');
                const empty = document.getElementById('fileArchiveEmpty');
                if (docs.length === 0) { grid.innerHTML = ''; empty.style.display = ''; }
                else { empty.style.display = 'none'; this.renderFileArchive(); }
            },

            renderLineage() {
                const stats = document.getElementById('lineageStats');
                const tbody = document.getElementById('lineageTableBody');
                if (!stats || !tbody) return;
                stats.innerHTML = `
                    <div class="admin-card" style="text-align:center;"><h3 style="color:#7b1fa2;">1,840</h3><p style="margin:0;font-size:0.85rem;">Provenance Records</p></div>
                    <div class="admin-card" style="text-align:center;"><h3 style="color:#1a237e;">44</h3><p style="margin:0;font-size:0.85rem;">Source Documents</p></div>
                    <div class="admin-card" style="text-align:center;"><h3 style="color:#2e7d32;">14</h3><p style="margin:0;font-size:0.85rem;">Extraction Rules</p></div>
                    <div class="admin-card" style="text-align:center;"><h3 style="color:#e65100;">96.2%</h3><p style="margin:0;font-size:0.85rem;">Avg Confidence</p></div>`;
                const sampleLineage = [
                    { doc: 'MemberList_2024.xlsx', table: 'persons', id: 'PER-a1b2c3d4', col: 'display_name', value: 'Ranadhir Ghosh', confidence: 1.0, rule: 'R01-NameExtract' },
                    { doc: 'MemberList_2024.xlsx', table: 'sem_families', id: 'FAM-gh01', col: 'primary_surname', value: 'Ghosh', confidence: 0.98, rule: 'R02-FamilyLink' },
                    { doc: 'Budget_FY2024.xlsx', table: 'transactions', id: 'TXN-001', col: 'amount', value: '$150.00', confidence: 1.0, rule: 'R05-AmountParse' },
                    { doc: 'Jagriti_2024.pdf', table: 'sem_magazine_contributions', id: 'CON-001', col: 'contributor_name', value: 'Anita Basu', confidence: 0.95, rule: 'R09-ContribExtract' },
                    { doc: 'EC_Meeting_Oct2024.docx', table: 'meetings', id: 'MTG-001', col: 'decisions', value: 'Approved budget for Durga Puja', confidence: 0.92, rule: 'R12-MinutesParse' }
                ];
                tbody.innerHTML = sampleLineage.map(r => `<tr>
                    <td style="font-size:0.85rem;"><i class="fas fa-file me-1" style="color:#90a4ae;"></i>${r.doc}</td>
                    <td><code>${r.table}</code></td>
                    <td style="font-size:0.8rem; color:#666;">${r.id}</td>
                    <td><code>${r.col}</code></td>
                    <td style="font-size:0.85rem;">${r.value}</td>
                    <td><span style="color:${r.confidence >= 0.95 ? '#2e7d32' : '#e65100'}; font-weight:600;">${(r.confidence*100).toFixed(0)}%</span></td>
                    <td style="font-size:0.8rem; color:#666;">${r.rule}</td>
                </tr>`).join('');
            }
        };

        /* ================================================================
         *  REPORT BUILDER
         * ================================================================ */
        const ReportBuilder = {
            currentPage: 1, perPage: 25,
            reportData: [], reportFiltered: [], reportColumns: [],
            generatedReports: [],

            render() { this.renderTemplates(); },

            renderTemplates() {
                const grid = document.getElementById('reportTemplateGrid');
                if (!grid) return;
                const templates = [
                    { id: 'membership_summary', name: 'Membership Summary', icon: 'fas fa-users', color: '#1a237e', desc: 'Members by year, tier, retention status', source: 'archive', table: 'sem_memberships' },
                    { id: 'financial_overview', name: 'Financial Overview', icon: 'fas fa-dollar-sign', color: '#2e7d32', desc: 'Income vs expenses by fiscal year', source: 'archive', table: 'transactions' },
                    { id: 'event_attendance', name: 'Event Attendance', icon: 'fas fa-calendar-alt', color: '#e65100', desc: 'Events, types, and attendee counts', source: 'archive', table: 'sem_events' },
                    { id: 'officer_history', name: 'EC Officer History', icon: 'fas fa-landmark', color: '#4a148c', desc: 'Officers by term and role', source: 'archive', table: 'ec_officers' },
                    { id: 'family_universe', name: 'Family Universe', icon: 'fas fa-home', color: '#0277bd', desc: 'All families with retention status', source: 'archive', table: 'sem_families' },
                    { id: 'document_audit', name: 'Document Audit', icon: 'fas fa-file-archive', color: '#4e342e', desc: 'Source documents and extraction status', source: 'archive', table: 'sem_documents' },
                    { id: 'sponsor_report', name: 'Sponsor Report', icon: 'fas fa-handshake', color: '#00695c', desc: 'Sponsorship packages and payments', source: 'archive', table: 'sponsor_payments' },
                    { id: 'current_members', name: 'Current Members', icon: 'fas fa-id-card', color: '#c62828', desc: 'Active member directory snapshot', source: 'current', table: 'memberDirectory' }
                ];
                grid.innerHTML = templates.map(t => `
                    <div onclick="ReportBuilder.runTemplate('${t.id}')" style="border:1px solid #e0e0e0; border-radius:8px; padding:1rem; cursor:pointer; transition:all 0.2s;" onmouseover="this.style.borderColor='${t.color}'; this.style.boxShadow='0 2px 8px ${t.color}22'" onmouseout="this.style.borderColor='#e0e0e0'; this.style.boxShadow=''">
                        <div style="display:flex; align-items:center; gap:0.75rem; margin-bottom:0.5rem;">
                            <i class="${t.icon}" style="color:${t.color}; font-size:1.2rem;"></i>
                            <strong style="font-size:0.9rem;">${t.name}</strong>
                        </div>
                        <p style="margin:0; font-size:0.8rem; color:#666;">${t.desc}</p>
                        <span style="font-size:0.7rem; background:${t.source === 'archive' ? '#fff3e0' : '#e8f5e9'}; color:${t.source === 'archive' ? '#e65100' : '#2e7d32'}; padding:1px 6px; border-radius:4px; margin-top:0.5rem; display:inline-block;">${t.source === 'archive' ? '📦 Archive' : '🔄 Current'}</span>
                    </div>
                `).join('');
            },

            createNew() {
                document.getElementById('reportConfigPanel').style.display = '';
                document.getElementById('reportOutput').style.display = 'none';
                document.getElementById('reportName').value = '';
                document.getElementById('reportDataSource').value = '';
            },

            onSourceChange() {
                const source = document.getElementById('reportDataSource')?.value;
                const tableSel = document.getElementById('reportTable');
                const groupSel = document.getElementById('reportGroupBy');
                if (!tableSel) return;
                tableSel.innerHTML = '<option value="">Select table…</option>';
                if (source === 'archive') {
                    ArchiveSchema.layers.forEach(l => l.tables.forEach(t => { tableSel.innerHTML += `<option value="${t.name}">${t.label}</option>`; }));
                } else if (source === 'current') {
                    Object.entries(UniversalDBExplorer.CURRENT_TABLES).forEach(([k, t]) => { tableSel.innerHTML += `<option value="${k}">${t.label}</option>`; });
                }
                if (groupSel) groupSel.innerHTML = '<option value="">None</option>';
            },

            onTableChange() {
                const source = document.getElementById('reportDataSource')?.value;
                const table = document.getElementById('reportTable')?.value;
                const groupSel = document.getElementById('reportGroupBy');
                if (!groupSel || !table) return;
                let cols = [];
                if (source === 'archive') {
                    const meta = ArchiveSchema.getTableByName(table);
                    if (meta) cols = meta.columns.map(c => c.split(' ')[0]);
                } else {
                    const meta = UniversalDBExplorer.CURRENT_TABLES[table];
                    if (meta) cols = meta.columns;
                }
                groupSel.innerHTML = '<option value="">None</option>' + cols.map(c => `<option value="${c}">${c}</option>`).join('');
            },

            runTemplate(templateId) {
                const templates = {
                    membership_summary: { name: 'Membership Summary Report', source: 'archive', table: 'sem_memberships', type: 'summary' },
                    financial_overview: { name: 'Financial Overview Report', source: 'archive', table: 'transactions', type: 'groupby', groupBy: 'txn_direction' },
                    event_attendance: { name: 'Event Attendance Report', source: 'archive', table: 'sem_events', type: 'table' },
                    officer_history: { name: 'EC Officer History Report', source: 'archive', table: 'ec_officers', type: 'table' },
                    family_universe: { name: 'Family Universe Report', source: 'archive', table: 'sem_families', type: 'table' },
                    document_audit: { name: 'Document Audit Report', source: 'archive', table: 'sem_documents', type: 'table' },
                    sponsor_report: { name: 'Sponsor Report', source: 'archive', table: 'sponsor_payments', type: 'table' },
                    current_members: { name: 'Current Members Report', source: 'current', table: 'memberDirectory', type: 'table' }
                };
                const tpl = templates[templateId];
                if (!tpl) return;
                // Load data
                let data = [];
                if (tpl.source === 'archive') { data = ArchiveDemoData.getTableData(tpl.table); }
                else { data = (DemoData[tpl.table] || DemoData.memberDirectory || []).slice(); }
                this.reportData = data;
                this.reportFiltered = data.slice();
                this.reportColumns = data.length > 0 ? Object.keys(data[0]) : [];
                this.currentPage = 1;
                // Generate output
                this._renderOutput(tpl.name, tpl.type, tpl.groupBy);
                // Log
                this.generatedReports.push({ name: tpl.name, timestamp: new Date().toLocaleString(), rows: data.length, type: tpl.type });
                this._renderSavedReports();
            },

            generate() {
                const name = document.getElementById('reportName')?.value || 'Custom Report';
                const source = document.getElementById('reportDataSource')?.value;
                const table = document.getElementById('reportTable')?.value;
                const type = document.getElementById('reportType')?.value || 'table';
                const groupBy = document.getElementById('reportGroupBy')?.value || '';
                if (!source || !table) { alert('Please select a data source and table.'); return; }
                let data = [];
                if (source === 'archive') { data = ArchiveDemoData.getTableData(table); }
                else { data = (DemoData[table] || DemoData.memberDirectory || []).slice(); }
                this.reportData = data;
                this.reportFiltered = data.slice();
                this.reportColumns = data.length > 0 ? Object.keys(data[0]) : [];
                this.currentPage = 1;
                this._renderOutput(name, type, groupBy);
                this.generatedReports.push({ name, timestamp: new Date().toLocaleString(), rows: data.length, type });
                this._renderSavedReports();
            },

            _renderOutput(name, type, groupBy) {
                document.getElementById('reportConfigPanel').style.display = 'none';
                const output = document.getElementById('reportOutput');
                output.style.display = '';
                document.getElementById('reportOutputTitle').innerHTML = `<i class="fas fa-file-alt me-2"></i>${name}`;
                // Summary stats
                const statsEl = document.getElementById('reportSummaryStats');
                statsEl.innerHTML = `
                    <div class="admin-card" style="text-align:center;"><h3 style="color:#1a237e;">${this.reportData.length}</h3><p style="margin:0;font-size:0.85rem;">Total Records</p></div>
                    <div class="admin-card" style="text-align:center;"><h3 style="color:#2e7d32;">${this.reportColumns.length}</h3><p style="margin:0;font-size:0.85rem;">Columns</p></div>
                    <div class="admin-card" style="text-align:center;"><h3 style="color:#e65100;">${type}</h3><p style="margin:0;font-size:0.85rem;">Report Type</p></div>
                    <div class="admin-card" style="text-align:center;"><h3 style="color:#4a148c;">${new Date().toLocaleDateString()}</h3><p style="margin:0;font-size:0.85rem;">Generated</p></div>`;
                // Chart area (group by)
                const chartEl = document.getElementById('reportChartArea');
                if (type === 'groupby' && groupBy && this.reportData.length > 0) {
                    const groups = {};
                    this.reportData.forEach(r => { const g = r[groupBy] || 'Unknown'; groups[g] = (groups[g] || 0) + 1; });
                    chartEl.innerHTML = '<div style="display:flex; gap:1rem; flex-wrap:wrap;">' + Object.entries(groups).map(([k, v]) => `<div style="background:#f5f5f5; padding:0.75rem 1.25rem; border-radius:8px; text-align:center; min-width:100px;"><strong style="font-size:1.2rem; color:#1a237e;">${v}</strong><br><span style="font-size:0.8rem; color:#666;">${k}</span></div>`).join('') + '</div>';
                } else if (type === 'summary') {
                    const numCols = this.reportColumns.filter(c => this.reportData.some(r => typeof r[c] === 'number'));
                    chartEl.innerHTML = '<div style="display:flex; gap:1rem; flex-wrap:wrap;">' + numCols.map(c => {
                        const vals = this.reportData.map(r => r[c]).filter(v => typeof v === 'number');
                        const sum = vals.reduce((a,b) => a+b, 0);
                        const avg = vals.length ? (sum / vals.length).toFixed(2) : 0;
                        return `<div style="background:#f5f5f5; padding:0.75rem 1.25rem; border-radius:8px; text-align:center;"><strong style="color:#2e7d32;">Σ${sum.toLocaleString()}</strong><br><span style="font-size:0.8rem; color:#666;">${c} (avg: ${avg})</span></div>`;
                    }).join('') + '</div>';
                } else { chartEl.innerHTML = ''; }
                // Render table
                this.renderReportTable();
            },

            renderReportTable() {
                const thead = document.getElementById('reportResultHead');
                const tbody = document.getElementById('reportResultBody');
                if (!thead || !tbody) return;
                thead.innerHTML = '<tr><th>#</th>' + this.reportColumns.map(c => `<th>${c}</th>`).join('') + '</tr>';
                const start = (this.currentPage - 1) * this.perPage;
                const page = this.reportFiltered.slice(start, start + this.perPage);
                const tp = Math.max(1, Math.ceil(this.reportFiltered.length / this.perPage));
                tbody.innerHTML = page.map((row, i) => '<tr><td>' + (start+i+1) + '</td>' + this.reportColumns.map(c => { let v = row[c]; if (v === null || v === undefined) v = ''; if (typeof v === 'number') return `<td style="text-align:right;">${v.toLocaleString()}</td>`; v = String(v); if (v.length > 60) v = v.substring(0,57)+'…'; return `<td style="font-size:0.85rem;">${v}</td>`; }).join('') + '</tr>').join('') || '<tr><td colspan="99" style="text-align:center;color:#999;padding:2rem;">No data</td></tr>';
                document.getElementById('reportPageInfo').textContent = `${this.reportFiltered.length ? start+1 : 0}–${Math.min(start+this.perPage, this.reportFiltered.length)} of ${this.reportFiltered.length} (Page ${this.currentPage}/${tp})`;
                document.getElementById('reportPrevBtn').disabled = this.currentPage <= 1;
                document.getElementById('reportNextBtn').disabled = this.currentPage >= tp;
            },

            prevPage() { if (this.currentPage > 1) { this.currentPage--; this.renderReportTable(); } },
            nextPage() { const tp = Math.ceil(this.reportFiltered.length / this.perPage); if (this.currentPage < tp) { this.currentPage++; this.renderReportTable(); } },

            exportReport(format) {
                if (!this.reportFiltered.length) return;
                if (format === 'csv') {
                    const rows = [this.reportColumns.join(','), ...this.reportFiltered.map(r => this.reportColumns.map(c => '"'+String(r[c]||'').replace(/"/g,'""')+'"').join(','))];
                    const blob = new Blob([rows.join('\n')], { type: 'text/csv' });
                    const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
                    a.download = 'banf_report_' + new Date().toISOString().slice(0,10) + '.csv'; a.click(); URL.revokeObjectURL(a.href);
                } else if (format === 'xlsx') {
                    if (typeof XLSX === 'undefined') { alert('❌ SheetJS not loaded.'); return; }
                    const ws = XLSX.utils.json_to_sheet(this.reportFiltered);
                    const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, 'Report');
                    XLSX.writeFile(wb, 'banf_report_' + new Date().toISOString().slice(0,10) + '.xlsx');
                }
            },

            printReport() { window.print(); },

            _renderSavedReports() {
                const el = document.getElementById('savedReportsList');
                if (!el) return;
                if (this.generatedReports.length === 0) { el.innerHTML = '<p style="text-align:center; color:#999; padding:1rem;">No reports generated yet.</p>'; return; }
                el.innerHTML = '<div class="admin-table"><table><thead><tr><th>#</th><th>Report Name</th><th>Type</th><th>Rows</th><th>Generated</th></tr></thead><tbody>' +
                    this.generatedReports.map((r, i) => `<tr><td>${i+1}</td><td><strong>${r.name}</strong></td><td>${r.type}</td><td>${r.rows}</td><td style="font-size:0.85rem; color:#666;">${r.timestamp}</td></tr>`).join('') +
                    '</tbody></table></div>';
            }
        };

        /* ================================================================
         *  GMAIL / EMAIL MANAGEMENT FUNCTIONS
         * ================================================================ */

        let gmailState = { connected: false, currentPage: 1, perPage: 15, currentEmail: null, contactGroups: {} };

        async function gmailCheckConnection() {
            const icon = document.getElementById('gmailStatusIcon');
            const text = document.getElementById('gmailStatusText');
            const detail = document.getElementById('gmailStatusDetail');
            const bar = document.getElementById('gmailConnectionStatus');
            icon.style.color = '#ff9800'; text.textContent = 'Connecting...'; detail.textContent = 'Connecting to BANF Email Service...';
            const { ok, status, data } = await safeApiFetch('/status');
            if (ok && data.status === 'connected') {
                icon.style.color = '#4CAF50'; text.textContent = '✅ Connected to BANF Email Service';
                detail.textContent = `Service: ${data.service_type || data.service || 'Wix'} | Sent Today: ${data.sentToday || data.sent_today || 0}`;
                bar.style.borderLeftColor = '#4CAF50'; gmailState.connected = true;
                gmailLoadUnreadCount();
            } else if (status === 404) {
                icon.style.color = '#ff9800'; text.textContent = '⚠️ Email Backend Not Yet Deployed';
                detail.innerHTML = 'The Wix Velo email backend needs to be published. '
                    + '<strong>Steps:</strong> Open Wix Editor → Dev Mode → publish <code>email-gateway.jsw</code> + <code>http-functions.js</code> → Publish Site. '
                    + '<br><small class="text-muted">Endpoint: ' + WIX_API_BASE + '/email_status → 404</small>';
                bar.style.borderLeftColor = '#ff9800';
            } else {
                icon.style.color = '#f44336'; text.textContent = '❌ Connection Failed';
                detail.textContent = data.error || 'Email service temporarily unavailable';
                bar.style.borderLeftColor = '#f44336';
            }
        }

        async function gmailLoadUnreadCount() {
            const { ok, data } = await safeApiFetch('/unread');
            const badge = document.getElementById('gmailUnreadBadge');
            const stat = document.getElementById('gmailStatUnread');
            if (ok && data.unread_count > 0) { badge.style.display = 'inline-block'; badge.textContent = data.unread_count; stat.textContent = data.unread_count; }
            else { badge.style.display = 'none'; stat.textContent = '0'; }
        }

        function gmailShowTab(tab, clickedEl) {
            ['inbox','compose','contacts','search'].forEach(t => {
                const el = document.getElementById('gmailTab' + t.charAt(0).toUpperCase() + t.slice(1));
                if (el) el.style.display = (t === tab) ? 'block' : 'none';
            });
            document.querySelectorAll('#gmailTabs .nav-link').forEach(a => a.classList.remove('active'));
            const fallbackActive = {
                inbox: '#gmailTabs .nav-item:nth-child(1) .nav-link',
                compose: '#gmailTabs .nav-item:nth-child(2) .nav-link',
                contacts: '#gmailTabs .nav-item:nth-child(3) .nav-link',
                search: '#gmailTabs .nav-item:nth-child(4) .nav-link'
            };
            let target = clickedEl || null;
            if (!target) { try { target = (typeof event !== 'undefined' && event && event.target) ? event.target : null; } catch(ex) { /* no event context */ } }
            if (!target) target = document.querySelector(fallbackActive[tab] || fallbackActive.inbox);
            if (target) target.classList.add('active');
            if (tab === 'inbox') gmailLoadInbox();
            if (tab === 'contacts') gmailLoadContactGroups();
        }

        function gmailOpenCompose(to, subject, body) {
            gmailShowTab('compose');
            document.querySelectorAll('#gmailTabs .nav-link').forEach(a => a.classList.remove('active'));
            document.querySelectorAll('#gmailTabs .nav-link')[1].classList.add('active');
            if (to) document.getElementById('gmailComposeTo').value = to;
            if (subject) document.getElementById('gmailComposeSubject').value = subject;
            if (body) document.getElementById('gmailComposeBody').value = body;
        }

        async function gmailLoadInbox() {
            const tbody = document.getElementById('gmailInboxTableBody');
            const folder = document.getElementById('gmailFolderSelect').value;
            tbody.innerHTML = '<tr><td colspan="5" class="text-center"><i class="fas fa-spinner fa-spin me-2"></i>Loading...</td></tr>';
            const { ok, status, data } = await safeApiFetch(`/inbox?page=${gmailState.currentPage}&per_page=${gmailState.perPage}&folder=${encodeURIComponent(folder)}`);
            if (!ok) {
                const msg = status === 404
                    ? '⚠️ Email backend not deployed yet. Publish Wix Velo code to enable inbox.'
                    : `❌ Failed to load inbox: ${data.error || 'Service unavailable'}`;
                tbody.innerHTML = `<tr><td colspan="5" class="text-center text-muted">${msg}</td></tr>`;
                document.getElementById('gmailStatInbox').textContent = '--'; return;
            }
            const d = data;
            if (!d.emails || d.emails.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center text-muted">No emails found</td></tr>';
                document.getElementById('gmailStatInbox').textContent = '0'; return;
            }
            document.getElementById('gmailStatInbox').textContent = d.total || d.emails.length;
            tbody.innerHTML = d.emails.map(em => {
                const unread = !em.seen;
                const fw = unread ? 'fw-bold' : '';
                const bg = unread ? 'background:#fff8e1;' : '';
                const fromShort = (em.from || 'Unknown').replace(/<.*>/,'').trim().substring(0,30);
                const subjShort = (em.subject || '(no subject)').substring(0,60);
                const dateShort = em.date ? new Date(em.date).toLocaleDateString() : '';
                return `<tr style="${bg}" onclick="gmailViewEmail('${em.id}','${encodeURIComponent(folder)}')" class="cursor-pointer">
                    <td class="${fw}">${escapeHtml(fromShort)}</td>
                    <td class="${fw}">${escapeHtml(subjShort)}</td>
                    <td>${dateShort}</td>
                    <td>${em.has_attachments ? '<i class="fas fa-paperclip text-muted"></i>' : ''}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="event.stopPropagation();gmailReplyToId('${em.id}','${encodeURIComponent(folder)}')"><i class="fas fa-reply"></i></button>
                        <button class="btn btn-sm btn-outline-danger" onclick="event.stopPropagation();gmailDeleteEmail('${em.id}','${encodeURIComponent(folder)}')"><i class="fas fa-trash"></i></button>
                    </td></tr>`;
            }).join('');
            // Pagination
            const totalPages = Math.ceil((d.total || d.emails.length) / gmailState.perPage);
            const pag = document.getElementById('gmailPagination');
            pag.innerHTML = '';
            if (totalPages > 1) {
                for (let p = 1; p <= Math.min(totalPages, 10); p++) {
                    pag.innerHTML += `<button class="btn btn-sm ${p===gmailState.currentPage?'btn-primary':'btn-outline-secondary'}" onclick="gmailState.currentPage=${p};gmailLoadInbox()">${p}</button>`;
                }
            }
        }

        async function gmailViewEmail(emailId, folder) {
            document.getElementById('gmailReaderArea').style.display = 'block';
            document.getElementById('gmailReaderBody').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
            const { ok, status, data } = await safeApiFetch(`/email/${emailId}?folder=${folder || 'INBOX'}`);
            if (!ok) {
                document.getElementById('gmailReaderBody').innerHTML = status === 404
                    ? '<div class="text-warning">⚠️ Email backend not deployed yet.</div>'
                    : `<div class="text-danger">Error loading email: ${data.error}</div>`;
                return;
            }
            const em = data;
            gmailState.currentEmail = em;
            document.getElementById('gmailReaderSubject').textContent = em.subject || '(no subject)';
            document.getElementById('gmailReaderFrom').textContent = `From: ${em.from || 'Unknown'}`;
            document.getElementById('gmailReaderDate').textContent = em.date || '';
            const body = em.body_html || escapeHtml(em.body || 'No content');
            document.getElementById('gmailReaderBody').innerHTML = em.body_html ? body : `<pre style="white-space:pre-wrap">${body}</pre>`;
            // Mark as read
            safeApiFetch(`/mark-read/${emailId}`, { method: 'POST' });
            gmailLoadUnreadCount();
        }

        function gmailReplyTo() {
            if (!gmailState.currentEmail) return;
            const em = gmailState.currentEmail;
            const fromEmail = (em.from || '').match(/<([^>]+)>/);
            const to = fromEmail ? fromEmail[1] : em.from;
            gmailOpenCompose(to, 'Re: ' + (em.subject || ''), `\n\n--- Original Message ---\nFrom: ${em.from}\nDate: ${em.date}\n\n${em.body || ''}`);
        }

        async function gmailReplyToId(emailId, folder) {
            const { ok, data } = await safeApiFetch(`/email/${emailId}?folder=${decodeURIComponent(folder)}`);
            if (!ok) { alert('Could not load email for reply'); return; }
            const em = data;
            const fromEmail = (em.from || '').match(/<([^>]+)>/);
            const to = fromEmail ? fromEmail[1] : em.from;
            gmailOpenCompose(to, 'Re: ' + (em.subject || ''), `\n\n--- Original Message ---\nFrom: ${em.from}\nDate: ${em.date}\n\n${em.body || ''}`);
        }

        function gmailForwardEmail() {
            if (!gmailState.currentEmail) return;
            const em = gmailState.currentEmail;
            gmailOpenCompose('', 'Fwd: ' + (em.subject || ''), `\n\n--- Forwarded Message ---\nFrom: ${em.from}\nDate: ${em.date}\nSubject: ${em.subject}\n\n${em.body || ''}`);
        }

        async function gmailSendEmail(e) {
            if (e && e.preventDefault) e.preventDefault();
            const to = document.getElementById('gmailComposeTo').value;
            const cc = document.getElementById('gmailComposeCc').value;
            const bcc = document.getElementById('gmailComposeBcc').value;
            const subject = document.getElementById('gmailComposeSubject').value;
            const body = document.getElementById('gmailComposeBody').value;
            if (!to || !subject) { alert('Please fill in To and Subject fields'); return false; }
            const { ok, status, data } = await safeApiFetch('/send', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ to, cc: cc || undefined, bcc: bcc || undefined, subject, body })
            });
            if (ok && data.success) {
                alert('✅ Email sent successfully!');
                document.getElementById('gmailComposeForm').reset();
                gmailShowTab('inbox');
            } else if (status === 404) {
                alert('⚠️ Email backend not deployed yet. Please publish the Wix Velo code first.');
            } else {
                alert('❌ Failed to send: ' + (data.error || 'Unknown error'));
            }
            return false;
        }

        async function gmailDeleteEmail(emailId, folder) {
            if (!confirm('Move this email to Trash?')) return;
            const { ok, status, data } = await safeApiFetch(`/delete/${emailId}`, { method: 'DELETE' });
            if (!ok && status === 404) { alert('⚠️ Email backend not deployed yet.'); return; }
            gmailLoadInbox();
        }

        async function gmailSearchEmails() {
            const q = document.getElementById('gmailSearchQuery').value;
            if (!q) return;
            const results = document.getElementById('gmailSearchResults');
            results.innerHTML = '<div class="text-center"><i class="fas fa-spinner fa-spin me-2"></i>Searching...</div>';
            const { ok, status, data } = await safeApiFetch(`/search?q=${encodeURIComponent(q)}`);
            if (!ok) {
                results.innerHTML = status === 404
                    ? '<div class="admin-card text-warning">⚠️ Search unavailable — email backend not deployed yet.</div>'
                    : `<div class="admin-card text-danger">Search failed: ${data.error}</div>`;
                return;
            }
            if (!data.results || data.results.length === 0) {
                results.innerHTML = '<div class="admin-card text-muted">No results found</div>'; return;
            }
            results.innerHTML = '<div class="admin-card"><h5>Found ' + data.results.length + ' results</h5><div class="admin-table"><table><thead><tr><th>From</th><th>Subject</th><th>Date</th></tr></thead><tbody>' +
                data.results.map(em => `<tr style="cursor:pointer" onclick="gmailViewEmail('${em.id}','INBOX')"><td>${escapeHtml((em.from||'').substring(0,30))}</td><td>${escapeHtml((em.subject||'').substring(0,50))}</td><td>${em.date?new Date(em.date).toLocaleDateString():''}</td></tr>`).join('') +
                '</tbody></table></div></div>';
        }

        // === CONTACT GROUPS ===

        async function gmailLoadContactGroups() {
            const container = document.getElementById('gmailContactGroupsList');
            const { ok, status, data } = await safeApiFetch('/contacts');
            if (!ok) {
                const msg = status === 404
                    ? '<div class="admin-card" style="border-left:4px solid #ff9800;"><i class="fas fa-info-circle me-2 text-warning"></i>Contact groups will be available after the Wix Velo backend is published.</div>'
                    : `<div class="admin-card text-danger"><i class="fas fa-exclamation-circle me-2"></i>Error loading groups: ${data.error}</div>`;
                container.innerHTML = msg;
                document.getElementById('gmailStatGroups').textContent = '--'; return;
            }
            gmailState.contactGroups = data.groups || {};
            const groupNames = Object.keys(gmailState.contactGroups);
            document.getElementById('gmailStatGroups').textContent = groupNames.length;
            if (groupNames.length === 0) {
                container.innerHTML = '<div class="admin-card text-muted"><i class="fas fa-address-book me-2"></i>No contact groups yet. Click "New Group" to create one.</div>';
                return;
            }
                container.innerHTML = groupNames.map(name => {
                    const contacts = gmailState.contactGroups[name];
                    return `<div class="admin-card" style="border-left:4px solid var(--gold);">
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <h5><i class="fas fa-users me-2"></i>${escapeHtml(name)} <span class="badge bg-primary">${contacts.length}</span></h5>
                            <div style="display:flex;gap:0.3rem;">
                                <button class="btn btn-sm btn-outline-primary" onclick="gmailShowAddContact('${escapeHtml(name)}')" title="Add contact"><i class="fas fa-user-plus"></i></button>
                                <button class="btn btn-sm btn-outline-success" onclick="gmailSendToGroup('${escapeHtml(name)}')" title="Send email to group"><i class="fas fa-paper-plane"></i></button>
                                <button class="btn btn-sm btn-outline-danger" onclick="gmailDeleteGroup('${escapeHtml(name)}')" title="Delete group"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                        ${contacts.length > 0 ? '<div class="mt-2">' + contacts.map((c,i) =>
                            `<span class="badge bg-secondary me-1 mb-1" style="font-size:0.8rem;">${escapeHtml(c.name || c.email)} &lt;${escapeHtml(c.email)}&gt; <i class="fas fa-times ms-1" style="cursor:pointer" onclick="gmailRemoveFromGroup('${escapeHtml(name)}','${escapeHtml(c.email)}')"></i></span>`
                        ).join('') + '</div>' : '<p class="text-muted mb-0 mt-2">No contacts in this group</p>'}
                    </div>`;
                }).join('');
        }

        async function gmailCreateGroupPrompt() {
            const name = prompt('Enter group name (e.g., "EC Members", "All Members", "Volunteers"):');
            if (!name) return;
            const { ok, status, data } = await safeApiFetch('/contacts/group', {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ group_name: name })
            });
            if (ok && data.success) { alert('✅ Group "' + name + '" created!'); gmailLoadContactGroups(); }
            else if (status === 404) { alert('⚠️ Contact groups unavailable — email backend not deployed yet.'); }
            else { alert('❌ ' + (data.error || 'Failed to create group')); }
        }

        function gmailShowAddContact(groupName) {
            document.getElementById('gmailAddContactForm').style.display = 'block';
            document.getElementById('gmailAddContactGroupName').textContent = groupName;
            document.getElementById('gmailAddContactForm').dataset.group = groupName;
            document.getElementById('gmailAddContactName').value = '';
            document.getElementById('gmailAddContactEmail').value = '';
        }

        async function gmailAddContactToGroup() {
            const group = document.getElementById('gmailAddContactForm').dataset.group;
            const name = document.getElementById('gmailAddContactName').value;
            const email = document.getElementById('gmailAddContactEmail').value;
            if (!email) { alert('Email is required'); return; }
            const { ok, status, data } = await safeApiFetch(`/contacts/group/${encodeURIComponent(group)}/add`, {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contacts: [{ name: name || email, email }] })
            });
            if (ok && data.success) { gmailLoadContactGroups(); document.getElementById('gmailAddContactName').value = ''; document.getElementById('gmailAddContactEmail').value = ''; }
            else if (status === 404) { alert('⚠️ Email backend not deployed yet.'); }
            else { alert('❌ ' + (data.error || 'Failed')); }
        }

        async function gmailRemoveFromGroup(groupName, email) {
            if (!confirm(`Remove ${email} from "${groupName}"?`)) return;
            const { ok, status } = await safeApiFetch(`/contacts/group/${encodeURIComponent(groupName)}/remove`, {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ emails: [email] })
            });
            if (!ok && status === 404) { alert('⚠️ Email backend not deployed yet.'); return; }
            gmailLoadContactGroups();
        }

        async function gmailDeleteGroup(name) {
            if (!confirm(`Delete group "${name}" and all its contacts?`)) return;
            const { ok, status } = await safeApiFetch(`/contacts/group/${encodeURIComponent(name)}`, { method: 'DELETE' });
            if (!ok && status === 404) { alert('⚠️ Email backend not deployed yet.'); return; }
            gmailLoadContactGroups();
        }

        function gmailSendToGroup(groupName) {
            const contacts = gmailState.contactGroups[groupName] || [];
            if (contacts.length === 0) { alert('No contacts in this group'); return; }
            const emails = contacts.map(c => c.email).join(', ');
            gmailOpenCompose(emails, '', '');
        }

        /* ================================================================
         *  ADMIN SECTION HANDLER FUNCTIONS (Events, Complaints, Surveys,
         *  Announcements, Magazine, Budget, Vendors, Volunteers, Meetings)
         *  ── localStorage-backed CRUD with demo data
         * ================================================================ */

        // ────────────── EVENTS ──────────────
        const adminEventsStore = {
            key: 'banf_admin_events',
            data: null,
            defaults: [
                { id: 1, name: 'Durga Puja 2025', date: '2025-10-01', time: '10:00', venue: 'BANF Community Hall', description: 'Annual Durga Puja celebration', category: 'Cultural', status: 'Upcoming', rsvps: 145 },
                { id: 2, name: 'Nabo Borsho 1432', date: '2025-04-14', time: '17:00', venue: 'Jacksonville Civic Center', description: 'Bengali New Year celebration', category: 'Cultural', status: 'Completed', rsvps: 210 },
                { id: 3, name: 'Summer Picnic 2025', date: '2025-06-21', time: '11:00', venue: 'Hanna Park', description: 'Annual summer picnic with games and food', category: 'Social', status: 'Upcoming', rsvps: 89 },
                { id: 4, name: 'Saraswati Puja', date: '2025-02-02', time: '09:00', venue: 'BANF Community Hall', description: 'Saraswati Puja and cultural program', category: 'Religious', status: 'Completed', rsvps: 120 },
                { id: 5, name: 'Annual General Meeting', date: '2025-12-15', time: '14:00', venue: 'Virtual (Zoom)', description: 'AGM for BANF members', category: 'Administrative', status: 'Draft', rsvps: 0 }
            ],
            load() { try { const s = localStorage.getItem(this.key); this.data = s ? JSON.parse(s) : [...this.defaults]; } catch(e) { this.data = [...this.defaults]; } return this.data; },
            save() { localStorage.setItem(this.key, JSON.stringify(this.data)); },
            nextId() { return this.data.length ? Math.max(...this.data.map(d => d.id)) + 1 : 1; }
        };

        function renderAdminEvents() {
            const data = adminEventsStore.load();
            const tbody = document.getElementById('eventsTableBody');
            if (!tbody) return;
            const upcoming = data.filter(e => e.status === 'Upcoming').length;
            const drafts = data.filter(e => e.status === 'Draft').length;
            const totalRsvps = data.reduce((s, e) => s + (e.rsvps || 0), 0);
            const stats = document.querySelectorAll('#adminEvents .stat-number');
            if (stats.length >= 4) { stats[0].textContent = upcoming; stats[1].textContent = data.length; stats[2].textContent = totalRsvps; stats[3].textContent = drafts; }
            tbody.innerHTML = data.map(e => `<tr>
                <td>${escapeHtml(e.name)}</td><td>${e.date}</td><td>${escapeHtml(e.venue)}</td>
                <td>${e.rsvps}</td><td><span class="badge bg-${e.status==='Upcoming'?'success':e.status==='Completed'?'secondary':'warning'}">${e.status}</span></td>
                <td><button class="btn btn-sm btn-outline-primary me-1" onclick="openEventModal(${e.id})"><i class="fas fa-edit"></i></button>
                <button class="btn btn-sm btn-outline-danger" onclick="deleteAdminItem(adminEventsStore,${e.id},renderAdminEvents)"><i class="fas fa-trash"></i></button></td></tr>`).join('');
        }
        function openEventModal(id) {
            const modal = document.getElementById('eventModal'); if (!modal) return;
            const data = adminEventsStore.load();
            const item = id ? data.find(d => d.id === id) : null;
            document.getElementById('eventModalTitle').textContent = item ? 'Edit Event' : 'Create Event';
            document.getElementById('eventEditId').value = item ? item.id : '';
            document.getElementById('eventName').value = item ? item.name : '';
            document.getElementById('eventDate').value = item ? item.date : '';
            document.getElementById('eventTime').value = item ? item.time : '';
            document.getElementById('eventVenue').value = item ? item.venue : '';
            document.getElementById('eventDescription').value = item ? item.description : '';
            document.getElementById('eventCategory').value = item ? item.category : 'Cultural';
            document.getElementById('eventStatus').value = item ? item.status : 'Draft';
            modal.style.display = 'block';
        }
        function closeEventModal() { const m = document.getElementById('eventModal'); if (m) m.style.display = 'none'; }
        function saveEvent() {
            const data = adminEventsStore.load();
            const editId = document.getElementById('eventEditId').value;
            const obj = { name: document.getElementById('eventName').value, date: document.getElementById('eventDate').value, time: document.getElementById('eventTime').value, venue: document.getElementById('eventVenue').value, description: document.getElementById('eventDescription').value, category: document.getElementById('eventCategory').value, status: document.getElementById('eventStatus').value };
            if (!obj.name || !obj.date) { alert('Event name and date are required'); return; }
            if (editId) { const idx = data.findIndex(d => d.id == editId); if (idx > -1) Object.assign(data[idx], obj); }
            else { obj.id = adminEventsStore.nextId(); obj.rsvps = 0; data.push(obj); }
            adminEventsStore.data = data; adminEventsStore.save(); closeEventModal(); renderAdminEvents();
            if (typeof showStatusMessage === 'function') showStatusMessage('success', 'Event saved successfully');
        }

        // ────────────── COMPLAINTS ──────────────
        const adminComplaintsStore = {
            key: 'banf_admin_complaints',
            data: null,
            defaults: [
                { id: 1, date: '2025-01-10', member: 'Anita Roy', category: 'Facilities', subject: 'Hall AC not working during event', priority: 'High', status: 'In Progress', details: 'The AC unit was not functioning during the Saraswati Puja event.', resolution: '' },
                { id: 2, date: '2025-01-05', member: 'Rajesh Gupta', category: 'Communication', subject: 'Event schedule not communicated on time', priority: 'Medium', status: 'Resolved', details: 'Members did not receive timely notification about schedule changes.', resolution: 'Implemented automated email notifications for schedule changes.' },
                { id: 3, date: '2025-01-15', member: 'Priya Sen', category: 'Food', subject: 'Catering quality below expectations', priority: 'Medium', status: 'New', details: 'Food at the last community dinner was cold and insufficient for the number of attendees.', resolution: '' }
            ],
            load() { try { const s = localStorage.getItem(this.key); this.data = s ? JSON.parse(s) : [...this.defaults]; } catch(e) { this.data = [...this.defaults]; } return this.data; },
            save() { localStorage.setItem(this.key, JSON.stringify(this.data)); },
            nextId() { return this.data.length ? Math.max(...this.data.map(d => d.id)) + 1 : 1; }
        };

        function renderAdminComplaints() {
            const data = adminComplaintsStore.load();
            const tbody = document.getElementById('complaintsTableBody');
            if (!tbody) return;
            const stats = document.querySelectorAll('#adminComplaints .stat-number');
            if (stats.length >= 4) { stats[0].textContent = data.filter(c => c.status === 'New').length; stats[1].textContent = data.filter(c => c.status === 'In Progress').length; stats[2].textContent = data.filter(c => c.status === 'Resolved').length; stats[3].textContent = data.length; }
            tbody.innerHTML = data.map(c => `<tr>
                <td>#${c.id}</td><td>${c.date}</td><td>${escapeHtml(c.member)}</td><td>${escapeHtml(c.category)}</td>
                <td>${escapeHtml(c.subject)}</td><td><span class="badge bg-${c.priority==='High'?'danger':c.priority==='Medium'?'warning':'info'}">${c.priority}</span></td>
                <td><span class="badge bg-${c.status==='New'?'primary':c.status==='In Progress'?'warning':'success'}">${c.status}</span></td>
                <td><button class="btn btn-sm btn-outline-primary me-1" onclick="openComplaintModal(${c.id})"><i class="fas fa-edit"></i></button>
                <button class="btn btn-sm btn-outline-danger" onclick="deleteAdminItem(adminComplaintsStore,${c.id},renderAdminComplaints)"><i class="fas fa-trash"></i></button></td></tr>`).join('');
        }
        function openComplaintModal(id) {
            const modal = document.getElementById('adminComplaintModal'); if (!modal) return;
            const data = adminComplaintsStore.load(); const item = id ? data.find(d => d.id === id) : null;
            document.getElementById('admComplaintModalTitle').textContent = item ? 'Edit Complaint' : 'New Complaint';
            document.getElementById('admComplaintEditId').value = item ? item.id : '';
            document.getElementById('admComplaintMember').value = item ? item.member : '';
            document.getElementById('admComplaintCategory').value = item ? item.category : 'General';
            document.getElementById('admComplaintPriority').value = item ? item.priority : 'Medium';
            document.getElementById('admComplaintSubject').value = item ? item.subject : '';
            document.getElementById('admComplaintDetails').value = item ? item.details : '';
            document.getElementById('admComplaintStatus').value = item ? item.status : 'New';
            document.getElementById('admComplaintResolution').value = item ? item.resolution : '';
            modal.style.display = 'block';
        }
        function closeComplaintModal() { const m = document.getElementById('adminComplaintModal'); if (m) m.style.display = 'none'; }
        function saveComplaint() {
            const data = adminComplaintsStore.load();
            const editId = document.getElementById('admComplaintEditId').value;
            const obj = { member: document.getElementById('admComplaintMember').value, category: document.getElementById('admComplaintCategory').value, priority: document.getElementById('admComplaintPriority').value, subject: document.getElementById('admComplaintSubject').value, details: document.getElementById('admComplaintDetails').value, status: document.getElementById('admComplaintStatus').value, resolution: document.getElementById('admComplaintResolution').value };
            if (!obj.subject) { alert('Subject is required'); return; }
            if (editId) { const idx = data.findIndex(d => d.id == editId); if (idx > -1) Object.assign(data[idx], obj); }
            else { obj.id = adminComplaintsStore.nextId(); obj.date = new Date().toISOString().slice(0,10); data.push(obj); }
            adminComplaintsStore.data = data; adminComplaintsStore.save(); closeComplaintModal(); renderAdminComplaints();
            if (typeof showStatusMessage === 'function') showStatusMessage('success', 'Complaint saved successfully');
        }

        // ────────────── SURVEYS ──────────────
        const adminSurveysStore = {
            key: 'banf_admin_surveys',
            data: null,
            defaults: [
                { id: 1, name: 'Event Satisfaction Survey 2025', questions: 8, responses: 67, created: '2025-01-01', deadline: '2025-03-31', status: 'Active', questionList: 'How satisfied were you with the event?\nHow was the food quality?\nWould you attend again?\nRate the venue (1-5)\nAny suggestions?\nFavorite part of the event?\nHow did you hear about us?\nOverall rating (1-10)' },
                { id: 2, name: 'Community Needs Assessment', questions: 12, responses: 34, created: '2024-11-01', deadline: '2025-01-31', status: 'Closed', questionList: 'What programs would you like BANF to offer?\nHow often should we hold events?\nPreferred event timings?\nWould you volunteer?\nBiggest challenge as a community member?\nPreferred communication method?\nInterest in cultural classes?\nInterest in language classes?\nInterest in sports activities?\nFeedback on current leadership?\nBudget priority areas?\nAny other suggestions?' },
                { id: 3, name: 'Durga Puja Planning Survey', questions: 6, responses: 0, created: '2025-01-15', deadline: '2025-06-30', status: 'Active', questionList: 'Preferred Puja dates?\nWould you volunteer for setup?\nFood preference: vegetarian/non-veg/both?\nBudget contribution willingness?\nPreferred entertainment?\nAny special requirements?' }
            ],
            load() { try { const s = localStorage.getItem(this.key); this.data = s ? JSON.parse(s) : [...this.defaults]; } catch(e) { this.data = [...this.defaults]; } return this.data; },
            save() { localStorage.setItem(this.key, JSON.stringify(this.data)); },
            nextId() { return this.data.length ? Math.max(...this.data.map(d => d.id)) + 1 : 1; }
        };

        function renderAdminSurveys() {
            const data = adminSurveysStore.load();
            const tbody = document.getElementById('surveysTableBody');
            if (!tbody) return;
            const stats = document.querySelectorAll('#adminSurveys .stat-number');
            const active = data.filter(s => s.status === 'Active').length;
            const totalResp = data.reduce((s, d) => s + (d.responses || 0), 0);
            const avgRate = data.length ? (totalResp / data.length).toFixed(1) : '0';
            const closed = data.filter(s => s.status === 'Closed').length;
            if (stats.length >= 4) { stats[0].textContent = active; stats[1].textContent = totalResp; stats[2].textContent = avgRate; stats[3].textContent = closed; }
            tbody.innerHTML = data.map(s => `<tr>
                <td>${escapeHtml(s.name)}</td><td>${s.questions}</td><td>${s.responses}</td><td>${s.created}</td><td>${s.deadline}</td>
                <td><span class="badge bg-${s.status==='Active'?'success':'secondary'}">${s.status}</span></td>
                <td><button class="btn btn-sm btn-outline-primary me-1" onclick="openAdminSurveyModal(${s.id})"><i class="fas fa-edit"></i></button>
                <button class="btn btn-sm btn-outline-danger" onclick="deleteAdminItem(adminSurveysStore,${s.id},renderAdminSurveys)"><i class="fas fa-trash"></i></button></td></tr>`).join('');
        }
        function openAdminSurveyModal(id) {
            const modal = document.getElementById('adminSurveyModal'); if (!modal) return;
            const data = adminSurveysStore.load(); const item = id ? data.find(d => d.id === id) : null;
            document.getElementById('surveyModalTitle').textContent = item ? 'Edit Survey' : 'Create Survey';
            document.getElementById('surveyEditId').value = item ? item.id : '';
            document.getElementById('surveyTitle').value = item ? item.name : '';
            document.getElementById('surveyDescription').value = item ? item.questionList : '';
            document.getElementById('surveyDeadline').value = item ? item.deadline : '';
            document.getElementById('surveyStatus').value = item ? item.status : 'Active';
            modal.style.display = 'block';
        }
        function closeSurveyModal() { const m = document.getElementById('adminSurveyModal'); if (m) m.style.display = 'none'; }
        function saveSurvey() {
            const data = adminSurveysStore.load();
            const editId = document.getElementById('surveyEditId').value;
            const qList = document.getElementById('surveyDescription').value;
            const questions = qList.split('\n').filter(q => q.trim()).length;
            const obj = { name: document.getElementById('surveyTitle').value, deadline: document.getElementById('surveyDeadline').value, status: document.getElementById('surveyStatus').value, questionList: qList, questions: questions };
            if (!obj.name) { alert('Survey title is required'); return; }
            if (editId) { const idx = data.findIndex(d => d.id == editId); if (idx > -1) Object.assign(data[idx], obj); }
            else { obj.id = adminSurveysStore.nextId(); obj.responses = 0; obj.created = new Date().toISOString().slice(0,10); data.push(obj); }
            adminSurveysStore.data = data; adminSurveysStore.save(); closeSurveyModal(); renderAdminSurveys();
            if (typeof showStatusMessage === 'function') showStatusMessage('success', 'Survey saved successfully');
        }

        // ────────────── ANNOUNCEMENTS ──────────────
        const adminAnnouncementsStore = {
            key: 'banf_admin_announcements',
            data: null,
            defaults: [
                { id: 1, title: 'Durga Puja 2025 Date Announced', category: 'Events', author: 'BANF EC', date: '2025-01-20', pinned: true, status: 'Published', content: 'We are excited to announce that Durga Puja 2025 will be held from October 1-5 at the Jacksonville Civic Center.' },
                { id: 2, title: 'Membership Renewal Reminder', category: 'Membership', author: 'Secretary', date: '2025-01-15', pinned: false, status: 'Published', content: 'Please renew your BANF membership for 2025. Early bird discount available until February 28.' },
                { id: 3, title: 'New Bengali Language Classes', category: 'Education', author: 'Cultural Committee', date: '2025-01-10', pinned: false, status: 'Draft', content: 'Starting Bengali language classes for children every Saturday at the community hall.' }
            ],
            load() { try { const s = localStorage.getItem(this.key); this.data = s ? JSON.parse(s) : [...this.defaults]; } catch(e) { this.data = [...this.defaults]; } return this.data; },
            save() { localStorage.setItem(this.key, JSON.stringify(this.data)); },
            nextId() { return this.data.length ? Math.max(...this.data.map(d => d.id)) + 1 : 1; }
        };

        function renderAdminAnnouncements() {
            const data = adminAnnouncementsStore.load();
            const tbody = document.getElementById('announcementsTableBody');
            if (!tbody) return;
            const stats = document.querySelectorAll('#adminAnnouncements .stat-number');
            if (stats.length >= 4) { stats[0].textContent = data.filter(a => a.status === 'Published').length; stats[1].textContent = data.filter(a => a.status === 'Draft').length; stats[2].textContent = data.filter(a => a.pinned).length; stats[3].textContent = data.length; }
            tbody.innerHTML = data.map(a => `<tr>
                <td>${escapeHtml(a.title)}</td><td>${escapeHtml(a.category)}</td><td>${escapeHtml(a.author)}</td><td>${a.date}</td>
                <td>${a.pinned ? '<i class="fas fa-thumbtack text-warning"></i>' : '-'}</td>
                <td><span class="badge bg-${a.status==='Published'?'success':'warning'}">${a.status}</span></td>
                <td><button class="btn btn-sm btn-outline-primary me-1" onclick="openAnnouncementModal(${a.id})"><i class="fas fa-edit"></i></button>
                <button class="btn btn-sm btn-outline-danger" onclick="deleteAdminItem(adminAnnouncementsStore,${a.id},renderAdminAnnouncements)"><i class="fas fa-trash"></i></button></td></tr>`).join('');
        }
        function openAnnouncementModal(id) {
            const modal = document.getElementById('announcementModal'); if (!modal) return;
            const data = adminAnnouncementsStore.load(); const item = id ? data.find(d => d.id === id) : null;
            document.getElementById('announcementModalTitle').textContent = item ? 'Edit Announcement' : 'New Announcement';
            document.getElementById('announcementEditId').value = item ? item.id : '';
            document.getElementById('announcementTitle').value = item ? item.title : '';
            document.getElementById('announcementContent').value = item ? item.content : '';
            document.getElementById('announcementCategory').value = item ? item.category : 'General';
            document.getElementById('announcementStatus').value = item ? item.status : 'Draft';
            document.getElementById('announcementPinned').checked = item ? item.pinned : false;
            modal.style.display = 'block';
        }
        function closeAnnouncementModal() { const m = document.getElementById('announcementModal'); if (m) m.style.display = 'none'; }
        function saveAnnouncement() {
            const data = adminAnnouncementsStore.load();
            const editId = document.getElementById('announcementEditId').value;
            const obj = { title: document.getElementById('announcementTitle').value, content: document.getElementById('announcementContent').value, category: document.getElementById('announcementCategory').value, status: document.getElementById('announcementStatus').value, pinned: document.getElementById('announcementPinned').checked };
            if (!obj.title) { alert('Title is required'); return; }
            if (editId) { const idx = data.findIndex(d => d.id == editId); if (idx > -1) Object.assign(data[idx], obj); }
            else { obj.id = adminAnnouncementsStore.nextId(); obj.author = (AdminPortal.admin ? AdminPortal.admin.name : 'Admin'); obj.date = new Date().toISOString().slice(0,10); data.push(obj); }
            adminAnnouncementsStore.data = data; adminAnnouncementsStore.save(); closeAnnouncementModal(); renderAdminAnnouncements();
            if (typeof showStatusMessage === 'function') showStatusMessage('success', 'Announcement saved successfully');
        }

        // ────────────── MAGAZINE ──────────────
        const adminMagazineStore = {
            key: 'banf_admin_magazine',
            data: null,
            defaults: [
                { id: 1, title: 'Memories of Durga Puja in Kolkata', author: 'Suman Dey', type: 'Essay', submitted: '2025-01-05', wordCount: 1200, status: 'Approved', summary: 'A nostalgic essay about childhood Durga Puja celebrations in North Kolkata.' },
                { id: 2, title: 'Autumn Rain', author: 'Rina Chakraborty', type: 'Poem', submitted: '2025-01-08', wordCount: 120, status: 'Approved', summary: 'A Bengali poem about the monsoon season and its beauty.' },
                { id: 3, title: 'The Hilsa Fish Fry Recipe', author: 'Meera Banerjee', type: 'Article', submitted: '2025-01-12', wordCount: 800, status: 'Pending', summary: 'Step-by-step guide to making the perfect Hilsa fish fry.' },
                { id: 4, title: 'Journey to America', author: 'Arun Mukherjee', type: 'Short Story', submitted: '2025-01-14', wordCount: 3500, status: 'Pending', summary: 'A fictional short story about an immigrant family\'s journey from Bengal to Jacksonville.' },
                { id: 5, title: 'BANF Community Spotlight', author: 'Editorial Team', type: 'Interview', submitted: '2024-12-20', wordCount: 950, status: 'Rejected', summary: 'Interview with a founding member. Needs revision for clarity.' }
            ],
            load() { try { const s = localStorage.getItem(this.key); this.data = s ? JSON.parse(s) : [...this.defaults]; } catch(e) { this.data = [...this.defaults]; } return this.data; },
            save() { localStorage.setItem(this.key, JSON.stringify(this.data)); },
            nextId() { return this.data.length ? Math.max(...this.data.map(d => d.id)) + 1 : 1; }
        };

        function renderAdminMagazine() {
            const data = adminMagazineStore.load();
            const tbody = document.getElementById('magazineTableBody');
            if (!tbody) return;
            const stats = document.querySelectorAll('#adminMagazine .stat-number');
            if (stats.length >= 4) { stats[0].textContent = data.filter(m => m.status === 'Approved').length; stats[1].textContent = data.filter(m => m.status === 'Pending').length; stats[2].textContent = data.filter(m => m.status === 'Rejected').length; stats[3].textContent = data.length; }
            tbody.innerHTML = data.map(m => `<tr>
                <td>${escapeHtml(m.title)}</td><td>${escapeHtml(m.author)}</td><td>${escapeHtml(m.type)}</td><td>${m.submitted}</td>
                <td>${m.wordCount.toLocaleString()}</td>
                <td><span class="badge bg-${m.status==='Approved'?'success':m.status==='Pending'?'warning':'danger'}">${m.status}</span></td>
                <td><button class="btn btn-sm btn-outline-primary me-1" onclick="openMagazineModal(${m.id})"><i class="fas fa-edit"></i></button>
                <button class="btn btn-sm btn-outline-danger" onclick="deleteAdminItem(adminMagazineStore,${m.id},renderAdminMagazine)"><i class="fas fa-trash"></i></button></td></tr>`).join('');
        }
        function openMagazineModal(id) {
            const modal = document.getElementById('magazineModal'); if (!modal) return;
            const data = adminMagazineStore.load(); const item = id ? data.find(d => d.id === id) : null;
            document.getElementById('magazineModalTitle').textContent = item ? 'Edit Submission' : 'New Submission';
            document.getElementById('magazineEditId').value = item ? item.id : '';
            document.getElementById('magazineTitle').value = item ? item.title : '';
            document.getElementById('magazineAuthor').value = item ? item.author : '';
            document.getElementById('magazineType').value = item ? item.type : 'Article';
            document.getElementById('magazineSummary').value = item ? item.summary : '';
            document.getElementById('magazineStatus').value = item ? item.status : 'Pending';
            modal.style.display = 'block';
        }
        function closeMagazineModal() { const m = document.getElementById('magazineModal'); if (m) m.style.display = 'none'; }
        function saveMagazineSubmission() {
            const data = adminMagazineStore.load();
            const editId = document.getElementById('magazineEditId').value;
            const summary = document.getElementById('magazineSummary').value;
            const obj = { title: document.getElementById('magazineTitle').value, author: document.getElementById('magazineAuthor').value, type: document.getElementById('magazineType').value, summary: summary, status: document.getElementById('magazineStatus').value, wordCount: summary.split(/\s+/).filter(w=>w).length * 10 };
            if (!obj.title) { alert('Title is required'); return; }
            if (editId) { const idx = data.findIndex(d => d.id == editId); if (idx > -1) Object.assign(data[idx], obj); }
            else { obj.id = adminMagazineStore.nextId(); obj.submitted = new Date().toISOString().slice(0,10); data.push(obj); }
            adminMagazineStore.data = data; adminMagazineStore.save(); closeMagazineModal(); renderAdminMagazine();
            if (typeof showStatusMessage === 'function') showStatusMessage('success', 'Magazine submission saved');
        }

        // ────────────── BUDGET ──────────────
        const adminBudgetStore = {
            key: 'banf_admin_budget',
            data: null,
            defaults: [
                { id: 1, date: '2025-01-01', description: 'Annual Membership Dues Collection', category: 'Membership Dues', type: 'Income', amount: 4500, notes: 'Q1 2025 membership dues from 45 families' },
                { id: 2, date: '2025-01-05', description: 'Community Hall Rental - January', category: 'Venue Rental', type: 'Expense', amount: 800, notes: 'Monthly hall rental' },
                { id: 3, date: '2025-01-10', description: 'Saraswati Puja Catering', category: 'Catering', type: 'Expense', amount: 1200, notes: 'Catering for 120 attendees' },
                { id: 4, date: '2025-01-12', description: 'Donation from Desi Spice Kitchen', category: 'Donations', type: 'Income', amount: 500, notes: 'Gold sponsor contribution' },
                { id: 5, date: '2025-01-15', description: 'Event Supplies - Decorations', category: 'Supplies', type: 'Expense', amount: 350, notes: 'Flowers, lights, and decorations for Puja' },
                { id: 6, date: '2025-01-18', description: 'Insurance Premium - Q1', category: 'Insurance', type: 'Expense', amount: 450, notes: 'Quarterly liability insurance' },
                { id: 7, date: '2025-01-20', description: 'Nabo Borsho Ticket Sales', category: 'Event Revenue', type: 'Income', amount: 3200, notes: 'Pre-sale tickets for Bengali New Year event' }
            ],
            load() { try { const s = localStorage.getItem(this.key); this.data = s ? JSON.parse(s) : [...this.defaults]; } catch(e) { this.data = [...this.defaults]; } return this.data; },
            save() { localStorage.setItem(this.key, JSON.stringify(this.data)); },
            nextId() { return this.data.length ? Math.max(...this.data.map(d => d.id)) + 1 : 1; }
        };

        function renderAdminBudget() {
            const data = adminBudgetStore.load();
            const tbody = document.getElementById('budgetTableBody');
            if (!tbody) return;
            const income = data.filter(b => b.type === 'Income').reduce((s, b) => s + b.amount, 0);
            const expense = data.filter(b => b.type === 'Expense').reduce((s, b) => s + b.amount, 0);
            const stats = document.querySelectorAll('#adminBudget .stat-number');
            if (stats.length >= 4) { stats[0].textContent = '$' + income.toLocaleString(); stats[1].textContent = '$' + expense.toLocaleString(); stats[2].textContent = '$' + (income - expense).toLocaleString(); stats[3].textContent = data.length; }
            tbody.innerHTML = data.map(b => `<tr>
                <td>${b.date}</td><td>${escapeHtml(b.description)}</td><td>${escapeHtml(b.category)}</td>
                <td><span class="badge bg-${b.type==='Income'?'success':'danger'}">${b.type}</span></td>
                <td class="text-${b.type==='Income'?'success':'danger'} fw-bold">${b.type==='Income'?'+':'-'}$${b.amount.toLocaleString()}</td>
                <td><button class="btn btn-sm btn-outline-primary me-1" onclick="openBudgetModal(${b.id})"><i class="fas fa-edit"></i></button>
                <button class="btn btn-sm btn-outline-danger" onclick="deleteAdminItem(adminBudgetStore,${b.id},renderAdminBudget)"><i class="fas fa-trash"></i></button></td></tr>`).join('');
        }
        function openBudgetModal(id) {
            const modal = document.getElementById('budgetModal'); if (!modal) return;
            const data = adminBudgetStore.load(); const item = id ? data.find(d => d.id === id) : null;
            document.getElementById('budgetModalTitle').textContent = item ? 'Edit Transaction' : 'New Transaction';
            document.getElementById('budgetEditId').value = item ? item.id : '';
            document.getElementById('budgetDescription').value = item ? item.description : '';
            document.getElementById('budgetAmount').value = item ? item.amount : '';
            document.getElementById('budgetDate').value = item ? item.date : new Date().toISOString().slice(0,10);
            document.getElementById('budgetType').value = item ? item.type : 'Expense';
            document.getElementById('budgetCategory').value = item ? item.category : 'Other';
            document.getElementById('budgetNotes').value = item ? item.notes : '';
            modal.style.display = 'block';
        }
        function closeBudgetModal() { const m = document.getElementById('budgetModal'); if (m) m.style.display = 'none'; }
        function saveBudgetTransaction() {
            const data = adminBudgetStore.load();
            const editId = document.getElementById('budgetEditId').value;
            const obj = { description: document.getElementById('budgetDescription').value, amount: parseFloat(document.getElementById('budgetAmount').value) || 0, date: document.getElementById('budgetDate').value, type: document.getElementById('budgetType').value, category: document.getElementById('budgetCategory').value, notes: document.getElementById('budgetNotes').value };
            if (!obj.description || obj.amount <= 0) { alert('Description and valid amount are required'); return; }
            if (editId) { const idx = data.findIndex(d => d.id == editId); if (idx > -1) Object.assign(data[idx], obj); }
            else { obj.id = adminBudgetStore.nextId(); data.push(obj); }
            adminBudgetStore.data = data; adminBudgetStore.save(); closeBudgetModal(); renderAdminBudget();
            if (typeof showStatusMessage === 'function') showStatusMessage('success', 'Transaction saved');
        }
        function exportBudgetReport() {
            const data = adminBudgetStore.load();
            const income = data.filter(b => b.type === 'Income').reduce((s, b) => s + b.amount, 0);
            const expense = data.filter(b => b.type === 'Expense').reduce((s, b) => s + b.amount, 0);
            let csv = 'Date,Description,Category,Type,Amount\n';
            data.forEach(b => { csv += `${b.date},"${b.description}",${b.category},${b.type},${b.type==='Income'?'':'-'}${b.amount}\n`; });
            csv += `\nSummary\nTotal Income,,$${income}\nTotal Expenses,,$${expense}\nNet Balance,,$${income-expense}\n`;
            const blob = new Blob([csv], { type: 'text/csv' });
            const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `banf_budget_report_${new Date().toISOString().slice(0,10)}.csv`; a.click();
            if (typeof showStatusMessage === 'function') showStatusMessage('success', 'Budget report exported');
        }

        // ────────────── VENDORS ──────────────
        const adminVendorsStore = {
            key: 'banf_admin_vendors',
            data: null,
            defaults: [
                { id: 1, name: 'Desi Spice Kitchen', type: 'Caterer', contact: 'Amit Sharma', phone: '(904) 555-1001', email: 'amit@desispice.com', rating: 5, status: 'Active', tier: 'Gold', notes: 'Primary caterer for large events' },
                { id: 2, name: 'Bengal Decorators', type: 'Decorator', contact: 'Priya Das', phone: '(904) 555-1002', email: 'priya@bengaldecor.com', rating: 4, status: 'Active', tier: '', notes: 'Specializes in traditional Bengali decorations' },
                { id: 3, name: 'JAX Sound & Light', type: 'Sound/AV', contact: 'Mike Johnson', phone: '(904) 555-1003', email: 'mike@jaxsound.com', rating: 4, status: 'Active', tier: '', notes: 'PA system and stage lighting' },
                { id: 4, name: 'Bengal Tax Services', type: 'Sponsor', contact: 'Rajan Ghosh', phone: '(904) 555-1004', email: 'rajan@bengaltax.com', rating: 5, status: 'Active', tier: 'Platinum', notes: 'Platinum sponsor since 2022' },
                { id: 5, name: 'Moments Photography', type: 'Photographer', contact: 'Neha Roy', phone: '(904) 555-1005', email: 'neha@moments.com', rating: 3, status: 'Inactive', tier: '', notes: 'Used for Durga Puja 2024' }
            ],
            load() { try { const s = localStorage.getItem(this.key); this.data = s ? JSON.parse(s) : [...this.defaults]; } catch(e) { this.data = [...this.defaults]; } return this.data; },
            save() { localStorage.setItem(this.key, JSON.stringify(this.data)); },
            nextId() { return this.data.length ? Math.max(...this.data.map(d => d.id)) + 1 : 1; }
        };

        function renderAdminVendors() {
            const data = adminVendorsStore.load();
            const tbody = document.getElementById('vendorsTableBody');
            if (!tbody) return;
            const active = data.filter(v => v.status === 'Active').length;
            const sponsors = data.filter(v => v.type === 'Sponsor').length;
            const avgRating = data.length ? (data.reduce((s, v) => s + v.rating, 0) / data.length).toFixed(1) : '0';
            const stats = document.querySelectorAll('#adminVendors .stat-number');
            if (stats.length >= 4) { stats[0].textContent = active; stats[1].textContent = sponsors; stats[2].textContent = data.length; stats[3].textContent = avgRating; }
            tbody.innerHTML = data.map(v => `<tr>
                <td>${escapeHtml(v.name)}</td><td>${escapeHtml(v.type)}</td><td>${escapeHtml(v.contact)}</td><td>${escapeHtml(v.phone)}</td>
                <td>${'★'.repeat(v.rating)}${'☆'.repeat(5-v.rating)}</td>
                <td><span class="badge bg-${v.status==='Active'?'success':'secondary'}">${v.status}</span></td>
                <td><button class="btn btn-sm btn-outline-primary me-1" onclick="openVendorModal(${v.id})"><i class="fas fa-edit"></i></button>
                <button class="btn btn-sm btn-outline-danger" onclick="deleteAdminItem(adminVendorsStore,${v.id},renderAdminVendors)"><i class="fas fa-trash"></i></button></td></tr>`).join('');
        }
        function openVendorModal(id) {
            const modal = document.getElementById('vendorModal'); if (!modal) return;
            const data = adminVendorsStore.load(); const item = id ? data.find(d => d.id === id) : null;
            document.getElementById('vendorModalTitle').textContent = item ? 'Edit Vendor' : 'Add Vendor';
            document.getElementById('vendorEditId').value = item ? item.id : '';
            document.getElementById('vendorName').value = item ? item.name : '';
            document.getElementById('vendorType').value = item ? item.type : 'Caterer';
            document.getElementById('vendorStatus').value = item ? item.status : 'Active';
            document.getElementById('vendorContact').value = item ? item.contact : '';
            document.getElementById('vendorPhone').value = item ? item.phone : '';
            document.getElementById('vendorEmail').value = item ? item.email : '';
            document.getElementById('vendorRating').value = item ? item.rating : 3;
            document.getElementById('vendorTier').value = item ? item.tier : '';
            document.getElementById('vendorNotes').value = item ? item.notes : '';
            modal.style.display = 'block';
        }
        function closeVendorModal() { const m = document.getElementById('vendorModal'); if (m) m.style.display = 'none'; }
        function saveVendor() {
            const data = adminVendorsStore.load();
            const editId = document.getElementById('vendorEditId').value;
            const obj = { name: document.getElementById('vendorName').value, type: document.getElementById('vendorType').value, status: document.getElementById('vendorStatus').value, contact: document.getElementById('vendorContact').value, phone: document.getElementById('vendorPhone').value, email: document.getElementById('vendorEmail').value, rating: parseInt(document.getElementById('vendorRating').value) || 3, tier: document.getElementById('vendorTier').value, notes: document.getElementById('vendorNotes').value };
            if (!obj.name) { alert('Vendor name is required'); return; }
            if (editId) { const idx = data.findIndex(d => d.id == editId); if (idx > -1) Object.assign(data[idx], obj); }
            else { obj.id = adminVendorsStore.nextId(); data.push(obj); }
            adminVendorsStore.data = data; adminVendorsStore.save(); closeVendorModal(); renderAdminVendors();
            if (typeof showStatusMessage === 'function') showStatusMessage('success', 'Vendor saved successfully');
        }

        // ────────────── VOLUNTEERS ──────────────
        const adminVolunteersStore = {
            key: 'banf_admin_volunteers',
            data: null,
            defaults: [
                { id: 1, name: 'Arnab Das', email: 'arnab@email.com', phone: '(904) 555-2001', skill: 'Cooking', availability: 'Weekends', hours: 45, status: 'Active', notes: 'Expert in Bengali cuisine preparation' },
                { id: 2, name: 'Swati Mukherjee', email: 'swati@email.com', phone: '(904) 555-2002', skill: 'Decoration', availability: 'Anytime', hours: 32, status: 'Active', notes: 'Leads decoration team for all events' },
                { id: 3, name: 'Rahul Bose', email: 'rahul@email.com', phone: '(904) 555-2003', skill: 'Sound/AV', availability: 'Weekends', hours: 20, status: 'Active', notes: 'Handles sound and music systems' },
                { id: 4, name: 'Tanima Sen', email: 'tanima@email.com', phone: '(904) 555-2004', skill: 'Photography', availability: 'Event-only', hours: 15, status: 'Active', notes: 'Official event photographer' },
                { id: 5, name: 'Subir Chatterjee', email: 'subir@email.com', phone: '(904) 555-2005', skill: 'MC/Hosting', availability: 'Weekends', hours: 28, status: 'Inactive', notes: 'Bilingual MC for cultural programs' }
            ],
            load() { try { const s = localStorage.getItem(this.key); this.data = s ? JSON.parse(s) : [...this.defaults]; } catch(e) { this.data = [...this.defaults]; } return this.data; },
            save() { localStorage.setItem(this.key, JSON.stringify(this.data)); },
            nextId() { return this.data.length ? Math.max(...this.data.map(d => d.id)) + 1 : 1; }
        };

        function renderAdminVolunteers() {
            const data = adminVolunteersStore.load();
            const tbody = document.getElementById('volunteersTableBody');
            if (!tbody) return;
            const active = data.filter(v => v.status === 'Active').length;
            const assigned = data.filter(v => v.hours > 0).length;
            const totalHours = data.reduce((s, v) => s + v.hours, 0);
            const stats = document.querySelectorAll('#adminVolunteers .stat-number');
            if (stats.length >= 4) { stats[0].textContent = active; stats[1].textContent = assigned; stats[2].textContent = totalHours; stats[3].textContent = data.length; }
            tbody.innerHTML = data.map(v => `<tr>
                <td>${escapeHtml(v.name)}</td><td>${escapeHtml(v.email)}</td><td><span class="badge bg-info">${escapeHtml(v.skill)}</span></td>
                <td>${v.hours}</td><td>${escapeHtml(v.availability)}</td>
                <td><span class="badge bg-${v.status==='Active'?'success':'secondary'}">${v.status}</span></td>
                <td><button class="btn btn-sm btn-outline-primary me-1" onclick="openVolunteerModal(${v.id})"><i class="fas fa-edit"></i></button>
                <button class="btn btn-sm btn-outline-danger" onclick="deleteAdminItem(adminVolunteersStore,${v.id},renderAdminVolunteers)"><i class="fas fa-trash"></i></button></td></tr>`).join('');
        }
        function openVolunteerModal(id) {
            const modal = document.getElementById('volunteerModal'); if (!modal) return;
            const data = adminVolunteersStore.load(); const item = id ? data.find(d => d.id === id) : null;
            document.getElementById('volunteerModalTitle').textContent = item ? 'Edit Volunteer' : 'Add Volunteer';
            document.getElementById('volunteerEditId').value = item ? item.id : '';
            document.getElementById('volunteerName').value = item ? item.name : '';
            document.getElementById('volunteerEmail').value = item ? item.email : '';
            document.getElementById('volunteerPhone').value = item ? item.phone : '';
            document.getElementById('volunteerSkill').value = item ? item.skill : 'General';
            document.getElementById('volunteerAvailability').value = item ? item.availability : 'Weekends';
            document.getElementById('volunteerHours').value = item ? item.hours : 0;
            document.getElementById('volunteerStatus').value = item ? item.status : 'Active';
            document.getElementById('volunteerNotes').value = item ? item.notes : '';
            modal.style.display = 'block';
        }
        function closeVolunteerModal() { const m = document.getElementById('volunteerModal'); if (m) m.style.display = 'none'; }
        function saveVolunteer() {
            const data = adminVolunteersStore.load();
            const editId = document.getElementById('volunteerEditId').value;
            const obj = { name: document.getElementById('volunteerName').value, email: document.getElementById('volunteerEmail').value, phone: document.getElementById('volunteerPhone').value, skill: document.getElementById('volunteerSkill').value, availability: document.getElementById('volunteerAvailability').value, hours: parseInt(document.getElementById('volunteerHours').value) || 0, status: document.getElementById('volunteerStatus').value, notes: document.getElementById('volunteerNotes').value };
            if (!obj.name) { alert('Volunteer name is required'); return; }
            if (editId) { const idx = data.findIndex(d => d.id == editId); if (idx > -1) Object.assign(data[idx], obj); }
            else { obj.id = adminVolunteersStore.nextId(); data.push(obj); }
            adminVolunteersStore.data = data; adminVolunteersStore.save(); closeVolunteerModal(); renderAdminVolunteers();
            if (typeof showStatusMessage === 'function') showStatusMessage('success', 'Volunteer saved successfully');
        }

        // ────────────── MEETINGS ──────────────
        const adminMeetingsStore = {
            key: 'banf_admin_meetings',
            data: null,
            defaults: [
                { id: 1, date: '2025-01-05', type: 'EC Meeting', attendees: 8, agenda: 'Q1 planning and budget review', minutes: 'Discussed Durga Puja 2025 venue options. Approved Q1 budget of $5,000. Assigned committee leads.', actionItems: 'Book venue by Feb 15\nFinalize catering vendor\nSend membership renewal notices', status: 'Approved' },
                { id: 2, date: '2025-01-15', type: 'Sub-Committee', attendees: 5, agenda: 'Cultural program planning for Nabo Borsho', minutes: 'Discussed entertainment lineup. Confirmed DJ and live band. Need to finalize MC.', actionItems: 'Confirm MC by Feb 1\nBook sound equipment\nDesign event poster', status: 'Approved' },
                { id: 3, date: '2025-02-01', type: 'General Body', attendees: 0, agenda: 'Annual general meeting - elections and budget presentation', minutes: '', actionItems: 'Prepare financial report\nSet up voting system\nSend invitations to all members', status: 'Draft' }
            ],
            load() { try { const s = localStorage.getItem(this.key); this.data = s ? JSON.parse(s) : [...this.defaults]; } catch(e) { this.data = [...this.defaults]; } return this.data; },
            save() { localStorage.setItem(this.key, JSON.stringify(this.data)); },
            nextId() { return this.data.length ? Math.max(...this.data.map(d => d.id)) + 1 : 1; }
        };

        function renderAdminMeetings() {
            const data = adminMeetingsStore.load();
            const tbody = document.getElementById('meetingsTableBody');
            if (!tbody) return;
            const thisYear = data.filter(m => m.date && m.date.startsWith('2025')).length;
            const pendingApproval = data.filter(m => m.status === 'Draft').length;
            const openActions = data.reduce((s, m) => s + (m.actionItems ? m.actionItems.split('\n').filter(a => a.trim()).length : 0), 0);
            const stats = document.querySelectorAll('#adminMeetings .stat-number');
            if (stats.length >= 4) { stats[0].textContent = thisYear; stats[1].textContent = data.length; stats[2].textContent = pendingApproval; stats[3].textContent = openActions; }
            tbody.innerHTML = data.map(m => `<tr>
                <td>${m.date}</td><td>${escapeHtml(m.type)}</td><td>${m.attendees}</td>
                <td>${m.actionItems ? m.actionItems.split('\n').filter(a=>a.trim()).length : 0}</td>
                <td><span class="badge bg-${m.status==='Approved'?'success':m.status==='Published'?'primary':'warning'}">${m.status}</span></td>
                <td><button class="btn btn-sm btn-outline-primary me-1" onclick="openMeetingModal(${m.id})"><i class="fas fa-edit"></i></button>
                <button class="btn btn-sm btn-outline-info me-1" onclick="viewMeetingMinutes(${m.id})"><i class="fas fa-eye"></i></button>
                <button class="btn btn-sm btn-outline-danger" onclick="deleteAdminItem(adminMeetingsStore,${m.id},renderAdminMeetings)"><i class="fas fa-trash"></i></button></td></tr>`).join('');
        }
        function openMeetingModal(id) {
            const modal = document.getElementById('meetingModal'); if (!modal) return;
            const data = adminMeetingsStore.load(); const item = id ? data.find(d => d.id === id) : null;
            document.getElementById('meetingModalTitle').textContent = item ? 'Edit Meeting' : 'New Meeting';
            document.getElementById('meetingEditId').value = item ? item.id : '';
            document.getElementById('meetingDate').value = item ? item.date : new Date().toISOString().slice(0,10);
            document.getElementById('meetingType').value = item ? item.type : 'EC Meeting';
            document.getElementById('meetingAttendees').value = item ? item.attendees : '';
            document.getElementById('meetingAgenda').value = item ? item.agenda : '';
            document.getElementById('meetingMinutes').value = item ? item.minutes : '';
            document.getElementById('meetingActionItems').value = item ? item.actionItems : '';
            document.getElementById('meetingStatus').value = item ? item.status : 'Draft';
            modal.style.display = 'block';
        }
        function closeMeetingModal() { const m = document.getElementById('meetingModal'); if (m) m.style.display = 'none'; }
        function saveMeeting() {
            const data = adminMeetingsStore.load();
            const editId = document.getElementById('meetingEditId').value;
            const obj = { date: document.getElementById('meetingDate').value, type: document.getElementById('meetingType').value, attendees: parseInt(document.getElementById('meetingAttendees').value) || 0, agenda: document.getElementById('meetingAgenda').value, minutes: document.getElementById('meetingMinutes').value, actionItems: document.getElementById('meetingActionItems').value, status: document.getElementById('meetingStatus').value };
            if (!obj.date) { alert('Meeting date is required'); return; }
            if (editId) { const idx = data.findIndex(d => d.id == editId); if (idx > -1) Object.assign(data[idx], obj); }
            else { obj.id = adminMeetingsStore.nextId(); data.push(obj); }
            adminMeetingsStore.data = data; adminMeetingsStore.save(); closeMeetingModal(); renderAdminMeetings();
            if (typeof showStatusMessage === 'function') showStatusMessage('success', 'Meeting saved successfully');
        }
        function viewMeetingMinutes(id) {
            const data = adminMeetingsStore.load(); const item = data.find(d => d.id === id);
            if (!item) return;
            const content = `<h5>${escapeHtml(item.type)} - ${item.date}</h5>
                <p><strong>Attendees:</strong> ${item.attendees}</p>
                <p><strong>Agenda:</strong><br>${escapeHtml(item.agenda || 'N/A')}</p>
                <p><strong>Minutes:</strong><br>${escapeHtml(item.minutes || 'No minutes recorded')}</p>
                <p><strong>Action Items:</strong></p><ul>${(item.actionItems||'').split('\n').filter(a=>a.trim()).map(a=>'<li>'+escapeHtml(a)+'</li>').join('')}</ul>`;
            const div = document.createElement('div'); div.innerHTML = `<div class="modal fade" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header bg-dark text-white"><h5 class="modal-title">Meeting Minutes</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div><div class="modal-body">${content}</div></div></div></div>`;
            document.body.appendChild(div.firstChild); new bootstrap.Modal(div.firstChild).show();
            div.firstChild.addEventListener('hidden.bs.modal', function() { this.remove(); });
        }

        // ────────────── SHARED DELETE UTILITY ──────────────
        function deleteAdminItem(store, id, renderFn) {
            if (!confirm('Are you sure you want to delete this item?')) return;
            store.load();
            store.data = store.data.filter(d => d.id !== id);
            store.save();
            renderFn();
            if (typeof showStatusMessage === 'function') showStatusMessage('info', 'Item deleted');
        }

        // ────────────── localStorage BACKUP / EXPORT / IMPORT ──────────────
        const BanfDataBackup = {
            storageKeys: [
                'banf_membership_data', 'banf_site_config',
                'banf_admin_events', 'banf_admin_complaints', 'banf_admin_surveys',
                'banf_admin_announcements', 'banf_admin_magazine', 'banf_admin_budget',
                'banf_admin_vendors', 'banf_admin_volunteers', 'banf_admin_meetings',
                'banf_ad_data', 'banf_photo_albums'
            ],
            exportAll() {
                const backup = { version: '1.0', exported: new Date().toISOString(), data: {} };
                this.storageKeys.forEach(key => {
                    const val = localStorage.getItem(key);
                    if (val) backup.data[key] = JSON.parse(val);
                });
                const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob); a.download = `banf_backup_${new Date().toISOString().slice(0,10)}.json`; a.click();
                if (typeof showStatusMessage === 'function') showStatusMessage('success', 'Data backup exported successfully');
            },
            importAll(file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const backup = JSON.parse(e.target.result);
                        if (!backup.data || typeof backup.data !== 'object') throw new Error('Invalid backup format');
                        let count = 0;
                        Object.entries(backup.data).forEach(([key, value]) => {
                            if (this.storageKeys.includes(key)) { localStorage.setItem(key, JSON.stringify(value)); count++; }
                        });
                        if (typeof showStatusMessage === 'function') showStatusMessage('success', `Restored ${count} data sets from backup (${backup.exported || 'unknown date'})`);
                    } catch(err) {
                        alert('Failed to import backup: ' + err.message);
                    }
                };
                reader.readAsText(file);
            },
            getStats() {
                let total = 0;
                const details = {};
                this.storageKeys.forEach(key => {
                    const val = localStorage.getItem(key);
                    if (val) { const size = val.length; total += size; details[key] = { size: size, records: Array.isArray(JSON.parse(val)) ? JSON.parse(val).length : 1 }; }
                });
                return { totalBytes: total, totalKB: (total / 1024).toFixed(1), details };
            }
        };

        /* ================================================================
         *  ENHANCED ADMIN SECTION LOADER
         * ================================================================ */
        (function patchShowAdminSection() {
            const orig = showAdminSection;
            showAdminSection = function(sectionId, clickedNav) {
                orig(sectionId, clickedNav);
                if (sectionId === 'evite') renderEviteHistory();
                if (sectionId === 'rsvps') renderRsvpDashboard();
                if (sectionId === 'gmail') { gmailCheckConnection(); gmailLoadInbox(); gmailLoadContactGroups(); }
                if (sectionId === 'events') renderAdminEvents();
                if (sectionId === 'complaints') renderAdminComplaints();
                if (sectionId === 'surveys') renderAdminSurveys();
                if (sectionId === 'announcements') renderAdminAnnouncements();
                if (sectionId === 'magazine') renderAdminMagazine();
                if (sectionId === 'budget') renderAdminBudget();
                if (sectionId === 'vendors') renderAdminVendors();
                if (sectionId === 'volunteers') renderAdminVolunteers();
                if (sectionId === 'meetings') renderAdminMeetings();
            };
        })();

        /**
         * Run due diligence checks for member/admin workflows
         */
        function runDueDiligenceChecks(scope = 'all') {
            const results = [];
            const addCheck = (name, status, details) => results.push({ name, status, details });

            const memberSections = ['portalDashboard', 'portalProfile', 'portalFamily', 'portalPayments', 'portalBudget', 'portalMeetings', 'portalEvents', 'portalSurveys', 'portalDirectory', 'portalRadio', 'portalMagazine'];
            const adminSections = ['adminDashboard', 'adminMembers', 'adminPayments', 'adminEvents', 'adminRsvps', 'adminEvite', 'adminDataImport', 'adminDbExplorer', 'adminComplaints', 'adminSurveys', 'adminAnnouncements', 'adminRadio', 'adminMagazine', 'adminBudget', 'adminVendors', 'adminVolunteers', 'adminMeetings', 'adminGmail', 'adminCareers', 'adminSiteConfig', 'adminArchiveData', 'adminReportBuilder'];

            if (scope === 'all' || scope === 'member') {
                addCheck('Member portal overlay', !!document.getElementById('memberPortalOverlay'), 'Member full-screen overlay available');
                addCheck('Member login modal', !!document.getElementById('memberPortalModal'), 'Member login modal available');

                const missingMemberSections = memberSections.filter(id => !document.getElementById(id));
                addCheck('Member portal sections', missingMemberSections.length === 0, missingMemberSections.length ? `Missing: ${missingMemberSections.join(', ')}` : 'All sections present');

                if (MemberPortal.member) {
                    const schemaCheck = validateMemberSchema(MemberPortal.member);
                    addCheck('Member schema validation', schemaCheck.valid, schemaCheck.valid ? 'Schema OK' : `Missing: ${schemaCheck.missing.join(', ')}`);
                } else {
                    addCheck('Member session', false, 'No member is logged in');
                }
            }

            if (scope === 'all' || scope === 'admin') {
                addCheck('Admin portal overlay', !!document.getElementById('adminPortalOverlay'), 'Admin full-screen overlay available');
                addCheck('Admin login modal', !!document.getElementById('adminLoginModal'), 'Admin login modal available');

                const missingAdminSections = adminSections.filter(id => !document.getElementById(id));
                addCheck('Admin portal sections', missingAdminSections.length === 0, missingAdminSections.length ? `Missing: ${missingAdminSections.join(', ')}` : 'All sections present');

                if (AdminPortal.admin) {
                    const schemaCheck = validateMemberSchema(AdminPortal.admin);
                    addCheck('Admin schema validation', schemaCheck.valid, schemaCheck.valid ? 'Schema OK' : `Missing: ${schemaCheck.missing.join(', ')}`);
                    addCheck('Admin role validation', AdminPortal.admin.isAdmin === true, AdminPortal.admin.isAdmin ? 'Admin role confirmed' : 'Admin role missing');
                } else {
                    addCheck('Admin session', false, 'No admin is logged in');
                }
            }

            const title = scope === 'member' ? 'Member System Check' : scope === 'admin' ? 'Admin System Check' : 'Full System Check';
            renderDiagnosticsResults(results, title);
            return results;
        }

        function renderDiagnosticsResults(results, title) {
            const container = document.getElementById('diagnosticsResults');
            const modalTitle = document.getElementById('diagnosticsModalLabel');
            if (!container || !modalTitle) {
                console.table(results);
                alert(`${title} complete. Check console for details.`);
                return;
            }

            modalTitle.textContent = title;
            const rows = results.map(result => {
                const statusClass = result.status ? 'success' : 'danger';
                const icon = result.status ? 'fa-check-circle' : 'fa-times-circle';
                const detail = result.details ? `<div class="small text-muted">${result.details}</div>` : '';
                return `
                    <div class="alert alert-${statusClass} mb-2">
                        <div class="d-flex align-items-center gap-2">
                            <i class="fas ${icon}"></i>
                            <strong>${result.name}</strong>
                        </div>
                        ${detail}
                    </div>
                `;
            }).join('');

            container.innerHTML = rows || '<div class="alert alert-info">No checks executed.</div>';
            const modal = new bootstrap.Modal(document.getElementById('diagnosticsModal'));
            modal.show();
        }
        
        /**
         * Handle profile form update
         */
        function handleProfileUpdate(event) {
            event.preventDefault();
            
            const formData = {
                firstName: document.getElementById('portalFirstName')?.value,
                lastName: document.getElementById('portalLastName')?.value,
                email: document.getElementById('portalEmail')?.value,
                phone: document.getElementById('portalPhone')?.value,
                address: document.getElementById('portalAddress')?.value,
                city: document.getElementById('portalCity')?.value,
                state: document.getElementById('portalState')?.value,
                zip: document.getElementById('portalZip')?.value
            };
            
            console.log('💾 Saving profile:', formData);
            
            // Update local member data
            if (MemberPortal.member) {
                MemberPortal.member = {
                    ...MemberPortal.member,
                    ...formData,
                    address: {
                        street: formData.address || MemberPortal.member.address?.street || '',
                        city: formData.city || MemberPortal.member.address?.city || '',
                        state: formData.state || MemberPortal.member.address?.state || '',
                        zip: formData.zip || MemberPortal.member.address?.zip || ''
                    }
                };
            }
            
            // Show success notification
            alert('✅ Profile updated successfully! (Demo Mode)');
        }
        
        /**
         * Handle event RSVP
         */
        function handleEventRSVP(eventName, response) {
            console.log('🎉 RSVP:', eventName, response);
            alert(`RSVP "${response}" recorded for ${eventName}! (Demo Mode)`);
        }
        
        /**
         * Handle song request
         */
        function handleSongRequest(event) {
            event.preventDefault();
            const song = document.getElementById('songTitle')?.value;
            const artist = document.getElementById('artistName')?.value;
            const dedication = document.getElementById('dedication')?.value;
            
            console.log('🎵 Song request:', { song, artist, dedication });
            alert(`Song request submitted: "${song}" by ${artist}! (Demo Mode)`);
            
            // Reset form
            event.target.reset();
        }
        
        /**
         * Handle magazine submission
         */
        function handleMagazineSubmission(event) {
            event.preventDefault();
            const title = document.getElementById('submissionTitle')?.value;
            const type = document.getElementById('submissionType')?.value;
            
            console.log('📝 Magazine submission:', { title, type });
            alert(`Submission "${title}" received! Our editorial team will review it. (Demo Mode)`);
            
            // Reset form
            event.target.reset();
        }
        
        /**
         * Helper: Capitalize first letter
         */
        function capitalizeFirst(str) {
            if (!str) return '';
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        /**
         * Handle Login - With Demo Mode Support
         */
        async function handleLogin(event) {
            event.preventDefault();
            
            const emailOrUsername = document.getElementById('loginEmail').value.trim().toLowerCase();
            const password = document.getElementById('loginPassword').value;
            
            console.log('🔐 Login attempt:', emailOrUsername, '| Password length:', password.length);
            
            showStatusMessage('info', '<i class="fas fa-spinner fa-spin me-2"></i>Logging in...');
            
            // Simulate network delay
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // Check demo/test accounts first
            console.log('📋 Checking DemoData.testAccounts:', Object.keys(DemoData.testAccounts));
            const testAccount = DemoData.testAccounts[emailOrUsername];
            console.log('🔍 Found account:', testAccount ? 'YES' : 'NO');
            
            if (testAccount) {
                console.log('🔑 Password check:', testAccount.password, '===', password, '?', testAccount.password === password);
            }
            
            if (testAccount && testAccount.password === password) {
                MemberPortal.isLoggedIn = true;
                MemberPortal.member = normalizeMemberRecord(testAccount.member);
                
                showStatusMessage('success', 
                    `<i class="fas fa-check-circle me-2"></i>Welcome back, ${testAccount.member.firstName}!
                    <br><small class="text-muted">(Demo Mode - All features are simulated)</small>`);
                
                updateProfileDisplay(MemberPortal.member);
                
                setTimeout(() => {
                    showFullPortal(MemberPortal.member);
                }, 1500);
                return false;
            }
            
            // Check dynamically registered demo accounts
            const dynamicAccount = Object.values(DemoData.pendingRegistrations).find(
                reg => reg.completed && (reg.username === emailOrUsername || reg.email.toLowerCase() === emailOrUsername) && reg.password === password
            );
            
            if (dynamicAccount) {
                MemberPortal.isLoggedIn = true;
                MemberPortal.member = normalizeMemberRecord(dynamicAccount.memberData);
                
                showStatusMessage('success', 
                    `<i class="fas fa-check-circle me-2"></i>Welcome back, ${dynamicAccount.memberData.firstName}!
                    <br><small class="text-muted">(Demo Mode)</small>`);
                
                updateProfileDisplay(MemberPortal.member);
                
                setTimeout(() => {
                    showFullPortal(MemberPortal.member);
                }, 1500);
                return false;
            }
            
            // Demo mode - no backend needed
            // Show login failed with helpful demo credentials
            showStatusMessage('error', 
                `<i class="fas fa-exclamation-circle me-2"></i><strong>Login failed.</strong>
                <br>Invalid username or password. Please try again.
                <br><br><small><a href="#" onclick="showPortalTab('forgot'); return false;" class="text-warning">Forgot your password?</a></small>`);
            
            return false;
        }

        /**
         * Handle Sign Up - With Demo Mode Support
         */
        async function handleSignup(event) {
            event.preventDefault();
            
            const signupData = {
                firstName: document.getElementById('signupFirstName').value.trim(),
                lastName: document.getElementById('signupLastName').value.trim(),
                email: document.getElementById('signupEmail').value.trim(),
                phone: document.getElementById('signupPhone').value.trim()
            };
            
            // Validate
            if (!signupData.firstName || !signupData.lastName || !signupData.email) {
                showStatusMessage('error', '<i class="fas fa-exclamation-circle me-2"></i>Please fill in all required fields.');
                return false;
            }
            
            showStatusMessage('info', '<i class="fas fa-spinner fa-spin me-2"></i>Verifying your membership fee payment...');
            
            // Simulate network delay
            await new Promise(resolve => setTimeout(resolve, 1200));
            
            // Demo mode - simulate successful payment verification
            const registrationCode = 'BANF' + (++DemoData.registrationCodeCounter);
            const registrationId = 'REG_' + Date.now();
            
            DemoData.pendingRegistrations[registrationId] = {
                id: registrationId,
                code: registrationCode,
                ...signupData,
                membershipType: 'Family',
                createdAt: new Date().toISOString(),
                completed: false
            };
            
            MemberPortal.registrationId = registrationId;
            
            showStatusMessage('success', 
                `<i class="fas fa-check-circle me-2"></i><strong>Payment verified!</strong>
                <br>Membership type: <strong>Family</strong>
                <br><br><span class="text-warning"><i class="fas fa-envelope me-1"></i>Your registration code: <strong>${registrationCode}</strong></span>
                <br><small class="text-muted">(Demo Mode - In production, this would be sent via email)</small>`);
            
            // Move to registration code step
            setTimeout(() => {
                showPortalTab('code');
                // Pre-fill the code in demo mode
                document.getElementById('registrationCode').value = registrationCode;
            }, 2500);
            
            return false;
        }

        /**
         * Handle Registration Code Verification - With Demo Mode Support
         */
        async function handleCodeVerification(event) {
            event.preventDefault();
            
            const code = document.getElementById('registrationCode').value.trim().toUpperCase();
            
            showStatusMessage('info', '<i class="fas fa-spinner fa-spin me-2"></i>Verifying registration code...');
            
            // Simulate network delay
            await new Promise(resolve => setTimeout(resolve, 800));
            
            // Find registration by code in demo data
            const registration = Object.values(DemoData.pendingRegistrations).find(reg => reg.code === code);
            
            if (registration) {
                document.getElementById('setupRegistrationId').value = registration.id;
                document.getElementById('setupRegistrationCode').value = code;
                document.getElementById('setupUsername').placeholder = registration.email + ' (or choose your own)';
                
                showStatusMessage('success', 
                    `<i class="fas fa-check-circle me-2"></i><strong>Code verified!</strong>
                    <br>Welcome ${registration.firstName}! Please set up your account credentials.`);
                
                setTimeout(() => {
                    showPortalTab('setup');
                }, 1500);
                return false;
            }
            
            // Demo mode - invalid code
            showStatusMessage('error', 
                `<i class="fas fa-exclamation-circle me-2"></i><strong>Invalid registration code</strong>
                <br><small>Please sign up first to get a valid code.</small>
                <br><br><a href="#" onclick="showPortalTab('signup'); return false;" class="btn btn-sm btn-warning mt-2">Go to Sign Up</a>`);
            
            return false;
        }

        /**
         * Handle Account Setup - With Demo Mode Support
         */
        async function handleAccountSetup(event) {
            event.preventDefault();
            
            const password = document.getElementById('setupPassword').value;
            const confirmPassword = document.getElementById('setupConfirmPassword').value;
            const username = document.getElementById('setupUsername').value.trim();
            
            // Validate passwords match
            if (password !== confirmPassword) {
                showStatusMessage('error', '<i class="fas fa-exclamation-circle me-2"></i>Passwords do not match.');
                return false;
            }
            
            // Validate password strength
            if (password.length < 8) {
                showStatusMessage('error', '<i class="fas fa-exclamation-circle me-2"></i>Password must be at least 8 characters.');
                return false;
            }
            
            // If username is empty, use email from registration
            const registrationId = document.getElementById('setupRegistrationId').value;
            let finalUsername = username;
            if (!finalUsername) {
                // Auto-fill from registration email
                const reg = DemoData.pendingRegistrations[registrationId];
                if (reg && reg.email) {
                    finalUsername = reg.email.toLowerCase();
                } else {
                    showStatusMessage('error', '<i class="fas fa-exclamation-circle me-2"></i>Please choose a username.');
                    return false;
                }
            }
            
            showStatusMessage('info', '<i class="fas fa-spinner fa-spin me-2"></i>Creating your account...');
            
            // Simulate network delay
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Demo mode - complete registration
            const registration = DemoData.pendingRegistrations[registrationId];
            if (registration) {
                registration.username = finalUsername.toLowerCase();
                registration.password = password;
                registration.completed = true;
                registration.memberData = {
                    id: 'MEMBER_' + Date.now(),
                    firstName: registration.firstName,
                    lastName: registration.lastName,
                    fullName: registration.firstName + ' ' + registration.lastName,
                    email: registration.email,
                    phone: registration.phone,
                    role: 'member',
                    roles: ['member'],
                    isAdmin: false,
                    membershipType: registration.membershipType,
                    memberSince: new Date().toISOString().split('T')[0],
                    expiresOn: '2026-12-31',
                    address: {
                        street: document.getElementById('setupAddress')?.value || '',
                        city: document.getElementById('setupCity')?.value || 'Jacksonville',
                        state: document.getElementById('setupState')?.value || 'FL',
                        zip: document.getElementById('setupZip')?.value || ''
                    }
                };
                
                MemberPortal.isLoggedIn = true;
                MemberPortal.member = normalizeMemberRecord(registration.memberData);
                
                showStatusMessage('success', 
                    `<i class="fas fa-party-horn me-2"></i><strong>Account created successfully!</strong>
                    <br>Welcome to BANF, ${registration.firstName}!
                    <br><br><small class="text-muted">You can now log in with your chosen credentials.</small>`);
                
                updateProfileDisplay(MemberPortal.member);
                
                setTimeout(() => {
                    showFullPortal(MemberPortal.member);
                }, 2500);
                
                return false;
            }
            
            // Demo mode - no registration found
            showStatusMessage('error', 
                '<i class="fas fa-exclamation-circle me-2"></i>Registration not found. Please start the sign-up process first.');
            
            return false;
        }

        /**
         * Handle Forgot Password - With Demo Mode Support
         */
        async function handleForgotPassword(event) {
            event.preventDefault();
            
            const email = document.getElementById('forgotEmail').value.trim();
            
            if (!email) {
                showStatusMessage('error', '<i class="fas fa-exclamation-circle me-2"></i>Please enter your email address.');
                return false;
            }
            
            showStatusMessage('info', '<i class="fas fa-spinner fa-spin me-2"></i>Looking up your account...');
            
            // Simulate network delay
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Check demo accounts
            const demoAccount = Object.entries(DemoData.testAccounts).find(([key, acc]) => 
                acc.member.email.toLowerCase() === email.toLowerCase()
            );
            
            if (demoAccount) {
                showStatusMessage('success', 
                    `<i class="fas fa-check-circle me-2"></i><strong>Password reset link sent!</strong>
                    <br><br>Check your email for instructions to reset your password.
                    <br><br><a href="#" onclick="showPortalTab('login'); return false;" class="btn btn-sm btn-warning mt-2">Back to Login</a>`);
                return false;
            }
            
            // Check dynamically registered accounts
            const dynamicAccount = Object.values(DemoData.pendingRegistrations).find(
                reg => reg.completed && reg.email.toLowerCase() === email.toLowerCase()
            );
            
            if (dynamicAccount) {
                showStatusMessage('success', 
                    `<i class="fas fa-check-circle me-2"></i><strong>Account found!</strong>
                    <br><br>Username: <code>${dynamicAccount.username}</code>
                    <br>Password: <em>(the password you set during sign-up)</em>
                    <br><br><small class="text-muted">(Demo Mode)</small>`);
                return false;
            }
            
            // Demo mode - account not found
            showStatusMessage('info', 
                `<i class="fas fa-info-circle me-2"></i>If an account exists with that email, a password reset link has been sent.
                <br><br><a href="#" onclick="showPortalTab('signup'); return false;" class="text-warning">Sign up as new member</a>`);
            
            return false;
        }
        
        /**
         * Handle Forgot Username - Demo Mode
         */
        async function handleForgotUsername(event) {
            if (event) event.preventDefault();
            
            const email = document.getElementById('forgotEmail').value.trim();
            
            if (!email) {
                showStatusMessage('error', '<i class="fas fa-exclamation-circle me-2"></i>Please enter your email address first.');
                return false;
            }
            
            showStatusMessage('info', '<i class="fas fa-spinner fa-spin me-2"></i>Looking up your username...');
            
            await new Promise(resolve => setTimeout(resolve, 800));
            
            // Check demo accounts
            const demoAccount = Object.entries(DemoData.testAccounts).find(([key, acc]) => 
                acc.member.email.toLowerCase() === email.toLowerCase()
            );
            
            if (demoAccount) {
                showStatusMessage('success', 
                    `<i class="fas fa-check-circle me-2"></i>Your username is: <code>${demoAccount[0]}</code>
                    <br><br><a href="#" onclick="showPortalTab('login'); return false;" class="btn btn-sm btn-warning mt-2">Go to Login</a>`);
                return false;
            }
            
            // Check dynamic accounts
            const dynamicAccount = Object.values(DemoData.pendingRegistrations).find(
                reg => reg.completed && reg.email.toLowerCase() === email.toLowerCase()
            );
            
            if (dynamicAccount) {
                showStatusMessage('success', 
                    `<i class="fas fa-check-circle me-2"></i>Your username is: <code>${dynamicAccount.username}</code>
                    <br><br><a href="#" onclick="showPortalTab('login'); return false;" class="btn btn-sm btn-warning mt-2">Go to Login</a>`);
                return false;
            }
            
            showStatusMessage('info', 
                `<i class="fas fa-info-circle me-2"></i>If an account exists with this email, your username has been sent.
                <br><br><small>No account? <a href="#" onclick="showPortalTab('signup'); return false;" class="text-warning">Sign up here</a></small>`);
            
            return false;
        }

        /**
         * Handle Logout
         */
        function handleLogout() {
            MemberPortal.isLoggedIn = false;
            MemberPortal.member = null;
            
            // Clear forms
            document.querySelectorAll('.portal-form input').forEach(input => {
                if (input.type !== 'hidden') input.value = '';
            });
            
            showStatusMessage('info', '<i class="fas fa-sign-out-alt me-2"></i>You have been logged out.');
            
            setTimeout(() => {
                showPortalTab('login');
            }, 1000);
        }

        /**
         * Resend Registration Code
         */
        async function resendRegistrationCode() {
            showStatusMessage('info', '<i class="fas fa-spinner fa-spin me-2"></i>Resending registration code...');
            
            // This would call the signup API again to resend code
            showStatusMessage('success', '<i class="fas fa-check-circle me-2"></i>Registration code has been resent. Please check your email.');
        }

        /**
         * Update Profile Display
         */
        function updateProfileDisplay(member) {
            if (!member) return;

            const normalized = normalizeMemberRecord(member);
            
            // Set initials
            const initials = (member.firstName?.charAt(0) || '') + (member.lastName?.charAt(0) || '');
            document.getElementById('profileInitials').textContent = initials.toUpperCase() || member.fullName?.charAt(0) || '?';
            
            // Set name
            document.getElementById('profileName').textContent = normalized.fullName || normalized.email;
            
            // Set role badge
            const roleEl = document.getElementById('profileRole');
            const roleLabel = ADMIN_ROLE_LABELS[normalized.roleNormalized] || normalized.role?.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase()) || 'Member';
            roleEl.textContent = roleLabel;
            roleEl.className = `badge ${getRoleBadgeClass(normalized.roleNormalized)}`;
        }

        /**
         * Show Profile Edit Form
         */
        function showProfileEdit() {
            // Navigate to Wix profile edit page or show edit form
            navigateToWixPage('member-profile');
        }

        /**
         * Toggle Password Visibility
         */
        function togglePasswordVisibility(inputId, button) {
            const input = document.getElementById(inputId);
            const icon = button.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        /**
         * Show Status Message
         */
        function showStatusMessage(type, message) {
            const el = document.getElementById('portalStatusMessage');
            
            let bgClass = 'alert-info';
            if (type === 'success') bgClass = 'alert-success';
            if (type === 'error') bgClass = 'alert-danger';
            if (type === 'warning') bgClass = 'alert-warning';
            
            el.className = `alert ${bgClass} mt-3`;
            el.innerHTML = message;
            el.style.display = 'block';
        }

        /**
         * Hide Status Message
         */
        function hideStatusMessage() {
            document.getElementById('portalStatusMessage').style.display = 'none';
        }

        // ========== PORTAL NAVIGATION FUNCTIONS ==========
        
        /**
         * Scroll to a specific section
         */
        function scrollToSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                const navbarHeight = document.querySelector('.navbar')?.offsetHeight || 60;
                const y = section.getBoundingClientRect().top + window.pageYOffset - navbarHeight - 10;
                window.scrollTo({ top: y, behavior: 'smooth' });
            }
        }
        
        /**
         * Open Member Login Modal
         */
        function openMemberLoginModal() {
            // Use the same Bootstrap modal as openMemberPortal
            openMemberPortal('login');
        }

        /**
         * Show a toast notification (global helper)
         */
        function showToast(message, type) {
            const colors = { success: '#10B981', error: '#EF4444', info: '#3B82F6', warning: '#F59E0B' };
            const icons  = { success: 'check-circle', error: 'exclamation-circle', info: 'info-circle', warning: 'exclamation-triangle' };
            const toast = document.createElement('div');
            toast.style.cssText = 'position:fixed;top:20px;right:20px;z-index:100000;padding:12px 24px;border-radius:8px;color:#fff;font-weight:500;display:flex;align-items:center;gap:8px;box-shadow:0 4px 12px rgba(0,0,0,0.3);animation:slideInRight 0.3s ease;max-width:360px;';
            toast.style.background = colors[type] || colors.info;
            toast.innerHTML = '<i class="fas fa-' + (icons[type] || icons.info) + '"></i> ' + message;
            document.body.appendChild(toast);
            setTimeout(function(){ toast.style.opacity = '0'; toast.style.transition = 'opacity 0.3s'; setTimeout(function(){ toast.remove(); }, 300); }, 3500);
        }
        
        /**
         * Open Admin Login Modal
         */
        function openAdminLoginModal() {
            if (AdminPortal.isLoggedIn && AdminPortal.admin) {
                showAdminPortal(AdminPortal.admin);
                return;
            }
            // Create admin login modal dynamically if it doesn't exist
            let adminModal = document.getElementById('adminLoginModal');
            if (!adminModal) {
                adminModal = document.createElement('div');
                adminModal.className = 'modal fade';
                adminModal.id = 'adminLoginModal';
                adminModal.setAttribute('tabindex', '-1');
                adminModal.innerHTML = `
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content" style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border: 2px solid var(--gold); border-radius: 20px;">
                            <div class="modal-header border-0" style="background: linear-gradient(135deg, #8B0000, #DC143C); border-radius: 18px 18px 0 0;">
                                <h5 class="modal-title text-white"><i class="fas fa-user-shield me-2"></i>Admin Portal Login</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body p-4">
                                <p class="text-light mb-4">EC Members Only - Please enter your admin credentials</p>
                                <form id="adminLoginForm" onsubmit="handleAdminLogin(event)">
                                    <div class="mb-3">
                                        <label class="form-label text-light">Email or Username</label>
                                        <input type="text" class="form-control" id="adminEmail" required 
                                               style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white;">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label text-light">Password</label>
                                        <input type="password" class="form-control" id="adminPassword" required
                                               style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white;">
                                    </div>
                                    <div id="adminLoginStatus" class="mb-3"></div>
                                    <button type="submit" class="btn w-100" style="background: linear-gradient(135deg, #8B0000, #DC143C); color: white; font-weight: 600;">
                                        <i class="fas fa-sign-in-alt me-2"></i>Login to Admin Portal
                                    </button>
                                </form>
                                <p class="text-muted small mt-3 mb-0"><i class="fas fa-lock me-1"></i>This portal is restricted to Executive Committee members only.</p>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(adminModal);
            }
            const modal = new bootstrap.Modal(adminModal);
            modal.show();
        }
        
        /**
         * Handle Admin Login Form Submission
         */
        function handleAdminLogin(event) {
            event.preventDefault();
            const email = document.getElementById('adminEmail').value.trim().toLowerCase();
            const password = document.getElementById('adminPassword').value;
            const statusDiv = document.getElementById('adminLoginStatus');
            
            // Show loading
            statusDiv.innerHTML = '<div class="text-info"><i class="fas fa-spinner fa-spin me-2"></i>Verifying credentials...</div>';
            
            setTimeout(() => {
                // Check DemoData.testAccounts for matching admin credentials
                const account = DemoData.testAccounts[email];
                
                if (account && account.password === password) {
                    const member = account.member;
                    // Verify this account has admin/EC privileges
                    if (member.isAdmin || member.role === 'ec_member' || (member.roles && member.roles.includes('ec_member'))) {
                        statusDiv.innerHTML = '<div class="alert alert-success"><i class="fas fa-check-circle me-2"></i>Welcome, ' + member.firstName + '! Opening Admin Portal...</div>';
                        setTimeout(() => {
                            showAdminPortal(member);
                        }, 100);
                        return;
                    } else {
                        statusDiv.innerHTML = '<div class="alert alert-warning"><i class="fas fa-exclamation-triangle me-2"></i>This account does not have admin privileges. EC members only.</div>';
                        return;
                    }
                }
                
                // Also check dynamic registrations with admin flag
                const dynamicAdmin = Object.values(DemoData.pendingRegistrations).find(
                    reg => reg.completed && (reg.username === email || (reg.email && reg.email.toLowerCase() === email)) && reg.password === password && reg.memberData && reg.memberData.isAdmin
                );
                
                if (dynamicAdmin) {
                    statusDiv.innerHTML = '<div class="alert alert-success"><i class="fas fa-check-circle me-2"></i>Welcome! Opening Admin Portal...</div>';
                    setTimeout(() => {
                        showAdminPortal(dynamicAdmin.memberData);
                    }, 100);
                    return;
                }
                
                // Login failed
                statusDiv.innerHTML = `<div class="alert alert-danger"><i class="fas fa-exclamation-circle me-2"></i><strong>Login failed.</strong><br>Invalid credentials. Please contact an EC member for admin access.</div>`;
            }, 150);
        }
        
        /**
         * Open Survey Section
         */
        function openSurveySection() {
            // Open the survey modal directly for better UX
            openSurveyModal();
        }
        
        /**
         * Open Anonymous Complaint Form — requires member login
         */
        function openComplaintForm() {
            if (!MemberPortal.isLoggedIn) {
                MemberPortal.pendingServiceAction = 'complaint';
                openMemberLoginModal();
                return;
            }
            const modal = new bootstrap.Modal(document.getElementById('complaintModal'));
            modal.show();
        }

        /**
         * Open surveys modal and load active surveys — requires member login
         */
        async function openSurveyModal() {
            if (!MemberPortal.isLoggedIn) {
                MemberPortal.pendingServiceAction = 'survey';
                openMemberLoginModal();
                return;
            }
            const modal = new bootstrap.Modal(document.getElementById('surveyModal'));
            modal.show();
            await loadSurveys();
        }

        /**
         * Open magazine article submission — requires member login
         * (Reading the magazine is always public)
         */
        function openMagazineSubmit() {
            if (!MemberPortal.isLoggedIn) {
                MemberPortal.pendingServiceAction = 'magazineSubmit';
                openMemberLoginModal();
                return;
            }
            // Scroll to the magazine section where they can submit
            scrollToSection('magazine');
            // Show a success toast so they know they're ready
            setTimeout(() => {
                showToast('✅ You\'re logged in! You can submit your article, poem, or story.', 'success');
            }, 600);
        }

        /**
         * Handle pending service action after successful login
         * Called from showFullPortal() after member logs in
         */
        function handlePendingServiceAction() {
            const action = MemberPortal.pendingServiceAction;
            if (!action) return;
            MemberPortal.pendingServiceAction = null; // clear it

            // Close the member portal overlay first
            const overlay = document.getElementById('memberPortalOverlay');
            if (overlay) {
                overlay.style.display = 'none';
                document.body.style.overflow = '';
            }
            // Also close the login modal if open
            const modal = document.getElementById('memberPortalModal');
            if (modal) {
                const bsModal = bootstrap.Modal.getInstance(modal);
                if (bsModal) bsModal.hide();
            }

            setTimeout(() => {
                switch(action) {
                    case 'survey':
                        const surveyModal = new bootstrap.Modal(document.getElementById('surveyModal'));
                        surveyModal.show();
                        loadSurveys();
                        break;
                    case 'complaint':
                        const complaintModal = new bootstrap.Modal(document.getElementById('complaintModal'));
                        complaintModal.show();
                        break;
                    case 'magazineSubmit':
                        scrollToSection('magazine');
                        setTimeout(() => showToast('✅ You\'re logged in! Submit your article below.', 'success'), 600);
                        break;
                    default:
                        console.log('Unknown pending action:', action);
                }
            }, 500);
        }

        /**
         * Load active surveys from Wix API
         */
        async function loadSurveys() {
            const container = document.getElementById('surveyModalBody');
            if (!container) return;
            container.innerHTML = '<div class="text-muted">Loading surveys...</div>';

            try {
                const data = await fetchFromAPI(BANF_API.endpoints.surveys.active);
                const surveys = data?.surveys || data?.items || [];
                if (!surveys.length) {
                    throw new Error('No surveys from API');
                }

                container.innerHTML = surveys.map(survey => `
                    <div class="card mb-3">
                        <div class="card-body">
                            <h5 class="card-title">${survey.title || survey.name || 'Community Survey'}</h5>
                            <p class="card-text text-muted">${survey.description || 'Share your feedback with BANF.'}</p>
                            <button class="btn btn-sm" style="background: var(--gradient-green); color: #fff;" onclick="openMemberLoginModal()">
                                <i class="fas fa-vote-yea me-1"></i> Take Survey
                            </button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                container.innerHTML = `
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>Surveys will appear here when published. (Demo Mode)
                    </div>
                `;
            }
        }

        /**
         * Submit anonymous complaint to Wix API
         */
        async function submitComplaint(event) {
            event.preventDefault();
            const status = document.getElementById('complaintStatus');
            status.innerHTML = '<div class="text-info"><i class="fas fa-spinner fa-spin me-2"></i>Submitting...</div>';

            const payload = {
                category: document.getElementById('complaintCategory').value,
                subject: document.getElementById('complaintSubject').value,
                details: document.getElementById('complaintDetails').value
            };

            try {
                const response = await fetch(BANF_API.siteUrl + BANF_API.endpoints.complaints.submit, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error('Submission failed');
                const data = await response.json();
                status.innerHTML = `<div class="alert alert-success"><i class="fas fa-check-circle me-2"></i>Complaint submitted. Reference: <strong>${data.code || data.id || 'BANF-REF'}</strong></div>`;
                document.getElementById('complaintForm').reset();
            } catch (error) {
                status.innerHTML = '<div class="alert alert-warning"><i class="fas fa-info-circle me-2"></i>Complaint submitted in demo mode. A reference code will be emailed.</div>';
            }
            return false;
        }

        /**
         * Open event details modal
         */
        function openEventDetails(title, date, location, notes) {
            const body = document.getElementById('eventDetailsBody');
            body.innerHTML = `
                <div>
                    <h4>${title}</h4>
                    <p class="text-muted mb-1"><i class="fas fa-calendar me-2"></i>${date}</p>
                    <p class="text-muted mb-1"><i class="fas fa-map-marker-alt me-2"></i>${location}</p>
                    <p class="mt-3">${notes}</p>
                </div>
            `;
            const modal = new bootstrap.Modal(document.getElementById('eventDetailsModal'));
            modal.show();
        }

        // ========== WIX EMBED INTEGRATION ==========
        
        /**
         * Detect if running in Wix iframe
         */
        function isWixEmbed() {
            try {
                return window.self !== window.top;
            } catch (e) {
                return true; // Blocked by CORS = we're in an iframe
            }
        }

        /**
         * Calculate actual document height including all content
         */
        function getDocumentHeight() {
            // Calculate actual content height — no phantom padding
            const lastSection = document.querySelector('body > section:last-of-type, body > footer, body > div:last-of-type');
            if (lastSection) {
                const rect = lastSection.getBoundingClientRect();
                return Math.ceil(rect.bottom + window.pageYOffset);
            }
            // Fallback: use scrollHeight (most accurate single value)
            return document.body.scrollHeight;
        }

        /**
         * Send height to parent Wix page for auto-resize
         */
        function sendHeightToWix() {
            const height = getDocumentHeight();
            
            // Send to all possible parent origins
            const origins = ['*', 'https://www.jaxbengali.org', 'https://banfwix.wixsite.com'];
            origins.forEach(origin => {
                try {
                    window.parent.postMessage({
                        type: 'BANF_EMBED_HEIGHT',
                        height: height
                    }, origin);
                    
                    // Also send Wix-specific message format
                    window.parent.postMessage({
                        type: 'set-height',
                        data: height
                    }, origin);
                    
                    // Wix HtmlComponent message format
                    window.parent.postMessage(JSON.stringify({
                        height: height,
                        type: 'ready'
                    }), origin);
                } catch (e) {
                    console.log('[BANF] PostMessage error:', e);
                }
            });
            
            console.log('[BANF Embed] Sent height:', height);
        }

        /* ================================================================
         *  CAREERS & PROFESSIONAL NETWORK (Feature 6)
         *  LinkedIn-style member expertise directory
         * ================================================================ */

        const CAREER_PROFILES = [
            {
                memberId: 'BANF-2024-001', name: 'Dr. Ranadhir Ghosh', title: 'Software Architect',
                company: 'Fortune 500 Tech Company', industry: 'Technology', yearsExperience: 20,
                skills: ['Software Architecture', 'Cloud Computing', 'AI/ML', 'Python', 'Team Leadership'],
                guidanceOffered: ['Career Mentorship', 'Resume Review', 'Interview Prep'],
                education: 'Ph.D. Computer Science',
                linkedinUrl: '', bio: 'Passionate about helping the next generation of Bengali-American technologists succeed in their careers.',
                photoPath: 'assets/ec-photos/president/ranadhir-ghosh.jpg',
                availableForMeeting: true, isVisible: true
            },
            {
                memberId: 'BANF-2024-002', name: 'Suchismita Chandak', title: 'Senior Data Scientist',
                company: 'Healthcare Analytics Corp', industry: 'Healthcare', yearsExperience: 12,
                skills: ['Data Science', 'Machine Learning', 'Statistics', 'R', 'Clinical Research'],
                guidanceOffered: ['Career Mentorship', 'Industry Insights'],
                education: 'M.S. Biostatistics',
                linkedinUrl: '', bio: 'Helping aspiring data professionals navigate the healthcare analytics landscape.',
                photoPath: '', availableForMeeting: true, isVisible: true
            },
            {
                memberId: 'BANF-2024-003', name: 'Amitava Roy', title: 'Financial Advisor',
                company: 'RBC Wealth Management', industry: 'Finance', yearsExperience: 15,
                skills: ['Financial Planning', 'Investment Strategy', 'Tax Planning', 'Retirement Planning'],
                guidanceOffered: ['Career Mentorship', 'Networking', 'Industry Insights'],
                education: 'MBA Finance, CFA',
                linkedinUrl: '', bio: 'Available to mentor young professionals interested in finance and wealth management.',
                photoPath: '', availableForMeeting: true, isVisible: true
            },
            {
                memberId: 'BANF-2024-004', name: 'Priyanka Sen', title: 'Civil Engineer, PE',
                company: 'State DOT', industry: 'Engineering', yearsExperience: 10,
                skills: ['Structural Engineering', 'Project Management', 'AutoCAD', 'PE License Prep'],
                guidanceOffered: ['Career Mentorship', 'Interview Prep', 'Industry Insights'],
                education: 'M.S. Civil Engineering',
                linkedinUrl: '', bio: 'Happy to guide engineers through the PE licensing process and government career paths.',
                photoPath: '', availableForMeeting: false, isVisible: true
            },
            {
                memberId: 'BANF-2024-005', name: 'Dr. Shreya Mukherjee', title: 'Pediatrician',
                company: 'Children\'s Hospital', industry: 'Healthcare', yearsExperience: 8,
                skills: ['Pediatric Medicine', 'USMLE Prep', 'Residency Applications', 'Clinical Skills'],
                guidanceOffered: ['Career Mentorship', 'Resume Review', 'Interview Prep'],
                education: 'MD, Board Certified Pediatrics',
                linkedinUrl: '', bio: 'Mentoring pre-med students and IMGs navigating the US medical system.',
                photoPath: '', availableForMeeting: true, isVisible: true
            },
            {
                memberId: 'BANF-2024-006', name: 'Debanjan Gupta', title: 'Immigration Attorney',
                company: 'Gupta Law Group', industry: 'Legal', yearsExperience: 14,
                skills: ['Immigration Law', 'H1B/Green Card', 'Business Law', 'Contract Review'],
                guidanceOffered: ['Industry Insights', 'Networking'],
                education: 'J.D., Bar Admitted',
                linkedinUrl: '', bio: 'Offering guidance on legal career paths and immigration-related professional questions.',
                photoPath: '', availableForMeeting: true, isVisible: true
            }
        ];

        // Careers directory policy: allow only recent members (2025-2026)
        const CAREER_ALLOWED_YEARS = [2025, 2026];

        function extractCareerYearFromMemberId(memberId) {
            if (!memberId) return null;
            const m = String(memberId).match(/BANF-(\d{4})-/i);
            return m ? parseInt(m[1], 10) : null;
        }

        function isCareerProfileRecent(profile) {
            const yr = extractCareerYearFromMemberId(profile?.memberId);
            return CAREER_ALLOWED_YEARS.includes(yr);
        }

        function getRecentCareerProfiles() {
            return CAREER_PROFILES.filter(isCareerProfileRecent);
        }

        /**
         * Render career cards on landing page
         */
        function renderCareerCards() {
            const grid = document.getElementById('careerCardGrid');
            if (!grid) return;

            const searchVal = (document.getElementById('careerSearch')?.value || '').toLowerCase();
            const industryVal = document.getElementById('industryFilter')?.value || '';
            const guidanceVal = document.getElementById('guidanceFilter')?.value || '';

            const filtered = getRecentCareerProfiles().filter(p => {
                if (!p.isVisible) return false;
                if (industryVal && p.industry !== industryVal) return false;
                if (guidanceVal && !p.guidanceOffered.includes(guidanceVal)) return false;
                if (searchVal) {
                    const haystack = [p.name, p.title, p.company, p.industry, ...p.skills, ...p.guidanceOffered].join(' ').toLowerCase();
                    if (!haystack.includes(searchVal)) return false;
                }
                return true;
            });

            if (filtered.length === 0) {
                grid.innerHTML = '<div class="col-12 text-center py-5 text-muted"><i class="fas fa-search fa-3x mb-3 d-block"></i>No career profiles match your search criteria.</div>';
                return;
            }

            grid.innerHTML = filtered.map(p => {
                const initials = p.name.split(' ').map(w => w[0]).join('').substring(0, 2);
                const avatarBg = p.photoPath
                    ? `<img src="${p.photoPath}" alt="${p.name}" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">`
                    : `<span style="font-size:1.4rem;font-weight:700;color:#fff;">${initials}</span>`;
                const avatarStyle = p.photoPath ? '' : 'background:var(--gradient-hero);display:flex;align-items:center;justify-content:center;';

                return `
                <div class="col-lg-4 col-md-6">
                    <div class="card h-100 shadow-sm border-0" style="border-radius:14px;overflow:hidden;transition:transform 0.2s;">
                        <div class="card-body p-4">
                            <div class="d-flex align-items-center mb-3">
                                <div style="width:56px;height:56px;border-radius:50%;overflow:hidden;flex-shrink:0;${avatarStyle}">${avatarBg}</div>
                                <div class="ms-3">
                                    <h6 class="mb-0 fw-bold">${p.name}</h6>
                                    <small class="text-muted">${p.title}</small><br>
                                    <small class="text-muted"><i class="fas fa-building me-1"></i>${p.company}</small>
                                </div>
                            </div>
                            <div class="mb-2">
                                <span class="badge bg-primary bg-opacity-10 text-primary me-1"><i class="fas fa-industry me-1"></i>${p.industry}</span>
                                <span class="badge bg-secondary bg-opacity-10 text-secondary">${p.yearsExperience}+ yrs</span>
                                ${p.availableForMeeting ? '<span class=\"badge bg-success bg-opacity-10 text-success ms-1\"><i class=\"fas fa-check-circle me-1\"></i>Available</span>' : ''}
                            </div>
                            <p class="small text-muted mb-2" style="min-height:40px;">${p.bio.substring(0, 120)}${p.bio.length > 120 ? '...' : ''}</p>
                            <div class="mb-2">${p.skills.slice(0, 4).map(s => '<span class=\"badge bg-light text-dark border me-1 mb-1\" style=\"font-size:0.7rem;\">' + s + '</span>').join('')}</div>
                            <div class="mb-3">${p.guidanceOffered.map(g => '<span class=\"badge\" style=\"background:#fff3cd;color:#856404;font-size:0.7rem;margin-right:4px;\">' + g + '</span>').join('')}</div>
                            <div class="d-flex gap-2">
                                ${p.linkedinUrl ? '<a href=\"' + p.linkedinUrl + '\" target=\"_blank\" class=\"btn btn-sm btn-outline-primary\"><i class=\"fab fa-linkedin me-1\"></i>LinkedIn</a>' : ''}
                                <button class="btn btn-sm btn-outline-secondary" onclick="alert('Contact feature coming soon — please use Member Directory for now.')"><i class="fas fa-envelope me-1"></i>Connect</button>
                            </div>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        /**
         * Save career profile from member portal
         */
        function saveMyCareerProfile() {
            const currentMemberId = (window.MemberPortal?.member?.id || '').trim();
            const currentMemberYear = extractCareerYearFromMemberId(currentMemberId);
            if (!CAREER_ALLOWED_YEARS.includes(currentMemberYear)) {
                alert('⚠️ Career guidance directory accepts only recent members from 2025-2026.');
                return;
            }

            const profile = {
                memberId: currentMemberId || ('BANF-2026-SELF-' + Date.now()),
                name: document.getElementById('portalUserName')?.textContent || 'Member',
                title: document.getElementById('careerTitle')?.value || '',
                company: document.getElementById('careerCompany')?.value || '',
                industry: document.getElementById('careerIndustry')?.value || '',
                yearsExperience: parseInt(document.getElementById('careerYears')?.value) || 0,
                skills: (document.getElementById('careerSkills')?.value || '').split(',').map(s => s.trim()).filter(Boolean),
                guidanceOffered: [...document.querySelectorAll('#guidanceCheckboxes input:checked')].map(cb => cb.value),
                education: document.getElementById('careerEducation')?.value || '',
                linkedinUrl: document.getElementById('careerLinkedin')?.value || '',
                bio: document.getElementById('careerBio')?.value || '',
                photoPath: '',
                availableForMeeting: document.getElementById('careerAvailable')?.checked ?? true,
                isVisible: document.getElementById('careerProfileVisible')?.checked ?? true
            };

            // Check if profile already exists for this member
            const existingIdx = CAREER_PROFILES.findIndex(p => p.memberId === profile.memberId || p.name === profile.name);
            if (existingIdx >= 0) {
                CAREER_PROFILES[existingIdx] = { ...CAREER_PROFILES[existingIdx], ...profile };
            } else {
                CAREER_PROFILES.push(profile);
            }

            renderCareerCards();
            renderAdminCareerTable();
            alert('✅ Career profile saved successfully!');
        }

        /**
         * Delete own career profile from member portal
         */
        function deleteMyCareerProfile() {
            if (!confirm('Remove your career profile from the directory?')) return;
            const name = document.getElementById('portalUserName')?.textContent || '';
            const idx = CAREER_PROFILES.findIndex(p => p.name === name);
            if (idx >= 0) {
                CAREER_PROFILES.splice(idx, 1);
                renderCareerCards();
                renderAdminCareerTable();
                alert('Profile removed.');
            }
        }

        /**
         * Render admin career directory table
         */
        function renderAdminCareerTable() {
            const tbody = document.getElementById('adminCareerTableBody');
            if (!tbody) return;

            const recentProfiles = getRecentCareerProfiles();

            // Update stats
            const el = id => document.getElementById(id);
            if (el('careerTotalStat'))   el('careerTotalStat').textContent = recentProfiles.length;
            if (el('careerVisibleStat')) el('careerVisibleStat').textContent = recentProfiles.filter(p => p.isVisible).length;
            if (el('careerHiddenStat'))  el('careerHiddenStat').textContent = recentProfiles.filter(p => !p.isVisible).length;
            if (el('careerIndustryStat')) el('careerIndustryStat').textContent = new Set(recentProfiles.map(p => p.industry)).size;

            if (recentProfiles.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center text-muted py-3">No eligible profiles (only member IDs from 2025-2026 are shown).</td></tr>';
                return;
            }

            tbody.innerHTML = recentProfiles.map((p) => {
                const realIndex = CAREER_PROFILES.indexOf(p);
                return `
                <tr>
                    <td><strong>${p.name}</strong></td>
                    <td>${p.title}</td>
                    <td><span class="badge bg-primary bg-opacity-10 text-primary">${p.industry}</span></td>
                    <td>${p.guidanceOffered.map(g => '<span class=\"badge bg-warning bg-opacity-25 text-dark me-1\">' + g + '</span>').join('')}</td>
                    <td>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" ${p.isVisible ? 'checked' : ''} onchange="toggleCareerVisibility(${realIndex}, this.checked)">
                        </div>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline-danger" onclick="removeCareerProfile(${realIndex})"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `;
            }).join('');
        }

        function toggleCareerVisibility(index, visible) {
            if (CAREER_PROFILES[index]) {
                CAREER_PROFILES[index].isVisible = visible;
                renderCareerCards();
            }
        }

        function removeCareerProfile(index) {
            if (!confirm('Remove this career profile?')) return;
            CAREER_PROFILES.splice(index, 1);
            renderAdminCareerTable();
            renderCareerCards();
        }

        function openAddCareerModal() {
            const name = prompt('Member name:');
            if (!name) return;
            const memberId = (prompt('Member ID (BANF-2025-XXXX or BANF-2026-XXXX):') || '').trim();
            const memberYear = extractCareerYearFromMemberId(memberId);
            if (!CAREER_ALLOWED_YEARS.includes(memberYear)) {
                alert('⚠️ Only members from 2025-2026 can be added to the career directory.');
                return;
            }
            const title = prompt('Professional title:');
            const industry = prompt('Industry (Technology, Healthcare, Finance, Education, Engineering, Legal, Business):');
            CAREER_PROFILES.push({
                memberId: memberId, name, title: title || '',
                company: '', industry: industry || 'Technology', yearsExperience: 0,
                skills: [], guidanceOffered: ['Career Mentorship'],
                education: '', linkedinUrl: '', bio: '',
                photoPath: '', availableForMeeting: true, isVisible: true
            });
            renderAdminCareerTable();
            renderCareerCards();
        }

        function exportCareerDirectory() {
            const headers = ['Name', 'Title', 'Company', 'Industry', 'Years', 'Skills', 'Guidance', 'Education', 'LinkedIn', 'Visible'];
            const rows = getRecentCareerProfiles().map(p => [
                p.name, p.title, p.company, p.industry, p.yearsExperience,
                p.skills.join('; '), p.guidanceOffered.join('; '),
                p.education, p.linkedinUrl, p.isVisible ? 'Yes' : 'No'
            ]);
            const csv = [headers, ...rows].map(r => r.map(c => '"' + String(c).replace(/"/g, '""') + '"').join(',')).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'BANF_Career_Directory.csv';
            a.click();
        }

        /**
         * ========== SITE CONFIGURATION MANAGER (Feature 1) ==========
         * Manages section visibility, membership fees, sponsorship tiers, and ad slots
         */
        const SiteConfigManager = {
            config: null,

            defaultConfig: {
                sectionVisibility: {
                    about:       true,  // President's Message
                    'ec-team':   true,  // EC Team
                    services:    true,  // Services Portal
                    'member-portal': true, // Member Portal cards/buttons
                    events:      true,  // Events Calendar
                    radio:       true,  // Radio Player
                    guide:       true,  // Jacksonville Guide
                    surveys:     true,  // Surveys & Complaints
                    magazine:    true,  // E-Magazine
                    sponsors:    true,  // Sponsorship Tiers
                    'admin-ads': true,  // Ad Slots
                    membership:  true,  // Membership Plans
                    photos:      true,  // Photo Gallery
                    contact:     true   // Contact Section
                },
                membershipPlans: [
                    { id: 'student',    name: 'Student',         amount: 165, period: 'Annual', active: true },
                    { id: 'individual', name: 'Individual Premium', amount: 240, period: 'Annual', active: true },
                    { id: 'couple',     name: 'Couple',          amount: 330, period: 'Annual', active: true },
                    { id: 'family',     name: 'Family Premium',  amount: 410, earlyBird: 375, earlyBirdDeadline: '2026-03-31', period: 'Annual', active: true }
                ],
                sponsorshipTiers: [
                    { id: 'tier_1', name: 'Community', amount: 250,  benefits: 'Name listed on website',               active: true },
                    { id: 'tier_2', name: 'Silver',    amount: 500,  benefits: 'Logo on website, 2 event tickets',      active: true },
                    { id: 'tier_3', name: 'Gold',      amount: 1000, benefits: 'Logo + 4 event tickets + newsletter',   active: true },
                    { id: 'tier_4', name: 'Title',     amount: 2500, benefits: 'Title sponsor, banner, 6 tickets',      active: true }
                ],
                adSlots: [
                    { id: 'slot_1', slot: 1, flierUrl: '', businessName: '', amount: 200, yearStart: '2026-01', yearEnd: '2026-12', active: true },
                    { id: 'slot_2', slot: 2, flierUrl: '', businessName: '', amount: 200, yearStart: '2026-01', yearEnd: '2026-12', active: true },
                    { id: 'slot_3', slot: 3, flierUrl: '', businessName: '', amount: 200, yearStart: '2026-01', yearEnd: '2026-12', active: true }
                ]
            },

            load: function() {
                try {
                    const saved = localStorage.getItem('banf_site_config');
                    this.config = saved ? JSON.parse(saved) : JSON.parse(JSON.stringify(this.defaultConfig));
                    // Backfill new config keys for older saved payloads
                    this.config.sectionVisibility = {
                        ...this.defaultConfig.sectionVisibility,
                        ...(this.config.sectionVisibility || {})
                    };
                    this.config.membershipPlans = this.config.membershipPlans || JSON.parse(JSON.stringify(this.defaultConfig.membershipPlans));
                    this.config.sponsorshipTiers = this.config.sponsorshipTiers || JSON.parse(JSON.stringify(this.defaultConfig.sponsorshipTiers));
                    this.config.adSlots = this.config.adSlots || JSON.parse(JSON.stringify(this.defaultConfig.adSlots));
                } catch(e) {
                    console.warn('[SiteConfig] Failed to load, using defaults:', e);
                    this.config = JSON.parse(JSON.stringify(this.defaultConfig));
                }
                return this.config;
            },

            save: function() {
                try {
                    localStorage.setItem('banf_site_config', JSON.stringify(this.config));
                    console.log('[SiteConfig] Configuration saved');
                    this.applySectionVisibility();
                    this.showToast('Configuration saved successfully!', 'success');
                } catch(e) {
                    console.error('[SiteConfig] Failed to save:', e);
                    this.showToast('Failed to save configuration', 'error');
                }
            },

            reset: function() {
                this.config = JSON.parse(JSON.stringify(this.defaultConfig));
                localStorage.removeItem('banf_site_config');
                this.applySectionVisibility();
                this.renderConfigPanel();
                this.showToast('Configuration reset to defaults', 'info');
            },

            applySectionVisibility: function() {
                if (!this.config) this.load();
                const vis = this.config.sectionVisibility;
                Object.entries(vis).forEach(([sectionId, visible]) => {
                    if (sectionId === 'member-portal') {
                        const memberPortalEls = [
                            document.getElementById('memberPortalCard'),
                            document.getElementById('memberPortalServiceCard')
                        ].filter(Boolean);
                        memberPortalEls.forEach(el => {
                            el.style.display = visible ? '' : 'none';
                        });
                        window.BANF_MEMBER_PORTAL_DISABLED = !visible;
                        return;
                    }
                    const el = document.getElementById(sectionId);
                    if (el) {
                        el.style.display = visible ? '' : 'none';
                    }
                });
                this.applyAdSlotWeighting();
                console.log('[SiteConfig] Section visibility applied');
            },

            applyAdSlotWeighting: function() {
                if (!this.config || !Array.isArray(this.config.adSlots)) return;
                const nowMonth = new Date().toISOString().slice(0, 7);
                const eligible = this.config.adSlots
                    .filter(a => a && a.active)
                    .filter(a => !a.yearStart || a.yearStart <= nowMonth)
                    .filter(a => !a.yearEnd || a.yearEnd >= nowMonth)
                    .sort((a, b) => Number(b.amount || 0) - Number(a.amount || 0))
                    .slice(0, 3);

                const cards = Array.from(document.querySelectorAll('#ad-carousel-container [data-ad-slot]'));
                cards.forEach((cardEl, idx) => {
                    const slot = eligible[idx];
                    if (!slot) {
                        cardEl.style.display = 'none';
                        return;
                    }
                    cardEl.style.display = '';
                    const body = cardEl.querySelector('.ad-card');
                    const content = cardEl.querySelector('.ad-content');
                    if (!body || !content) return;

                    body.style.background = 'linear-gradient(135deg,#1a237e,#3949ab)';
                    body.style.color = '#fff';
                    body.style.border = 'none';
                    content.innerHTML = `
                        ${slot.flierUrl ? `<img src="${slot.flierUrl}" alt="${slot.businessName || 'Sponsor'}" style="max-width:100%;max-height:70px;object-fit:contain;margin-bottom:8px;border-radius:6px;background:#fff;padding:4px;">` : '<i class="fas fa-bullhorn fa-2x mb-2"></i>'}
                        <h5>${slot.businessName || `Sponsor Slot ${slot.slot}`}</h5>
                        <p class="small opacity-90 mb-1">Priority by sponsorship amount</p>
                        <div class="small mb-2"><i class="fas fa-dollar-sign me-1"></i>${Number(slot.amount || 0).toLocaleString()} &nbsp;•&nbsp; ${slot.yearStart || ''} to ${slot.yearEnd || ''}</div>
                        <span class="badge bg-warning text-dark">Priority #${idx + 1}</span>
                    `;
                });
            },

            renderConfigPanel: function() {
                const container = document.getElementById('siteConfigContent');
                if (!container) return;
                if (!this.config) this.load();

                const sectionLabels = {
                    about:       "President's Message",
                    'ec-team':   'EC Team',
                    services:    'Services Portal',
                    'member-portal': 'Member Portal Access',
                    events:      'Events Calendar',
                    radio:       'Radio Player',
                    guide:       'Jacksonville Guide',
                    surveys:     'Surveys & Complaints',
                    magazine:    'E-Magazine',
                    sponsors:    'Sponsorship Tiers',
                    'admin-ads': 'Ad Slots',
                    membership:  'Membership Plans',
                    photos:      'Photo Gallery',
                    contact:     'Contact Section'
                };

                container.innerHTML = `
                    <!-- Section Visibility -->
                    <div class="admin-card mb-4">
                        <div class="admin-card-header">
                            <div class="admin-card-icon" style="background:rgba(99,102,241,0.1);color:#6366F1"><i class="fas fa-eye"></i></div>
                            <div><h4>Section Visibility</h4><small class="text-muted">Show or hide landing page sections</small></div>
                        </div>
                        <div class="row g-2 mt-2">
                            ${Object.entries(sectionLabels).map(([id, label]) => `
                                <div class="col-md-4 col-6">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="vis_${id}" ${this.config.sectionVisibility[id] ? 'checked' : ''} onchange="SiteConfigManager.toggleSection('${id}', this.checked)">
                                        <label class="form-check-label" for="vis_${id}">${label}</label>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Membership Plans -->
                    <div class="admin-card mb-4">
                        <div class="admin-card-header">
                            <div class="admin-card-icon" style="background:rgba(16,185,129,0.1);color:#10B981"><i class="fas fa-id-card"></i></div>
                            <div><h4>Membership Plans</h4><small class="text-muted">Manage membership tiers and pricing</small></div>
                        </div>
                        <div class="table-responsive mt-2">
                            <table class="table table-sm table-hover mb-0">
                                <thead><tr><th>Plan</th><th>Amount</th><th>Period</th><th>Active</th><th></th></tr></thead>
                                <tbody id="membershipPlanRows">
                                    ${this.config.membershipPlans.map((p, i) => `
                                        <tr>
                                            <td><input class="form-control form-control-sm" value="${p.name}" onchange="SiteConfigManager.config.membershipPlans[${i}].name=this.value"></td>
                                            <td><div class="input-group input-group-sm"><span class="input-group-text">$</span><input type="number" class="form-control" value="${p.amount}" onchange="SiteConfigManager.config.membershipPlans[${i}].amount=parseInt(this.value)"></div></td>
                                            <td><select class="form-select form-select-sm" onchange="SiteConfigManager.config.membershipPlans[${i}].period=this.value"><option ${p.period==='Annual'?'selected':''}>Annual</option><option ${p.period==='One-time'?'selected':''}>One-time</option><option ${p.period==='Monthly'?'selected':''}>Monthly</option></select></td>
                                            <td><input type="checkbox" class="form-check-input" ${p.active?'checked':''} onchange="SiteConfigManager.config.membershipPlans[${i}].active=this.checked"></td>
                                            <td><button class="btn btn-sm btn-outline-danger" onclick="SiteConfigManager.removePlan(${i})" title="Remove"><i class="fas fa-trash-alt"></i></button></td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        <button class="btn btn-sm btn-outline-success mt-2" onclick="SiteConfigManager.addPlan()"><i class="fas fa-plus me-1"></i>Add Plan</button>
                    </div>

                    <!-- Sponsorship Tiers -->
                    <div class="admin-card mb-4">
                        <div class="admin-card-header">
                            <div class="admin-card-icon" style="background:rgba(245,158,11,0.1);color:#F59E0B"><i class="fas fa-handshake"></i></div>
                            <div><h4>Sponsorship Tiers</h4><small class="text-muted">Manage sponsorship levels and benefits</small></div>
                        </div>
                        <div class="table-responsive mt-2">
                            <table class="table table-sm table-hover mb-0">
                                <thead><tr><th>Tier</th><th>Amount</th><th>Benefits</th><th>Active</th><th></th></tr></thead>
                                <tbody id="sponsorshipTierRows">
                                    ${this.config.sponsorshipTiers.map((t, i) => `
                                        <tr>
                                            <td><input class="form-control form-control-sm" value="${t.name}" onchange="SiteConfigManager.config.sponsorshipTiers[${i}].name=this.value"></td>
                                            <td><div class="input-group input-group-sm"><span class="input-group-text">$</span><input type="number" class="form-control" value="${t.amount}" onchange="SiteConfigManager.config.sponsorshipTiers[${i}].amount=parseInt(this.value)"></div></td>
                                            <td><input class="form-control form-control-sm" value="${t.benefits}" onchange="SiteConfigManager.config.sponsorshipTiers[${i}].benefits=this.value"></td>
                                            <td><input type="checkbox" class="form-check-input" ${t.active?'checked':''} onchange="SiteConfigManager.config.sponsorshipTiers[${i}].active=this.checked"></td>
                                            <td><button class="btn btn-sm btn-outline-danger" onclick="SiteConfigManager.removeTier(${i})" title="Remove"><i class="fas fa-trash-alt"></i></button></td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        <button class="btn btn-sm btn-outline-success mt-2" onclick="SiteConfigManager.addTier()"><i class="fas fa-plus me-1"></i>Add Tier</button>
                    </div>

                    <!-- Ad Slots -->
                    <div class="admin-card mb-4">
                        <div class="admin-card-header">
                            <div class="admin-card-icon" style="background:rgba(239,68,68,0.1);color:#EF4444"><i class="fas fa-ad"></i></div>
                            <div><h4>Ad Slots</h4><small class="text-muted">Manage advertisement slots and fliers</small></div>
                        </div>
                        <div class="table-responsive mt-2">
                            <table class="table table-sm table-hover mb-0">
                                <thead><tr><th>Slot</th><th>Business</th><th>Amount</th><th>Start</th><th>End</th><th>Active</th><th></th></tr></thead>
                                <tbody id="adSlotRows">
                                    ${this.config.adSlots.map((a, i) => `
                                        <tr>
                                            <td class="text-center">${a.slot}</td>
                                            <td><input class="form-control form-control-sm" value="${a.businessName}" placeholder="Business name" onchange="SiteConfigManager.config.adSlots[${i}].businessName=this.value"></td>
                                            <td><div class="input-group input-group-sm"><span class="input-group-text">$</span><input type="number" class="form-control" value="${a.amount}" onchange="SiteConfigManager.config.adSlots[${i}].amount=parseInt(this.value)"></div></td>
                                            <td><input type="month" class="form-control form-control-sm" value="${a.yearStart}" onchange="SiteConfigManager.config.adSlots[${i}].yearStart=this.value"></td>
                                            <td><input type="month" class="form-control form-control-sm" value="${a.yearEnd}" onchange="SiteConfigManager.config.adSlots[${i}].yearEnd=this.value"></td>
                                            <td><input type="checkbox" class="form-check-input" ${a.active?'checked':''} onchange="SiteConfigManager.config.adSlots[${i}].active=this.checked"></td>
                                            <td><button class="btn btn-sm btn-outline-danger" onclick="SiteConfigManager.removeAdSlot(${i})" title="Remove"><i class="fas fa-trash-alt"></i></button></td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        <button class="btn btn-sm btn-outline-success mt-2" onclick="SiteConfigManager.addAdSlot()"><i class="fas fa-plus me-1"></i>Add Slot</button>
                    </div>

                    <!-- Action Buttons -->
                    <div class="d-flex gap-2 mt-3">
                        <button class="admin-primary" onclick="SiteConfigManager.save()"><i class="fas fa-save me-1"></i>Save Configuration</button>
                        <button class="admin-secondary" onclick="SiteConfigManager.reset()"><i class="fas fa-undo me-1"></i>Reset to Defaults</button>
                    </div>
                `;
            },

            toggleSection: function(sectionId, visible) {
                this.config.sectionVisibility[sectionId] = visible;
            },

            addPlan: function() {
                const id = 'plan_' + Date.now();
                this.config.membershipPlans.push({ id, name: 'New Plan', amount: 0, period: 'Annual', active: true });
                this.renderConfigPanel();
            },
            removePlan: function(idx) {
                this.config.membershipPlans.splice(idx, 1);
                this.renderConfigPanel();
            },

            addTier: function() {
                const id = 'tier_' + Date.now();
                this.config.sponsorshipTiers.push({ id, name: 'New Tier', amount: 0, benefits: '', active: true });
                this.renderConfigPanel();
            },
            removeTier: function(idx) {
                this.config.sponsorshipTiers.splice(idx, 1);
                this.renderConfigPanel();
            },

            addAdSlot: function() {
                const nextSlot = this.config.adSlots.length + 1;
                const id = 'slot_' + Date.now();
                this.config.adSlots.push({ id, slot: nextSlot, flierUrl: '', businessName: '', amount: 200, yearStart: '2026-01', yearEnd: '2026-12', active: true });
                this.renderConfigPanel();
            },
            removeAdSlot: function(idx) {
                this.config.adSlots.splice(idx, 1);
                // Re-number slots
                this.config.adSlots.forEach((a, i) => a.slot = i + 1);
                this.renderConfigPanel();
            },

            showToast: function(message, type) {
                const colors = { success: '#10B981', error: '#EF4444', info: '#3B82F6' };
                const icons  = { success: 'check-circle', error: 'exclamation-circle', info: 'info-circle' };
                const toast = document.createElement('div');
                toast.style.cssText = 'position:fixed;top:20px;right:20px;z-index:100000;padding:12px 24px;border-radius:8px;color:#fff;font-weight:500;display:flex;align-items:center;gap:8px;box-shadow:0 4px 12px rgba(0,0,0,0.3);animation:slideInRight 0.3s ease;';
                toast.style.background = colors[type] || colors.info;
                toast.innerHTML = `<i class="fas fa-${icons[type] || icons.info}"></i> ${message}`;
                document.body.appendChild(toast);
                setTimeout(() => { toast.style.opacity = '0'; toast.style.transition = 'opacity 0.3s'; setTimeout(() => toast.remove(), 300); }, 3000);
            }
        };

        /**
         * ========== ADMIN ADVERTISEMENT MANAGEMENT (STANDALONE) ==========
         */
        
        const AdManager = {
            ads: [],
            isAdmin: false,
            storageKey: 'banf_ad_data',
            
            defaultAds: [
                { id: 'ad1', title: 'Desi Spice Kitchen', description: 'Authentic Bengali & Indian cuisine in Jacksonville', icon: 'fas fa-utensils', link: '#', buttonText: 'Visit', buttonClass: 'btn-outline-light', style: 'background:linear-gradient(135deg,#ff6b35,#ff9800);color:#fff', active: true },
                { id: 'ad2', title: 'Bengal Tax Services', description: 'Expert tax preparation for individuals & businesses', icon: 'fas fa-calculator', link: '#', buttonText: 'Learn More', buttonClass: 'btn-outline-light', style: 'background:linear-gradient(135deg,#006A4E,#4CAF50);color:#fff', active: true },
                { id: 'ad3', title: 'Kolkata Jewelers', description: 'Fine gold & diamond jewelry. Traditional & modern designs', icon: 'fas fa-gem', link: '#', buttonText: 'Shop Now', buttonClass: 'btn-outline-light', style: 'background:linear-gradient(135deg,#8B0000,#D4AF37);color:#fff', active: true }
            ],
            
            init: function() {
                // Load from localStorage or use defaults
                try {
                    const saved = localStorage.getItem(this.storageKey);
                    this.ads = saved ? JSON.parse(saved) : [...this.defaultAds];
                } catch(e) {
                    this.ads = [...this.defaultAds];
                }
                // Check admin status from AdminPortal
                this.isAdmin = !!(AdminPortal && AdminPortal.admin);
                this.updateAdminControls();
                this.renderAds();
            },
            
            save: function() {
                try { localStorage.setItem(this.storageKey, JSON.stringify(this.ads)); } catch(e) { console.warn('AdManager save failed:', e); }
            },
            
            updateAdminControls: function() {
                const adminControls = document.getElementById('ad-admin-controls');
                if (adminControls) adminControls.style.display = this.isAdmin ? 'block' : 'none';
            },
            
            renderAds: function() {
                const container = document.getElementById('ad-carousel-container');
                if (!container) return;
                const activeAds = this.ads.filter(a => a.active !== false);
                if (!activeAds.length) { container.innerHTML = '<p class="text-center text-muted">No ads configured</p>'; return; }
                container.innerHTML = activeAds.map((ad, index) => `
                    <div class="col-md-4" data-ad-slot="${index + 1}" data-ad-id="${escapeHtml(ad.id)}">
                        <div class="ad-card h-100 p-4 rounded-4 text-center shadow" style="${escapeHtml(ad.style || '')}">
                            <div class="ad-content">
                                ${ad.icon ? `<i class="${escapeHtml(ad.icon)} fa-3x mb-3"></i>` : ''}
                                ${ad.image ? `<img src="${escapeHtml(ad.image)}" alt="${escapeHtml(ad.title)}" class="mb-3" style="max-width: 100%; border-radius: 10px;">` : ''}
                                <h5>${escapeHtml(ad.title)}</h5>
                                <p class="small opacity-85">${escapeHtml(ad.description)}</p>
                                ${ad.link ? `<a href="${escapeHtml(ad.link)}" target="_blank" class="btn btn-sm ${escapeHtml(ad.buttonClass || 'btn-outline-light')}">${escapeHtml(ad.buttonText || 'Learn More')}</a>` : ''}
                            </div>
                        </div>
                    </div>
                `).join('');
            },
            
            addAd: function(ad) {
                ad.id = 'ad_' + Date.now();
                ad.active = true;
                this.ads.push(ad);
                this.save();
                this.renderAds();
            },
            
            removeAd: function(id) {
                this.ads = this.ads.filter(a => a.id !== id);
                this.save();
                this.renderAds();
            },
            
            toggleAd: function(id) {
                const ad = this.ads.find(a => a.id === id);
                if (ad) { ad.active = !ad.active; this.save(); this.renderAds(); }
            }
        };
        
        function openAdManager() {
            alert('Ad Manager: Use Site Configuration → Ad Slots section to manage advertisements.');
        }

        /**
         * ========== PHOTO GALLERY (STANDALONE WITH DEMO DATA) ==========
         */
        
        const PhotoGallery = {
            albums: [],
            isLoggedIn: false,
            storageKey: 'banf_photo_albums',
            
            defaultAlbums: [
                { id: 'evt1', title: 'Durga Puja 2025', date: '2025-10-12', photos: 48, coverIcon: 'fas fa-om', access: 'public', description: 'Annual Durga Puja celebrations at BANF community center' },
                { id: 'evt2', title: 'Nabo Borsho 1432', date: '2025-04-14', photos: 35, coverIcon: 'fas fa-sun', access: 'public', description: 'Bengali New Year celebration with cultural programs' },
                { id: 'evt3', title: 'Saraswati Puja 2025', date: '2025-02-02', photos: 22, coverIcon: 'fas fa-book', access: 'members', description: 'Saraswati Puja at Jacksonville temple' },
                { id: 'evt4', title: 'Holi Festival 2025', date: '2025-03-14', photos: 56, coverIcon: 'fas fa-palette', access: 'public', description: 'Colorful Holi celebration at Riverside Park' },
                { id: 'evt5', title: 'Annual Picnic 2025', date: '2025-05-25', photos: 41, coverIcon: 'fas fa-tree', access: 'members', description: 'Family picnic and sports day at Hanna Park' },
                { id: 'evt6', title: 'Independence Day 2025', date: '2025-08-15', photos: 30, coverIcon: 'fas fa-flag', access: 'public', description: 'Indian Independence Day cultural program' }
            ],
            
            init: function() {
                try {
                    const saved = localStorage.getItem(this.storageKey);
                    this.albums = saved ? JSON.parse(saved) : [...this.defaultAlbums];
                } catch(e) {
                    this.albums = [...this.defaultAlbums];
                }
            },
            
            save: function() {
                try { localStorage.setItem(this.storageKey, JSON.stringify(this.albums)); } catch(e) {}
            },
            
            loadAlbums: async function(memberOnly = false) {
                if (!this.albums.length) this.init();
                if (memberOnly) return this.albums.filter(a => a.access === 'members');
                return this.albums.filter(a => a.access === 'public');
            },
            
            getAllAlbums: function() {
                if (!this.albums.length) this.init();
                return this.albums;
            },
            
            openGallery: function(albumId) {
                const album = this.albums.find(a => a.id === albumId);
                if (!album) { alert('Album not found'); return; }
                if (album.access === 'members' && !this.isLoggedIn) {
                    openMemberPortal('login');
                    showStatusMessage('info', 'Please log in to access member-only photos');
                    return;
                }
                alert(`📸 Photo Gallery: "${album.title}"\n\n${album.photos} photos\n${album.description}\n\n(Photo viewer would open here with lightbox)`);
            },
            
            requestMemberAccess: function() {
                if (!this.isLoggedIn) {
                    openMemberPortal('login');
                    showStatusMessage('info', 'Please log in to access member-only photos');
                    return false;
                }
                return true;
            },
            
            renderGallerySection: function() {
                const container = document.getElementById('photoGalleryGrid');
                if (!container) return;
                const allAlbums = this.getAllAlbums();
                container.innerHTML = allAlbums.map(album => `
                    <div class="col-md-4 col-6 mb-3">
                        <div class="card h-100 shadow-sm" style="cursor:pointer;border-radius:12px;overflow:hidden" onclick="PhotoGallery.openGallery('${escapeHtml(album.id)}')">
                            <div class="card-body text-center p-4" style="background:linear-gradient(135deg,rgba(0,106,78,0.1),rgba(255,107,53,0.05))">
                                <i class="${escapeHtml(album.coverIcon)} fa-3x mb-3" style="color:var(--banf-green)"></i>
                                <h6 class="mb-1">${escapeHtml(album.title)}</h6>
                                <small class="text-muted">${escapeHtml(album.date)} • ${album.photos} photos</small>
                                ${album.access === 'members' ? '<br><span class="badge bg-warning text-dark mt-1"><i class="fas fa-lock me-1"></i>Members Only</span>' : ''}
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        };

        /**
         * Initialize embed mode - with internal scrolling
         */
        function initEmbedMode() {
            document.body.classList.add('wix-embed-mode');
            
            // Enable smooth scrolling within the iframe
            document.documentElement.style.scrollBehavior = 'smooth';
            
            // Initialize ad manager
            AdManager.init();

            // Initialize site configuration (Feature 1)
            SiteConfigManager.load();
            SiteConfigManager.applySectionVisibility();
            
            // Still send height for reference (Wix may use it)
            setTimeout(sendHeightToWix, 100);
            window.addEventListener('resize', sendHeightToWix);
            window.addEventListener('load', () => {
                setTimeout(sendHeightToWix, 500);
            });
            
            // Listen for messages from Wix parent
            window.addEventListener('message', (event) => {
                if (event.data && event.data.type === 'WIX_SCROLL_TO') {
                    const section = document.querySelector(event.data.target);
                    if (section) {
                        section.scrollIntoView({ behavior: 'smooth' });
                    }
                }
                // Handle member login status
                if (event.data && event.data.type === 'MEMBER_STATUS') {
                    PhotoGallery.isLoggedIn = event.data.isLoggedIn;
                }
            });
            
            // Use ResizeObserver for accurate dynamic height tracking
            if (typeof ResizeObserver !== 'undefined') {
                const ro = new ResizeObserver(() => {
                    sendHeightToWix();
                });
                ro.observe(document.body);
            }

            console.log('[BANF Embed] Running in embed mode with internal scrolling');
        }

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initEmbedMode);
        } else {
            initEmbedMode();
        }

        // Force favicon to prevent 403 errors - runs immediately
        (function() {
            // Remove any existing favicon links
            var existingLinks = document.querySelectorAll("link[rel*='icon']");
            existingLinks.forEach(function(link) { link.parentNode.removeChild(link); });
            
            // Create new favicon with data URI
            var link = document.createElement('link');
            link.type = 'image/x-icon';
            link.rel = 'icon';
            link.href = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%23ff6b35"/><text x="50" y="65" font-family="Arial" font-size="40" font-weight="bold" fill="white" text-anchor="middle">B</text></svg>';
            document.head.appendChild(link);
            
            // Also set as shortcut icon
            var link2 = document.createElement('link');
            link2.rel = 'shortcut icon';
            link2.href = link.href;
            document.head.appendChild(link2);
        })();

        // ═══════════════════════════════════════════════════════════════
        // MEMBERSHIP DASHBOARD & FAMILY UNIVERSE — JS Logic
        // ═══════════════════════════════════════════════════════════════
        let currentFamilyDetailId = null;

        // ── Membership Dashboard ──────────────────────────────────────
        function renderMembershipDashboard() {
            const year = document.getElementById('mbrYearSelect')?.value || '2026-2027';
            const ecTerm = document.getElementById('mbrECTermSelect')?.value || '26-28';
            const stats = MembershipManager.getDashboardStats();
            const memberships = MembershipManager.getMembershipsByYear(year);

            // Update stats cards
            const allFamilies = MembershipManager.getAllFamilies();
            const activeFamiliesThisYear = allFamilies.filter(f => MembershipManager.isFamilyMemberCurrentYear(f.familyId, year));
            document.getElementById('mbrStatTotalFamilies').textContent = allFamilies.length;
            document.getElementById('mbrStatActive').textContent = activeFamiliesThisYear.length;
            document.getElementById('mbrStatInactive').textContent = allFamilies.length - activeFamiliesThisYear.length;

            const revenue = memberships.reduce((sum, m) => sum + (m.amountPaid || 0), 0);
            document.getElementById('mbrStatRevenue').textContent = '$' + revenue.toLocaleString();

            // Tier breakdown
            const byTier = { family: 0, couple: 0, individual: 0, student: 0 };
            memberships.forEach(m => { if (byTier[m.tier] !== undefined) byTier[m.tier]++; });
            document.getElementById('mbrTierFamily').textContent = byTier.family;
            document.getElementById('mbrTierCouple').textContent = byTier.couple;
            document.getElementById('mbrTierIndividual').textContent = byTier.individual;
            document.getElementById('mbrTierStudent').textContent = byTier.student;

            // Render table
            renderMembershipTable(memberships);
        }

        function renderMembershipTable(memberships) {
            const tbody = document.getElementById('mbrTableBody');
            if (!tbody) return;
            if (!memberships || memberships.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" class="text-center text-muted py-4"><i class="fas fa-inbox me-2"></i>No memberships found for this period</td></tr>';
                return;
            }
            const tierIcons = { family: 'fa-home', couple: 'fa-heart', individual: 'fa-user', student: 'fa-graduation-cap' };
            const tierColors = { family: '#6f42c1', couple: '#0d6efd', individual: '#198754', student: '#ffc107' };
            const statusBadge = s => {
                const colors = { active: 'success', pending: 'warning', expired: 'secondary' };
                return `<span class="badge bg-${colors[s] || 'secondary'}">${(s || 'unknown').charAt(0).toUpperCase() + (s || '').slice(1)}</span>`;
            };

            tbody.innerHTML = memberships.map(m => {
                const family = MembershipManager.getFamily(m.familyId);
                const headName = family ? family.members.find(mb => mb.relationship === 'head')?.name || family.members[0]?.name || '—' : '—';
                return `<tr data-mbr-id="${m.membershipId}" data-tier="${m.tier}" data-status="${m.status}">
                    <td><code>${m.membershipId}</code></td>
                    <td><a href="#" onclick="showFamilyDetail('${m.familyId}');return false;" style="color:#6528F7;">${m.familyId}</a></td>
                    <td>${headName}</td>
                    <td><i class="fas ${tierIcons[m.tier] || 'fa-circle'} me-1" style="color:${tierColors[m.tier] || '#666'};"></i>${(m.tier || '').charAt(0).toUpperCase() + (m.tier || '').slice(1)}</td>
                    <td>$${(m.amountPaid || 0).toLocaleString()}</td>
                    <td>${m.paymentDate || '—'}</td>
                    <td>${(m.paymentMethod || '—').charAt(0).toUpperCase() + (m.paymentMethod || '').slice(1)}</td>
                    <td>${statusBadge(m.status)}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="showFamilyDetail('${m.familyId}')" title="View Family"><i class="fas fa-eye"></i></button>
                    </td>
                </tr>`;
            }).join('');
        }

        function filterMembershipTable() {
            const search = (document.getElementById('mbrSearchInput')?.value || '').toLowerCase();
            const tier = document.getElementById('mbrFilterTier')?.value || '';
            const status = document.getElementById('mbrFilterStatus')?.value || '';
            document.querySelectorAll('#mbrTableBody tr[data-mbr-id]').forEach(row => {
                const text = row.textContent.toLowerCase();
                const matchSearch = !search || text.includes(search);
                const matchTier = !tier || row.dataset.tier === tier;
                const matchStatus = !status || row.dataset.status === status;
                row.style.display = (matchSearch && matchTier && matchStatus) ? '' : 'none';
            });
        }

        // ── Family Universe ───────────────────────────────────────────
        function renderFamilyUniverse() {
            const container = document.getElementById('famCardsContainer');
            if (!container) return;
            const search = (document.getElementById('famSearchInput')?.value || '').toLowerCase();
            const statusFilter = document.getElementById('famFilterStatus')?.value || '';
            const year = document.getElementById('mbrYearSelect')?.value || '2026-2027';

            let families = MembershipManager.getAllFamilies();

            // Filter
            families = families.filter(f => {
                const headName = f.members.find(m => m.relationship === 'head')?.name || f.members[0]?.name || '';
                const textMatch = !search || headName.toLowerCase().includes(search) || f.familyId.toLowerCase().includes(search);
                const isActive = MembershipManager.isFamilyMemberCurrentYear(f.familyId, year);
                const statusMatch = !statusFilter || (statusFilter === 'active' && isActive) || (statusFilter === 'inactive' && !isActive);
                return textMatch && statusMatch;
            });

            if (families.length === 0) {
                container.innerHTML = '<div class="col-12 text-center text-muted py-5"><i class="fas fa-users fa-3x mb-3 d-block" style="opacity:0.3;"></i>No families found</div>';
                return;
            }

            container.innerHTML = families.map(f => {
                const head = f.members.find(m => m.relationship === 'head') || f.members[0] || {};
                const isActive = MembershipManager.isFamilyMemberCurrentYear(f.familyId, year);
                const memberships = MembershipManager.getMembershipsByFamily(f.familyId);
                const currentMbr = memberships.find(m => m.year === year);
                const tierLabel = currentMbr ? (currentMbr.tier.charAt(0).toUpperCase() + currentMbr.tier.slice(1)) : '—';
                const tierIcons = { family: 'fa-home', couple: 'fa-heart', individual: 'fa-user', student: 'fa-graduation-cap' };
                const tierIcon = currentMbr ? (tierIcons[currentMbr.tier] || 'fa-circle') : 'fa-minus';
                const notes = MembershipManager.getNotesFor('family', f.familyId);

                return `<div class="col-md-6 col-lg-4">
                    <div class="admin-card p-3" style="cursor:pointer;border-left:4px solid ${isActive ? '#28a745' : '#dc3545'};" onclick="showFamilyDetail('${f.familyId}')">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <h6 class="mb-0">${head.name || 'Unknown'}</h6>
                                <small class="text-muted"><code>${f.familyId}</code></small>
                            </div>
                            <span class="badge ${isActive ? 'bg-success' : 'bg-danger'}">${isActive ? 'Active' : 'Inactive'}</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <small><i class="fas fa-user-friends me-1"></i>${f.members.length} member${f.members.length !== 1 ? 's' : ''}</small>
                                ${currentMbr ? `<br><small><i class="fas ${tierIcon} me-1"></i>${tierLabel} — $${currentMbr.amountPaid}</small>` : '<br><small class="text-muted">No membership this year</small>'}
                            </div>
                            <div>
                                ${notes.length > 0 ? `<span class="badge bg-info" title="${notes.length} notes"><i class="fas fa-sticky-note"></i> ${notes.length}</span>` : ''}
                                <span class="badge bg-secondary">${memberships.length} yr${memberships.length !== 1 ? 's' : ''}</span>
                            </div>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        // ── Family Detail View ────────────────────────────────────────
        function showFamilyDetail(familyId) {
            currentFamilyDetailId = familyId;
            const family = MembershipManager.getFamily(familyId);
            if (!family) { alert('Family not found: ' + familyId); return; }

            const year = document.getElementById('mbrYearSelect')?.value || '2026-2027';
            const isActive = MembershipManager.isFamilyMemberCurrentYear(familyId, year);
            const head = family.members.find(m => m.relationship === 'head') || family.members[0] || {};

            // Update header
            document.getElementById('famDetailTitle').textContent = head.name + "'s Family";
            document.getElementById('famDetailId').textContent = familyId;
            const statusEl = document.getElementById('famDetailStatus');
            statusEl.textContent = isActive ? 'Active ' + year : 'Inactive ' + year;
            statusEl.className = 'status-badge ' + (isActive ? 'active' : 'inactive');

            // Render members table
            const membersBody = document.getElementById('famMembersTableBody');
            membersBody.innerHTML = family.members.map((m, i) => `<tr>
                <td>${m.name} ${m.relationship === 'head' ? '<span class="badge bg-dark ms-1">Head</span>' : ''}</td>
                <td>${(m.relationship || '').charAt(0).toUpperCase() + (m.relationship || '').slice(1)}</td>
                <td>${m.email || '<span class="text-muted">—</span>'}</td>
                <td>${m.phone || '<span class="text-muted">—</span>'}</td>
                <td>
                    <button class="btn btn-sm btn-outline-secondary" onclick="editFamilyMember('${familyId}',${i})" title="Edit"><i class="fas fa-edit"></i></button>
                    ${m.relationship !== 'head' ? `<button class="btn btn-sm btn-outline-danger ms-1" onclick="removeFamilyMember('${familyId}',${i})" title="Remove"><i class="fas fa-user-minus"></i></button>` : ''}
                </td>
            </tr>`).join('');

            // Render membership history
            const historyBody = document.getElementById('famMembershipHistoryBody');
            const memberships = MembershipManager.getMembershipsByFamily(familyId);
            if (memberships.length === 0) {
                historyBody.innerHTML = '<tr><td colspan="7" class="text-center text-muted">No membership records</td></tr>';
            } else {
                historyBody.innerHTML = memberships.map(m => `<tr>
                    <td><code>${m.membershipId}</code></td>
                    <td>${m.year}</td>
                    <td>EC ${m.ecTerm}</td>
                    <td>${(m.tier || '').charAt(0).toUpperCase() + (m.tier || '').slice(1)}</td>
                    <td>$${(m.amountPaid || 0).toLocaleString()}</td>
                    <td>${m.paymentDate || '—'} (${(m.paymentMethod || '—').charAt(0).toUpperCase() + (m.paymentMethod || '').slice(1)})</td>
                    <td><span class="badge bg-${m.status === 'active' ? 'success' : m.status === 'pending' ? 'warning' : 'secondary'}">${(m.status || '').charAt(0).toUpperCase() + (m.status || '').slice(1)}</span></td>
                </tr>`).join('');
            }

            // Render admin notes
            const notesContainer = document.getElementById('famNotesContainer');
            const notes = MembershipManager.getNotesFor('family', familyId);
            if (notes.length === 0) {
                notesContainer.innerHTML = '<div class="text-center text-muted py-3"><i class="fas fa-sticky-note me-1"></i>No notes yet</div>';
            } else {
                notesContainer.innerHTML = notes.sort((a, b) => new Date(b.date) - new Date(a.date)).map(n => `
                    <div class="border rounded p-2 mb-2" style="background:#f8f9fa;">
                        <div class="d-flex justify-content-between">
                            <small class="text-muted"><i class="fas fa-user me-1"></i>${n.addedBy}</small>
                            <small class="text-muted"><i class="fas fa-clock me-1"></i>${new Date(n.date).toLocaleString()}</small>
                        </div>
                        <div class="mt-1">${n.note}</div>
                    </div>`).join('');
            }

            // Show the section
            showAdminSection('familyDetail');
        }

        // ── Modal Launchers ───────────────────────────────────────────
        function showAddMembershipModal(prefillFamilyId) {
            document.getElementById('mbrFormEditId').value = '';
            document.getElementById('addMembershipModalLabel').innerHTML = '<i class="fas fa-id-card me-2"></i>New Membership';
            const form = document.getElementById('addMembershipForm');
            form.reset();
            // Populate family dropdown
            const famSelect = document.getElementById('mbrFormFamily');
            const families = MembershipManager.getAllFamilies();
            famSelect.innerHTML = '<option value="">Select family...</option>' +
                families.map(f => {
                    const head = f.members.find(m => m.relationship === 'head') || f.members[0] || {};
                    return `<option value="${f.familyId}" ${f.familyId === prefillFamilyId ? 'selected' : ''}>${f.familyId} — ${head.name || 'Unknown'}</option>`;
                }).join('');
            // Set today's date
            document.getElementById('mbrFormPaymentDate').value = new Date().toISOString().split('T')[0];
            // Toggle future date checkbox
            document.getElementById('mbrFormFutureDate').addEventListener('change', function() {
                document.getElementById('mbrFormAgreedDate').classList.toggle('d-none', !this.checked);
                if (this.checked) document.getElementById('mbrFormStatus').value = 'pending';
            });
            new bootstrap.Modal(document.getElementById('addMembershipModal')).show();
        }

        function updateMbrFormAmount() {
            const tier = document.getElementById('mbrFormTier').value;
            const amounts = { student: 165, individual: 240, couple: 330, family: 410 };
            if (amounts[tier]) document.getElementById('mbrFormAmount').value = amounts[tier];
        }

        function submitMembership(e) {
            e.preventDefault();
            const familyId = document.getElementById('mbrFormFamily').value;
            const year = document.getElementById('mbrFormYear').value;
            const tier = document.getElementById('mbrFormTier').value;
            const amount = parseFloat(document.getElementById('mbrFormAmount').value);
            const paymentDate = document.getElementById('mbrFormPaymentDate').value;
            const paymentMethod = document.getElementById('mbrFormPaymentMethod').value;
            const ecTerm = document.getElementById('mbrFormECTerm').value;
            const status = document.getElementById('mbrFormStatus').value;
            const agreedFutureDate = document.getElementById('mbrFormFutureDate').checked ? document.getElementById('mbrFormAgreedDate').value : null;

            if (!familyId || !tier || !amount) {
                document.getElementById('mbrFormStatus_msg').innerHTML = '<div class="alert alert-danger">Please fill all required fields</div>';
                return false;
            }

            const mbr = MembershipManager.createMembership(familyId, year, tier, amount, paymentDate, paymentMethod, ecTerm);
            if (mbr) {
                mbr.status = status;
                if (agreedFutureDate) mbr.agreedFutureDate = agreedFutureDate;
                MembershipManager._save();
                bootstrap.Modal.getInstance(document.getElementById('addMembershipModal'))?.hide();
                renderMembershipDashboard();
                if (currentFamilyDetailId === familyId) showFamilyDetail(familyId);
            }
            return false;
        }

        function showAddFamilyModal() {
            document.getElementById('famFormEditId').value = '';
            document.getElementById('addFamilyModalLabel').innerHTML = '<i class="fas fa-users me-2"></i>New Family';
            document.getElementById('addFamilyForm').reset();
            document.getElementById('famFormMembersList').innerHTML = '';
            addFamilyMemberRow(); // Add first empty member row
            new bootstrap.Modal(document.getElementById('addFamilyModal')).show();
        }

        function showEditFamilyModal() {
            if (!currentFamilyDetailId) return;
            const family = MembershipManager.getFamily(currentFamilyDetailId);
            if (!family) return;
            const head = family.members.find(m => m.relationship === 'head') || family.members[0];
            document.getElementById('famFormEditId').value = currentFamilyDetailId;
            document.getElementById('addFamilyModalLabel').innerHTML = '<i class="fas fa-edit me-2"></i>Edit Family';
            document.getElementById('famFormHeadName').value = head?.name || '';
            document.getElementById('famFormHeadEmail').value = head?.email || '';
            document.getElementById('famFormHeadPhone').value = head?.phone || '';
            // Populate additional members
            const membersList = document.getElementById('famFormMembersList');
            membersList.innerHTML = '';
            family.members.filter(m => m.relationship !== 'head').forEach(m => addFamilyMemberRow(m));
            new bootstrap.Modal(document.getElementById('addFamilyModal')).show();
        }

        function addFamilyMemberRow(prefill) {
            const container = document.getElementById('famFormMembersList');
            const row = document.createElement('div');
            row.className = 'row g-2 mb-2 align-items-end fam-member-row';
            row.innerHTML = `
                <div class="col-md-3"><input type="text" class="form-control form-control-sm" placeholder="Name" value="${prefill?.name || ''}"></div>
                <div class="col-md-2"><select class="form-select form-select-sm">
                    <option value="spouse" ${prefill?.relationship === 'spouse' ? 'selected' : ''}>Spouse</option>
                    <option value="child" ${prefill?.relationship === 'child' ? 'selected' : ''}>Child</option>
                    <option value="parent" ${prefill?.relationship === 'parent' ? 'selected' : ''}>Parent</option>
                    <option value="sibling" ${prefill?.relationship === 'sibling' ? 'selected' : ''}>Sibling</option>
                    <option value="other" ${prefill?.relationship === 'other' ? 'selected' : ''}>Other</option>
                </select></div>
                <div class="col-md-3"><input type="email" class="form-control form-control-sm" placeholder="Email" value="${prefill?.email || ''}"></div>
                <div class="col-md-3"><input type="tel" class="form-control form-control-sm" placeholder="Phone" value="${prefill?.phone || ''}"></div>
                <div class="col-md-1"><button type="button" class="btn btn-sm btn-outline-danger" onclick="this.closest('.fam-member-row').remove()"><i class="fas fa-times"></i></button></div>`;
            container.appendChild(row);
        }

        function submitFamily(e) {
            e.preventDefault();
            const editId = document.getElementById('famFormEditId').value;
            const headName = document.getElementById('famFormHeadName').value.trim();
            const headEmail = document.getElementById('famFormHeadEmail').value.trim();
            const headPhone = document.getElementById('famFormHeadPhone').value.trim();

            if (!headName) {
                document.getElementById('famFormStatus_msg').innerHTML = '<div class="alert alert-danger">Head of family name is required</div>';
                return false;
            }

            // Collect additional members
            const additionalMembers = [];
            document.querySelectorAll('#famFormMembersList .fam-member-row').forEach(row => {
                const inputs = row.querySelectorAll('input');
                const select = row.querySelector('select');
                const name = inputs[0]?.value?.trim();
                if (name) {
                    additionalMembers.push({
                        name,
                        relationship: select?.value || 'other',
                        email: inputs[1]?.value?.trim() || '',
                        phone: inputs[2]?.value?.trim() || ''
                    });
                }
            });

            if (editId) {
                // Update existing family
                const family = MembershipManager.getFamily(editId);
                if (family) {
                    const head = family.members.find(m => m.relationship === 'head') || family.members[0];
                    if (head) { head.name = headName; head.email = headEmail; head.phone = headPhone; }
                    // Replace non-head members
                    family.members = [head, ...additionalMembers];
                    MembershipManager._save();
                }
            } else {
                // Create new family
                MembershipManager.createFamily(headName, headEmail, headPhone, additionalMembers);
            }

            bootstrap.Modal.getInstance(document.getElementById('addFamilyModal'))?.hide();
            renderFamilyUniverse();
            if (editId) showFamilyDetail(editId);
            return false;
        }

        function showTransferMemberModal() {
            if (!currentFamilyDetailId) return;
            const family = MembershipManager.getFamily(currentFamilyDetailId);
            if (!family) return;

            document.getElementById('xferSourceFamilyId').value = currentFamilyDetailId;
            const memberSelect = document.getElementById('xferMemberSelect');
            memberSelect.innerHTML = '<option value="">Select member...</option>' +
                family.members.filter(m => m.relationship !== 'head').map((m, i) =>
                    `<option value="${i}">${m.name} (${m.relationship})</option>`
                ).join('');

            // Populate existing families dropdown
            const existingSelect = document.getElementById('xferExistingFamily');
            existingSelect.innerHTML = MembershipManager.getAllFamilies()
                .filter(f => f.familyId !== currentFamilyDetailId)
                .map(f => {
                    const head = f.members.find(m => m.relationship === 'head') || f.members[0];
                    return `<option value="${f.familyId}">${f.familyId} — ${head?.name || 'Unknown'}</option>`;
                }).join('');

            // Toggle existing family dropdown
            document.getElementById('xferDestination').onchange = function() {
                document.getElementById('xferExistingFamilyDiv').classList.toggle('d-none', this.value !== 'existing');
            };

            document.getElementById('transferMemberForm').reset();
            document.getElementById('xferSourceFamilyId').value = currentFamilyDetailId;
            new bootstrap.Modal(document.getElementById('transferMemberModal')).show();
        }

        function submitTransferMember(e) {
            e.preventDefault();
            const sourceFamilyId = document.getElementById('xferSourceFamilyId').value;
            const memberIdx = parseInt(document.getElementById('xferMemberSelect').value);
            const destination = document.getElementById('xferDestination').value;
            const reason = document.getElementById('xferReason').value;

            const family = MembershipManager.getFamily(sourceFamilyId);
            if (!family || isNaN(memberIdx)) { alert('Please select a member to transfer'); return false; }

            const member = family.members[memberIdx];
            if (!member) { alert('Invalid member selection'); return false; }

            if (destination === 'existing') {
                const destFamilyId = document.getElementById('xferExistingFamily').value;
                if (!destFamilyId) { alert('Please select a destination family'); return false; }
                // Move member to existing family
                MembershipManager.addFamilyMember(destFamilyId, member.name, member.relationship === 'head' ? 'other' : member.relationship, member.email, member.phone);
                MembershipManager.removeFamilyMember(sourceFamilyId, memberIdx);
                // Add note
                MembershipManager.addAdminNote('family', sourceFamilyId, `Member "${member.name}" transferred to ${destFamilyId}. Reason: ${reason || 'Not specified'}`, AdminPortal.admin?.name || 'Admin');
                MembershipManager.addAdminNote('family', destFamilyId, `Member "${member.name}" transferred from ${sourceFamilyId}. Reason: ${reason || 'Not specified'}`, AdminPortal.admin?.name || 'Admin');
            } else {
                // Create new family with transferred member
                const result = MembershipManager.transferMemberToNewFamily(sourceFamilyId, memberIdx);
                if (result) {
                    MembershipManager.addAdminNote('family', sourceFamilyId, `Member "${member.name}" transferred to new family ${result.familyId}. Reason: ${reason || 'Not specified'}`, AdminPortal.admin?.name || 'Admin');
                    MembershipManager.addAdminNote('family', result.familyId, `Family created via transfer from ${sourceFamilyId}. Reason: ${reason || 'Not specified'}`, AdminPortal.admin?.name || 'Admin');
                }
            }

            bootstrap.Modal.getInstance(document.getElementById('transferMemberModal'))?.hide();
            showFamilyDetail(sourceFamilyId);
            return false;
        }

        function showAddNoteModal(targetType, targetId) {
            const type = targetType || 'family';
            const id = targetId || currentFamilyDetailId;
            document.getElementById('noteFormTargetType').value = type;
            document.getElementById('noteFormTargetId').value = id;
            document.getElementById('noteFormTargetLabel').value = `${type.charAt(0).toUpperCase() + type.slice(1)}: ${id}`;
            document.getElementById('noteFormText').value = '';
            new bootstrap.Modal(document.getElementById('addNoteModal')).show();
        }

        function submitAdminNote(e) {
            e.preventDefault();
            const type = document.getElementById('noteFormTargetType').value;
            const id = document.getElementById('noteFormTargetId').value;
            const note = document.getElementById('noteFormText').value.trim();
            if (!note) { alert('Please enter a note'); return false; }
            MembershipManager.addAdminNote(type, id, note, AdminPortal.admin?.name || 'Admin');
            bootstrap.Modal.getInstance(document.getElementById('addNoteModal'))?.hide();
            if (currentFamilyDetailId) showFamilyDetail(currentFamilyDetailId);
            return false;
        }

        function showAddFamilyMemberModal() {
            if (!currentFamilyDetailId) return;
            document.getElementById('addMemFamilyId').value = currentFamilyDetailId;
            document.getElementById('addFamilyMemberForm').reset();
            document.getElementById('addMemFamilyId').value = currentFamilyDetailId;
            new bootstrap.Modal(document.getElementById('addFamilyMemberModal')).show();
        }

        function submitAddFamilyMember(e) {
            e.preventDefault();
            const familyId = document.getElementById('addMemFamilyId').value;
            const name = document.getElementById('addMemName').value.trim();
            const relation = document.getElementById('addMemRelation').value;
            const email = document.getElementById('addMemEmail').value.trim();
            const phone = document.getElementById('addMemPhone').value.trim();
            if (!name) { alert('Name is required'); return false; }
            MembershipManager.addFamilyMember(familyId, name, relation, email, phone);
            bootstrap.Modal.getInstance(document.getElementById('addFamilyMemberModal'))?.hide();
            showFamilyDetail(familyId);
            return false;
        }

        function editFamilyMember(familyId, memberIdx) {
            const family = MembershipManager.getFamily(familyId);
            if (!family) return;
            const member = family.members[memberIdx];
            if (!member) return;
            const newName = prompt('Name:', member.name);
            if (newName === null) return;
            const newEmail = prompt('Email:', member.email || '');
            const newPhone = prompt('Phone:', member.phone || '');
            const updates = {};
            if (newName.trim()) updates.name = newName.trim();
            if (newEmail !== null) updates.email = newEmail.trim();
            if (newPhone !== null) updates.phone = newPhone.trim();
            MembershipManager.updateFamilyMember(familyId, memberIdx, updates);
            showFamilyDetail(familyId);
        }

        function removeFamilyMember(familyId, memberIdx) {
            const family = MembershipManager.getFamily(familyId);
            if (!family) return;
            const member = family.members[memberIdx];
            if (!member) return;
            if (!confirm(`Remove ${member.name} from this family?`)) return;
            MembershipManager.removeFamilyMember(familyId, memberIdx);
            MembershipManager.addAdminNote('family', familyId, `Removed member: ${member.name}`, AdminPortal.admin?.name || 'Admin');
            showFamilyDetail(familyId);
        }

        function renderLegacyMembers() {
            const tbody = document.getElementById('legacyMembersTableBody');
            if (!tbody) return;
            const families = MembershipManager.getAllFamilies();
            const year = '2026-2027';
            const rows = [];
            families.forEach(f => {
                f.members.forEach(m => {
                    const isActive = MembershipManager.isFamilyMemberCurrentYear(f.familyId, year);
                    const mbr = MembershipManager.getMembershipsByFamily(f.familyId).find(mb => mb.year === year);
                    rows.push(`<tr>
                        <td><code>${mbr?.membershipId || '—'}</code></td>
                        <td>${m.name}</td>
                        <td>${m.email || '—'}</td>
                        <td>${mbr ? mbr.tier.charAt(0).toUpperCase() + mbr.tier.slice(1) : '—'}</td>
                        <td><span class="status-badge ${isActive ? 'active' : 'inactive'}">${isActive ? 'Active' : 'Inactive'}</span></td>
                        <td><button class="btn btn-sm btn-outline-primary" onclick="showFamilyDetail('${f.familyId}')"><i class="fas fa-eye"></i></button></td>
                    </tr>`);
                });
            });
            tbody.innerHTML = rows.length ? rows.join('') : '<tr><td colspan="6" class="text-center text-muted">No members</td></tr>';
        }

        // ========== ZELLE PAYMENT AUTOMATION ==========
        // Zelle runs via Wix Velo HTTP Functions — same pattern as Gmail
        const ZELLE_API = WIX_API_BASE;
        let _zelleServiceAvailable = false;
        let _zelleCurrentFilter = 'all';
        let _zelleMatchPaymentId = null;

        // Check Zelle service availability on load
        async function zelleCheckService() {
            try {
                const result = await safeApiFetch('/zelle_health');
                if (result.ok) { _zelleServiceAvailable = true; return true; }
            } catch (e) { /* service not available */ }
            _zelleServiceAvailable = false;
            // Show offline banner in the Zelle section
            const banner = document.getElementById('zelleScanBanner');
            if (banner) {
                banner.style.display = 'block';
                banner.style.background = '#fff3e0'; banner.style.borderColor = '#ff9800';
                document.getElementById('zelleScanMessage').innerHTML =
                    '<i class="fas fa-info-circle"></i> <strong>Zelle service connecting...</strong> The Zelle Payment API is initializing via Wix Velo. ' +
                    'If this persists, contact your admin to verify the backend is published.';
            }
            return false;
        }

        async function zelleApiFetch(path, options = {}) {
            // Convert REST-style paths to Wix Velo flat function names
            // e.g. /stats → /zelle_stats, /payments → /zelle_payments, /payments/5/verify → /zelle_verify
            let endpoint;
            const cleanPath = path.replace(/^\//, '');
            
            // Handle parameterized paths like /payments/:id/verify, /payments/:id/reject, /payments/:id/match
            const actionMatch = cleanPath.match(/^payments\/(\d+)\/(verify|reject|match)$/);
            if (actionMatch) {
                endpoint = `/zelle_${actionMatch[2]}`;
                // Inject the payment ID into the body
                let body = {};
                try { body = JSON.parse(options.body || '{}'); } catch(e) {}
                body.payment_id = parseInt(actionMatch[1]);
                options.body = JSON.stringify(body);
            } else if (cleanPath.startsWith('poller/')) {
                endpoint = `/zelle_poller_${cleanPath.split('/')[1]}`; // poller/start → zelle_poller_start
            } else if (cleanPath.startsWith('test/')) {
                endpoint = `/zelle_test_${cleanPath.split('/')[1]}`; // test/seed → zelle_test_seed
            } else {
                endpoint = `/zelle_${cleanPath.replace(/\?.*/, '')}`; // /stats → /zelle_stats
            }
            
            // Preserve query params
            const qIdx = path.indexOf('?');
            if (qIdx >= 0) {
                const params = path.substring(qIdx + 1);
                // Inject query params into body for POST, or append for GET
                if (options.method === 'POST' || options.body) {
                    let body = {};
                    try { body = JSON.parse(options.body || '{}'); } catch(e) {}
                    new URLSearchParams(params).forEach((v, k) => { body[k] = v; });
                    options.body = JSON.stringify(body);
                } else {
                    endpoint += '?' + params;
                }
            }
            
            // Use safeApiFetch (same wrapper as Gmail)
            const result = await safeApiFetch(endpoint, {
                method: options.method || 'GET',
                ...(options.body ? { body: options.body } : {})
            });
            
            if (!result.ok) {
                if (result.status === 404) {
                    _zelleServiceAvailable = false;
                    console.warn('[Zelle] Endpoint not found:', endpoint, '— Wix Velo backend may not be published.');
                }
                return null;
            }
            return result.data;
        }

        async function zelleLoadStats() {
            const data = await zelleApiFetch('/stats');
            if (!data) return;
            document.getElementById('zelleTotalDetected').textContent = data.total_payments || 0;
            document.getElementById('zellePendingCount').textContent = (data.by_status?.pending?.count || 0);
            const verified = (data.by_status?.verified?.count || 0) + (data.by_status?.auto_verified?.count || 0);
            document.getElementById('zelleVerifiedCount').textContent = verified;
            document.getElementById('zelleAutoMatched').textContent = data.auto_vs_manual?.auto || 0;
            document.getElementById('zelleTotalAmount').textContent = '$' + (data.total_amount || 0).toLocaleString(undefined, {minimumFractionDigits:2});
            if (data.last_poll?.poll_time) {
                const d = new Date(data.last_poll.poll_time);
                document.getElementById('zelleLastScan').textContent = d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
            }
            // Poller toggle
            const btn = document.getElementById('btnZelleAutoToggle');
            if (data.poller_active) {
                btn.innerHTML = '<i class="fas fa-sync-alt fa-spin"></i> Auto-Poll: ON';
                btn.classList.remove('admin-secondary'); btn.classList.add('admin-primary');
            } else {
                btn.innerHTML = '<i class="fas fa-sync-alt"></i> Auto-Poll: OFF';
                btn.classList.remove('admin-primary'); btn.classList.add('admin-secondary');
            }
        }

        async function zelleLoadPayments() {
            const statusParam = _zelleCurrentFilter === 'all' ? '' : `?status=${_zelleCurrentFilter}`;
            const data = await zelleApiFetch(`/payments${statusParam}`);
            if (!data || !data.payments) return;
            const tbody = document.getElementById('zellePaymentsBody');
            if (data.payments.length === 0) {
                tbody.innerHTML = `<tr><td colspan="9" class="text-center" style="padding:2rem; color:#999;">
                    <i class="fas fa-inbox" style="font-size:2rem; display:block; margin-bottom:0.5rem;"></i>
                    No payments found${_zelleCurrentFilter !== 'all' ? ' with status "' + _zelleCurrentFilter + '"' : ''}. Click "Scan Gmail Now" or "Load Test Data" to start.
                </td></tr>`;
                return;
            }
            tbody.innerHTML = data.payments.map(p => {
                const statusColors = { pending: '#FFC107', auto_verified: '#17a2b8', verified: '#28a745', rejected: '#dc3545' };
                const statusLabels = { pending: '⏳ Pending', auto_verified: '🤖 Auto-Verified', verified: '✅ Verified', rejected: '❌ Rejected' };
                const color = statusColors[p.status] || '#6c757d';
                const label = statusLabels[p.status] || p.status;
                const dateStr = p.email_date ? new Date(p.email_date).toLocaleDateString() : 'N/A';
                let actions = '';
                if (p.status === 'pending') {
                    actions = `<button class="admin-primary" style="font-size:0.8rem; padding:4px 10px;" onclick="zelleVerifyPayment(${p.id})"><i class="fas fa-check"></i></button>
                        <button class="admin-secondary" style="font-size:0.8rem; padding:4px 10px;" onclick="zelleOpenMatchModal(${p.id}, '${(p.sender_name||'').replace(/'/g,"\\'")} - $${p.amount}')"><i class="fas fa-link"></i></button>
                        <button class="admin-secondary" style="font-size:0.8rem; padding:4px 8px; color:#dc3545;" onclick="zelleRejectPayment(${p.id})"><i class="fas fa-times"></i></button>`;
                } else if (p.status === 'auto_verified') {
                    actions = `<button class="admin-secondary" style="font-size:0.8rem; padding:4px 10px;" onclick="zelleVerifyPayment(${p.id})" title="Confirm"><i class="fas fa-check-double"></i></button>`;
                }
                return `<tr>
                    <td style="font-size:0.85rem;">${p.id}</td>
                    <td style="font-size:0.85rem;">${dateStr}</td>
                    <td><strong>${p.sender_name || 'Unknown'}</strong><br><small style="color:#888;">${(p.sender_email||'').substring(0,30)}</small></td>
                    <td><strong style="color:#28a745;">$${(p.amount||0).toFixed(2)}</strong></td>
                    <td style="font-size:0.85rem;">${p.memo || '-'}</td>
                    <td style="font-size:0.85rem;">${p.bank_source || '-'}</td>
                    <td>${p.matched_member_name ? '<i class="fas fa-user-check" style="color:#28a745;"></i> ' + p.matched_member_name : '<span style="color:#999;">Unmatched</span>'}</td>
                    <td><span style="background:${color}22; color:${color}; padding:3px 10px; border-radius:12px; font-size:0.8rem; font-weight:600;">${label}</span></td>
                    <td style="white-space:nowrap;">${actions}</td>
                </tr>`;
            }).join('');
            zelleLoadStats();
        }

        async function zelleManualScan() {
            const btn = document.getElementById('btnZelleScan');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Scanning...';
            const banner = document.getElementById('zelleScanBanner');
            banner.style.display = 'none';
            const result = await zelleApiFetch('/scan', { method: 'POST', body: JSON.stringify({ days_back: 90 }) });
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-search"></i> Scan Gmail Now';
            if (result) {
                banner.style.display = 'block';
                if (result.new_payments > 0) {
                    banner.style.background = '#e8f5e9'; banner.style.borderColor = '#4caf50';
                    document.getElementById('zelleScanMessage').innerHTML =
                        `<strong>${result.new_payments}</strong> new Zelle payment(s) detected! (${result.auto_matched} auto-matched) • ${result.emails_checked} emails scanned in ${result.duration_ms}ms`;
                } else {
                    banner.style.background = '#fff3e0'; banner.style.borderColor = '#ff9800';
                    document.getElementById('zelleScanMessage').innerHTML =
                        `No new payments found. ${result.emails_checked} emails scanned in ${result.duration_ms}ms`;
                }
                zelleLoadPayments();
            } else {
                banner.style.display = 'block';
                banner.style.background = '#ffebee'; banner.style.borderColor = '#f44336';
                document.getElementById('zelleScanMessage').innerHTML =
                    '❌ Scan failed. Verify that the Zelle backend is published on Wix Velo.';
            }
        }

        async function zelleTogglePoller() {
            const btn = document.getElementById('btnZelleAutoToggle');
            const isOn = btn.textContent.includes('ON');
            const result = await zelleApiFetch(isOn ? '/poller/stop' : '/poller/start', { method: 'POST' });
            if (result?.success) zelleLoadStats();
        }

        function zelleFilterPayments(status) {
            _zelleCurrentFilter = status;
            ['All','Pending','Auto','Verified','Rejected'].forEach(s => {
                const el = document.getElementById('zelleFilter' + s);
                if (el) { el.classList.remove('admin-primary'); el.classList.add('admin-secondary'); }
            });
            const map = { all: 'All', pending: 'Pending', auto_verified: 'Auto', verified: 'Verified', rejected: 'Rejected' };
            const activeBtn = document.getElementById('zelleFilter' + (map[status] || 'All'));
            if (activeBtn) { activeBtn.classList.remove('admin-secondary'); activeBtn.classList.add('admin-primary'); }
            zelleLoadPayments();
        }

        async function zelleVerifyPayment(id) {
            if (!confirm('Verify this payment?')) return;
            await zelleApiFetch(`/payments/${id}/verify`, { method: 'POST', body: JSON.stringify({ verified_by: 'admin' }) });
            zelleLoadPayments();
        }

        async function zelleRejectPayment(id) {
            const reason = prompt('Reason for rejection (optional):') || '';
            await zelleApiFetch(`/payments/${id}/reject`, { method: 'POST', body: JSON.stringify({ reason }) });
            zelleLoadPayments();
        }

        async function zelleOpenMatchModal(paymentId, info) {
            _zelleMatchPaymentId = paymentId;
            document.getElementById('zelleMatchPaymentInfo').textContent = info;
            // Load members
            const data = await zelleApiFetch('/members');
            const sel = document.getElementById('zelleMatchMemberSelect');
            sel.innerHTML = '<option value="">-- Select a member --</option>';
            if (data?.members) {
                data.members.forEach(m => {
                    sel.innerHTML += `<option value="${m.id}">${m.full_name} (${m.email})</option>`;
                });
            }
            document.getElementById('zelleMatchModal').style.display = 'flex';
        }

        function zelleCloseMatchModal() {
            document.getElementById('zelleMatchModal').style.display = 'none';
            _zelleMatchPaymentId = null;
        }

        async function zelleConfirmMatch() {
            const memberId = document.getElementById('zelleMatchMemberSelect').value;
            if (!memberId) { alert('Please select a member'); return; }
            await zelleApiFetch(`/payments/${_zelleMatchPaymentId}/match`, {
                method: 'POST', body: JSON.stringify({ member_id: memberId })
            });
            zelleCloseMatchModal();
            zelleLoadPayments();
        }

        async function zelleSeedTestData() {
            const result = await zelleApiFetch('/test/seed', { method: 'POST' });
            if (result?.success) {
                const banner = document.getElementById('zelleScanBanner');
                banner.style.display = 'block';
                banner.style.background = '#e3f2fd'; banner.style.borderColor = '#2196f3';
                document.getElementById('zelleScanMessage').innerHTML =
                    `<i class="fas fa-flask"></i> ${result.inserted} test Zelle payment(s) loaded for demo.`;
                zelleLoadPayments();
            }
        }

        function portalRefreshPayments() {
            // Refresh member portal payment view from Zelle service
            zelleApiFetch('/history').then(data => {
                if (!data?.history?.length) return;
                const tbody = document.getElementById('portalPaymentHistoryBody');
                tbody.innerHTML = data.history.map(h => {
                    const d = h.created_at ? new Date(h.created_at).toLocaleDateString('en-US', {month:'short', day:'2-digit', year:'numeric'}) : '';
                    return `<tr>
                        <td>${d}</td>
                        <td>${h.description || h.payment_type || ''}</td>
                        <td>$${(h.amount||0).toFixed(2)}</td>
                        <td><i class="fas fa-bolt" style="color:#6528F7;"></i> ${h.payment_method || 'Zelle'}</td>
                        <td><span class="status-badge active">${h.status === 'completed' ? 'Paid' : h.status}</span></td>
                        <td><a href="#" class="text-primary" onclick="alert('Receipt: ${h.receipt_number || 'N/A'}'); return false;"><i class="fas fa-download"></i> PDF</a></td>
                    </tr>`;
                }).join('');
            });
        }
        // ========== END ZELLE PAYMENT AUTOMATION ==========
    </script>

    <!-- ========== SOURCE CODE PROTECTION ========== -->
    <script>
    (function() {
        'use strict';

        // Block keyboard shortcuts for viewing source / DevTools
        document.addEventListener('keydown', function(e) {
            // F12 — DevTools
            if (e.key === 'F12' || e.keyCode === 123) {
                e.preventDefault(); e.stopPropagation(); return false;
            }
            // Ctrl+U — View Source
            if (e.ctrlKey && e.key === 'u') {
                e.preventDefault(); e.stopPropagation(); return false;
            }
            // Ctrl+Shift+I — DevTools Inspector
            if (e.ctrlKey && e.shiftKey && e.key === 'I') {
                e.preventDefault(); e.stopPropagation(); return false;
            }
            // Ctrl+Shift+J — DevTools Console
            if (e.ctrlKey && e.shiftKey && e.key === 'J') {
                e.preventDefault(); e.stopPropagation(); return false;
            }
            // Ctrl+Shift+C — DevTools Inspect Element
            if (e.ctrlKey && e.shiftKey && e.key === 'C') {
                e.preventDefault(); e.stopPropagation(); return false;
            }
            // Ctrl+S — Save page
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault(); e.stopPropagation(); return false;
            }
            // Ctrl+A — Select all
            if (e.ctrlKey && e.key === 'a') {
                e.preventDefault(); e.stopPropagation(); return false;
            }
            // Ctrl+P — Print (can reveal source)
            if (e.ctrlKey && e.key === 'p') {
                e.preventDefault(); e.stopPropagation(); return false;
            }
        }, true);

        // Block right-click context menu
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault(); return false;
        }, true);

        // Block drag
        document.addEventListener('dragstart', function(e) {
            e.preventDefault(); return false;
        }, true);

        // DevTools detection — console warning + clear
        var devtoolsWarning = function() {
            console.clear();
            console.log('%c⛔ STOP!', 'color: red; font-size: 48px; font-weight: bold;');
            console.log('%cThis is a protected website. Unauthorized access or inspection of source code is not permitted.', 'color: #333; font-size: 16px;');
            console.log('%c© BANF Jacksonville — Bengali Association of North Florida', 'color: #006A4E; font-size: 14px;');
        };
        devtoolsWarning();

        // Periodic console clear to deter DevTools browsing
        setInterval(devtoolsWarning, 5000);

        // Disable view-source protocol
        if (window.location.protocol === 'view-source:') {
            window.location.href = window.location.href.replace('view-source:', '');
        }

        // Disable image dragging
        document.addEventListener('DOMContentLoaded', function() {
            var images = document.querySelectorAll('img');
            images.forEach(function(img) {
                img.setAttribute('draggable', 'false');
                img.style.pointerEvents = 'auto';
            });
        });
    })();
    </script>
</body>
</html>
