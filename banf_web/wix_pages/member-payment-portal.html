<!-- 
BANF Member Payment Portal - Wix Page
Page Name: member-payment
URL: /member-payment

Instructions to implement in Wix:
1. Create a new page named "Member Payment Portal"
2. Copy this HTML structure using Wix's custom elements or use Wix's native elements
3. Connect the Velo backend code from payment-processing.jsw
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Member Payment - BANF</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --banf-green: #006A4E;
            --banf-orange: #F42A41;
            --banf-gold: #FFD700;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
            min-height: 100vh;
        }
        
        .page-header {
            background: linear-gradient(135deg, var(--banf-green) 0%, #004d38 100%);
            color: white;
            padding: 40px 0;
            margin-bottom: 30px;
        }
        
        .payment-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 25px;
        }
        
        .payment-card .card-header {
            background: linear-gradient(135deg, var(--banf-green) 0%, #008B5C 100%);
            color: white;
            padding: 20px 25px;
            border: none;
        }
        
        .membership-tier {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .membership-tier:hover {
            border-color: var(--banf-green);
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0,106,78,0.2);
        }
        
        .membership-tier.selected {
            border-color: var(--banf-green);
            background: linear-gradient(135deg, rgba(0,106,78,0.05) 0%, rgba(0,139,92,0.05) 100%);
        }
        
        .tier-badge {
            background: var(--banf-green);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .tier-badge.eb {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #333;
        }
        
        .price-display {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--banf-green);
        }
        
        .fee-notice {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .fee-breakdown {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .fee-breakdown .line-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed #dee2e6;
        }
        
        .fee-breakdown .line-item:last-child {
            border-bottom: none;
        }
        
        .fee-breakdown .total {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--banf-green);
            border-top: 2px solid var(--banf-green);
            margin-top: 10px;
            padding-top: 10px;
        }
        
        .btn-pay {
            background: linear-gradient(135deg, var(--banf-green) 0%, #008B5C 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .btn-pay:hover {
            background: linear-gradient(135deg, #005540 0%, #006A4E 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,106,78,0.3);
        }
        
        .btn-zelle {
            background: linear-gradient(135deg, #6d1ed4 0%, #9333ea 100%);
            color: white;
        }
        
        .btn-zelle:hover {
            background: linear-gradient(135deg, #5a18b0 0%, #7928ca 100%);
            color: white;
        }
        
        .zelle-info {
            background: linear-gradient(135deg, #f3e8ff 0%, #ede9fe 100%);
            border: 2px solid #9333ea;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
        }
        
        .zelle-info .zelle-logo {
            font-size: 2.5rem;
            color: #6d1ed4;
            margin-bottom: 15px;
        }
        
        .payment-method-tabs .nav-link {
            color: #666;
            font-weight: 500;
            border: none;
            padding: 15px 25px;
        }
        
        .payment-method-tabs .nav-link.active {
            color: var(--banf-green);
            background: transparent;
            border-bottom: 3px solid var(--banf-green);
        }
        
        .secure-badge {
            background: #d4edda;
            color: #155724;
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="page-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1><i class="fas fa-credit-card me-3"></i>Member Payment Portal</h1>
                    <p class="mb-0 opacity-75">Pay your membership dues and event fees securely online</p>
                </div>
                <div class="col-md-4 text-md-end">
                    <span class="secure-badge">
                        <i class="fas fa-shield-alt"></i> Secure Payment
                    </span>
                </div>
            </div>
        </div>
    </div>

    <div class="container pb-5">
        <!-- Fee Notice -->
        <div class="fee-notice">
            <div class="row align-items-center">
                <div class="col-md-1 text-center">
                    <i class="fas fa-info-circle fa-2x text-warning"></i>
                </div>
                <div class="col-md-11">
                    <strong>Credit Card Processing Fee</strong>
                    <p class="mb-0 small">A 2.9% + $0.30 processing fee will be added to credit card payments. 
                    This fee covers the payment processor charges. To avoid this fee, you can pay via Zelle (fee-free).</p>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Left Column - Membership Selection -->
            <div class="col-lg-7">
                <div class="payment-card">
                    <div class="card-header">
                        <h4 class="mb-0"><i class="fas fa-id-card me-2"></i>Select Membership Type</h4>
                    </div>
                    <div class="card-body p-4">
                        <!-- Executive Board Tiers -->
                        <h5 class="mb-3"><span class="tier-badge eb">Executive Board</span></h5>
                        
                        <div class="membership-tier" data-tier="EB-Family" data-price="340" onclick="selectTier(this)">
                            <div class="row align-items-center">
                                <div class="col-md-6">
                                    <h5 class="mb-1">EB Family Membership</h5>
                                    <small class="text-muted">For EC members with family (spouse + children)</small>
                                </div>
                                <div class="col-md-6 text-md-end">
                                    <span class="price-display">$340</span>
                                    <span class="text-muted">/year</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="membership-tier" data-tier="EB-Couple" data-price="300" onclick="selectTier(this)">
                            <div class="row align-items-center">
                                <div class="col-md-6">
                                    <h5 class="mb-1">EB Couple Membership</h5>
                                    <small class="text-muted">For EC members (couple)</small>
                                </div>
                                <div class="col-md-6 text-md-end">
                                    <span class="price-display">$300</span>
                                    <span class="text-muted">/year</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="membership-tier" data-tier="EB-Individual" data-price="190" onclick="selectTier(this)">
                            <div class="row align-items-center">
                                <div class="col-md-6">
                                    <h5 class="mb-1">EB Individual Membership</h5>
                                    <small class="text-muted">For individual EC members</small>
                                </div>
                                <div class="col-md-6 text-md-end">
                                    <span class="price-display">$190</span>
                                    <span class="text-muted">/year</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="membership-tier" data-tier="EB-Student" data-price="150" onclick="selectTier(this)">
                            <div class="row align-items-center">
                                <div class="col-md-6">
                                    <h5 class="mb-1">EB Student Membership</h5>
                                    <small class="text-muted">For EC student members</small>
                                </div>
                                <div class="col-md-6 text-md-end">
                                    <span class="price-display">$150</span>
                                    <span class="text-muted">/year</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Regular Tiers -->
                        <h5 class="mt-4 mb-3"><span class="tier-badge">Regular Member</span></h5>
                        
                        <div class="membership-tier" data-tier="Reg-Family" data-price="215" onclick="selectTier(this)">
                            <div class="row align-items-center">
                                <div class="col-md-6">
                                    <h5 class="mb-1">Family Membership</h5>
                                    <small class="text-muted">Family with children</small>
                                </div>
                                <div class="col-md-6 text-md-end">
                                    <span class="price-display">$215</span>
                                    <span class="text-muted">/year</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="membership-tier" data-tier="Reg-Couple" data-price="200" onclick="selectTier(this)">
                            <div class="row align-items-center">
                                <div class="col-md-6">
                                    <h5 class="mb-1">Couple Membership</h5>
                                    <small class="text-muted">For couples without children</small>
                                </div>
                                <div class="col-md-6 text-md-end">
                                    <span class="price-display">$200</span>
                                    <span class="text-muted">/year</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column - Payment Summary & Methods -->
            <div class="col-lg-5">
                <div class="payment-card">
                    <div class="card-header">
                        <h4 class="mb-0"><i class="fas fa-receipt me-2"></i>Payment Summary</h4>
                    </div>
                    <div class="card-body p-4">
                        <div id="noSelection" class="text-center text-muted py-4">
                            <i class="fas fa-hand-pointer fa-3x mb-3 opacity-50"></i>
                            <p>Select a membership type to see pricing</p>
                        </div>
                        
                        <div id="paymentSummary" style="display: none;">
                            <h5 id="selectedTierName" class="mb-3">-</h5>
                            
                            <div class="fee-breakdown">
                                <div class="line-item">
                                    <span>Membership Fee</span>
                                    <span id="baseAmount">$0.00</span>
                                </div>
                                <div class="line-item" id="ccFeeRow">
                                    <span>Processing Fee (2.9% + $0.30)</span>
                                    <span id="processingFee">$0.00</span>
                                </div>
                                <div class="line-item total">
                                    <span>Total Amount</span>
                                    <span id="totalAmount">$0.00</span>
                                </div>
                            </div>
                            
                            <!-- Payment Method Tabs -->
                            <ul class="nav payment-method-tabs mt-4" id="paymentTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#creditCard" type="button">
                                        <i class="fas fa-credit-card me-1"></i> Credit Card
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#zelleTab" type="button">
                                        <i class="fas fa-university me-1"></i> Zelle (No Fee)
                                    </button>
                                </li>
                            </ul>
                            
                            <div class="tab-content mt-4" id="paymentTabContent">
                                <!-- Credit Card Tab -->
                                <div class="tab-pane fade show active" id="creditCard" role="tabpanel">
                                    <button class="btn btn-pay w-100" onclick="initiateCardPayment()">
                                        <i class="fas fa-lock me-2"></i>Pay <span id="ccPayAmount">$0.00</span> with Card
                                    </button>
                                    <p class="text-center text-muted small mt-2">
                                        <i class="fas fa-shield-alt me-1"></i>Secured by Wix Payments
                                    </p>
                                </div>
                                
                                <!-- Zelle Tab -->
                                <div class="tab-pane fade" id="zelleTab" role="tabpanel">
                                    <div class="zelle-info">
                                        <div class="zelle-logo">
                                            <i class="fas fa-university"></i>
                                        </div>
                                        <h5>Pay with Zelle - No Processing Fee!</h5>
                                        <p class="mb-3">Send payment to:</p>
                                        <div class="bg-white p-3 rounded mb-3">
                                            <strong>treasurer@jaxbengali.org</strong>
                                        </div>
                                        <p class="small">Amount: <strong id="zelleAmount">$0.00</strong></p>
                                        <hr>
                                        <p class="small text-muted mb-2">After sending payment, enter confirmation code:</p>
                                        <input type="text" class="form-control mb-3" id="zelleConfirmation" placeholder="Zelle Confirmation Code">
                                        <button class="btn btn-zelle w-100" onclick="submitZellePayment()">
                                            <i class="fas fa-check-circle me-2"></i>Confirm Zelle Payment
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal fade" id="successModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title"><i class="fas fa-check-circle me-2"></i>Payment Submitted</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center p-4">
                    <i class="fas fa-check-circle fa-4x text-success mb-3"></i>
                    <h4>Thank You!</h4>
                    <p id="successMessage">Your payment has been submitted successfully.</p>
                    <div class="alert alert-info">
                        <strong>Reference:</strong> <span id="referenceNumber">-</span>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" data-bs-dismiss="modal">Continue</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Payment state
        let selectedTier = null;
        let basePrice = 0;
        
        // CC Fee constants (must match backend)
        const CC_FEE_PERCENTAGE = 2.9;
        const CC_FEE_FIXED = 0.30;
        
        function selectTier(element) {
            // Remove previous selection
            document.querySelectorAll('.membership-tier').forEach(el => {
                el.classList.remove('selected');
            });
            
            // Select new tier
            element.classList.add('selected');
            selectedTier = element.dataset.tier;
            basePrice = parseFloat(element.dataset.price);
            
            // Update UI
            updatePaymentSummary();
        }
        
        function calculateFee(amount) {
            // Calculate total with fee so that base + fee = total
            const totalWithFee = (amount + CC_FEE_FIXED) / (1 - CC_FEE_PERCENTAGE / 100);
            const fee = totalWithFee - amount;
            return {
                base: amount,
                fee: parseFloat(fee.toFixed(2)),
                total: parseFloat(totalWithFee.toFixed(2))
            };
        }
        
        function updatePaymentSummary() {
            document.getElementById('noSelection').style.display = 'none';
            document.getElementById('paymentSummary').style.display = 'block';
            
            document.getElementById('selectedTierName').textContent = selectedTier + ' Membership 2025-26';
            document.getElementById('baseAmount').textContent = '$' + basePrice.toFixed(2);
            
            const pricing = calculateFee(basePrice);
            document.getElementById('processingFee').textContent = '$' + pricing.fee.toFixed(2);
            document.getElementById('totalAmount').textContent = '$' + pricing.total.toFixed(2);
            document.getElementById('ccPayAmount').textContent = '$' + pricing.total.toFixed(2);
            document.getElementById('zelleAmount').textContent = '$' + basePrice.toFixed(2);
        }
        
        async function initiateCardPayment() {
            // This will call the Velo backend
            // In actual Wix implementation, use wixPay.startPayment()
            alert('Card payment would be initiated here via Wix Pay.\n\nTotal: $' + calculateFee(basePrice).total.toFixed(2));
            
            /* Actual Wix Velo code:
            import { createPaymentRequest } from 'backend/payment-processing.jsw';
            import wixPay from 'wix-pay';
            
            const result = await createPaymentRequest({
                amount: basePrice,
                paymentType: selectedTier + ' Membership',
                description: 'BANF Membership 2025-26',
                memberId: currentMember._id,
                memberEmail: currentMember.email,
                memberName: currentMember.name
            });
            
            if (result.success) {
                const paymentResult = await wixPay.startPayment(result.payment.id);
                // Handle result
            }
            */
        }
        
        async function submitZellePayment() {
            const confirmationCode = document.getElementById('zelleConfirmation').value.trim();
            
            if (!confirmationCode) {
                alert('Please enter your Zelle confirmation code');
                return;
            }
            
            if (!selectedTier) {
                alert('Please select a membership type');
                return;
            }
            
            // Show success modal
            document.getElementById('successMessage').textContent = 
                'Your Zelle payment has been submitted for verification. You will receive a confirmation email once verified.';
            document.getElementById('referenceNumber').textContent = 'ZELLE-' + Date.now().toString(36).toUpperCase();
            
            const modal = new bootstrap.Modal(document.getElementById('successModal'));
            modal.show();
            
            /* Actual Wix Velo code:
            import { recordZellePayment } from 'backend/payment-processing.jsw';
            
            const result = await recordZellePayment({
                confirmationCode,
                amount: basePrice,
                paymentType: selectedTier + ' Membership',
                memberId: currentMember._id,
                memberName: currentMember.name,
                memberEmail: currentMember.email
            });
            
            if (result.success) {
                // Show success modal
            }
            */
        }
    </script>
</body>
</html>
